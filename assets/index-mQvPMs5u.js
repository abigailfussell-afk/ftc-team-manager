var kk=Object.defineProperty;var Zb=n=>{throw TypeError(n)};var Tk=(n,e,t)=>e in n?kk(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var W=(n,e,t)=>Tk(n,typeof e!="symbol"?e+"":e,t),l0=(n,e,t)=>e.has(n)||Zb("Cannot "+t);var l=(n,e,t)=>(l0(n,e,"read from private field"),t?t.call(n):e.get(n)),C=(n,e,t)=>e.has(n)?Zb("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),_=(n,e,t,s)=>(l0(n,e,"write to private field"),s?s.call(n,t):e.set(n,t),t),E=(n,e,t)=>(l0(n,e,"access private method"),t);var ot=(n,e,t,s)=>({set _(i){_(n,e,i,t)},get _(){return l(n,e,s)}});import{r as F,a as Nk,g as Ik,R as tA,u as Pk,b as ub,L as Ml,c as Rk,d as Vr,N as ev,H as Mk}from"./vendor-CBr7In39.js";import{c as Dk}from"./supabase-CRHRt2Ih.js";import{s as Tp,d as Lk}from"./charts-CeMqgyHT.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var sA={exports:{}},Og={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fk=F,jk=Symbol.for("react.element"),Ok=Symbol.for("react.fragment"),Uk=Object.prototype.hasOwnProperty,Bk=Fk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Hk={key:!0,ref:!0,__self:!0,__source:!0};function nA(n,e,t){var s,i={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)Uk.call(e,s)&&!Hk.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:jk,type:n,key:r,ref:o,props:i,_owner:Bk.current}}Og.Fragment=Ok;Og.jsx=nA;Og.jsxs=nA;sA.exports=Og;var h=sA.exports,L0={},tv=Nk;L0.createRoot=tv.createRoot,L0.hydrateRoot=tv.hydrateRoot;var Ug=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Gk={setTimeout:(n,e)=>setTimeout(n,e),clearTimeout:n=>clearTimeout(n),setInterval:(n,e)=>setInterval(n,e),clearInterval:n=>clearInterval(n)},Qr,db,$_,qk=($_=class{constructor(){C(this,Qr,Gk);C(this,db,!1)}setTimeoutProvider(n){_(this,Qr,n)}setTimeout(n,e){return l(this,Qr).setTimeout(n,e)}clearTimeout(n){l(this,Qr).clearTimeout(n)}setInterval(n,e){return l(this,Qr).setInterval(n,e)}clearInterval(n){l(this,Qr).clearInterval(n)}},Qr=new WeakMap,db=new WeakMap,$_),F0=new qk;function Vk(n){setTimeout(n,0)}var Bg=typeof window>"u"||"Deno"in globalThis;function In(){}function $k(n,e){return typeof n=="function"?n(e):n}function zk(n){return typeof n=="number"&&n>=0&&n!==1/0}function Wk(n,e){return Math.max(n+(e||0)-Date.now(),0)}function j0(n,e){return typeof n=="function"?n(e):n}function Kk(n,e){return typeof n=="function"?n(e):n}function sv(n,e){const{type:t="all",exact:s,fetchStatus:i,predicate:r,queryKey:o,stale:a}=n;if(o){if(s){if(e.queryHash!==hb(o,e.options))return!1}else if(!ih(e.queryKey,o))return!1}if(t!=="all"){const c=e.isActive();if(t==="active"&&!c||t==="inactive"&&c)return!1}return!(typeof a=="boolean"&&e.isStale()!==a||i&&i!==e.state.fetchStatus||r&&!r(e))}function nv(n,e){const{exact:t,status:s,predicate:i,mutationKey:r}=n;if(r){if(!e.options.mutationKey)return!1;if(t){if(nh(e.options.mutationKey)!==nh(r))return!1}else if(!ih(e.options.mutationKey,r))return!1}return!(s&&e.state.status!==s||i&&!i(e))}function hb(n,e){return((e==null?void 0:e.queryKeyHashFn)||nh)(n)}function nh(n){return JSON.stringify(n,(e,t)=>O0(t)?Object.keys(t).sort().reduce((s,i)=>(s[i]=t[i],s),{}):t)}function ih(n,e){return n===e?!0:typeof n!=typeof e?!1:n&&e&&typeof n=="object"&&typeof e=="object"?Object.keys(e).every(t=>ih(n[t],e[t])):!1}var Yk=Object.prototype.hasOwnProperty;function iA(n,e){if(n===e)return n;const t=iv(n)&&iv(e);if(!t&&!(O0(n)&&O0(e)))return e;const i=(t?n:Object.keys(n)).length,r=t?e:Object.keys(e),o=r.length,a=t?new Array(o):{};let c=0;for(let d=0;d<o;d++){const u=t?d:r[d],m=n[u],p=e[u];if(m===p){a[u]=m,(t?d<i:Yk.call(n,u))&&c++;continue}if(m===null||p===null||typeof m!="object"||typeof p!="object"){a[u]=p;continue}const y=iA(m,p);a[u]=y,y===m&&c++}return i===o&&c===i?n:a}function iv(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function O0(n){if(!rv(n))return!1;const e=n.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!rv(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function rv(n){return Object.prototype.toString.call(n)==="[object Object]"}function Jk(n){return new Promise(e=>{F0.setTimeout(e,n)})}function Xk(n,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(n,e):t.structuralSharing!==!1?iA(n,e):e}function Qk(n,e,t=0){const s=[...n,e];return t&&s.length>t?s.slice(1):s}function Zk(n,e,t=0){const s=[e,...n];return t&&s.length>t?s.slice(0,-1):s}var fb=Symbol();function rA(n,e){return!n.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!n.queryFn||n.queryFn===fb?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}function eT(n,e,t){let s=!1,i;return Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(i??(i=e()),s||(s=!0,i.aborted?t():i.addEventListener("abort",t,{once:!0})),i)}),n}var ha,Zr,wc,z_,tT=(z_=class extends Ug{constructor(){super();C(this,ha);C(this,Zr);C(this,wc);_(this,wc,e=>{if(!Bg&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){l(this,Zr)||this.setEventListener(l(this,wc))}onUnsubscribe(){var e;this.hasListeners()||((e=l(this,Zr))==null||e.call(this),_(this,Zr,void 0))}setEventListener(e){var t;_(this,wc,e),(t=l(this,Zr))==null||t.call(this),_(this,Zr,e(s=>{typeof s=="boolean"?this.setFocused(s):this.onFocus()}))}setFocused(e){l(this,ha)!==e&&(_(this,ha,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof l(this,ha)=="boolean"?l(this,ha):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},ha=new WeakMap,Zr=new WeakMap,wc=new WeakMap,z_),oA=new tT;function sT(){let n,e;const t=new Promise((i,r)=>{n=i,e=r});t.status="pending",t.catch(()=>{});function s(i){Object.assign(t,i),delete t.resolve,delete t.reject}return t.resolve=i=>{s({status:"fulfilled",value:i}),n(i)},t.reject=i=>{s({status:"rejected",reason:i}),e(i)},t}var nT=Vk;function iT(){let n=[],e=0,t=a=>{a()},s=a=>{a()},i=nT;const r=a=>{e?n.push(a):i(()=>{t(a)})},o=()=>{const a=n;n=[],a.length&&i(()=>{s(()=>{a.forEach(c=>{t(c)})})})};return{batch:a=>{let c;e++;try{c=a()}finally{e--,e||o()}return c},batchCalls:a=>(...c)=>{r(()=>{a(...c)})},schedule:r,setNotifyFunction:a=>{t=a},setBatchNotifyFunction:a=>{s=a},setScheduler:a=>{i=a}}}var ps=iT(),_c,eo,Ac,W_,rT=(W_=class extends Ug{constructor(){super();C(this,_c,!0);C(this,eo);C(this,Ac);_(this,Ac,e=>{if(!Bg&&window.addEventListener){const t=()=>e(!0),s=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}})}onSubscribe(){l(this,eo)||this.setEventListener(l(this,Ac))}onUnsubscribe(){var e;this.hasListeners()||((e=l(this,eo))==null||e.call(this),_(this,eo,void 0))}setEventListener(e){var t;_(this,Ac,e),(t=l(this,eo))==null||t.call(this),_(this,eo,e(this.setOnline.bind(this)))}setOnline(e){l(this,_c)!==e&&(_(this,_c,e),this.listeners.forEach(s=>{s(e)}))}isOnline(){return l(this,_c)}},_c=new WeakMap,eo=new WeakMap,Ac=new WeakMap,W_),Gm=new rT;function oT(n){return Math.min(1e3*2**n,3e4)}function aA(n){return(n??"online")==="online"?Gm.isOnline():!0}var U0=class extends Error{constructor(n){super("CancelledError"),this.revert=n==null?void 0:n.revert,this.silent=n==null?void 0:n.silent}};function lA(n){let e=!1,t=0,s;const i=sT(),r=()=>i.status!=="pending",o=x=>{var b;if(!r()){const w=new U0(x);p(w),(b=n.onCancel)==null||b.call(n,w)}},a=()=>{e=!0},c=()=>{e=!1},d=()=>oA.isFocused()&&(n.networkMode==="always"||Gm.isOnline())&&n.canRun(),u=()=>aA(n.networkMode)&&n.canRun(),m=x=>{r()||(s==null||s(),i.resolve(x))},p=x=>{r()||(s==null||s(),i.reject(x))},y=()=>new Promise(x=>{var b;s=w=>{(r()||d())&&x(w)},(b=n.onPause)==null||b.call(n)}).then(()=>{var x;s=void 0,r()||(x=n.onContinue)==null||x.call(n)}),v=()=>{if(r())return;let x;const b=t===0?n.initialPromise:void 0;try{x=b??n.fn()}catch(w){x=Promise.reject(w)}Promise.resolve(x).then(m).catch(w=>{var N;if(r())return;const S=n.retry??(Bg?0:3),A=n.retryDelay??oT,k=typeof A=="function"?A(t,w):A,T=S===!0||typeof S=="number"&&t<S||typeof S=="function"&&S(t,w);if(e||!T){p(w);return}t++,(N=n.onFail)==null||N.call(n,t,w),Jk(k).then(()=>d()?void 0:y()).then(()=>{e?p(w):v()})})};return{promise:i,status:()=>i.status,cancel:o,continue:()=>(s==null||s(),i),cancelRetry:a,continueRetry:c,canStart:u,start:()=>(u()?v():y().then(v),i)}}var fa,K_,cA=(K_=class{constructor(){C(this,fa)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),zk(this.gcTime)&&_(this,fa,F0.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(Bg?1/0:5*60*1e3))}clearGcTimeout(){l(this,fa)&&(F0.clearTimeout(l(this,fa)),_(this,fa,void 0))}},fa=new WeakMap,K_),pa,Sc,rn,ma,It,_h,ga,Pn,ji,Y_,aT=(Y_=class extends cA{constructor(e){super();C(this,Pn);C(this,pa);C(this,Sc);C(this,rn);C(this,ma);C(this,It);C(this,_h);C(this,ga);_(this,ga,!1),_(this,_h,e.defaultOptions),this.setOptions(e.options),this.observers=[],_(this,ma,e.client),_(this,rn,l(this,ma).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,_(this,pa,av(this.options)),this.state=e.state??l(this,pa),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=l(this,It))==null?void 0:e.promise}setOptions(e){if(this.options={...l(this,_h),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=av(this.options);t.data!==void 0&&(this.setState(ov(t.data,t.dataUpdatedAt)),_(this,pa,t))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&l(this,rn).remove(this)}setData(e,t){const s=Xk(this.state.data,e,this.options);return E(this,Pn,ji).call(this,{data:s,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),s}setState(e,t){E(this,Pn,ji).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var s,i;const t=(s=l(this,It))==null?void 0:s.promise;return(i=l(this,It))==null||i.cancel(e),t?t.then(In).catch(In):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(l(this,pa))}isActive(){return this.observers.some(e=>Kk(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===fb||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>j0(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!Wk(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(s=>s.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=l(this,It))==null||t.continue()}onOnline(){var t;const e=this.observers.find(s=>s.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=l(this,It))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),l(this,rn).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(l(this,It)&&(l(this,ga)?l(this,It).cancel({revert:!0}):l(this,It).cancelRetry()),this.scheduleGc()),l(this,rn).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||E(this,Pn,ji).call(this,{type:"invalidate"})}async fetch(e,t){var c,d,u,m,p,y,v,x,b,w,S,A;if(this.state.fetchStatus!=="idle"&&((c=l(this,It))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(l(this,It))return l(this,It).continueRetry(),l(this,It).promise}if(e&&this.setOptions(e),!this.options.queryFn){const k=this.observers.find(T=>T.options.queryFn);k&&this.setOptions(k.options)}const s=new AbortController,i=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(_(this,ga,!0),s.signal)})},r=()=>{const k=rA(this.options,t),N=(()=>{const I={client:l(this,ma),queryKey:this.queryKey,meta:this.meta};return i(I),I})();return _(this,ga,!1),this.options.persister?this.options.persister(k,N,this):k(N)},a=(()=>{const k={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:l(this,ma),state:this.state,fetchFn:r};return i(k),k})();(d=this.options.behavior)==null||d.onFetch(a,this),_(this,Sc,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=a.fetchOptions)==null?void 0:u.meta))&&E(this,Pn,ji).call(this,{type:"fetch",meta:(m=a.fetchOptions)==null?void 0:m.meta}),_(this,It,lA({initialPromise:t==null?void 0:t.initialPromise,fn:a.fetchFn,onCancel:k=>{k instanceof U0&&k.revert&&this.setState({...l(this,Sc),fetchStatus:"idle"}),s.abort()},onFail:(k,T)=>{E(this,Pn,ji).call(this,{type:"failed",failureCount:k,error:T})},onPause:()=>{E(this,Pn,ji).call(this,{type:"pause"})},onContinue:()=>{E(this,Pn,ji).call(this,{type:"continue"})},retry:a.options.retry,retryDelay:a.options.retryDelay,networkMode:a.options.networkMode,canRun:()=>!0}));try{const k=await l(this,It).start();if(k===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(k),(y=(p=l(this,rn).config).onSuccess)==null||y.call(p,k,this),(x=(v=l(this,rn).config).onSettled)==null||x.call(v,k,this.state.error,this),k}catch(k){if(k instanceof U0){if(k.silent)return l(this,It).promise;if(k.revert){if(this.state.data===void 0)throw k;return this.state.data}}throw E(this,Pn,ji).call(this,{type:"error",error:k}),(w=(b=l(this,rn).config).onError)==null||w.call(b,k,this),(A=(S=l(this,rn).config).onSettled)==null||A.call(S,this.state.data,k,this),k}finally{this.scheduleGc()}}},pa=new WeakMap,Sc=new WeakMap,rn=new WeakMap,ma=new WeakMap,It=new WeakMap,_h=new WeakMap,ga=new WeakMap,Pn=new WeakSet,ji=function(e){const t=s=>{switch(e.type){case"failed":return{...s,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...lT(s.data,this.options),fetchMeta:e.meta??null};case"success":const i={...s,...ov(e.data,e.dataUpdatedAt),dataUpdateCount:s.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return _(this,Sc,e.manual?i:void 0),i;case"error":const r=e.error;return{...s,error:r,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:r,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...e.state}}};this.state=t(this.state),ps.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),l(this,rn).notify({query:this,type:"updated",action:e})})},Y_);function lT(n,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:aA(e.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function ov(n,e){return{data:n,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function av(n){const e=typeof n.initialData=="function"?n.initialData():n.initialData,t=e!==void 0,s=t?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}function lv(n){return{onFetch:(e,t)=>{var u,m,p,y,v;const s=e.options,i=(p=(m=(u=e.fetchOptions)==null?void 0:u.meta)==null?void 0:m.fetchMore)==null?void 0:p.direction,r=((y=e.state.data)==null?void 0:y.pages)||[],o=((v=e.state.data)==null?void 0:v.pageParams)||[];let a={pages:[],pageParams:[]},c=0;const d=async()=>{let x=!1;const b=A=>{eT(A,()=>e.signal,()=>x=!0)},w=rA(e.options,e.fetchOptions),S=async(A,k,T)=>{if(x)return Promise.reject();if(k==null&&A.pages.length)return Promise.resolve(A);const I=(()=>{const j={client:e.client,queryKey:e.queryKey,pageParam:k,direction:T?"backward":"forward",meta:e.options.meta};return b(j),j})(),D=await w(I),{maxPages:P}=e.options,R=T?Zk:Qk;return{pages:R(A.pages,D,P),pageParams:R(A.pageParams,k,P)}};if(i&&r.length){const A=i==="backward",k=A?cT:cv,T={pages:r,pageParams:o},N=k(s,T);a=await S(T,N,A)}else{const A=n??r.length;do{const k=c===0?o[0]??s.initialPageParam:cv(s,a);if(c>0&&k==null)break;a=await S(a,k),c++}while(c<A)}return a};e.options.persister?e.fetchFn=()=>{var x,b;return(b=(x=e.options).persister)==null?void 0:b.call(x,d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=d}}}function cv(n,{pages:e,pageParams:t}){const s=e.length-1;return e.length>0?n.getNextPageParam(e[s],e,t[s],t):void 0}function cT(n,{pages:e,pageParams:t}){var s;return e.length>0?(s=n.getPreviousPageParam)==null?void 0:s.call(n,e[0],e,t[0],t):void 0}var Ah,ti,as,ya,si,zr,J_,dT=(J_=class extends cA{constructor(e){super();C(this,si);C(this,Ah);C(this,ti);C(this,as);C(this,ya);_(this,Ah,e.client),this.mutationId=e.mutationId,_(this,as,e.mutationCache),_(this,ti,[]),this.state=e.state||uT(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){l(this,ti).includes(e)||(l(this,ti).push(e),this.clearGcTimeout(),l(this,as).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){_(this,ti,l(this,ti).filter(t=>t!==e)),this.scheduleGc(),l(this,as).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){l(this,ti).length||(this.state.status==="pending"?this.scheduleGc():l(this,as).remove(this))}continue(){var e;return((e=l(this,ya))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var o,a,c,d,u,m,p,y,v,x,b,w,S,A,k,T,N,I,D,P;const t=()=>{E(this,si,zr).call(this,{type:"continue"})},s={client:l(this,Ah),meta:this.options.meta,mutationKey:this.options.mutationKey};_(this,ya,lA({fn:()=>this.options.mutationFn?this.options.mutationFn(e,s):Promise.reject(new Error("No mutationFn found")),onFail:(R,j)=>{E(this,si,zr).call(this,{type:"failed",failureCount:R,error:j})},onPause:()=>{E(this,si,zr).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>l(this,as).canRun(this)}));const i=this.state.status==="pending",r=!l(this,ya).canStart();try{if(i)t();else{E(this,si,zr).call(this,{type:"pending",variables:e,isPaused:r}),await((a=(o=l(this,as).config).onMutate)==null?void 0:a.call(o,e,this,s));const j=await((d=(c=this.options).onMutate)==null?void 0:d.call(c,e,s));j!==this.state.context&&E(this,si,zr).call(this,{type:"pending",context:j,variables:e,isPaused:r})}const R=await l(this,ya).start();return await((m=(u=l(this,as).config).onSuccess)==null?void 0:m.call(u,R,e,this.state.context,this,s)),await((y=(p=this.options).onSuccess)==null?void 0:y.call(p,R,e,this.state.context,s)),await((x=(v=l(this,as).config).onSettled)==null?void 0:x.call(v,R,null,this.state.variables,this.state.context,this,s)),await((w=(b=this.options).onSettled)==null?void 0:w.call(b,R,null,e,this.state.context,s)),E(this,si,zr).call(this,{type:"success",data:R}),R}catch(R){try{await((A=(S=l(this,as).config).onError)==null?void 0:A.call(S,R,e,this.state.context,this,s))}catch(j){Promise.reject(j)}try{await((T=(k=this.options).onError)==null?void 0:T.call(k,R,e,this.state.context,s))}catch(j){Promise.reject(j)}try{await((I=(N=l(this,as).config).onSettled)==null?void 0:I.call(N,void 0,R,this.state.variables,this.state.context,this,s))}catch(j){Promise.reject(j)}try{await((P=(D=this.options).onSettled)==null?void 0:P.call(D,void 0,R,e,this.state.context,s))}catch(j){Promise.reject(j)}throw E(this,si,zr).call(this,{type:"error",error:R}),R}finally{l(this,as).runNext(this)}}},Ah=new WeakMap,ti=new WeakMap,as=new WeakMap,ya=new WeakMap,si=new WeakSet,zr=function(e){const t=s=>{switch(e.type){case"failed":return{...s,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...s,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:e.error,failureCount:s.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),ps.batch(()=>{l(this,ti).forEach(s=>{s.onMutationUpdate(e)}),l(this,as).notify({mutation:this,type:"updated",action:e})})},J_);function uT(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var $i,Rn,Sh,X_,hT=(X_=class extends Ug{constructor(e={}){super();C(this,$i);C(this,Rn);C(this,Sh);this.config=e,_(this,$i,new Set),_(this,Rn,new Map),_(this,Sh,0)}build(e,t,s){const i=new dT({client:e,mutationCache:this,mutationId:++ot(this,Sh)._,options:e.defaultMutationOptions(t),state:s});return this.add(i),i}add(e){l(this,$i).add(e);const t=Np(e);if(typeof t=="string"){const s=l(this,Rn).get(t);s?s.push(e):l(this,Rn).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(l(this,$i).delete(e)){const t=Np(e);if(typeof t=="string"){const s=l(this,Rn).get(t);if(s)if(s.length>1){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}else s[0]===e&&l(this,Rn).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Np(e);if(typeof t=="string"){const s=l(this,Rn).get(t),i=s==null?void 0:s.find(r=>r.state.status==="pending");return!i||i===e}else return!0}runNext(e){var s;const t=Np(e);if(typeof t=="string"){const i=(s=l(this,Rn).get(t))==null?void 0:s.find(r=>r!==e&&r.state.isPaused);return(i==null?void 0:i.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ps.batch(()=>{l(this,$i).forEach(e=>{this.notify({type:"removed",mutation:e})}),l(this,$i).clear(),l(this,Rn).clear()})}getAll(){return Array.from(l(this,$i))}find(e){const t={exact:!0,...e};return this.getAll().find(s=>nv(t,s))}findAll(e={}){return this.getAll().filter(t=>nv(e,t))}notify(e){ps.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return ps.batch(()=>Promise.all(e.map(t=>t.continue().catch(In))))}},$i=new WeakMap,Rn=new WeakMap,Sh=new WeakMap,X_);function Np(n){var e;return(e=n.options.scope)==null?void 0:e.id}var ni,Q_,fT=(Q_=class extends Ug{constructor(e={}){super();C(this,ni);this.config=e,_(this,ni,new Map)}build(e,t,s){const i=t.queryKey,r=t.queryHash??hb(i,t);let o=this.get(r);return o||(o=new aT({client:e,queryKey:i,queryHash:r,options:e.defaultQueryOptions(t),state:s,defaultOptions:e.getQueryDefaults(i)}),this.add(o)),o}add(e){l(this,ni).has(e.queryHash)||(l(this,ni).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=l(this,ni).get(e.queryHash);t&&(e.destroy(),t===e&&l(this,ni).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){ps.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return l(this,ni).get(e)}getAll(){return[...l(this,ni).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(s=>sv(t,s))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(s=>sv(e,s)):t}notify(e){ps.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){ps.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){ps.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ni=new WeakMap,Q_),at,to,so,Cc,Ec,no,kc,Tc,Z_,pT=(Z_=class{constructor(n={}){C(this,at);C(this,to);C(this,so);C(this,Cc);C(this,Ec);C(this,no);C(this,kc);C(this,Tc);_(this,at,n.queryCache||new fT),_(this,to,n.mutationCache||new hT),_(this,so,n.defaultOptions||{}),_(this,Cc,new Map),_(this,Ec,new Map),_(this,no,0)}mount(){ot(this,no)._++,l(this,no)===1&&(_(this,kc,oA.subscribe(async n=>{n&&(await this.resumePausedMutations(),l(this,at).onFocus())})),_(this,Tc,Gm.subscribe(async n=>{n&&(await this.resumePausedMutations(),l(this,at).onOnline())})))}unmount(){var n,e;ot(this,no)._--,l(this,no)===0&&((n=l(this,kc))==null||n.call(this),_(this,kc,void 0),(e=l(this,Tc))==null||e.call(this),_(this,Tc,void 0))}isFetching(n){return l(this,at).findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return l(this,to).findAll({...n,status:"pending"}).length}getQueryData(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=l(this,at).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(n){const e=this.defaultQueryOptions(n),t=l(this,at).build(this,e),s=t.state.data;return s===void 0?this.fetchQuery(n):(n.revalidateIfStale&&t.isStaleByTime(j0(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(s))}getQueriesData(n){return l(this,at).findAll(n).map(({queryKey:e,state:t})=>{const s=t.data;return[e,s]})}setQueryData(n,e,t){const s=this.defaultQueryOptions({queryKey:n}),i=l(this,at).get(s.queryHash),r=i==null?void 0:i.state.data,o=$k(e,r);if(o!==void 0)return l(this,at).build(this,s).setData(o,{...t,manual:!0})}setQueriesData(n,e,t){return ps.batch(()=>l(this,at).findAll(n).map(({queryKey:s})=>[s,this.setQueryData(s,e,t)]))}getQueryState(n){var t;const e=this.defaultQueryOptions({queryKey:n});return(t=l(this,at).get(e.queryHash))==null?void 0:t.state}removeQueries(n){const e=l(this,at);ps.batch(()=>{e.findAll(n).forEach(t=>{e.remove(t)})})}resetQueries(n,e){const t=l(this,at);return ps.batch(()=>(t.findAll(n).forEach(s=>{s.reset()}),this.refetchQueries({type:"active",...n},e)))}cancelQueries(n,e={}){const t={revert:!0,...e},s=ps.batch(()=>l(this,at).findAll(n).map(i=>i.cancel(t)));return Promise.all(s).then(In).catch(In)}invalidateQueries(n,e={}){return ps.batch(()=>(l(this,at).findAll(n).forEach(t=>{t.invalidate()}),(n==null?void 0:n.refetchType)==="none"?Promise.resolve():this.refetchQueries({...n,type:(n==null?void 0:n.refetchType)??(n==null?void 0:n.type)??"active"},e)))}refetchQueries(n,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},s=ps.batch(()=>l(this,at).findAll(n).filter(i=>!i.isDisabled()&&!i.isStatic()).map(i=>{let r=i.fetch(void 0,t);return t.throwOnError||(r=r.catch(In)),i.state.fetchStatus==="paused"?Promise.resolve():r}));return Promise.all(s).then(In)}fetchQuery(n){const e=this.defaultQueryOptions(n);e.retry===void 0&&(e.retry=!1);const t=l(this,at).build(this,e);return t.isStaleByTime(j0(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(In).catch(In)}fetchInfiniteQuery(n){return n.behavior=lv(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(In).catch(In)}ensureInfiniteQueryData(n){return n.behavior=lv(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return Gm.isOnline()?l(this,to).resumePausedMutations():Promise.resolve()}getQueryCache(){return l(this,at)}getMutationCache(){return l(this,to)}getDefaultOptions(){return l(this,so)}setDefaultOptions(n){_(this,so,n)}setQueryDefaults(n,e){l(this,Cc).set(nh(n),{queryKey:n,defaultOptions:e})}getQueryDefaults(n){const e=[...l(this,Cc).values()],t={};return e.forEach(s=>{ih(n,s.queryKey)&&Object.assign(t,s.defaultOptions)}),t}setMutationDefaults(n,e){l(this,Ec).set(nh(n),{mutationKey:n,defaultOptions:e})}getMutationDefaults(n){const e=[...l(this,Ec).values()],t={};return e.forEach(s=>{ih(n,s.mutationKey)&&Object.assign(t,s.defaultOptions)}),t}defaultQueryOptions(n){if(n._defaulted)return n;const e={...l(this,so).queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return e.queryHash||(e.queryHash=hb(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===fb&&(e.enabled=!1),e}defaultMutationOptions(n){return n!=null&&n._defaulted?n:{...l(this,so).mutations,...(n==null?void 0:n.mutationKey)&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){l(this,at).clear(),l(this,to).clear()}},at=new WeakMap,to=new WeakMap,so=new WeakMap,Cc=new WeakMap,Ec=new WeakMap,no=new WeakMap,kc=new WeakMap,Tc=new WeakMap,Z_),mT=F.createContext(void 0),gT=({client:n,children:e})=>(F.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),h.jsx(mT.Provider,{value:n,children:e}));const Hg="https://cvnonrjzshaawzxcjwmn.supabase.co",tu="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2bm9ucmp6c2hhYXd6eGNqd21uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczODM0MjQsImV4cCI6MjA4Mjk1OTQyNH0._Qx-efsymzv9R2WpvqcuuxDbz0GeugueEgSPIEM7Cn0",z=Dk(Hg,tu,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),bn=()=>!!z,yT=Object.freeze(Object.defineProperty({__proto__:null,isSupabaseConfigured:bn,supabase:z,supabaseAnonKey:tu,supabaseUrl:Hg},Symbol.toStringTag,{value:"Module"})),Qe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,vt=Object.keys,ns=Array.isArray;function xs(n,e){return typeof e!="object"||vt(e).forEach(function(t){n[t]=e[t]}),n}typeof Promise>"u"||Qe.Promise||(Qe.Promise=Promise);const rh=Object.getPrototypeOf,xT={}.hasOwnProperty;function en(n,e){return xT.call(n,e)}function su(n,e){typeof e=="function"&&(e=e(rh(n))),(typeof Reflect>"u"?vt:Reflect.ownKeys)(e).forEach(t=>{Ir(n,t,e[t])})}const dA=Object.defineProperty;function Ir(n,e,t,s){dA(n,e,xs(t&&en(t,"get")&&typeof t.get=="function"?{get:t.get,set:t.set,configurable:!0}:{value:t,configurable:!0,writable:!0},s))}function pc(n){return{from:function(e){return n.prototype=Object.create(e.prototype),Ir(n.prototype,"constructor",n),{extend:su.bind(null,n.prototype)}}}}const bT=Object.getOwnPropertyDescriptor;function pb(n,e){let t;return bT(n,e)||(t=rh(n))&&pb(t,e)}const vT=[].slice;function qm(n,e,t){return vT.call(n,e,t)}function uA(n,e){return e(n)}function Su(n){if(!n)throw new Error("Assertion Failed")}function hA(n){Qe.setImmediate?setImmediate(n):setTimeout(n,0)}function fA(n,e){return n.reduce((t,s,i)=>{var r=e(s,i);return r&&(t[r[0]]=r[1]),t},{})}function Pr(n,e){if(typeof e=="string"&&en(n,e))return n[e];if(!e)return n;if(typeof e!="string"){for(var t=[],s=0,i=e.length;s<i;++s){var r=Pr(n,e[s]);t.push(r)}return t}var o=e.indexOf(".");if(o!==-1){var a=n[e.substr(0,o)];return a==null?void 0:Pr(a,e.substr(o+1))}}function zn(n,e,t){if(n&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(n)))if(typeof e!="string"&&"length"in e){Su(typeof t!="string"&&"length"in t);for(var s=0,i=e.length;s<i;++s)zn(n,e[s],t[s])}else{var r=e.indexOf(".");if(r!==-1){var o=e.substr(0,r),a=e.substr(r+1);if(a==="")t===void 0?ns(n)&&!isNaN(parseInt(o))?n.splice(o,1):delete n[o]:n[o]=t;else{var c=n[o];c&&en(n,o)||(c=n[o]={}),zn(c,a,t)}}else t===void 0?ns(n)&&!isNaN(parseInt(e))?n.splice(e,1):delete n[e]:n[e]=t}}function pA(n){var e={};for(var t in n)en(n,t)&&(e[t]=n[t]);return e}const wT=[].concat;function mA(n){return wT.apply([],n)}const gA="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(mA([8,16,32,64].map(n=>["Int","Uint","Float"].map(e=>e+n+"Array")))).filter(n=>Qe[n]),_T=gA.map(n=>Qe[n]);fA(gA,n=>[n,!0]);let Yr=null;function gp(n){Yr=typeof WeakMap<"u"&&new WeakMap;const e=B0(n);return Yr=null,e}function B0(n){if(!n||typeof n!="object")return n;let e=Yr&&Yr.get(n);if(e)return e;if(ns(n)){e=[],Yr&&Yr.set(n,e);for(var t=0,s=n.length;t<s;++t)e.push(B0(n[t]))}else if(_T.indexOf(n.constructor)>=0)e=n;else{const r=rh(n);for(var i in e=r===Object.prototype?{}:Object.create(r),Yr&&Yr.set(n,e),n)en(n,i)&&(e[i]=B0(n[i]))}return e}const{toString:AT}={};function H0(n){return AT.call(n).slice(8,-1)}const G0=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ST=typeof G0=="symbol"?function(n){var e;return n!=null&&(e=n[G0])&&e.apply(n)}:function(){return null},Jl={};function Er(n){var e,t,s,i;if(arguments.length===1){if(ns(n))return n.slice();if(this===Jl&&typeof n=="string")return[n];if(i=ST(n)){for(t=[];!(s=i.next()).done;)t.push(s.value);return t}if(n==null)return[n];if(typeof(e=n.length)=="number"){for(t=new Array(e);e--;)t[e]=n[e];return t}return[n]}for(e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return t}const mb=typeof Symbol<"u"?n=>n[Symbol.toStringTag]==="AsyncFunction":()=>!1;var Di=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function yA(n,e){Di=n,xA=e}var xA=()=>!0;const CT=!new Error("").stack;function Gl(){if(CT)try{throw Gl.arguments,new Error}catch(n){return n}return new Error}function q0(n,e){var t=n.stack;return t?(e=e||0,t.indexOf(n.name)===0&&(e+=(n.name+n.message).split(`
`).length),t.split(`
`).slice(e).filter(xA).map(s=>`
`+s).join("")):""}var bA=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],gb=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(bA),ET={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function mc(n,e){this._e=Gl(),this.name=n,this.message=e}function vA(n,e){return n+". Errors: "+Object.keys(e).map(t=>e[t].toString()).filter((t,s,i)=>i.indexOf(t)===s).join(`
`)}function Vm(n,e,t,s){this._e=Gl(),this.failures=e,this.failedKeys=s,this.successCount=t,this.message=vA(n,e)}function Ju(n,e){this._e=Gl(),this.name="BulkError",this.failures=Object.keys(e).map(t=>e[t]),this.failuresByPos=e,this.message=vA(n,e)}pc(mc).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+q0(this._e,2))}},toString:function(){return this.name+": "+this.message}}),pc(Vm).from(mc),pc(Ju).from(mc);var yb=gb.reduce((n,e)=>(n[e]=e+"Error",n),{});const kT=mc;var de=gb.reduce((n,e)=>{var t=e+"Error";function s(i,r){this._e=Gl(),this.name=t,i?typeof i=="string"?(this.message=`${i}${r?`
 `+r:""}`,this.inner=r||null):typeof i=="object"&&(this.message=`${i.name} ${i.message}`,this.inner=i):(this.message=ET[e]||t,this.inner=null)}return pc(s).from(kT),n[e]=s,n},{});de.Syntax=SyntaxError,de.Type=TypeError,de.Range=RangeError;var dv=bA.reduce((n,e)=>(n[e+"Error"]=de[e],n),{}),Qp=gb.reduce((n,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(n[e+"Error"]=de[e]),n),{});function $e(){}function oh(n){return n}function TT(n,e){return n==null||n===oh?e:function(t){return e(n(t))}}function jl(n,e){return function(){n.apply(this,arguments),e.apply(this,arguments)}}function NT(n,e){return n===$e?e:function(){var t=n.apply(this,arguments);t!==void 0&&(arguments[0]=t);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var r=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?jl(s,this.onsuccess):s),i&&(this.onerror=this.onerror?jl(i,this.onerror):i),r!==void 0?r:t}}function IT(n,e){return n===$e?e:function(){n.apply(this,arguments);var t=this.onsuccess,s=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),t&&(this.onsuccess=this.onsuccess?jl(t,this.onsuccess):t),s&&(this.onerror=this.onerror?jl(s,this.onerror):s)}}function PT(n,e){return n===$e?e:function(t){var s=n.apply(this,arguments);xs(t,s);var i=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?jl(i,this.onsuccess):i),r&&(this.onerror=this.onerror?jl(r,this.onerror):r),s===void 0?o===void 0?void 0:o:xs(s,o)}}function RT(n,e){return n===$e?e:function(){return e.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function xb(n,e){return n===$e?e:function(){var t=n.apply(this,arguments);if(t&&typeof t.then=="function"){for(var s=this,i=arguments.length,r=new Array(i);i--;)r[i]=arguments[i];return t.then(function(){return e.apply(s,r)})}return e.apply(this,arguments)}}Qp.ModifyError=Vm,Qp.DexieError=mc,Qp.BulkError=Ju;var ah={};const wA=100,[V0,$m,$0]=typeof Promise>"u"?[]:(()=>{let n=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[n,rh(n),n];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,rh(e),n]})(),_A=$m&&$m.then,Zp=V0&&V0.constructor,bb=!!$0;var z0=!1,MT=$0?()=>{$0.then(Ip)}:Qe.setImmediate?setImmediate.bind(null,Ip):Qe.MutationObserver?()=>{var n=document.createElement("div");new MutationObserver(()=>{Ip(),n=null}).observe(n,{attributes:!0}),n.setAttribute("i","1")}:()=>{setTimeout(Ip,0)},Xu=function(n,e){Cu.push([n,e]),zm&&(MT(),zm=!1)},W0=!0,zm=!0,Dl=[],em=[],K0=null,Y0=oh,gc={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:fv,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(n=>{try{fv(n[0],n[1])}catch{}})}},ae=gc,Cu=[],Ll=0,tm=[];function ne(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=$e,this._lib=!1;var e=this._PSD=ae;if(Di&&(this._stackHolder=Gl(),this._prev=null,this._numPrev=0),typeof n!="function"){if(n!==ah)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&X0(this,this._value))}this._state=null,this._value=null,++e.ref,SA(this,n)}const J0={get:function(){var n=ae,e=Wm;function t(s,i){var r=!n.global&&(n!==ae||e!==Wm);const o=r&&!Fr();var a=new ne((c,d)=>{vb(this,new AA(Km(s,n,r,o),Km(i,n,r,o),c,d,n))});return Di&&kA(a,this),a}return t.prototype=ah,t},set:function(n){Ir(this,"then",n&&n.prototype===ah?J0:{get:function(){return n},set:J0.set})}};function AA(n,e,t,s,i){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof e=="function"?e:null,this.resolve=t,this.reject=s,this.psd=i}function SA(n,e){try{e(t=>{if(n._state===null){if(t===n)throw new TypeError("A promise cannot be resolved with itself.");var s=n._lib&&yp();t&&typeof t.then=="function"?SA(n,(i,r)=>{t instanceof ne?t._then(i,r):t.then(i,r)}):(n._state=!0,n._value=t,CA(n)),s&&xp()}},X0.bind(null,n))}catch(t){X0(n,t)}}function X0(n,e){if(em.push(e),n._state===null){var t=n._lib&&yp();e=Y0(e),n._state=!1,n._value=e,Di&&e!==null&&typeof e=="object"&&!e._promise&&function(s,i,r){try{s.apply(null,r)}catch{}}(()=>{var s=pb(e,"stack");e._promise=n,Ir(e,"stack",{get:()=>z0?s&&(s.get?s.get.apply(e):s.value):n.stack})}),function(s){Dl.some(i=>i._value===s._value)||Dl.push(s)}(n),CA(n),t&&xp()}}function CA(n){var e=n._listeners;n._listeners=[];for(var t=0,s=e.length;t<s;++t)vb(n,e[t]);var i=n._PSD;--i.ref||i.finalize(),Ll===0&&(++Ll,Xu(()=>{--Ll==0&&wb()},[]))}function vb(n,e){if(n._state!==null){var t=n._state?e.onFulfilled:e.onRejected;if(t===null)return(n._state?e.resolve:e.reject)(n._value);++e.psd.ref,++Ll,Xu(DT,[t,n,e])}else n._listeners.push(e)}function DT(n,e,t){try{K0=e;var s,i=e._value;e._state?s=n(i):(em.length&&(em=[]),s=n(i),em.indexOf(i)===-1&&function(r){for(var o=Dl.length;o;)if(Dl[--o]._value===r._value)return void Dl.splice(o,1)}(e)),t.resolve(s)}catch(r){t.reject(r)}finally{K0=null,--Ll==0&&wb(),--t.psd.ref||t.psd.finalize()}}function EA(n,e,t){if(e.length===t)return e;var s="";if(n._state===!1){var i,r,o=n._value;o!=null?(i=o.name||"Error",r=o.message||o,s=q0(o,0)):(i=o,r=""),e.push(i+(r?": "+r:"")+s)}return Di&&((s=q0(n._stackHolder,2))&&e.indexOf(s)===-1&&e.push(s),n._prev&&EA(n._prev,e,t)),e}function kA(n,e){var t=e?e._numPrev+1:0;t<100&&(n._prev=e,n._numPrev=t)}function Ip(){yp()&&xp()}function yp(){var n=W0;return W0=!1,zm=!1,n}function xp(){var n,e,t;do for(;Cu.length>0;)for(n=Cu,Cu=[],t=n.length,e=0;e<t;++e){var s=n[e];s[0].apply(null,s[1])}while(Cu.length>0);W0=!0,zm=!0}function wb(){var n=Dl;Dl=[],n.forEach(s=>{s._PSD.onunhandled.call(null,s._value,s)});for(var e=tm.slice(0),t=e.length;t;)e[--t]()}function Pp(n){return new ne(ah,!1,n)}function st(n,e){var t=ae;return function(){var s=yp(),i=ae;try{return Xo(t,!0),n.apply(this,arguments)}catch(r){e&&e(r)}finally{Xo(i,!1),s&&xp()}}}su(ne.prototype,{then:J0,_then:function(n,e){vb(this,new AA(null,null,n,e,ae))},catch:function(n){if(arguments.length===1)return this.then(null,n);var e=arguments[0],t=arguments[1];return typeof e=="function"?this.then(null,s=>s instanceof e?t(s):Pp(s)):this.then(null,s=>s&&s.name===e?t(s):Pp(s))},finally:function(n){return this.then(e=>(n(),e),e=>(n(),Pp(e)))},stack:{get:function(){if(this._stack)return this._stack;try{z0=!0;var n=EA(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=n),n}finally{z0=!1}}},timeout:function(n,e){return n<1/0?new ne((t,s)=>{var i=setTimeout(()=>s(new de.Timeout(e)),n);this.then(t,s).finally(clearTimeout.bind(null,i))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Ir(ne.prototype,Symbol.toStringTag,"Dexie.Promise"),gc.env=TA(),su(ne,{all:function(){var n=Er.apply(null,arguments).map(Rp);return new ne(function(e,t){n.length===0&&e([]);var s=n.length;n.forEach((i,r)=>ne.resolve(i).then(o=>{n[r]=o,--s||e(n)},t))})},resolve:n=>{if(n instanceof ne)return n;if(n&&typeof n.then=="function")return new ne((t,s)=>{n.then(t,s)});var e=new ne(ah,!0,n);return kA(e,K0),e},reject:Pp,race:function(){var n=Er.apply(null,arguments).map(Rp);return new ne((e,t)=>{n.map(s=>ne.resolve(s).then(e,t))})},PSD:{get:()=>ae,set:n=>ae=n},totalEchoes:{get:()=>Wm},newPSD:Jo,usePSD:lu,scheduler:{get:()=>Xu,set:n=>{Xu=n}},rejectionMapper:{get:()=>Y0,set:n=>{Y0=n}},follow:(n,e)=>new ne((t,s)=>Jo((i,r)=>{var o=ae;o.unhandleds=[],o.onunhandled=r,o.finalize=jl(function(){(function(a){function c(){a(),tm.splice(tm.indexOf(c),1)}tm.push(c),++Ll,Xu(()=>{--Ll==0&&wb()},[])})(()=>{this.unhandleds.length===0?i():r(this.unhandleds[0])})},o.finalize),n()},e,t,s))}),Zp&&(Zp.allSettled&&Ir(ne,"allSettled",function(){const n=Er.apply(null,arguments).map(Rp);return new ne(e=>{n.length===0&&e([]);let t=n.length;const s=new Array(t);n.forEach((i,r)=>ne.resolve(i).then(o=>s[r]={status:"fulfilled",value:o},o=>s[r]={status:"rejected",reason:o}).then(()=>--t||e(s)))})}),Zp.any&&typeof AggregateError<"u"&&Ir(ne,"any",function(){const n=Er.apply(null,arguments).map(Rp);return new ne((e,t)=>{n.length===0&&t(new AggregateError([]));let s=n.length;const i=new Array(s);n.forEach((r,o)=>ne.resolve(r).then(a=>e(a),a=>{i[o]=a,--s||t(new AggregateError(i))}))})}));const ss={awaits:0,echoes:0,id:0};var LT=0,sm=[],c0=0,Wm=0,FT=0;function Jo(n,e,t,s){var i=ae,r=Object.create(i);r.parent=i,r.ref=0,r.global=!1,r.id=++FT;var o=gc.env;r.env=bb?{Promise:ne,PromiseProp:{value:ne,configurable:!0,writable:!0},all:ne.all,race:ne.race,allSettled:ne.allSettled,any:ne.any,resolve:ne.resolve,reject:ne.reject,nthen:uv(o.nthen,r),gthen:uv(o.gthen,r)}:{},e&&xs(r,e),++i.ref,r.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=lu(r,n,t,s);return r.ref===0&&r.finalize(),a}function au(){return ss.id||(ss.id=++LT),++ss.awaits,ss.echoes+=wA,ss.id}function Fr(){return!!ss.awaits&&(--ss.awaits==0&&(ss.id=0),ss.echoes=ss.awaits*wA,!0)}function Rp(n){return ss.echoes&&n&&n.constructor===Zp?(au(),n.then(e=>(Fr(),e),e=>(Fr(),kt(e)))):n}function jT(n){++Wm,ss.echoes&&--ss.echoes!=0||(ss.echoes=ss.id=0),sm.push(ae),Xo(n,!0)}function OT(){var n=sm[sm.length-1];sm.pop(),Xo(n,!1)}function Xo(n,e){var t=ae;if((e?!ss.echoes||c0++&&n===ae:!c0||--c0&&n===ae)||NA(e?jT.bind(null,n):OT),n!==ae&&(ae=n,t===gc&&(gc.env=TA()),bb)){var s=gc.env.Promise,i=n.env;$m.then=i.nthen,s.prototype.then=i.gthen,(t.global||n.global)&&(Object.defineProperty(Qe,"Promise",i.PromiseProp),s.all=i.all,s.race=i.race,s.resolve=i.resolve,s.reject=i.reject,i.allSettled&&(s.allSettled=i.allSettled),i.any&&(s.any=i.any))}}function TA(){var n=Qe.Promise;return bb?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(Qe,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject,nthen:$m.then,gthen:n.prototype.then}:{}}function lu(n,e,t,s,i){var r=ae;try{return Xo(n,!0),e(t,s,i)}finally{Xo(r,!1)}}function NA(n){_A.call(V0,n)}function Km(n,e,t,s){return typeof n!="function"?n:function(){var i=ae;t&&au(),Xo(e,!0);try{return n.apply(this,arguments)}finally{Xo(i,!1),s&&NA(Fr)}}}function uv(n,e){return function(t,s){return n.call(this,Km(t,e),Km(s,e))}}(""+_A).indexOf("[native code]")===-1&&(au=Fr=$e);const hv="unhandledrejection";function fv(n,e){var t;try{t=e.onuncatched(n)}catch{}if(t!==!1)try{var s,i={promise:e,reason:n};if(Qe.document&&document.createEvent?((s=document.createEvent("Event")).initEvent(hv,!0,!0),xs(s,i)):Qe.CustomEvent&&xs(s=new CustomEvent(hv,{detail:i}),i),s&&Qe.dispatchEvent&&(dispatchEvent(s),!Qe.PromiseRejectionEvent&&Qe.onunhandledrejection))try{Qe.onunhandledrejection(s)}catch{}Di&&s&&!s.defaultPrevented&&console.warn(`Unhandled rejection: ${n.stack||n}`)}catch{}}var kt=ne.reject;function Q0(n,e,t,s){if(n.idbdb&&(n._state.openComplete||ae.letThrough||n._vip)){var i=n._createTransaction(e,t,n._dbSchema);try{i.create(),n._state.PR1398_maxLoop=3}catch(r){return r.name===yb.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>Q0(n,e,t,s))):kt(r)}return i._promise(e,(r,o)=>Jo(()=>(ae.trans=i,s(r,o,i)))).then(r=>i._completion.then(()=>r))}if(n._state.openComplete)return kt(new de.DatabaseClosed(n._state.dbOpenError));if(!n._state.isBeingOpened){if(!n._options.autoOpen)return kt(new de.DatabaseClosed);n.open().catch($e)}return n._state.dbReadyPromise.then(()=>Q0(n,e,t,s))}const pv="3.2.7",ua="ï¿¿",Z0=-1/0,Li="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",IA="String expected.",Qu=[],Gg=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),UT=Gg,BT=Gg,PA=n=>!/(dexie\.js|dexie\.min\.js)/.test(n),qg="__dbnames",d0="readonly",u0="readwrite";function Ol(n,e){return n?e?function(){return n.apply(this,arguments)&&e.apply(this,arguments)}:n:e}const RA={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Mp(n){return typeof n!="string"||/\./.test(n)?e=>e:e=>(e[n]===void 0&&n in e&&delete(e=gp(e))[n],e)}class HT{_trans(e,t,s){const i=this._tx||ae.trans,r=this.name;function o(c,d,u){if(!u.schema[r])throw new de.NotFound("Table "+r+" not part of transaction");return t(u.idbtrans,u)}const a=yp();try{return i&&i.db===this.db?i===ae.trans?i._promise(e,o,s):Jo(()=>i._promise(e,o,s),{trans:i,transless:ae.transless||ae}):Q0(this.db,e,[this.name],o)}finally{a&&xp()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",s=>this.core.get({trans:s,key:e}).then(i=>this.hook.reading.fire(i))).then(t)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ns(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=vt(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);const s=this.schema.indexes.concat(this.schema.primKey).filter(d=>{if(d.compound&&t.every(u=>d.keyPath.indexOf(u)>=0)){for(let u=0;u<t.length;++u)if(t.indexOf(d.keyPath[u])===-1)return!1;return!0}return!1}).sort((d,u)=>d.keyPath.length-u.keyPath.length)[0];if(s&&this.db._maxKey!==ua){const d=s.keyPath.slice(0,t.length);return this.where(d).equals(d.map(u=>e[u]))}!s&&Di&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:i}=this.schema,r=this.db._deps.indexedDB;function o(d,u){try{return r.cmp(d,u)===0}catch{return!1}}const[a,c]=t.reduce(([d,u],m)=>{const p=i[m],y=e[m];return[d||p,d||!p?Ol(u,p&&p.multi?v=>{const x=Pr(v,m);return ns(x)&&x.some(b=>o(y,b))}:v=>o(y,Pr(v,m))):u]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(c):s?this.filter(c):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ns(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=s=>{if(!s)return s;const i=Object.create(e.prototype);for(var r in s)if(en(s,r))try{i[r]=s[r]}catch{}return i};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass(function(e){xs(this,e)})}add(e,t){const{auto:s,keyPath:i}=this.schema.primKey;let r=e;return i&&s&&(r=Mp(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:t!=null?[t]:null,values:[r]})).then(o=>o.numFailures?ne.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{zn(e,i,o)}catch{}return o})}update(e,t){if(typeof e!="object"||ns(e))return this.where(":id").equals(e).modify(t);{const s=Pr(e,this.schema.primKey.keyPath);if(s===void 0)return kt(new de.InvalidArgument("Given object does not contain its primary key"));try{typeof t!="function"?vt(t).forEach(i=>{zn(e,i,t[i])}):t(e,{value:e,primKey:s})}catch{}return this.where(":id").equals(s).modify(t)}}put(e,t){const{auto:s,keyPath:i}=this.schema.primKey;let r=e;return i&&s&&(r=Mp(i)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[r],keys:t!=null?[t]:null})).then(o=>o.numFailures?ne.reject(o.failures[0]):o.lastResult).then(o=>{if(i)try{zn(e,i,o)}catch{}return o})}delete(e){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"delete",keys:[e]})).then(t=>t.numFailures?ne.reject(t.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:RA})).then(e=>e.numFailures?ne.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",t=>this.core.getMany({keys:e,trans:t}).then(s=>s.map(i=>this.hook.reading.fire(i))))}bulkAdd(e,t,s){const i=Array.isArray(t)?t:void 0,r=(s=s||(i?void 0:t))?s.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new de.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let u=c&&a?e.map(Mp(c)):e;return this.core.mutate({trans:o,type:"add",keys:i,values:u,wantResults:r}).then(({numFailures:m,results:p,lastResult:y,failures:v})=>{if(m===0)return r?p:y;throw new Ju(`${this.name}.bulkAdd(): ${m} of ${d} operations failed`,v)})})}bulkPut(e,t,s){const i=Array.isArray(t)?t:void 0,r=(s=s||(i?void 0:t))?s.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:c}=this.schema.primKey;if(c&&i)throw new de.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==e.length)throw new de.InvalidArgument("Arguments objects and keys must have the same length");const d=e.length;let u=c&&a?e.map(Mp(c)):e;return this.core.mutate({trans:o,type:"put",keys:i,values:u,wantResults:r}).then(({numFailures:m,results:p,lastResult:y,failures:v})=>{if(m===0)return r?p:y;throw new Ju(`${this.name}.bulkPut(): ${m} of ${d} operations failed`,v)})})}bulkDelete(e){const t=e.length;return this._trans("readwrite",s=>this.core.mutate({trans:s,type:"delete",keys:e})).then(({numFailures:s,lastResult:i,failures:r})=>{if(s===0)return i;throw new Ju(`${this.name}.bulkDelete(): ${s} of ${t} operations failed`,r)})}}function Zu(n){var e={},t=function(o,a){if(a){for(var c=arguments.length,d=new Array(c-1);--c;)d[c-1]=arguments[c];return e[o].subscribe.apply(null,d),n}if(typeof o=="string")return e[o]};t.addEventType=r;for(var s=1,i=arguments.length;s<i;++s)r(arguments[s]);return t;function r(o,a,c){if(typeof o!="object"){var d;a||(a=RT),c||(c=$e);var u={subscribers:[],fire:c,subscribe:function(m){u.subscribers.indexOf(m)===-1&&(u.subscribers.push(m),u.fire=a(u.fire,m))},unsubscribe:function(m){u.subscribers=u.subscribers.filter(function(p){return p!==m}),u.fire=u.subscribers.reduce(a,c)}};return e[o]=t[o]=u,u}vt(d=o).forEach(function(m){var p=d[m];if(ns(p))r(m,d[m][0],d[m][1]);else{if(p!=="asap")throw new de.InvalidArgument("Invalid event config");var y=r(m,oh,function(){for(var v=arguments.length,x=new Array(v);v--;)x[v]=arguments[v];y.subscribers.forEach(function(b){hA(function(){b.apply(null,x)})})})}})}}function pu(n,e){return pc(e).from({prototype:n}),e}function Wl(n,e){return!(n.filter||n.algorithm||n.or)&&(e?n.justLimit:!n.replayFilter)}function h0(n,e){n.filter=Ol(n.filter,e)}function f0(n,e,t){var s=n.replayFilter;n.replayFilter=s?()=>Ol(s(),e()):e,n.justLimit=t&&!s}function nm(n,e){if(n.isPrimKey)return e.primaryKey;const t=e.getIndexByKeyPath(n.index);if(!t)throw new de.Schema("KeyPath "+n.index+" on object store "+e.name+" is not indexed");return t}function mv(n,e,t){const s=nm(n,e.schema);return e.openCursor({trans:t,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:s,range:n.range}})}function Dp(n,e,t,s){const i=n.replayFilter?Ol(n.filter,n.replayFilter()):n.filter;if(n.or){const r={},o=(a,c,d)=>{if(!i||i(c,d,p=>c.stop(p),p=>c.fail(p))){var u=c.primaryKey,m=""+u;m==="[object ArrayBuffer]"&&(m=""+new Uint8Array(u)),en(r,m)||(r[m]=!0,e(a,c,d))}};return Promise.all([n.or._iterate(o,t),gv(mv(n,s,t),n.algorithm,o,!n.keysOnly&&n.valueMapper)])}return gv(mv(n,s,t),Ol(n.algorithm,i),e,!n.keysOnly&&n.valueMapper)}function gv(n,e,t,s){var i=st(s?(r,o,a)=>t(s(r),o,a):t);return n.then(r=>{if(r)return r.start(()=>{var o=()=>r.continue();e&&!e(r,a=>o=a,a=>{r.stop(a),o=$e},a=>{r.fail(a),o=$e})||i(r.value,r,a=>o=a),o()})})}function ms(n,e){try{const t=yv(n),s=yv(e);if(t!==s)return t==="Array"?1:s==="Array"?-1:t==="binary"?1:s==="binary"?-1:t==="string"?1:s==="string"?-1:t==="Date"?1:s!=="Date"?NaN:-1;switch(t){case"number":case"Date":case"string":return n>e?1:n<e?-1:0;case"binary":return function(i,r){const o=i.length,a=r.length,c=o<a?o:a;for(let d=0;d<c;++d)if(i[d]!==r[d])return i[d]<r[d]?-1:1;return o===a?0:o<a?-1:1}(xv(n),xv(e));case"Array":return function(i,r){const o=i.length,a=r.length,c=o<a?o:a;for(let d=0;d<c;++d){const u=ms(i[d],r[d]);if(u!==0)return u}return o===a?0:o<a?-1:1}(n,e)}}catch{}return NaN}function yv(n){const e=typeof n;if(e!=="object")return e;if(ArrayBuffer.isView(n))return"binary";const t=H0(n);return t==="ArrayBuffer"?"binary":t}function xv(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}class GT{_read(e,t){var s=this._ctx;return s.error?s.table._trans(null,kt.bind(null,s.error)):s.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,kt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=Ol(t.algorithm,e)}_iterate(e,t){return Dp(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),s=Object.create(this._ctx);return e&&xs(s,e),t._ctx=s,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read(s=>Dp(t,e,s,t.table.core))}count(e){return this._read(t=>{const s=this._ctx,i=s.table.core;if(Wl(s,!0))return i.count({trans:t,query:{index:nm(s,i.schema),range:s.range}}).then(o=>Math.min(o,s.limit));var r=0;return Dp(s,()=>(++r,!1),t,i).then(()=>r)}).then(e)}sortBy(e,t){const s=e.split(".").reverse(),i=s[0],r=s.length-1;function o(d,u){return u?o(d[s[u]],u-1):d[i]}var a=this._ctx.dir==="next"?1:-1;function c(d,u){var m=o(d,r),p=o(u,r);return m<p?-a:m>p?a:0}return this.toArray(function(d){return d.sort(c)}).then(t)}toArray(e){return this._read(t=>{var s=this._ctx;if(s.dir==="next"&&Wl(s,!0)&&s.limit>0){const{valueMapper:i}=s,r=nm(s,s.table.core.schema);return s.table.core.query({trans:t,limit:s.limit,values:!0,query:{index:r,range:s.range}}).then(({result:o})=>i?o.map(i):o)}{const i=[];return Dp(s,r=>i.push(r),t,s.table.core).then(()=>i)}},e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Wl(t)?f0(t,()=>{var s=e;return(i,r)=>s===0||(s===1?(--s,!1):(r(()=>{i.advance(s),s=0}),!1))}):f0(t,()=>{var s=e;return()=>--s<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),f0(this._ctx,()=>{var t=e;return function(s,i,r){return--t<=0&&i(r),t>=0}},!0),this}until(e,t){return h0(this._ctx,function(s,i,r){return!e(s.value)||(i(r),t)}),this}first(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,s;return h0(this._ctx,function(i){return e(i.value)}),t=this._ctx,s=e,t.isMatch=Ol(t.isMatch,s),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(s,i){e(i.key,i)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(s,i){e(i.primaryKey,i)})}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var s=[];return this.each(function(i,r){s.push(r.key)}).then(function(){return s}).then(e)}primaryKeys(e){var t=this._ctx;if(t.dir==="next"&&Wl(t,!0)&&t.limit>0)return this._read(i=>{var r=nm(t,t.table.core.schema);return t.table.core.query({trans:i,values:!1,limit:t.limit,query:{index:r,range:t.range}})}).then(({result:i})=>i).then(e);t.keysOnly=!t.isMatch;var s=[];return this.each(function(i,r){s.push(r.primaryKey)}).then(function(){return s}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(t){return t[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var s={};return h0(this._ctx,function(i){var r=i.primaryKey.toString(),o=en(s,r);return s[r]=!0,!o}),this}modify(e){var t=this._ctx;return this._write(s=>{var i;if(typeof e=="function")i=e;else{var r=vt(e),o=r.length;i=function(x){for(var b=!1,w=0;w<o;++w){var S=r[w],A=e[S];Pr(x,S)!==A&&(zn(x,S,A),b=!0)}return b}}const a=t.table.core,{outbound:c,extractKey:d}=a.schema.primaryKey,u=this.db._options.modifyChunkSize||200,m=[];let p=0;const y=[],v=(x,b)=>{const{failures:w,numFailures:S}=b;p+=x-S;for(let A of vt(w))m.push(w[A])};return this.clone().primaryKeys().then(x=>{const b=w=>{const S=Math.min(u,x.length-w);return a.getMany({trans:s,keys:x.slice(w,w+S),cache:"immutable"}).then(A=>{const k=[],T=[],N=c?[]:null,I=[];for(let P=0;P<S;++P){const R=A[P],j={value:gp(R),primKey:x[w+P]};i.call(j,j.value,j)!==!1&&(j.value==null?I.push(x[w+P]):c||ms(d(R),d(j.value))===0?(T.push(j.value),c&&N.push(x[w+P])):(I.push(x[w+P]),k.push(j.value)))}const D=Wl(t)&&t.limit===1/0&&(typeof e!="function"||e===p0)&&{index:t.index,range:t.range};return Promise.resolve(k.length>0&&a.mutate({trans:s,type:"add",values:k}).then(P=>{for(let R in P.failures)I.splice(parseInt(R),1);v(k.length,P)})).then(()=>(T.length>0||D&&typeof e=="object")&&a.mutate({trans:s,type:"put",keys:N,values:T,criteria:D,changeSpec:typeof e!="function"&&e}).then(P=>v(T.length,P))).then(()=>(I.length>0||D&&e===p0)&&a.mutate({trans:s,type:"delete",keys:I,criteria:D}).then(P=>v(I.length,P))).then(()=>x.length>w+S&&b(w+u))})};return b(0).then(()=>{if(m.length>0)throw new Vm("Error modifying one or more objects",m,p,y);return x.length})})})}delete(){var e=this._ctx,t=e.range;return Wl(e)&&(e.isPrimKey&&!BT||t.type===3)?this._write(s=>{const{primaryKey:i}=e.table.core.schema,r=t;return e.table.core.count({trans:s,query:{index:i,range:r}}).then(o=>e.table.core.mutate({trans:s,type:"deleteRange",range:r}).then(({failures:a,lastResult:c,results:d,numFailures:u})=>{if(u)throw new Vm("Could not delete some values",Object.keys(a).map(m=>a[m]),o-u);return o-u}))}):this.modify(p0)}}const p0=(n,e)=>e.value=null;function qT(n,e){return n<e?-1:n===e?0:1}function VT(n,e){return n>e?-1:n===e?0:1}function Ns(n,e,t){var s=n instanceof DA?new n.Collection(n):n;return s._ctx.error=t?new t(e):new TypeError(e),s}function Kl(n){return new n.Collection(n,()=>MA("")).limit(0)}function $T(n,e,t,s,i,r){for(var o=Math.min(n.length,s.length),a=-1,c=0;c<o;++c){var d=e[c];if(d!==s[c])return i(n[c],t[c])<0?n.substr(0,c)+t[c]+t.substr(c+1):i(n[c],s[c])<0?n.substr(0,c)+s[c]+t.substr(c+1):a>=0?n.substr(0,a)+e[a]+t.substr(a+1):null;i(n[c],d)<0&&(a=c)}return o<s.length&&r==="next"?n+t.substr(n.length):o<n.length&&r==="prev"?n.substr(0,t.length):a<0?null:n.substr(0,a)+s[a]+t.substr(a+1)}function Lp(n,e,t,s){var i,r,o,a,c,d,u,m=t.length;if(!t.every(x=>typeof x=="string"))return Ns(n,IA);function p(x){i=function(w){return w==="next"?S=>S.toUpperCase():S=>S.toLowerCase()}(x),r=function(w){return w==="next"?S=>S.toLowerCase():S=>S.toUpperCase()}(x),o=x==="next"?qT:VT;var b=t.map(function(w){return{lower:r(w),upper:i(w)}}).sort(function(w,S){return o(w.lower,S.lower)});a=b.map(function(w){return w.upper}),c=b.map(function(w){return w.lower}),d=x,u=x==="next"?"":s}p("next");var y=new n.Collection(n,()=>Wr(a[0],c[m-1]+s));y._ondirectionchange=function(x){p(x)};var v=0;return y._addAlgorithm(function(x,b,w){var S=x.key;if(typeof S!="string")return!1;var A=r(S);if(e(A,c,v))return!0;for(var k=null,T=v;T<m;++T){var N=$T(S,A,a[T],c[T],o,d);N===null&&k===null?v=T+1:(k===null||o(k,N)>0)&&(k=N)}return b(k!==null?function(){x.continue(k+u)}:w),!1}),y}function Wr(n,e,t,s){return{type:2,lower:n,upper:e,lowerOpen:t,upperOpen:s}}function MA(n){return{type:1,lower:n,upper:n}}class DA{get Collection(){return this._ctx.table.db.Collection}between(e,t,s,i){s=s!==!1,i=i===!0;try{return this._cmp(e,t)>0||this._cmp(e,t)===0&&(s||i)&&(!s||!i)?Kl(this):new this.Collection(this,()=>Wr(e,t,!s,!i))}catch{return Ns(this,Li)}}equals(e){return e==null?Ns(this,Li):new this.Collection(this,()=>MA(e))}above(e){return e==null?Ns(this,Li):new this.Collection(this,()=>Wr(e,void 0,!0))}aboveOrEqual(e){return e==null?Ns(this,Li):new this.Collection(this,()=>Wr(e,void 0,!1))}below(e){return e==null?Ns(this,Li):new this.Collection(this,()=>Wr(void 0,e,!1,!0))}belowOrEqual(e){return e==null?Ns(this,Li):new this.Collection(this,()=>Wr(void 0,e))}startsWith(e){return typeof e!="string"?Ns(this,IA):this.between(e,e+ua,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):Lp(this,(t,s)=>t.indexOf(s[0])===0,[e],ua)}equalsIgnoreCase(e){return Lp(this,(t,s)=>t===s[0],[e],"")}anyOfIgnoreCase(){var e=Er.apply(Jl,arguments);return e.length===0?Kl(this):Lp(this,(t,s)=>s.indexOf(t)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Er.apply(Jl,arguments);return e.length===0?Kl(this):Lp(this,(t,s)=>s.some(i=>t.indexOf(i)===0),e,ua)}anyOf(){const e=Er.apply(Jl,arguments);let t=this._cmp;try{e.sort(t)}catch{return Ns(this,Li)}if(e.length===0)return Kl(this);const s=new this.Collection(this,()=>Wr(e[0],e[e.length-1]));s._ondirectionchange=r=>{t=r==="next"?this._ascending:this._descending,e.sort(t)};let i=0;return s._addAlgorithm((r,o,a)=>{const c=r.key;for(;t(c,e[i])>0;)if(++i,i===e.length)return o(a),!1;return t(c,e[i])===0||(o(()=>{r.continue(e[i])}),!1)}),s}notEqual(e){return this.inAnyRange([[Z0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Er.apply(Jl,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return Ns(this,Li)}const t=e.reduce((s,i)=>s?s.concat([[s[s.length-1][1],i]]):[[Z0,i]],null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const s=this._cmp,i=this._ascending,r=this._descending,o=this._min,a=this._max;if(e.length===0)return Kl(this);if(!e.every(S=>S[0]!==void 0&&S[1]!==void 0&&i(S[0],S[1])<=0))return Ns(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",de.InvalidArgument);const c=!t||t.includeLowers!==!1,d=t&&t.includeUppers===!0;let u,m=i;function p(S,A){return m(S[0],A[0])}try{u=e.reduce(function(S,A){let k=0,T=S.length;for(;k<T;++k){const N=S[k];if(s(A[0],N[1])<0&&s(A[1],N[0])>0){N[0]=o(N[0],A[0]),N[1]=a(N[1],A[1]);break}}return k===T&&S.push(A),S},[]),u.sort(p)}catch{return Ns(this,Li)}let y=0;const v=d?S=>i(S,u[y][1])>0:S=>i(S,u[y][1])>=0,x=c?S=>r(S,u[y][0])>0:S=>r(S,u[y][0])>=0;let b=v;const w=new this.Collection(this,()=>Wr(u[0][0],u[u.length-1][1],!c,!d));return w._ondirectionchange=S=>{S==="next"?(b=v,m=i):(b=x,m=r),u.sort(p)},w._addAlgorithm((S,A,k)=>{for(var T=S.key;b(T);)if(++y,y===u.length)return A(k),!1;return!!function(N){return!v(N)&&!x(N)}(T)||(this._cmp(T,u[y][1])===0||this._cmp(T,u[y][0])===0||A(()=>{m===i?S.continue(u[y][0]):S.continue(u[y][1])}),!1)}),w}startsWithAnyOf(){const e=Er.apply(Jl,arguments);return e.every(t=>typeof t=="string")?e.length===0?Kl(this):this.inAnyRange(e.map(t=>[t,t+ua])):Ns(this,"startsWithAnyOf() only works with strings")}}function ei(n){return st(function(e){return lh(e),n(e.target.error),!1})}function lh(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}const ch="storagemutated",Jr="x-storagemutated-1",Qo=Zu(null,ch);class zT{_lock(){return Su(!ae.global),++this._reculock,this._reculock!==1||ae.global||(ae.lockOwnerFor=this),this}_unlock(){if(Su(!ae.global),--this._reculock==0)for(ae.global||(ae.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{lu(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&ae.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,s=this.db._state.dbOpenError;if(Su(!this.idbtrans),!e&&!t)switch(s&&s.name){case"DatabaseClosedError":throw new de.DatabaseClosed(s);case"MissingAPIError":throw new de.MissingAPI(s.message,s);default:throw new de.OpenFailed(s)}if(!this.active)throw new de.TransactionInactive;return Su(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=st(i=>{lh(i),this._reject(e.error)}),e.onabort=st(i=>{lh(i),this.active&&this._reject(new de.Abort(e.error)),this.active=!1,this.on("abort").fire(i)}),e.oncomplete=st(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Qo.storagemutated.fire(e.mutatedParts)}),this}_promise(e,t,s){if(e==="readwrite"&&this.mode!=="readwrite")return kt(new de.ReadOnly("Transaction is readonly"));if(!this.active)return kt(new de.TransactionInactive);if(this._locked())return new ne((r,o)=>{this._blockedFuncs.push([()=>{this._promise(e,t,s).then(r,o)},ae])});if(s)return Jo(()=>{var r=new ne((o,a)=>{this._lock();const c=t(o,a,this);c&&c.then&&c.then(o,a)});return r.finally(()=>this._unlock()),r._lib=!0,r});var i=new ne((r,o)=>{var a=t(r,o,this);a&&a.then&&a.then(r,o)});return i._lib=!0,i}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const s=ne.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then(()=>s);else{t._waitingFor=s,t._waitingQueue=[];var i=t.idbtrans.objectStore(t.storeNames[0]);(function o(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(i.get(-1/0).onsuccess=o)})()}var r=t._waitingFor;return new ne((o,a)=>{s.then(c=>t._waitingQueue.push(st(o.bind(null,c))),c=>t._waitingQueue.push(st(a.bind(null,c)))).finally(()=>{t._waitingFor===r&&(t._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new de.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(en(t,e))return t[e];const s=this.schema[e];if(!s)throw new de.NotFound("Table "+e+" not part of transaction");const i=new this.db.Table(e,s,this);return i.core=this.db.core.table(e),t[e]=i,i}}function ey(n,e,t,s,i,r,o){return{name:n,keyPath:e,unique:t,multi:s,auto:i,compound:r,src:(t&&!o?"&":"")+(s?"*":"")+(i?"++":"")+LA(e)}}function LA(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function FA(n,e,t){return{name:n,primKey:e,indexes:t,mappedClass:null,idxByName:fA(t,s=>[s.name,s])}}let dh=n=>{try{return n.only([[]]),dh=()=>[[]],[[]]}catch{return dh=()=>ua,ua}};function ty(n){return n==null?()=>{}:typeof n=="string"?function(e){return e.split(".").length===1?s=>s[e]:s=>Pr(s,e)}(n):e=>Pr(e,n)}function bv(n){return[].slice.call(n)}let WT=0;function eh(n){return n==null?":id":typeof n=="string"?n:`[${n.join("+")}]`}function KT(n,e,t){function s(c){if(c.type===3)return null;if(c.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:d,upper:u,lowerOpen:m,upperOpen:p}=c;return d===void 0?u===void 0?null:e.upperBound(u,!!p):u===void 0?e.lowerBound(d,!!m):e.bound(d,u,!!m,!!p)}const{schema:i,hasGetAll:r}=function(c,d){const u=bv(c.objectStoreNames);return{schema:{name:c.name,tables:u.map(m=>d.objectStore(m)).map(m=>{const{keyPath:p,autoIncrement:y}=m,v=ns(p),x=p==null,b={},w={name:m.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:x,compound:v,keyPath:p,autoIncrement:y,unique:!0,extractKey:ty(p)},indexes:bv(m.indexNames).map(S=>m.index(S)).map(S=>{const{name:A,unique:k,multiEntry:T,keyPath:N}=S,I={name:A,compound:ns(N),keyPath:N,unique:k,multiEntry:T,extractKey:ty(N)};return b[eh(N)]=I,I}),getIndexByKeyPath:S=>b[eh(S)]};return b[":id"]=w.primaryKey,p!=null&&(b[eh(p)]=w.primaryKey),w})},hasGetAll:u.length>0&&"getAll"in d.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(n,t),o=i.tables.map(c=>function(d){const u=d.name;return{name:u,schema:d,mutate:function({trans:m,type:p,keys:y,values:v,range:x}){return new Promise((b,w)=>{b=st(b);const S=m.objectStore(u),A=S.keyPath==null,k=p==="put"||p==="add";if(!k&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);const{length:T}=y||v||{length:1};if(y&&v&&y.length!==v.length)throw new Error("Given keys array must have same length as given values array.");if(T===0)return b({numFailures:0,failures:{},results:[],lastResult:void 0});let N;const I=[],D=[];let P=0;const R=$=>{++P,lh($)};if(p==="deleteRange"){if(x.type===4)return b({numFailures:P,failures:D,results:[],lastResult:void 0});x.type===3?I.push(N=S.clear()):I.push(N=S.delete(s(x)))}else{const[$,B]=k?A?[v,y]:[v,null]:[y,null];if(k)for(let V=0;V<T;++V)I.push(N=B&&B[V]!==void 0?S[p]($[V],B[V]):S[p]($[V])),N.onerror=R;else for(let V=0;V<T;++V)I.push(N=S[p]($[V])),N.onerror=R}const j=$=>{const B=$.target.result;I.forEach((V,L)=>V.error!=null&&(D[L]=V.error)),b({numFailures:P,failures:D,results:p==="delete"?y:I.map(V=>V.result),lastResult:B})};N.onerror=$=>{R($),j($)},N.onsuccess=j})},getMany:({trans:m,keys:p})=>new Promise((y,v)=>{y=st(y);const x=m.objectStore(u),b=p.length,w=new Array(b);let S,A=0,k=0;const T=I=>{const D=I.target;w[D._pos]=D.result,++k===A&&y(w)},N=ei(v);for(let I=0;I<b;++I)p[I]!=null&&(S=x.get(p[I]),S._pos=I,S.onsuccess=T,S.onerror=N,++A);A===0&&y(w)}),get:({trans:m,key:p})=>new Promise((y,v)=>{y=st(y);const x=m.objectStore(u).get(p);x.onsuccess=b=>y(b.target.result),x.onerror=ei(v)}),query:function(m){return p=>new Promise((y,v)=>{y=st(y);const{trans:x,values:b,limit:w,query:S}=p,A=w===1/0?void 0:w,{index:k,range:T}=S,N=x.objectStore(u),I=k.isPrimaryKey?N:N.index(k.name),D=s(T);if(w===0)return y({result:[]});if(m){const P=b?I.getAll(D,A):I.getAllKeys(D,A);P.onsuccess=R=>y({result:R.target.result}),P.onerror=ei(v)}else{let P=0;const R=b||!("openKeyCursor"in I)?I.openCursor(D):I.openKeyCursor(D),j=[];R.onsuccess=$=>{const B=R.result;return B?(j.push(b?B.value:B.primaryKey),++P===w?y({result:j}):void B.continue()):y({result:j})},R.onerror=ei(v)}})}(r),openCursor:function({trans:m,values:p,query:y,reverse:v,unique:x}){return new Promise((b,w)=>{b=st(b);const{index:S,range:A}=y,k=m.objectStore(u),T=S.isPrimaryKey?k:k.index(S.name),N=v?x?"prevunique":"prev":x?"nextunique":"next",I=p||!("openKeyCursor"in T)?T.openCursor(s(A),N):T.openKeyCursor(s(A),N);I.onerror=ei(w),I.onsuccess=st(D=>{const P=I.result;if(!P)return void b(null);P.___id=++WT,P.done=!1;const R=P.continue.bind(P);let j=P.continuePrimaryKey;j&&(j=j.bind(P));const $=P.advance.bind(P),B=()=>{throw new Error("Cursor not stopped")};P.trans=m,P.stop=P.continue=P.continuePrimaryKey=P.advance=()=>{throw new Error("Cursor not started")},P.fail=st(w),P.next=function(){let V=1;return this.start(()=>V--?this.continue():this.stop()).then(()=>this)},P.start=V=>{const L=new Promise((H,J)=>{H=st(H),I.onerror=ei(J),P.fail=J,P.stop=Y=>{P.stop=P.continue=P.continuePrimaryKey=P.advance=B,H(Y)}}),U=()=>{if(I.result)try{V()}catch(H){P.fail(H)}else P.done=!0,P.start=()=>{throw new Error("Cursor behind last entry")},P.stop()};return I.onsuccess=st(H=>{I.onsuccess=U,U()}),P.continue=R,P.continuePrimaryKey=j,P.advance=$,U(),L},b(P)},w)})},count({query:m,trans:p}){const{index:y,range:v}=m;return new Promise((x,b)=>{const w=p.objectStore(u),S=y.isPrimaryKey?w:w.index(y.name),A=s(v),k=A?S.count(A):S.count();k.onsuccess=st(T=>x(T.target.result)),k.onerror=ei(b)})}}}(c)),a={};return o.forEach(c=>a[c.name]=c),{stack:"dbcore",transaction:n.transaction.bind(n),table(c){if(!a[c])throw new Error(`Table '${c}' not found`);return a[c]},MIN_KEY:-1/0,MAX_KEY:dh(e),schema:i}}function sy({_novip:n},e){const t=e.db,s=function(i,r,{IDBKeyRange:o,indexedDB:a},c){return{dbcore:function(u,m){return m.reduce((p,{create:y})=>({...p,...y(p)}),u)}(KT(r,o,c),i.dbcore)}}(n._middlewares,t,n._deps,e);n.core=s.dbcore,n.tables.forEach(i=>{const r=i.name;n.core.schema.tables.some(o=>o.name===r)&&(i.core=n.core.table(r),n[r]instanceof n.Table&&(n[r].core=i.core))})}function Ym({_novip:n},e,t,s){t.forEach(i=>{const r=s[i];e.forEach(o=>{const a=pb(o,i);(!a||"value"in a&&a.value===void 0)&&(o===n.Transaction.prototype||o instanceof n.Transaction?Ir(o,i,{get(){return this.table(i)},set(c){dA(this,i,{value:c,writable:!0,configurable:!0,enumerable:!0})}}):o[i]=new n.Table(i,r))})})}function ny({_novip:n},e){e.forEach(t=>{for(let s in t)t[s]instanceof n.Table&&delete t[s]})}function YT(n,e){return n._cfg.version-e._cfg.version}function JT(n,e,t,s){const i=n._dbSchema,r=n._createTransaction("readwrite",n._storeNames,i);r.create(t),r._completion.catch(s);const o=r._reject.bind(r),a=ae.transless||ae;Jo(()=>{ae.trans=r,ae.transless=a,e===0?(vt(i).forEach(c=>{m0(t,c,i[c].primKey,i[c].indexes)}),sy(n,t),ne.follow(()=>n.on.populate.fire(r)).catch(o)):function({_novip:c},d,u,m){const p=[],y=c._versions;let v=c._dbSchema=ry(c,c.idbdb,m),x=!1;const b=y.filter(S=>S._cfg.version>=d);function w(){return p.length?ne.resolve(p.shift()(u.idbtrans)).then(w):ne.resolve()}return b.forEach(S=>{p.push(()=>{const A=v,k=S._cfg.dbschema;oy(c,A,m),oy(c,k,m),v=c._dbSchema=k;const T=jA(A,k);T.add.forEach(I=>{m0(m,I[0],I[1].primKey,I[1].indexes)}),T.change.forEach(I=>{if(I.recreate)throw new de.Upgrade("Not yet support for changing primary key");{const D=m.objectStore(I.name);I.add.forEach(P=>iy(D,P)),I.change.forEach(P=>{D.deleteIndex(P.name),iy(D,P)}),I.del.forEach(P=>D.deleteIndex(P))}});const N=S._cfg.contentUpgrade;if(N&&S._cfg.version>d){sy(c,m),u._memoizedTables={},x=!0;let I=pA(k);T.del.forEach(j=>{I[j]=A[j]}),ny(c,[c.Transaction.prototype]),Ym(c,[c.Transaction.prototype],vt(I),I),u.schema=I;const D=mb(N);let P;D&&au();const R=ne.follow(()=>{if(P=N(u),P&&D){var j=Fr.bind(null,null);P.then(j,j)}});return P&&typeof P.then=="function"?ne.resolve(P):R.then(()=>P)}}),p.push(A=>{(!x||!UT)&&function(k,T){[].slice.call(T.db.objectStoreNames).forEach(N=>k[N]==null&&T.db.deleteObjectStore(N))}(S._cfg.dbschema,A),ny(c,[c.Transaction.prototype]),Ym(c,[c.Transaction.prototype],c._storeNames,c._dbSchema),u.schema=c._dbSchema})}),w().then(()=>{var S,A;A=m,vt(S=v).forEach(k=>{A.db.objectStoreNames.contains(k)||m0(A,k,S[k].primKey,S[k].indexes)})})}(n,e,r,t).catch(o)})}function jA(n,e){const t={del:[],add:[],change:[]};let s;for(s in n)e[s]||t.del.push(s);for(s in e){const i=n[s],r=e[s];if(i){const o={name:s,def:r,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(r.primKey.keyPath||"")||i.primKey.auto!==r.primKey.auto&&!Gg)o.recreate=!0,t.change.push(o);else{const a=i.idxByName,c=r.idxByName;let d;for(d in a)c[d]||o.del.push(d);for(d in c){const u=a[d],m=c[d];u?u.src!==m.src&&o.change.push(m):o.add.push(m)}(o.del.length>0||o.add.length>0||o.change.length>0)&&t.change.push(o)}}else t.add.push([s,r])}return t}function m0(n,e,t,s){const i=n.db.createObjectStore(e,t.keyPath?{keyPath:t.keyPath,autoIncrement:t.auto}:{autoIncrement:t.auto});return s.forEach(r=>iy(i,r)),i}function iy(n,e){n.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ry(n,e,t){const s={};return qm(e.objectStoreNames,0).forEach(i=>{const r=t.objectStore(i);let o=r.keyPath;const a=ey(LA(o),o||"",!1,!1,!!r.autoIncrement,o&&typeof o!="string",!0),c=[];for(let u=0;u<r.indexNames.length;++u){const m=r.index(r.indexNames[u]);o=m.keyPath;var d=ey(m.name,o,!!m.unique,!!m.multiEntry,!1,o&&typeof o!="string",!1);c.push(d)}s[i]=FA(i,a,c)}),s}function oy({_novip:n},e,t){const s=t.db.objectStoreNames;for(let i=0;i<s.length;++i){const r=s[i],o=t.objectStore(r);n._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const c=o.indexNames[a],d=o.index(c).keyPath,u=typeof d=="string"?d:"["+qm(d).join("+")+"]";if(e[r]){const m=e[r].idxByName[u];m&&(m.name=c,delete e[r].idxByName[u],e[r].idxByName[c]=m)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Qe.WorkerGlobalScope&&Qe instanceof Qe.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}class XT{_parseStoresSpec(e,t){vt(e).forEach(s=>{if(e[s]!==null){var i=e[s].split(",").map((o,a)=>{const c=(o=o.trim()).replace(/([&*]|\+\+)/g,""),d=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return ey(c,d||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),ns(d),a===0)}),r=i.shift();if(r.multi)throw new de.Schema("Primary key cannot be multi-valued");i.forEach(o=>{if(o.auto)throw new de.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new de.Schema("Index must have a name and cannot be an empty string")}),t[s]=FA(s,r,i)}})}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?xs(this._cfg.storesSource,e):e;const s=t._versions,i={};let r={};return s.forEach(o=>{xs(i,o._cfg.storesSource),r=o._cfg.dbschema={},o._parseStoresSpec(i,r)}),t._dbSchema=r,ny(t,[t._allTables,t,t.Transaction.prototype]),Ym(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],vt(r),r),t._storeNames=vt(r),this}upgrade(e){return this._cfg.contentUpgrade=xb(this._cfg.contentUpgrade||$e,e),this}}function _b(n,e){let t=n._dbNamesDB;return t||(t=n._dbNamesDB=new Fl(qg,{addons:[],indexedDB:n,IDBKeyRange:e}),t.version(1).stores({dbnames:"name"})),t.table("dbnames")}function Ab(n){return n&&typeof n.databases=="function"}function ay(n){return Jo(function(){return ae.letThrough=!0,n()})}function QT(){var n;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var t=function(){return indexedDB.databases().finally(e)};n=setInterval(t,100),t()}).finally(function(){return clearInterval(n)}):Promise.resolve()}function ZT(n){const e=n._state,{indexedDB:t}=n._deps;if(e.isBeingOpened||n.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?kt(e.dbOpenError):n);Di&&(e.openCanceller._stackHolder=Gl()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const s=e.openCanceller;function i(){if(e.openCanceller!==s)throw new de.DatabaseClosed("db.open() was cancelled")}let r=e.dbReadyResolve,o=null,a=!1;const c=()=>new ne((d,u)=>{if(i(),!t)throw new de.MissingAPI;const m=n.name,p=e.autoSchema?t.open(m):t.open(m,Math.round(10*n.verno));if(!p)throw new de.MissingAPI;p.onerror=ei(u),p.onblocked=st(n._fireOnBlocked),p.onupgradeneeded=st(y=>{if(o=p.transaction,e.autoSchema&&!n._options.allowEmptyDB){p.onerror=lh,o.abort(),p.result.close();const x=t.deleteDatabase(m);x.onsuccess=x.onerror=st(()=>{u(new de.NoSuchDatabase(`Database ${m} doesnt exist`))})}else{o.onerror=ei(u);var v=y.oldVersion>Math.pow(2,62)?0:y.oldVersion;a=v<1,n._novip.idbdb=p.result,JT(n,v/10,o,u)}},u),p.onsuccess=st(()=>{o=null;const y=n._novip.idbdb=p.result,v=qm(y.objectStoreNames);if(v.length>0)try{const b=y.transaction((x=v).length===1?x[0]:x,"readonly");e.autoSchema?function({_novip:w},S,A){w.verno=S.version/10;const k=w._dbSchema=ry(0,S,A);w._storeNames=qm(S.objectStoreNames,0),Ym(w,[w._allTables],vt(k),k)}(n,y,b):(oy(n,n._dbSchema,b),function(w,S){const A=jA(ry(0,w.idbdb,S),w._dbSchema);return!(A.add.length||A.change.some(k=>k.add.length||k.change.length))}(n,b)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),sy(n,b)}catch{}var x;Qu.push(n),y.onversionchange=st(b=>{e.vcFired=!0,n.on("versionchange").fire(b)}),y.onclose=st(b=>{n.on("close").fire(b)}),a&&function({indexedDB:b,IDBKeyRange:w},S){!Ab(b)&&S!==qg&&_b(b,w).put({name:S}).catch($e)}(n._deps,m),d()},u)}).catch(d=>d&&d.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),c()):ne.reject(d));return ne.race([s,(typeof navigator>"u"?ne.resolve():QT()).then(c)]).then(()=>(i(),e.onReadyBeingFired=[],ne.resolve(ay(()=>n.on.ready.fire(n.vip))).then(function d(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(xb,$e);return e.onReadyBeingFired=[],ne.resolve(ay(()=>u(n.vip))).then(d)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>n).catch(d=>{e.dbOpenError=d;try{o&&o.abort()}catch{}return s===e.openCanceller&&n._close(),kt(d)}).finally(()=>{e.openComplete=!0,r()})}function ly(n){var e=r=>n.next(r),t=i(e),s=i(r=>n.throw(r));function i(r){return o=>{var a=r(o),c=a.value;return a.done?c:c&&typeof c.then=="function"?c.then(t,s):ns(c)?Promise.all(c).then(t,s):t(c)}}return i(e)()}function eN(n,e,t){var s=arguments.length;if(s<2)throw new de.InvalidArgument("Too few arguments");for(var i=new Array(s-1);--s;)i[s-1]=arguments[s];return t=i.pop(),[n,mA(i),t]}function OA(n,e,t,s,i){return ne.resolve().then(()=>{const r=ae.transless||ae,o=n._createTransaction(e,t,n._dbSchema,s),a={trans:o,transless:r};if(s)o.idbtrans=s.idbtrans;else try{o.create(),n._state.PR1398_maxLoop=3}catch(m){return m.name===yb.InvalidState&&n.isOpen()&&--n._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),n._close(),n.open().then(()=>OA(n,e,t,null,i))):kt(m)}const c=mb(i);let d;c&&au();const u=ne.follow(()=>{if(d=i.call(o,o),d)if(c){var m=Fr.bind(null,null);d.then(m,m)}else typeof d.next=="function"&&typeof d.throw=="function"&&(d=ly(d))},a);return(d&&typeof d.then=="function"?ne.resolve(d).then(m=>o.active?m:kt(new de.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>d)).then(m=>(s&&o._resolve(),o._completion.then(()=>m))).catch(m=>(o._reject(m),kt(m)))})}function Fp(n,e,t){const s=ns(n)?n.slice():[n];for(let i=0;i<t;++i)s.push(e);return s}const tN={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return{...n,table(e){const t=n.table(e),{schema:s}=t,i={},r=[];function o(u,m,p){const y=eh(u),v=i[y]=i[y]||[],x=u==null?0:typeof u=="string"?1:u.length,b=m>0,w={...p,isVirtual:b,keyTail:m,keyLength:x,extractKey:ty(u),unique:!b&&p.unique};return v.push(w),w.isPrimaryKey||r.push(w),x>1&&o(x===2?u[0]:u.slice(0,x-1),m+1,p),v.sort((S,A)=>S.keyTail-A.keyTail),w}const a=o(s.primaryKey.keyPath,0,s.primaryKey);i[":id"]=[a];for(const u of s.indexes)o(u.keyPath,0,u);function c(u){const m=u.query.index;return m.isVirtual?{...u,query:{index:m,range:(p=u.query.range,y=m.keyTail,{type:p.type===1?2:p.type,lower:Fp(p.lower,p.lowerOpen?n.MAX_KEY:n.MIN_KEY,y),lowerOpen:!0,upper:Fp(p.upper,p.upperOpen?n.MIN_KEY:n.MAX_KEY,y),upperOpen:!0})}}:u;var p,y}return{...t,schema:{...s,primaryKey:a,indexes:r,getIndexByKeyPath:function(u){const m=i[eh(u)];return m&&m[0]}},count:u=>t.count(c(u)),query:u=>t.query(c(u)),openCursor(u){const{keyTail:m,isVirtual:p,keyLength:y}=u.query.index;return p?t.openCursor(c(u)).then(v=>v&&function(x){return Object.create(x,{continue:{value:function(w){w!=null?x.continue(Fp(w,u.reverse?n.MAX_KEY:n.MIN_KEY,m)):u.unique?x.continue(x.key.slice(0,y).concat(u.reverse?n.MIN_KEY:n.MAX_KEY,m)):x.continue()}},continuePrimaryKey:{value(w,S){x.continuePrimaryKey(Fp(w,n.MAX_KEY,m),S)}},primaryKey:{get:()=>x.primaryKey},key:{get(){const w=x.key;return y===1?w[0]:w.slice(0,y)}},value:{get:()=>x.value}})}(v)):t.openCursor(u)}}}}}};function Sb(n,e,t,s){return t=t||{},s=s||"",vt(n).forEach(i=>{if(en(e,i)){var r=n[i],o=e[i];if(typeof r=="object"&&typeof o=="object"&&r&&o){const a=H0(r);a!==H0(o)?t[s+i]=e[i]:a==="Object"?Sb(r,o,t,s+i+"."):r!==o&&(t[s+i]=e[i])}else r!==o&&(t[s+i]=e[i])}else t[s+i]=void 0}),vt(e).forEach(i=>{en(n,i)||(t[s+i]=e[i])}),t}const sN={stack:"dbcore",name:"HooksMiddleware",level:2,create:n=>({...n,table(e){const t=n.table(e),{primaryKey:s}=t.schema;return{...t,mutate(r){const o=ae.trans,{deleting:a,creating:c,updating:d}=o.table(e).hook;switch(r.type){case"add":if(c.fire===$e)break;return o._promise("readwrite",()=>u(r),!0);case"put":if(c.fire===$e&&d.fire===$e)break;return o._promise("readwrite",()=>u(r),!0);case"delete":if(a.fire===$e)break;return o._promise("readwrite",()=>u(r),!0);case"deleteRange":if(a.fire===$e)break;return o._promise("readwrite",()=>function(p){return m(p.trans,p.range,1e4)}(r),!0)}return t.mutate(r);function u(p){const y=ae.trans,v=p.keys||function(x,b){return b.type==="delete"?b.keys:b.keys||b.values.map(x.extractKey)}(s,p);if(!v)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?{...p,keys:v}:{...p}).type!=="delete"&&(p.values=[...p.values]),p.keys&&(p.keys=[...p.keys]),function(x,b,w){return b.type==="add"?Promise.resolve([]):x.getMany({trans:b.trans,keys:w,cache:"immutable"})}(t,p,v).then(x=>{const b=v.map((w,S)=>{const A=x[S],k={onerror:null,onsuccess:null};if(p.type==="delete")a.fire.call(k,w,A,y);else if(p.type==="add"||A===void 0){const T=c.fire.call(k,w,p.values[S],y);w==null&&T!=null&&(w=T,p.keys[S]=w,s.outbound||zn(p.values[S],s.keyPath,w))}else{const T=Sb(A,p.values[S]),N=d.fire.call(k,T,w,A,y);if(N){const I=p.values[S];Object.keys(N).forEach(D=>{en(I,D)?I[D]=N[D]:zn(I,D,N[D])})}}return k});return t.mutate(p).then(({failures:w,results:S,numFailures:A,lastResult:k})=>{for(let T=0;T<v.length;++T){const N=S?S[T]:v[T],I=b[T];N==null?I.onerror&&I.onerror(w[T]):I.onsuccess&&I.onsuccess(p.type==="put"&&x[T]?p.values[T]:N)}return{failures:w,results:S,numFailures:A,lastResult:k}}).catch(w=>(b.forEach(S=>S.onerror&&S.onerror(w)),Promise.reject(w)))})}function m(p,y,v){return t.query({trans:p,values:!1,query:{index:s,range:y},limit:v}).then(({result:x})=>u({type:"delete",keys:x,trans:p}).then(b=>b.numFailures>0?Promise.reject(b.failures[0]):x.length<v?{failures:[],numFailures:0,lastResult:void 0}:m(p,{...y,lower:x[x.length-1],lowerOpen:!0},v)))}}}}})};function UA(n,e,t){try{if(!e||e.keys.length<n.length)return null;const s=[];for(let i=0,r=0;i<e.keys.length&&r<n.length;++i)ms(e.keys[i],n[r])===0&&(s.push(t?gp(e.values[i]):e.values[i]),++r);return s.length===n.length?s:null}catch{return null}}const nN={stack:"dbcore",level:-1,create:n=>({table:e=>{const t=n.table(e);return{...t,getMany:s=>{if(!s.cache)return t.getMany(s);const i=UA(s.keys,s.trans._cache,s.cache==="clone");return i?ne.resolve(i):t.getMany(s).then(r=>(s.trans._cache={keys:s.keys,values:s.cache==="clone"?gp(r):r},r))},mutate:s=>(s.type!=="add"&&(s.trans._cache=null),t.mutate(s))}}})};function Cb(n){return!("from"in n)}const Vi=function(n,e){if(!this){const t=new Vi;return n&&"d"in n&&xs(t,n),t}xs(this,arguments.length?{d:1,from:n,to:arguments.length>1?e:n}:{d:0})};function uh(n,e,t){const s=ms(e,t);if(isNaN(s))return;if(s>0)throw RangeError();if(Cb(n))return xs(n,{from:e,to:t,d:1});const i=n.l,r=n.r;if(ms(t,n.from)<0)return i?uh(i,e,t):n.l={from:e,to:t,d:1,l:null,r:null},vv(n);if(ms(e,n.to)>0)return r?uh(r,e,t):n.r={from:e,to:t,d:1,l:null,r:null},vv(n);ms(e,n.from)<0&&(n.from=e,n.l=null,n.d=r?r.d+1:1),ms(t,n.to)>0&&(n.to=t,n.r=null,n.d=n.l?n.l.d+1:1);const o=!n.r;i&&!n.l&&Jm(n,i),r&&o&&Jm(n,r)}function Jm(n,e){Cb(e)||function t(s,{from:i,to:r,l:o,r:a}){uh(s,i,r),o&&t(s,o),a&&t(s,a)}(n,e)}function iN(n,e){const t=cy(e);let s=t.next();if(s.done)return!1;let i=s.value;const r=cy(n);let o=r.next(i.from),a=o.value;for(;!s.done&&!o.done;){if(ms(a.from,i.to)<=0&&ms(a.to,i.from)>=0)return!0;ms(i.from,a.from)<0?i=(s=t.next(a.from)).value:a=(o=r.next(i.from)).value}return!1}function cy(n){let e=Cb(n)?null:{s:0,n};return{next(t){const s=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,s)for(;e.n.l&&ms(t,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!s||ms(t,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function vv(n){var e,t;const s=(((e=n.r)===null||e===void 0?void 0:e.d)||0)-(((t=n.l)===null||t===void 0?void 0:t.d)||0),i=s>1?"r":s<-1?"l":"";if(i){const r=i==="r"?"l":"r",o={...n},a=n[i];n.from=a.from,n.to=a.to,n[i]=a[i],o[i]=a[r],n[r]=o,o.d=wv(o)}n.d=wv(n)}function wv({r:n,l:e}){return(n?e?Math.max(n.d,e.d):n.d:e?e.d:0)+1}su(Vi.prototype,{add(n){return Jm(this,n),this},addKey(n){return uh(this,n,n),this},addKeys(n){return n.forEach(e=>uh(this,e,e)),this},[G0](){return cy(this)}});const rN={stack:"dbcore",level:0,create:n=>{const e=n.schema.name,t=new Vi(n.MIN_KEY,n.MAX_KEY);return{...n,table:s=>{const i=n.table(s),{schema:r}=i,{primaryKey:o}=r,{extractKey:a,outbound:c}=o,d={...i,mutate:p=>{const y=p.trans,v=y.mutatedParts||(y.mutatedParts={}),x=N=>{const I=`idb://${e}/${s}/${N}`;return v[I]||(v[I]=new Vi)},b=x(""),w=x(":dels"),{type:S}=p;let[A,k]=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[];const T=p.trans._cache;return i.mutate(p).then(N=>{if(ns(A)){S!=="delete"&&(A=N.results),b.addKeys(A);const I=UA(A,T);I||S==="add"||w.addKeys(A),(I||k)&&function(D,P,R,j){function $(B){const V=D(B.name||"");function L(H){return H!=null?B.extractKey(H):null}const U=H=>B.multiEntry&&ns(H)?H.forEach(J=>V.addKey(J)):V.addKey(H);(R||j).forEach((H,J)=>{const Y=R&&L(R[J]),re=j&&L(j[J]);ms(Y,re)!==0&&(Y!=null&&U(Y),re!=null&&U(re))})}P.indexes.forEach($)}(x,r,I,k)}else if(A){const I={from:A.lower,to:A.upper};w.add(I),b.add(I)}else b.add(t),w.add(t),r.indexes.forEach(I=>x(I.name).add(t));return N})}},u=({query:{index:p,range:y}})=>{var v,x;return[p,new Vi((v=y.lower)!==null&&v!==void 0?v:n.MIN_KEY,(x=y.upper)!==null&&x!==void 0?x:n.MAX_KEY)]},m={get:p=>[o,new Vi(p.key)],getMany:p=>[o,new Vi().addKeys(p.keys)],count:u,query:u,openCursor:u};return vt(m).forEach(p=>{d[p]=function(y){const{subscr:v}=ae;if(v){const x=k=>{const T=`idb://${e}/${s}/${k}`;return v[T]||(v[T]=new Vi)},b=x(""),w=x(":dels"),[S,A]=m[p](y);if(x(S.name||"").add(A),!S.isPrimaryKey){if(p!=="count"){const k=p==="query"&&c&&y.values&&i.query({...y,values:!1});return i[p].apply(this,arguments).then(T=>{if(p==="query"){if(c&&y.values)return k.then(({result:I})=>(b.addKeys(I),T));const N=y.values?T.result.map(a):T.result;y.values?b.addKeys(N):w.addKeys(N)}else if(p==="openCursor"){const N=T,I=y.values;return N&&Object.create(N,{key:{get:()=>(w.addKey(N.primaryKey),N.key)},primaryKey:{get(){const D=N.primaryKey;return w.addKey(D),D}},value:{get:()=>(I&&b.addKey(N.primaryKey),N.value)}})}return T})}w.add(t)}}return i[p].apply(this,arguments)}}),d}}}};class Fl{constructor(e,t){this._middlewares={},this.verno=0;const s=Fl.dependencies;this._options=t={addons:Fl.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:i}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const r={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:$e,dbReadyPromise:null,cancelOpen:$e,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;r.dbReadyPromise=new ne(a=>{r.dbReadyResolve=a}),r.openCanceller=new ne((a,c)=>{r.cancelOpen=c}),this._state=r,this.name=e,this.on=Zu(this,"populate","blocked","versionchange","close",{ready:[xb,$e]}),this.on.ready.subscribe=uA(this.on.ready.subscribe,a=>(c,d)=>{Fl.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||ne.resolve().then(c),d&&a(c);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(c),d&&a(c);else{a(c);const m=this;d||a(function p(){m.on.ready.unsubscribe(c),m.on.ready.unsubscribe(p)})}})}),this.Collection=(o=this,pu(GT.prototype,function(a,c){this.db=o;let d=RA,u=null;if(c)try{d=c()}catch(v){u=v}const m=a._ctx,p=m.table,y=p.hook.reading.fire;this._ctx={table:p,index:m.index,isPrimKey:!m.index||p.schema.primKey.keyPath&&m.index===p.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:m.or,valueMapper:y!==oh?y:null}})),this.Table=function(a){return pu(HT.prototype,function(c,d,u){this.db=a,this._tx=u,this.name=c,this.schema=d,this.hook=a._allTables[c]?a._allTables[c].hook:Zu(null,{creating:[NT,$e],reading:[TT,oh],updating:[PT,$e],deleting:[IT,$e]})})}(this),this.Transaction=function(a){return pu(zT.prototype,function(c,d,u,m,p){this.db=a,this.mode=c,this.storeNames=d,this.schema=u,this.chromeTransactionDurability=m,this.idbtrans=null,this.on=Zu(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new ne((y,v)=>{this._resolve=y,this._reject=v}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},y=>{var v=this.active;return this.active=!1,this.on.error.fire(y),this.parent?this.parent._reject(y):v&&this.idbtrans&&this.idbtrans.abort(),kt(y)})})}(this),this.Version=function(a){return pu(XT.prototype,function(c){this.db=a,this._cfg={version:c,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return pu(DA.prototype,function(c,d,u){this.db=a,this._ctx={table:c,index:d===":id"?null:d,or:u};const m=a._deps.indexedDB;if(!m)throw new de.MissingAPI;this._cmp=this._ascending=m.cmp.bind(m),this._descending=(p,y)=>m.cmp(y,p),this._max=(p,y)=>m.cmp(p,y)>0?p:y,this._min=(p,y)=>m.cmp(p,y)<0?p:y,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=dh(t.IDBKeyRange),this._createTransaction=(a,c,d,u)=>new this.Transaction(a,c,d,this._options.chromeTransactionDurability,u),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Qu.filter(c=>c.name===this.name&&c!==this&&!c._state.vcFired).map(c=>c.on("versionchange").fire(a))},this.use(tN),this.use(sN),this.use(rN),this.use(nN),this.vip=Object.create(this,{_vip:{value:!0}}),i.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new de.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new de.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var s=t.filter(i=>i._cfg.version===e)[0];return s||(s=new this.Version(e),t.push(s),t.sort(YT),s.stores({}),this._state.autoSchema=!1,s)}_whenReady(e){return this.idbdb&&(this._state.openComplete||ae.letThrough||this._vip)?e():new ne((t,s)=>{if(this._state.openComplete)return s(new de.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void s(new de.DatabaseClosed);this.open().catch($e)}this._state.dbReadyPromise.then(t,s)}).then(e)}use({stack:e,create:t,level:s,name:i}){i&&this.unuse({stack:e,name:i});const r=this._middlewares[e]||(this._middlewares[e]=[]);return r.push({stack:e,create:t,level:s??10,name:i}),r.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:t,create:s}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(i=>s?i.create!==s:!!t&&i.name!==t)),this}open(){return ZT(this)}_close(){const e=this._state,t=Qu.indexOf(this);if(t>=0&&Qu.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new ne(s=>{e.dbReadyResolve=s}),e.openCanceller=new ne((s,i)=>{e.cancelOpen=i})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new de.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new ne((s,i)=>{const r=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=st(()=>{(function({indexedDB:a,IDBKeyRange:c},d){!Ab(a)&&d!==qg&&_b(a,c).delete(d).catch($e)})(this._deps,this.name),s()}),o.onerror=ei(i),o.onblocked=this._fireOnBlocked};if(e)throw new de.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(r):r()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return vt(this._allTables).map(e=>this._allTables[e])}transaction(){const e=eN.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,s){let i=ae.trans;i&&i.db===this&&e.indexOf("!")===-1||(i=null);const r=e.indexOf("?")!==-1;let o,a;e=e.replace("!","").replace("?","");try{if(a=t.map(d=>{var u=d instanceof this.Table?d.name:d;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===d0)o=d0;else{if(e!="rw"&&e!=u0)throw new de.InvalidArgument("Invalid transaction mode: "+e);o=u0}if(i){if(i.mode===d0&&o===u0){if(!r)throw new de.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(d=>{if(i&&i.storeNames.indexOf(d)===-1){if(!r)throw new de.SubTransaction("Table "+d+" not included in parent transaction.");i=null}}),r&&i&&!i.active&&(i=null)}}catch(d){return i?i._promise(null,(u,m)=>{m(d)}):kt(d)}const c=OA.bind(null,this,o,a,i,s);return i?i._promise(o,c,"lock"):ae.trans?lu(ae.transless,()=>this._whenReady(c)):this._whenReady(c)}table(e){if(!en(this._allTables,e))throw new de.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const oN=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class aN{constructor(e){this._subscribe=e}subscribe(e,t,s){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:s})}[oN](){return this}}function BA(n,e){return vt(e).forEach(t=>{Jm(n[t]||(n[t]=new Vi),e[t])}),n}function lN(n){let e,t=!1;const s=new aN(i=>{const r=mb(n);let o=!1,a={},c={};const d={get closed(){return o},unsubscribe:()=>{o=!0,Qo.storagemutated.unsubscribe(y)}};i.start&&i.start(d);let u=!1,m=!1;function p(){return vt(c).some(x=>a[x]&&iN(a[x],c[x]))}const y=x=>{BA(a,x),p()&&v()},v=()=>{if(u||o)return;a={};const x={},b=function(w){r&&au();const S=()=>Jo(n,{subscr:w,trans:null}),A=ae.trans?lu(ae.transless,S):S();return r&&A.then(Fr,Fr),A}(x);m||(Qo(ch,y),m=!0),u=!0,Promise.resolve(b).then(w=>{t=!0,e=w,u=!1,o||(p()?v():(a={},c=x,i.next&&i.next(w)))},w=>{u=!1,t=!1,i.error&&i.error(w),d.unsubscribe()})};return v(),d});return s.hasValue=()=>t,s.getValue=()=>e,s}let dy;try{dy={indexedDB:Qe.indexedDB||Qe.mozIndexedDB||Qe.webkitIndexedDB||Qe.msIndexedDB,IDBKeyRange:Qe.IDBKeyRange||Qe.webkitIDBKeyRange}}catch{dy={indexedDB:null,IDBKeyRange:null}}const na=Fl;function im(n){let e=Tr;try{Tr=!0,Qo.storagemutated.fire(n)}finally{Tr=e}}su(na,{...Qp,delete:n=>new na(n,{addons:[]}).delete(),exists:n=>new na(n,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(n){try{return function({indexedDB:e,IDBKeyRange:t}){return Ab(e)?Promise.resolve(e.databases()).then(s=>s.map(i=>i.name).filter(i=>i!==qg)):_b(e,t).toCollection().primaryKeys()}(na.dependencies).then(n)}catch{return kt(new de.MissingAPI)}},defineClass:()=>function(n){xs(this,n)},ignoreTransaction:n=>ae.trans?lu(ae.transless,n):n(),vip:ay,async:function(n){return function(){try{var e=ly(n.apply(this,arguments));return e&&typeof e.then=="function"?e:ne.resolve(e)}catch(t){return kt(t)}}},spawn:function(n,e,t){try{var s=ly(n.apply(t,e||[]));return s&&typeof s.then=="function"?s:ne.resolve(s)}catch(i){return kt(i)}},currentTransaction:{get:()=>ae.trans||null},waitFor:function(n,e){const t=ne.resolve(typeof n=="function"?na.ignoreTransaction(n):n).timeout(e||6e4);return ae.trans?ae.trans.waitFor(t):t},Promise:ne,debug:{get:()=>Di,set:n=>{yA(n,n==="dexie"?()=>!0:PA)}},derive:pc,extend:xs,props:su,override:uA,Events:Zu,on:Qo,liveQuery:lN,extendObservabilitySet:BA,getByKeyPath:Pr,setByKeyPath:zn,delByKeyPath:function(n,e){typeof e=="string"?zn(n,e,void 0):"length"in e&&[].map.call(e,function(t){zn(n,t,void 0)})},shallowClone:pA,deepClone:gp,getObjectDiff:Sb,cmp:ms,asap:hA,minKey:Z0,addons:[],connections:Qu,errnames:yb,dependencies:dy,semVer:pv,version:pv.split(".").map(n=>parseInt(n)).reduce((n,e,t)=>n+e/Math.pow(10,2*t))}),na.maxKey=dh(na.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Qo(ch,n=>{if(!Tr){let e;Gg?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Jr,!0,!0,n)):e=new CustomEvent(Jr,{detail:n}),Tr=!0,dispatchEvent(e),Tr=!1}}),addEventListener(Jr,({detail:n})=>{Tr||im(n)}));let Tr=!1;if(typeof BroadcastChannel<"u"){const n=new BroadcastChannel(Jr);typeof n.unref=="function"&&n.unref(),Qo(ch,e=>{Tr||n.postMessage(e)}),n.onmessage=e=>{e.data&&im(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Qo(ch,e=>{try{Tr||(typeof localStorage<"u"&&localStorage.setItem(Jr,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(t=>t.postMessage({type:Jr,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Jr){const t=JSON.parse(e.newValue);t&&im(t.changedParts)}});const n=self.document&&navigator.serviceWorker;n&&n.addEventListener("message",function({data:e}){e&&e.type===Jr&&im(e.changedParts)})}ne.rejectionMapper=function(n,e){if(!n||n instanceof mc||n instanceof TypeError||n instanceof SyntaxError||!n.name||!dv[n.name])return n;var t=new dv[n.name](e||n.message,n);return"stack"in n&&Ir(t,"stack",{get:function(){return this.inner.stack}}),t},yA(Di,PA);class cN extends Fl{constructor(){super("FTCManagerDB");W(this,"tasks");W(this,"checklists");W(this,"scoutingReports");W(this,"matchPlans");W(this,"syncQueue");W(this,"members");W(this,"teams");this.version(1).stores({tasks:"id, organizationId, teamId, status, syncStatus, updatedAt",checklists:"id, organizationId, syncStatus",scoutingReports:"id, organizationId, opponentTeamNumber, matchNumber, syncStatus",matchPlans:"id, organizationId, syncStatus",syncQueue:"id, tableName, timestamp, retryCount",members:"id, organizationId, syncStatus",teams:"id, organizationId, syncStatus"})}}const Eu=new cN;function Fi(){return crypto.randomUUID()}async function _v(){return await Eu.syncQueue.count()}const dN={},Av=n=>{let e;const t=new Set,s=(u,m)=>{const p=typeof u=="function"?u(e):u;if(!Object.is(p,e)){const y=e;e=m??(typeof p!="object"||p===null)?p:Object.assign({},e,p),t.forEach(v=>v(e,y))}},i=()=>e,c={setState:s,getState:i,getInitialState:()=>d,subscribe:u=>(t.add(u),()=>t.delete(u)),destroy:()=>{(dN?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},d=e=n(s,i,c);return c},uN=n=>n?Av(n):Av;var HA={exports:{}},GA={},qA={exports:{}},VA={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nu=F;function hN(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var fN=typeof Object.is=="function"?Object.is:hN,pN=nu.useState,mN=nu.useEffect,gN=nu.useLayoutEffect,yN=nu.useDebugValue;function xN(n,e){var t=e(),s=pN({inst:{value:t,getSnapshot:e}}),i=s[0].inst,r=s[1];return gN(function(){i.value=t,i.getSnapshot=e,g0(i)&&r({inst:i})},[n,t,e]),mN(function(){return g0(i)&&r({inst:i}),n(function(){g0(i)&&r({inst:i})})},[n]),yN(t),t}function g0(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!fN(n,t)}catch{return!0}}function bN(n,e){return e()}var vN=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?bN:xN;VA.useSyncExternalStore=nu.useSyncExternalStore!==void 0?nu.useSyncExternalStore:vN;qA.exports=VA;var wN=qA.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vg=F,_N=wN;function AN(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var SN=typeof Object.is=="function"?Object.is:AN,CN=_N.useSyncExternalStore,EN=Vg.useRef,kN=Vg.useEffect,TN=Vg.useMemo,NN=Vg.useDebugValue;GA.useSyncExternalStoreWithSelector=function(n,e,t,s,i){var r=EN(null);if(r.current===null){var o={hasValue:!1,value:null};r.current=o}else o=r.current;r=TN(function(){function c(y){if(!d){if(d=!0,u=y,y=s(y),i!==void 0&&o.hasValue){var v=o.value;if(i(v,y))return m=v}return m=y}if(v=m,SN(u,y))return v;var x=s(y);return i!==void 0&&i(v,x)?(u=y,v):(u=y,m=x)}var d=!1,u,m,p=t===void 0?null:t;return[function(){return c(e())},p===null?void 0:function(){return c(p())}]},[e,t,s,i]);var a=CN(n,r[0],r[1]);return kN(function(){o.hasValue=!0,o.value=a},[a]),NN(a),a};HA.exports=GA;var IN=HA.exports;const PN=Ik(IN),$A={},{useDebugValue:RN}=tA,{useSyncExternalStoreWithSelector:MN}=PN;let Sv=!1;const DN=n=>n;function LN(n,e=DN,t){($A?"production":void 0)!=="production"&&t&&!Sv&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Sv=!0);const s=MN(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return RN(s),s}const FN=n=>{($A?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?uN(n):n,t=(s,i)=>LN(e,s,i);return Object.assign(t,e),t},jN=n=>FN,ON={};function UN(n,e){let t;try{t=n()}catch{return}return{getItem:i=>{var r;const o=c=>c===null?null:JSON.parse(c,void 0),a=(r=t.getItem(i))!=null?r:null;return a instanceof Promise?a.then(o):o(a)},setItem:(i,r)=>t.setItem(i,JSON.stringify(r,void 0)),removeItem:i=>t.removeItem(i)}}const hh=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(s){return hh(s)(t)},catch(s){return this}}}catch(t){return{then(s){return this},catch(s){return hh(s)(t)}}}},BN=(n,e)=>(t,s,i)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:b=>b,version:0,merge:(b,w)=>({...w,...b}),...e},o=!1;const a=new Set,c=new Set;let d;try{d=r.getStorage()}catch{}if(!d)return n((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...b)},s,i);const u=hh(r.serialize),m=()=>{const b=r.partialize({...s()});let w;const S=u({state:b,version:r.version}).then(A=>d.setItem(r.name,A)).catch(A=>{w=A});if(w)throw w;return S},p=i.setState;i.setState=(b,w)=>{p(b,w),m()};const y=n((...b)=>{t(...b),m()},s,i);let v;const x=()=>{var b;if(!d)return;o=!1,a.forEach(S=>S(s()));const w=((b=r.onRehydrateStorage)==null?void 0:b.call(r,s()))||void 0;return hh(d.getItem.bind(d))(r.name).then(S=>{if(S)return r.deserialize(S)}).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==r.version){if(r.migrate)return r.migrate(S.state,S.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return S.state}).then(S=>{var A;return v=r.merge(S,(A=s())!=null?A:y),t(v,!0),m()}).then(()=>{w==null||w(v,void 0),o=!0,c.forEach(S=>S(v))}).catch(S=>{w==null||w(void 0,S)})};return i.persist={setOptions:b=>{r={...r,...b},b.getStorage&&(d=b.getStorage())},clearStorage:()=>{d==null||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:b=>(a.add(b),()=>{a.delete(b)}),onFinishHydration:b=>(c.add(b),()=>{c.delete(b)})},x(),v||y},HN=(n,e)=>(t,s,i)=>{let r={storage:UN(()=>localStorage),partialize:x=>x,version:0,merge:(x,b)=>({...b,...x}),...e},o=!1;const a=new Set,c=new Set;let d=r.storage;if(!d)return n((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),t(...x)},s,i);const u=()=>{const x=r.partialize({...s()});return d.setItem(r.name,{state:x,version:r.version})},m=i.setState;i.setState=(x,b)=>{m(x,b),u()};const p=n((...x)=>{t(...x),u()},s,i);i.getInitialState=()=>p;let y;const v=()=>{var x,b;if(!d)return;o=!1,a.forEach(S=>{var A;return S((A=s())!=null?A:p)});const w=((b=r.onRehydrateStorage)==null?void 0:b.call(r,(x=s())!=null?x:p))||void 0;return hh(d.getItem.bind(d))(r.name).then(S=>{if(S)if(typeof S.version=="number"&&S.version!==r.version){if(r.migrate)return[!0,r.migrate(S.state,S.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,S.state];return[!1,void 0]}).then(S=>{var A;const[k,T]=S;if(y=r.merge(T,(A=s())!=null?A:p),t(y,!0),k)return u()}).then(()=>{w==null||w(y,void 0),y=s(),o=!0,c.forEach(S=>S(y))}).catch(S=>{w==null||w(void 0,S)})};return i.persist={setOptions:x=>{r={...r,...x},x.storage&&(d=x.storage)},clearStorage:()=>{d==null||d.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>v(),hasHydrated:()=>o,onHydrate:x=>(a.add(x),()=>{a.delete(x)}),onFinishHydration:x=>(c.add(x),()=>{c.delete(x)})},r.skipHydration||v(),y||p},GN=(n,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?((ON?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),BN(n,e)):HN(n,e),qN=GN,zA="ftc-sync-queue";function WA(){try{const n=localStorage.getItem(zA);return n?JSON.parse(n):[]}catch{return[]}}function uy(n){localStorage.setItem(zA,JSON.stringify(n))}function Oi(n,e,t){const s=WA(),i=s.filter(r=>{var o;return!(r.table===n&&((o=r.data)==null?void 0:o.id)===(t==null?void 0:t.id))});if(e==="delete"&&s.some(o=>{var a;return o.table===n&&((a=o.data)==null?void 0:a.id)===(t==null?void 0:t.id)&&o.action==="create"})){uy(i);return}i.push({id:crypto.randomUUID(),table:n,action:e,data:t,timestamp:Date.now()}),uy(i)}function cu(){return navigator.onLine}async function KA(n){if(!bn()||!z)return console.log("Supabase not configured, using local data only"),null;if(!cu())return console.log("Offline, using local data"),null;try{const e=z,[t,s,i,r,o,a,c,d]=await Promise.all([e.from("seasons").select("*").eq("organization_id",n),e.from("tasks").select("*").eq("organization_id",n),e.from("scouting_reports").select("*").eq("organization_id",n),e.from("checklist_items").select("*").eq("organization_id",n),e.from("match_plans").select("*").eq("organization_id",n),e.from("portfolio_history").select("*").eq("organization_id",n),e.from("sub_teams").select("*").eq("organization_id",n),e.from("roster_members").select("*").eq("organization_id",n)]);return{seasons:t.data||[],tasks:s.data||[],scoutingReports:i.data||[],checklistItems:r.data||[],matchPlans:o.data||[],portfolioHistory:a.data||[],subTeams:c.data||[],rosterMembers:d.data||[]}}catch(e){return console.error("Error fetching org data:",e),null}}async function YA(n,e){if(!bn()||!z||!cu())return!1;try{const t=z,{error:s}=await t.from(n).upsert(e,{onConflict:"id"});return s?(console.error(`Error upserting to ${n}:`,s),!1):!0}catch(t){return console.error(`Error pushing to ${n}:`,t),!1}}async function JA(n,e){if(!bn()||!z||!cu())return!1;try{const t=z,{error:s}=await t.from(n).delete().eq("id",e);return s?(console.error(`Error deleting from ${n}:`,s),!1):!0}catch(t){return console.error(`Error deleting from ${n}:`,t),!1}}async function XA(){if(!cu())return 0;const n=WA();if(n.length===0)return 0;let e=0;const t=[];for(const s of n){let i=!1;s.action==="delete"?i=await JA(s.table,s.data.id):i=await YA(s.table,s.data),i?e++:t.push(s)}return uy(t),e}async function QA(n){if(!(!bn()||!z||!cu()))try{const e=z,{data:t}=await e.from("seasons").select("id").eq("organization_id",n).limit(1);if(t&&t.length>0)return;const s=crypto.randomUUID();await e.from("seasons").insert({id:s,organization_id:n,name:"2025-2026 Season",field_image_url:""});const i=["Build","Programming","Drive","Scouting","Outreach"];await e.from("sub_teams").insert(i.map(o=>({id:crypto.randomUUID(),organization_id:n,season_id:s,name:o,member_ids:[]})));const r=["Turn off robot","Swap main battery","Charge old battery","Charge Driver Hub","Tighten chassis screws","Check wiring connections","Clean wheels","Reset servo positions"];await e.from("checklist_items").insert(r.map((o,a)=>({id:crypto.randomUUID(),organization_id:n,season_id:s,text:o,checked:!1,assigned_to:"",sort_order:a}))),console.log("Initialized default data for organization:",n)}catch(e){console.error("Error initializing org defaults:",e)}}function VN(n){const e=async()=>{console.log("Back online, processing sync queue...");const t=await XA();t>0&&(console.log(`Synced ${t} items`),n())};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}}const $N=Object.freeze(Object.defineProperty({__proto__:null,deleteFromSupabase:JA,fetchOrgData:KA,initializeOrgDefaults:QA,isOnline:cu,processSyncQueue:XA,pushToSupabase:YA,queueSyncItem:Oi,setupSyncListeners:VN},Symbol.toStringTag,{value:"Module"})),mu={id:"f47ac10b-58cc-4372-a567-0e02b2c3d479",name:"2025-2026 Decode",fieldImageUrl:"",createdAt:Date.now()},Cv=[],Ev=[{id:"a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d",name:"Build",memberIds:[]},{id:"b2c3d4e5-f6a7-5b6c-9d0e-1f2a3b4c5d6e",name:"Programming",memberIds:[]},{id:"c3d4e5f6-a7b8-6c7d-0e1f-2a3b4c5d6e7f",name:"Drive",memberIds:[]},{id:"d4e5f6a7-b8c9-7d8e-1f2a-3b4c5d6e7f8a",name:"Scouting",memberIds:[]},{id:"e5f6a7b8-c9d0-8e9f-2a3b-4c5d6e7f8a9b",name:"Outreach",memberIds:[]}],y0=[{id:"11111111-1111-4111-8111-111111111111",text:"Turn off robot",checked:!1},{id:"22222222-2222-4222-8222-222222222222",text:"Swap main battery",checked:!1},{id:"33333333-3333-4333-8333-333333333333",text:"Charge old battery",checked:!1},{id:"44444444-4444-4444-8444-444444444444",text:"Charge Driver Hub",checked:!1},{id:"55555555-5555-4555-8555-555555555555",text:"Tighten chassis screws",checked:!1},{id:"66666666-6666-4666-8666-666666666666",text:"Check wiring connections",checked:!1},{id:"77777777-7777-4777-8777-777777777777",text:"Clean wheels",checked:!1},{id:"88888888-8888-4888-8888-888888888888",text:"Reset servo positions",checked:!1}],Xe=jN()(qN((n,e)=>({currentOrganizationId:null,tasks:[],members:Cv,teams:Ev,scoutingReports:[],checklist:y0,matchPlans:[],portfolioHistory:[],seasons:[mu],currentSeasonId:mu.id,theme:"dark",geminiApiKey:null,setCurrentOrganizationId:async t=>{const s=e(),i=s.currentOrganizationId;if(i){const a={tasks:s.tasks,members:s.members,teams:s.teams,scoutingReports:s.scoutingReports,checklist:s.checklist,matchPlans:s.matchPlans,portfolioHistory:s.portfolioHistory,seasons:s.seasons,currentSeasonId:s.currentSeasonId};localStorage.setItem(`ftc-storage-${i}`,JSON.stringify(a))}if(n({currentOrganizationId:t}),!t){e().resetToDefaults();return}const r=localStorage.getItem(`ftc-storage-${t}`);if(r)try{const a=JSON.parse(r);n({...a})}catch(a){console.error("Failed to parse local data",a)}else e().resetToDefaults();const o=await KA(t);if(o){n({seasons:o.seasons||[mu],tasks:o.tasks||[],scoutingReports:o.scoutingReports||[],checklist:o.checklistItems||y0,matchPlans:o.matchPlans||[],portfolioHistory:o.portfolioHistory||[]});const a=e(),c={tasks:a.tasks,members:a.members,teams:a.teams,scoutingReports:a.scoutingReports,checklist:a.checklist,matchPlans:a.matchPlans,portfolioHistory:a.portfolioHistory,seasons:a.seasons,currentSeasonId:a.currentSeasonId};localStorage.setItem(`ftc-storage-${t}`,JSON.stringify(c))}else r||(await QA(t),e().seasons.length===0&&n({seasons:[mu],currentSeasonId:mu.id}))},setTheme:t=>{n({theme:t}),t==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},setGeminiApiKey:t=>n({geminiApiKey:t}),addTask:t=>{const s={...t,id:Fi(),createdAt:Date.now(),seasonId:e().currentSeasonId||void 0,timeline:[{id:Fi(),type:"history",authorId:"System",content:"Task created",timestamp:Date.now()}]};n(i=>({tasks:[...i.tasks,s]})),Oi("tasks","create",s)},updateTask:(t,s)=>{n(r=>({tasks:r.tasks.map(o=>o.id===t?{...o,...s}:o)}));const i=e().tasks.find(r=>r.id===t);i&&Oi("tasks","update",{...i,...s})},deleteTask:t=>{n(s=>({tasks:s.tasks.filter(i=>i.id!==t)})),Oi("tasks","delete",{id:t})},addMember:(t,s)=>{const i={id:Fi(),firstName:t,lastNameInitial:s,seasonId:e().currentSeasonId||void 0};n(r=>({members:[...r.members,i]}))},removeMember:t=>{n(s=>({members:s.members.filter(i=>i.id!==t),teams:s.teams.map(i=>({...i,memberIds:i.memberIds.filter(r=>r!==t)}))}))},setMembers:t=>n({members:t}),addTeam:t=>{const s={id:Fi(),name:t,memberIds:[],seasonId:e().currentSeasonId||void 0};n(i=>({teams:[...i.teams,s]}))},removeTeam:t=>{n(s=>({teams:s.teams.filter(i=>i.id!==t)}))},toggleMemberInTeam:(t,s)=>{n(i=>({teams:i.teams.map(r=>{if(r.id!==t)return r;const o=r.memberIds.includes(s)?r.memberIds.filter(a=>a!==s):[...r.memberIds,s];return{...r,memberIds:o}})}))},setTeams:t=>n({teams:t}),addScoutingReport:t=>{const s={...t,id:Fi(),seasonId:e().currentSeasonId||void 0};n(i=>({scoutingReports:[...i.scoutingReports,s]})),Oi("scouting_reports","create",s)},deleteScoutingReport:t=>{n(s=>({scoutingReports:s.scoutingReports.filter(i=>i.id!==t)})),Oi("scouting_reports","delete",{id:t})},toggleChecklistItem:t=>{n(s=>({checklist:s.checklist.map(i=>i.id===t?{...i,checked:!i.checked}:i)}))},resetChecklist:()=>{n(t=>({checklist:t.checklist.map(s=>({...s,checked:!1}))}))},addChecklistItem:t=>{const s={id:Fi(),text:t,checked:!1,seasonId:e().currentSeasonId||void 0};n(i=>({checklist:[...i.checklist,s]}))},deleteChecklistItem:t=>{n(s=>({checklist:s.checklist.filter(i=>i.id!==t)}))},updateChecklistAssignment:(t,s)=>{n(i=>({checklist:i.checklist.map(r=>r.id===t?{...r,assignedTo:s}:r)}))},addMatchPlan:t=>{const s={...t,id:Fi(),updatedAt:Date.now(),seasonId:e().currentSeasonId||void 0};n(i=>({matchPlans:[...i.matchPlans,s]})),Oi("match_plans","create",s)},deleteMatchPlan:t=>{n(s=>({matchPlans:s.matchPlans.filter(i=>i.id!==t)})),Oi("match_plans","delete",{id:t})},updateMatchPlan:(t,s)=>{n(r=>({matchPlans:r.matchPlans.map(o=>o.id===t?{...o,...s,updatedAt:Date.now()}:o)}));const i=e().matchPlans.find(r=>r.id===t);i&&Oi("match_plans","update",{...i,...s})},addPortfolioEntry:(t,s)=>{const i={id:Fi(),content:t,createdAt:Date.now(),taskCount:s,seasonId:e().currentSeasonId||void 0};n(r=>({portfolioHistory:[i,...r.portfolioHistory]}))},deletePortfolioEntry:t=>{n(s=>({portfolioHistory:s.portfolioHistory.filter(i=>i.id!==t)}))},addSeason:(t,s="")=>{const i={id:Fi(),name:t,fieldImageUrl:s,createdAt:Date.now()};n(r=>({seasons:[...r.seasons,i],currentSeasonId:i.id}))},updateSeason:(t,s)=>{n(i=>({seasons:i.seasons.map(r=>r.id===t?{...r,...s}:r)}))},deleteSeason:t=>{e().seasons.length<=1||n(i=>{var r;return{seasons:i.seasons.filter(o=>o.id!==t),tasks:i.tasks.filter(o=>o.seasonId!==t),members:i.members.filter(o=>o.seasonId!==t),teams:i.teams.filter(o=>o.seasonId!==t),scoutingReports:i.scoutingReports.filter(o=>o.seasonId!==t),checklist:i.checklist.filter(o=>o.seasonId!==t),matchPlans:i.matchPlans.filter(o=>o.seasonId!==t),portfolioHistory:i.portfolioHistory.filter(o=>o.seasonId!==t),currentSeasonId:i.currentSeasonId===t?((r=i.seasons.find(o=>o.id!==t))==null?void 0:r.id)||null:i.currentSeasonId}})},setCurrentSeason:t=>n({currentSeasonId:t}),getCurrentSeason:()=>{const t=e();return t.seasons.find(s=>s.id===t.currentSeasonId)||null},initializeStore:async()=>{const t=e();t.currentOrganizationId&&t.setCurrentOrganizationId(t.currentOrganizationId)},resetToDefaults:()=>{n({tasks:[],members:Cv,teams:Ev,scoutingReports:[],checklist:y0,matchPlans:[]})}}),{name:"ftc-global-storage",partialize:n=>({theme:n.theme,currentOrganizationId:n.currentOrganizationId,geminiApiKey:n.geminiApiKey})}));if(typeof window<"u"){const n=localStorage.getItem("ftc-team-manager-storage");if(n)try{const{state:e}=JSON.parse(n);(e==null?void 0:e.theme)==="dark"&&document.documentElement.classList.add("dark")}catch{}}const x0=Object.freeze(Object.defineProperty({__proto__:null,useAppStore:Xe},Symbol.toStringTag,{value:"Module"})),zN={tasks:"tasks",scoutingReports:"scouting_reports",matchPlans:"match_plans",members:"members",teams:"teams",checklist:"checklist_items",portfolioHistory:"portfolio_history",seasons:"seasons"};function th(n,e,t){const s={user_id:t,updated_at:new Date().toISOString()};switch(n){case"tasks":return{...s,id:e.id,season_id:e.seasonId||null,title:e.title,description:e.description||"",status:e.status,type:e.type,assigned_to:e.assignedTo||"",department:e.department||"",tags:e.tags||[],checklist:e.checklist||[],timeline:e.timeline||[],due_date:e.dueDate?new Date(e.dueDate).toISOString():null,created_at:new Date(e.createdAt).toISOString()};case"scoutingReports":return{...s,id:e.id,season_id:e.seasonId||null,team_number:e.teamNumber,match_number:e.matchNumber,has_autonomous:e.hasAutonomous,auto_score:e.autoScore,intake_type:e.intakeType,auto_aim:e.autoAim,far_shooting:e.farShooting,shots_taken:e.shotsTaken,shots_missed:e.shotsMissed,parking:e.parking,rating:e.rating,end_game_notes:e.endGameNotes};case"matchPlans":return{...s,id:e.id,season_id:e.seasonId||null,title:e.title,drawing_data:e.drawingData||{},notes:e.notes||"",alliance_team:e.allianceTeam||"",partner_autonomous:e.partnerAutonomous||!1,partner_park:e.partnerPark||!1};case"checklist":return{...s,id:e.id,season_id:e.seasonId||null,text:e.text,checked:e.checked,assigned_to:e.assignedTo||""};case"members":return{...s,id:e.id,season_id:e.seasonId||null,first_name:e.firstName,last_name_initial:e.lastNameInitial};case"teams":return{...s,id:e.id,season_id:e.seasonId||null,name:e.name,member_ids:e.memberIds||[]};case"portfolioHistory":return{...s,id:e.id,season_id:e.seasonId||null,content:e.content,task_count:e.taskCount,created_at:new Date(e.createdAt).toISOString()};case"seasons":return{...s,id:e.id,name:e.name,field_image_url:e.fieldImageUrl||"",created_at:new Date(e.createdAt).toISOString()};default:return{...s,...e}}}function $r(n,e){switch(n){case"tasks":return{id:e.id,seasonId:e.season_id,title:e.title,description:e.description,status:e.status,type:e.type,assignedTo:e.assigned_to,department:e.department,tags:e.tags||[],checklist:e.checklist||[],timeline:e.timeline||[],dueDate:e.due_date?new Date(e.due_date).getTime():void 0,createdAt:new Date(e.created_at).getTime()};case"scouting_reports":return{id:e.id,seasonId:e.season_id,teamNumber:e.team_number,matchNumber:e.match_number,hasAutonomous:e.has_autonomous,autoScore:e.auto_score,intakeType:e.intake_type,autoAim:e.auto_aim,farShooting:e.far_shooting,shotsTaken:e.shots_taken,shotsMissed:e.shots_missed,parking:e.parking,rating:e.rating,endGameNotes:e.end_game_notes};case"match_plans":return{id:e.id,seasonId:e.season_id,title:e.title,drawingData:e.drawing_data,notes:e.notes,allianceTeam:e.alliance_team,partnerAutonomous:e.partner_autonomous,partnerPark:e.partner_park,updatedAt:new Date(e.updated_at).getTime()};case"checklist_items":return{id:e.id,seasonId:e.season_id,text:e.text,checked:e.checked,assignedTo:e.assigned_to};case"members":return{id:e.id,seasonId:e.season_id,firstName:e.first_name,lastNameInitial:e.last_name_initial};case"teams":return{id:e.id,seasonId:e.season_id,name:e.name,memberIds:e.member_ids||[]};case"portfolio_history":return{id:e.id,seasonId:e.season_id,content:e.content,taskCount:e.task_count,createdAt:new Date(e.created_at).getTime()};case"seasons":return{id:e.id,name:e.name,fieldImageUrl:e.field_image_url,createdAt:new Date(e.created_at).getTime()};default:return e}}function ZA(){const[n,e]=F.useState(navigator.onLine),[t,s]=F.useState("idle"),[i,r]=F.useState(0),[o,a]=F.useState(null),[c,d]=F.useState(null),u=F.useRef(!1);F.useEffect(()=>{const p=()=>{e(!0),s("idle")},y=()=>{e(!1),s("offline"),u.current=!1};return window.addEventListener("online",p),window.addEventListener("offline",y),()=>{window.removeEventListener("online",p),window.removeEventListener("offline",y)}},[]),F.useEffect(()=>{const p=async()=>{const v=await _v();r(v)};p();const y=setInterval(p,5e3);return()=>clearInterval(y)},[]),F.useEffect(()=>{n&&i>0&&t==="idle"&&!u.current&&m()},[n,i,t]);const m=F.useCallback(async()=>{if(!u.current){if(!n||!z){s("offline");return}u.current=!0,s("syncing"),d(null);try{const{data:{user:p}}=await z.auth.getUser();if(!p)throw new Error("Not authenticated");console.log("[Sync] Starting sync for user:",p.id);const y=await Eu.syncQueue.toArray();console.log("[Sync] Pending items to sync:",y.length);for(const x of y)try{console.log("[Sync] Processing item:",x.tableName,x.operation,x.recordId),await WN(x,p.id),await Eu.syncQueue.delete(x.id),console.log("[Sync] Successfully synced item:",x.recordId)}catch(b){console.error("[Sync] Failed to sync item:",x.tableName,x.recordId,(b==null?void 0:b.message)||b);const w=(x.retryCount||0)+1;w>=5?(console.error(`[Sync] Item ${x.id} failed after 5 retries. Removing from queue.`),await Eu.syncQueue.delete(x.id)):await Eu.syncQueue.update(x.id,{retryCount:w,lastError:b instanceof Error?b.message:"Unknown error"})}await eS(p.id),a(new Date),s("idle");const v=await _v();r(v)}catch(p){console.error("Sync failed:",p),d(p instanceof Error?p.message:"Sync failed"),s("error")}finally{u.current=!1}}},[n]);return{isOnline:n,syncStatus:t,pendingChanges:i,lastSyncTime:o,sync:m,error:c}}async function WN(n,e){if(!z)throw new Error("Supabase not configured");const{tableName:t,operation:s,data:i,recordId:r}=n,o=zN[t]||t;switch(s){case"create":const a=th(t,i,e),{error:c}=await z.from(o).upsert(a,{onConflict:"id"});if(c)throw c;break;case"update":const d=th(t,i,e),{error:u}=await z.from(o).update(d).eq("id",r);if(u)throw u;break;case"delete":const{error:m}=await z.from(o).delete().eq("id",r);if(m)throw m;break}}async function eS(n){if(z)try{const[{data:e},{data:t},{data:s},{data:i},{data:r},{data:o},{data:a},{data:c}]=await Promise.all([z.from("tasks").select("*").eq("user_id",n),z.from("scouting_reports").select("*").eq("user_id",n),z.from("match_plans").select("*").eq("user_id",n),z.from("checklist_items").select("*").eq("user_id",n),z.from("members").select("*").eq("user_id",n),z.from("teams").select("*").eq("user_id",n),z.from("portfolio_history").select("*").eq("user_id",n),z.from("seasons").select("*").eq("user_id",n)]);e&&e.length>0&&Xe.setState({tasks:e.map(d=>$r("tasks",d))}),t&&t.length>0&&Xe.setState({scoutingReports:t.map(d=>$r("scouting_reports",d))}),s&&s.length>0&&Xe.setState({matchPlans:s.map(d=>$r("match_plans",d))}),i&&i.length>0&&Xe.setState({checklist:i.map(d=>$r("checklist_items",d))}),r&&r.length>0&&Xe.setState({members:r.map(d=>$r("members",d))}),o&&o.length>0&&Xe.setState({teams:o.map(d=>$r("teams",d))}),a&&a.length>0&&Xe.setState({portfolioHistory:a.map(d=>$r("portfolio_history",d))}),c&&c.length>0&&Xe.setState({seasons:c.map(d=>$r("seasons",d))}),console.log("Pull from server completed")}catch(e){throw console.error("Failed to pull changes from server:",e),e}}async function KN(){if(!z)return;const{data:{user:n}}=await z.auth.getUser();n&&(await YN(n.id),await eS(n.id))}async function YN(n){if(!z)return;const e=Xe.getState(),{data:t}=await z.from("seasons").select("id").eq("user_id",n).limit(1);if(!t||t.length===0){console.log("Initializing default data for new user...");for(const s of e.seasons){const i=th("seasons",s,n),{error:r}=await z.from("seasons").upsert(i,{onConflict:"id"});r&&console.error("Failed to initialize season:",r)}for(const s of e.teams){const i=th("teams",s,n),{error:r}=await z.from("teams").upsert(i,{onConflict:"id"});r&&console.error("Failed to initialize team:",r)}for(const s of e.checklist){const i=th("checklist",s,n),{error:r}=await z.from("checklist_items").upsert(i,{onConflict:"id"});r&&console.error("Failed to initialize checklist item:",r)}console.log("Default data initialization complete")}}const tS=F.createContext(void 0);function JN({children:n}){const[e,t]=F.useState({user:null,session:null,isLoading:!0,isConfigured:bn()});F.useEffect(()=>{if(!z){t(w=>({...w,isLoading:!1}));return}const x=setTimeout(()=>{t(w=>w.isLoading?(console.warn("Auth check timed out, proceeding to app..."),{...w,isLoading:!1}):w)},1500);z.auth.getSession().then(({data:{session:w}})=>{clearTimeout(x),t(S=>({...S,session:w,user:(w==null?void 0:w.user)??null,isLoading:!1}))}).catch(w=>{console.error("Auth session error:",w),clearTimeout(x),t(S=>({...S,isLoading:!1}))});const{data:{subscription:b}}=z.auth.onAuthStateChange(async(w,S)=>{t(A=>({...A,session:S,user:(S==null?void 0:S.user)??null,isLoading:!1})),w==="SIGNED_IN"&&(S!=null&&S.user)&&(await s(S.user),await KN())});return()=>{b.unsubscribe()}},[]);const s=async x=>{if(!z)return;const{data:b}=await z.from("users").select("id").eq("id",x.id).single();b||await z.from("users").insert({id:x.id,email:x.email,full_name:x.user_metadata.full_name||x.user_metadata.name||null,avatar_url:x.user_metadata.avatar_url||null})},i=F.useCallback(async(x,b)=>{if(!z)return{error:{message:"Supabase not configured"}};const{error:w}=await z.auth.signInWithPassword({email:x,password:b});return{error:w}},[]),r=F.useCallback(async x=>{if(!z)return{error:new Error("Supabase not configured")};if(!x.confirmedAge18Plus)return{error:new Error("You must be 18 years or older to create a coach account")};if(!x.acceptedTerms)return{error:new Error("You must accept the Terms and Conditions")};if(!x.acknowledgedCoppaResponsibility)return{error:new Error("You must acknowledge responsibility for COPPA compliance")};const{data:b,error:w}=await z.auth.signUp({email:x.email,password:x.password,options:{data:{full_name:x.fullName,account_type:"coach"}}});if(w)return{error:w};if(b.user){const S=new Date().toISOString();await z.from("users").upsert({id:b.user.id,email:x.email,full_name:x.fullName,account_type:"coach",age_confirmed_18_plus:!0,age_confirmed_13_plus:!0,terms_accepted_at:S,community_guidelines_acknowledged_at:S,privacy_policy_acknowledged_at:S})}return{error:null}},[]),o=F.useCallback(async x=>{if(!z)return{error:new Error("Supabase not configured")};if(!x.confirmedAge13Plus)return{error:new Error("You must be at least 13 years old to create an account. Please ask a parent or guardian to contact your team coach.")};if(!x.acknowledgedPrivacyPolicy)return{error:new Error("You must acknowledge the Privacy Policy")};if(!x.acknowledgedCommunityGuidelines)return{error:new Error("You must acknowledge the Community Guidelines")};const{data:b,error:w}=await z.auth.signUp({email:x.email,password:x.password,options:{data:{full_name:x.fullName,account_type:"standard",invite_code:x.inviteCode||null}}});if(w)return{error:w};if(b.user){const S=new Date().toISOString();await z.from("users").upsert({id:b.user.id,email:x.email,full_name:x.fullName,account_type:"standard",age_confirmed_13_plus:!0,age_confirmed_18_plus:!1,community_guidelines_acknowledged_at:S,privacy_policy_acknowledged_at:S})}return{error:null}},[]),a=F.useCallback(async(x,b,w)=>{if(!z)return{error:{message:"Supabase not configured"}};const{error:S}=await z.auth.signUp({email:x,password:b,options:{data:{full_name:w}}});return{error:S}},[]),c=F.useCallback(async()=>{if(!z)return{error:{message:"Supabase not configured"}};const{error:x}=await z.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});return{error:x}},[]),d=F.useCallback(async()=>{if(!z)return{error:{message:"Supabase not configured"}};const{error:x}=await z.auth.signInWithOAuth({provider:"azure",options:{redirectTo:`${window.location.origin}/auth/callback`,scopes:"email profile openid"}});return{error:x}},[]),u=F.useCallback(async()=>{z&&await z.auth.signOut()},[]),m=F.useCallback(async x=>{if(!z)return{error:{message:"Supabase not configured"}};const{error:b}=await z.auth.resetPasswordForEmail(x,{redirectTo:`${window.location.origin}/auth/reset-password`});return{error:b}},[]),p=F.useCallback(async x=>{if(!z)return{error:{message:"Supabase not configured"}};const{data:b,error:w}=await z.auth.updateUser({data:{full_name:x}});return!w&&b.user&&t(S=>({...S,user:b.user})),{error:w}},[]),y=F.useCallback(async x=>{if(!z||!e.user)return{error:new Error("Not authenticated")};const{error:b}=await z.from("users").update(x).eq("id",e.user.id);return b?{error:new Error(b.message)}:{error:null}},[e.user]),v={...e,signInWithEmail:i,signUpWithEmail:a,signUpAsCoach:r,signUpAsStudentOrMentor:o,signInWithGoogle:c,signInWithMicrosoft:d,signOut:u,resetPassword:m,updateProfile:p,updateComplianceInfo:y};return h.jsx(tS.Provider,{value:v,children:n})}function Cn(){const n=F.useContext(tS);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n}const hy="ftc-current-user-cache",sS=F.createContext(void 0);function kv(){try{const n=localStorage.getItem(hy);if(n)return JSON.parse(n)}catch(n){console.warn("Failed to parse cached user:",n)}return null}function b0(n){try{n?localStorage.setItem(hy,JSON.stringify(n)):localStorage.removeItem(hy)}catch(e){console.warn("Failed to cache user:",e)}}function XN({children:n}){var v;const{user:e,session:t,isLoading:s,isConfigured:i}=Cn(),[r,o]=F.useState(kv),[a,c]=F.useState(!0),[d,u]=F.useState(!navigator.onLine);F.useEffect(()=>{const x=()=>u(!1),b=()=>u(!0);return window.addEventListener("online",x),window.addEventListener("offline",b),()=>{window.removeEventListener("online",x),window.removeEventListener("offline",b)}},[]),F.useEffect(()=>{async function x(){var b,w,S,A,k,T;if(!i||!e||!t||!z){!e&&!s&&o(kv()),c(!1);return}try{const{data:N}=await z.from("users").select("id, email, full_name, avatar_url").eq("id",e.id).single(),I=N,D={id:e.id,email:e.email||"",fullName:(I==null?void 0:I.full_name)||((b=e.user_metadata)==null?void 0:b.full_name)||((w=e.user_metadata)==null?void 0:w.name)||null,avatarUrl:(I==null?void 0:I.avatar_url)||((S=e.user_metadata)==null?void 0:S.avatar_url)||null};o(D),b0(D)}catch(N){console.warn("Failed to sync user profile, using auth data:",N);const I={id:e.id,email:e.email||"",fullName:((A=e.user_metadata)==null?void 0:A.full_name)||((k=e.user_metadata)==null?void 0:k.name)||null,avatarUrl:((T=e.user_metadata)==null?void 0:T.avatar_url)||null};o(I),b0(I)}c(!1)}s||x()},[e,t,s,i]),F.useEffect(()=>{!s&&!e&&i&&(b0(null),o(null))},[e,s,i]);const m=(r==null?void 0:r.fullName)||((v=r==null?void 0:r.email)==null?void 0:v.split("@")[0])||"Guest",p=(()=>{var x;if(r!=null&&r.fullName){const b=r.fullName.trim().split(/\s+/);return b.length>=2?`${b[0][0]}${b[b.length-1][0]}`.toUpperCase():((x=b[0])==null?void 0:x.substring(0,2).toUpperCase())||"?"}return r!=null&&r.email?r.email.substring(0,2).toUpperCase():"G"})(),y={currentUser:r,isLoading:a||s,isOffline:d,displayName:m,initials:p};return h.jsx(sS.Provider,{value:y,children:n})}function nS(){const n=F.useContext(sS);if(n===void 0)throw new Error("useCurrentUser must be used within a CurrentUserProvider");return n}const QN="modulepreload",ZN=function(n){return"/ftc-team-manager/"+n},Tv={},sh=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=ZN(c),c in Tv)return;Tv[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const m=document.createElement("link");if(m.rel=d?"stylesheet":QN,d||(m.as="script"),m.crossOrigin="",m.href=c,a&&m.setAttribute("nonce",a),document.head.appendChild(m),d)return new Promise((p,y)=>{m.addEventListener("load",p),m.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},fy="ftc-current-organization",iS=F.createContext(void 0);function e1(){try{return localStorage.getItem(fy)}catch{return null}}function jp(n){try{n?localStorage.setItem(fy,n):localStorage.removeItem(fy)}catch{}}function t1({children:n}){const{user:e,isLoading:t,isConfigured:s}=Cn(),[i,r]=F.useState([]),[o,a]=F.useState([]),[c,d]=F.useState(e1()),[u,m]=F.useState(!0),p=F.useCallback(async()=>{if(!z||!e){r([]),a([]),m(!1);return}try{const R=z,{data:j,error:$}=await R.from("organization_members").select(`
                    *,
                    organization:organizations(*)
                `).eq("user_id",e.id).in("status",["approved","pending"]);if($){console.error("Error fetching organizations:",$),m(!1);return}const B=[],V=[];for(const L of j||[]){const U=L.organization;if(!U)continue;const H={organization:U,membership:{id:L.id,organization_id:L.organization_id,user_id:L.user_id,role:L.role,status:L.status,approved_at:L.approved_at,approved_by:L.approved_by,removed_at:L.removed_at,removed_by:L.removed_by,removal_reason:L.removal_reason,created_at:L.created_at,updated_at:L.updated_at}};L.status==="approved"?B.push(H):L.status==="pending"&&V.push(H)}r(B),a(V),!c&&B.length>0&&(console.log("App: Auto-selecting first organization:",B[0].organization.name),d(B[0].organization.id),jp(B[0].organization.id),sh(async()=>{const{useAppStore:L}=await Promise.resolve().then(()=>x0);return{useAppStore:L}},void 0).then(({useAppStore:L})=>{L.getState().setCurrentOrganizationId(B[0].organization.id)}))}catch(R){console.error("Error fetching organizations:",R)}finally{m(!1)}},[e,c]);F.useEffect(()=>{const R=setTimeout(()=>{u&&!t&&(console.warn("App: Organization loading timed out, forcing completion"),m(!1))},8e3);return()=>clearTimeout(R)},[u,t]),F.useEffect(()=>{!t&&s?p():t||m(!1)},[e,t,s,p]),F.useEffect(()=>{!t&&!e&&(r([]),a([]),d(null),jp(null),sh(async()=>{const{useAppStore:R}=await Promise.resolve().then(()=>x0);return{useAppStore:R}},void 0).then(({useAppStore:R})=>{R.getState().setCurrentOrganizationId(null)}))},[e,t]);const y=F.useCallback(R=>{d(R),jp(R),sh(async()=>{const{useAppStore:j}=await Promise.resolve().then(()=>x0);return{useAppStore:j}},void 0).then(({useAppStore:j})=>{j.getState().setCurrentOrganizationId(R)})},[]),v=F.useCallback(async(R,j)=>{if(!z||!e)return{organization:null,error:new Error("Not authenticated")};try{const $=z,{data:B,error:V}=await $.rpc("create_organization_with_owner",{org_name:R,org_team_number:j||null});if(V)throw V;return await p(),y(B),{organization:{id:B,name:R},error:null}}catch($){return console.error("Error creating organization:",$),{organization:null,error:$}}},[e,p,y]),x=F.useCallback(async(R,j)=>{if(!z||!e)return{success:!1,error:new Error("Not authenticated")};try{const $=z,{data:B,error:V}=await $.from("organization_invites").select("*").eq("invite_code",R).eq("active",!0).single();if(V||!B)return{success:!1,error:new Error("Invalid or expired invite code")};if(B.expires_at&&new Date(B.expires_at)<new Date)return{success:!1,error:new Error("This invite has expired")};if(B.max_uses!==null&&B.use_count>=B.max_uses)return{success:!1,error:new Error("This invite has reached its maximum uses")};const{data:L}=await $.from("organization_members").select("id, status").eq("organization_id",B.organization_id).eq("user_id",e.id).single();if(L){if(L.status==="approved")return{success:!1,error:new Error("You are already a member of this organization")};if(L.status==="pending")return{success:!1,error:new Error("Your membership is pending approval")}}const{error:U}=await $.from("organization_members").insert({organization_id:B.organization_id,user_id:e.id,role:j||B.default_role||"student",status:"pending"});if(U)throw U;return await $.from("organization_invites").update({use_count:B.use_count+1}).eq("id",B.id),await p(),{success:!0,error:null}}catch($){return console.error("Error joining organization:",$),{success:!1,error:$}}},[e,p]),b=F.useCallback(async R=>{if(!z||!e)return{success:!1,error:new Error("Not authenticated")};try{const j=z,{error:$}=await j.from("organization_members").delete().eq("organization_id",R).eq("user_id",e.id);if($)throw $;if(await p(),c===R){const B=i.filter(V=>V.organization.id!==R);B.length>0?y(B[0].organization.id):(d(null),jp(null))}return{success:!0,error:null}}catch(j){return console.error("Error leaving organization:",j),{success:!1,error:j}}},[e,c,i,p,y]),w=i.find(R=>R.organization.id===c),S=(w==null?void 0:w.organization)||null,A=(w==null?void 0:w.membership)||null,k=(A==null?void 0:A.role)==="owner",T=(A==null?void 0:A.role)==="coach",N=k||T,I=(A==null?void 0:A.role)==="mentor",D=(A==null?void 0:A.role)==="student",P={organizations:i,pendingOrganizations:o,currentOrganization:S,currentMembership:A,isLoading:u||t,setCurrentOrganization:y,refreshOrganizations:p,createOrganization:v,joinOrganization:x,leaveOrganization:b,isOwner:k,isCoach:T,isAdmin:N,isMentor:I,isStudent:D};return h.jsx(iS.Provider,{value:P,children:n})}function Br(){const n=F.useContext(iS);if(n===void 0)throw new Error("useOrganization must be used within an OrganizationProvider");return n}/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n1=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),Nv=n=>{const e=n1(n);return e.charAt(0).toUpperCase()+e.slice(1)},rS=(...n)=>n.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),i1=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var r1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=F.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:r,iconNode:o,...a},c)=>F.createElement("svg",{ref:c,...r1,width:e,height:e,stroke:n,strokeWidth:s?Number(t)*24/Number(e):t,className:rS("lucide",i),...!r&&!i1(a)&&{"aria-hidden":"true"},...a},[...o.map(([d,u])=>F.createElement(d,u)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=(n,e)=>{const t=F.forwardRef(({className:s,...i},r)=>F.createElement(o1,{ref:r,iconNode:e,className:rS(`lucide-${s1(Nv(n))}`,`lucide-${n}`,s),...i}));return t.displayName=Nv(n),t};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a1=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],py=ee("activity",a1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],v0=ee("archive",l1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Eb=ee("arrow-left",c1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],rm=ee("arrow-right-left",d1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Nr=ee("arrow-right",u1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],f1=ee("at-sign",h1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],my=ee("book-open",p1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m1=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],yc=ee("building-2",m1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g1=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],oS=ee("calendar",g1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y1=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ei=ee("check",y1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x1=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],iu=ee("chevron-down",x1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],aS=ee("chevron-right",b1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],w1=ee("chevron-up",v1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],$g=ee("circle-alert",_1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A1=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],S1=ee("circle-check-big",A1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C1=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],lS=ee("circle-check",C1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E1=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],k1=ee("circle-plus",E1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],fh=ee("clipboard-check",T1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N1=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ru=ee("clock",N1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I1=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],Xm=ee("cloud-off",I1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P1=[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]],R1=ee("cloud-upload",P1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M1=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],D1=ee("cloud",M1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L1=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],F1=ee("copy",L1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Iv=ee("credit-card",j1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O1=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],U1=ee("download",O1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B1=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],gy=ee("eye",B1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H1=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],G1=ee("file-text",H1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q1=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Pv=ee("folder-open",q1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V1=[["line",{x1:"6",x2:"10",y1:"11",y2:"11",key:"1gktln"}],["line",{x1:"8",x2:"8",y1:"9",y2:"13",key:"qnk9ow"}],["line",{x1:"15",x2:"15.01",y1:"12",y2:"12",key:"krot7o"}],["line",{x1:"18",x2:"18.01",y1:"10",y2:"10",key:"1lcuu1"}],["path",{d:"M17.32 5H6.68a4 4 0 0 0-3.978 3.59c-.006.052-.01.101-.017.152C2.604 9.416 2 14.456 2 16a3 3 0 0 0 3 3c1 0 1.5-.5 2-1l1.414-1.414A2 2 0 0 1 9.828 16h4.344a2 2 0 0 1 1.414.586L17 18c.5.5 1 1 2 1a3 3 0 0 0 3-3c0-1.545-.604-6.584-.685-7.258-.007-.05-.011-.1-.017-.151A4 4 0 0 0 17.32 5z",key:"mfqc10"}]],ph=ee("gamepad-2",V1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $1=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],yy=ee("graduation-cap",$1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z1=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],W1=ee("key-round",z1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K1=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Rv=ee("layers",K1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y1=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],mh=ee("layout-dashboard",Y1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J1=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],X1=ee("link-2",J1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q1=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],Z1=ee("list",Q1);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Wt=ee("loader-circle",eI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tI=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],w0=ee("lock",tI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],xy=ee("log-in",sI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nI=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],by=ee("log-out",nI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iI=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ku=ee("mail",iI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rI=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],oI=ee("menu",rI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aI=[["path",{d:"M5 12h14",key:"1ays0h"}]],Mv=ee("minus",aI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lI=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],Dv=ee("moon",lI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cI=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],dI=ee("panels-top-left",cI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uI=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],hI=ee("pen",uI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fI=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],pI=ee("pencil",fI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mI=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ti=ee("plus",mI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gI=[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]],yI=ee("redo",gI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xI=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],zg=ee("refresh-cw",xI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bI=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],cS=ee("rotate-ccw",bI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vI=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],vy=ee("save",vI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wI=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Qm=ee("search",wI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],AI=ee("send",_I);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SI=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Lv=ee("settings",SI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CI=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],ou=ee("shield",CI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EI=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Zm=ee("sparkles",EI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],gh=ee("square-check-big",kI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TI=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],NI=ee("square-pen",TI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const II=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Fv=ee("sun",II);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PI=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ni=ee("trash-2",PI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RI=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],MI=ee("trending-up",RI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DI=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Wg=ee("triangle-alert",DI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LI=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],FI=ee("trophy",LI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jI=[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]],OI=ee("undo",jI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],BI=ee("user-minus",UI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HI=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],wy=ee("user-plus",HI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GI=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Rr=ee("user",GI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qI=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ii=ee("users",qI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VI=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],$I=ee("wifi-off",VI);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zI=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Pi=ee("x",zI);function WI(){const{signInWithEmail:n,signUpAsCoach:e,signUpAsStudentOrMentor:t,resetPassword:s}=Cn(),[i,r]=F.useState("login"),[o,a]=F.useState(""),[c,d]=F.useState(""),[u,m]=F.useState(""),[p,y]=F.useState(""),[v,x]=F.useState(!1),[b,w]=F.useState(null),[S,A]=F.useState(null),[k,T]=F.useState(!1),[N,I]=F.useState(!1),[D,P]=F.useState(!1),[R,j]=F.useState(!1),[$,B]=F.useState(!1),[V,L]=F.useState(!1),U=()=>{a(""),d(""),m(""),y(""),T(!1),I(!1),P(!1),j(!1),B(!1),L(!1),w(null),A(null)},H=async Y=>{Y.preventDefault(),x(!0),w(null),A(null);try{if(i==="login"){const{error:re}=await n(o,c);re&&w(re.message)}else if(i==="signup-coach"){const{error:re}=await e({email:o,password:c,fullName:u,confirmedAge18Plus:k,acceptedTerms:N,acknowledgedCoppaResponsibility:D});re?w(re.message):A("Account created! Check your email for a confirmation link.")}else if(i==="signup-student"){const{error:re}=await t({email:o,password:c,fullName:u,confirmedAge13Plus:R,acknowledgedPrivacyPolicy:$,acknowledgedCommunityGuidelines:V,inviteCode:p||void 0});re?w(re.message):A("Account created! Check your email for a confirmation link.")}else if(i==="forgot"){const{error:re}=await s(o);re?w(re.message):A("Password reset email sent!")}}catch{w("An unexpected error occurred")}finally{x(!1)}},J=()=>{switch(i){case"login":return"Sign in to your account";case"signup-choice":return"Create your account";case"signup-coach":return"Coach Registration";case"signup-student":return"Student / Mentor Registration";case"forgot":return"Reset your password"}};return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-md w-full",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl shadow-xl border border-slate-700/50 mb-4 p-4",children:h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-full h-full object-contain",alt:"FalconForge Logo"})}),h.jsxs("h1",{className:"text-3xl font-black italic tracking-tighter mb-2",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-white",children:"FORGE"})]}),h.jsx("p",{className:"text-slate-400",children:J()})]}),h.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6 shadow-xl",children:[b&&h.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-3 mb-4 flex items-start gap-2",children:[h.jsx($g,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),h.jsx("p",{className:"text-red-400 text-sm",children:b})]}),S&&h.jsxs("div",{className:"bg-green-500/10 border border-green-500/20 rounded-xl p-3 mb-4 flex items-start gap-2",children:[h.jsx(lS,{className:"w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"}),h.jsx("p",{className:"text-green-400 text-sm",children:S})]}),i==="signup-choice"&&h.jsxs("div",{className:"space-y-4",children:[h.jsx("p",{className:"text-slate-300 text-sm text-center mb-4",children:"Choose your account type"}),h.jsxs("button",{onClick:()=>{U(),r("signup-coach")},className:"w-full p-4 bg-slate-700/50 border border-slate-600 rounded-xl hover:border-orange-500/50 hover:bg-slate-700 transition-all text-left group",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:h.jsx(ou,{className:"w-5 h-5 text-orange-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-white font-semibold group-hover:text-orange-400 transition-colors",children:"Coach"}),h.jsx("p",{className:"text-slate-400 text-xs",children:"Adults 18+ who manage teams"})]})]}),h.jsx("p",{className:"text-slate-500 text-xs pl-[52px]",children:"Create teams, invite members, manage billing"})]}),h.jsxs("button",{onClick:()=>{U(),r("signup-student")},className:"w-full p-4 bg-slate-700/50 border border-slate-600 rounded-xl hover:border-blue-500/50 hover:bg-slate-700 transition-all text-left group",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:h.jsx(Ii,{className:"w-5 h-5 text-blue-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-white font-semibold group-hover:text-blue-400 transition-colors",children:"Student / Mentor"}),h.jsx("p",{className:"text-slate-400 text-xs",children:"Join an existing team"})]})]}),h.jsx("p",{className:"text-slate-500 text-xs pl-[52px]",children:"Requires invite from a coach"})]}),h.jsx("div",{className:"pt-4 text-center",children:h.jsxs("p",{className:"text-slate-400 text-sm",children:["Already have an account?"," ",h.jsx("button",{onClick:()=>{U(),r("login")},className:"text-orange-400 hover:text-orange-300 font-medium",children:"Sign in"})]})})]}),i==="login"&&h.jsxs("form",{onSubmit:H,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),h.jsxs("div",{className:"relative",children:[h.jsx(ku,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:o,onChange:Y=>a(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"you@team12345.org",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(w0,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"password",value:c,onChange:Y=>d(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"â¢â¢â¢â¢â¢â¢â¢â¢",required:!0,minLength:6})]})]}),h.jsx("button",{type:"submit",disabled:v,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25 disabled:opacity-50",children:v?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Sign In",h.jsx(Nr,{className:"w-4 h-4"})]})}),h.jsxs("div",{className:"text-center text-sm space-y-2",children:[h.jsx("button",{type:"button",onClick:()=>{U(),r("forgot")},className:"text-slate-400 hover:text-orange-400 transition-colors",children:"Forgot password?"}),h.jsxs("p",{className:"text-slate-400",children:["Don't have an account?"," ",h.jsx("button",{type:"button",onClick:()=>{U(),r("signup-choice")},className:"text-orange-400 hover:text-orange-300 font-medium",children:"Sign up"})]})]})]}),i==="signup-coach"&&h.jsxs("form",{onSubmit:H,className:"space-y-4",children:[h.jsx("div",{className:"bg-orange-500/10 border border-orange-500/20 rounded-xl p-3 mb-2",children:h.jsxs("p",{className:"text-orange-300 text-xs",children:[h.jsx("strong",{children:"Coach accounts"})," are for adults (18+) who manage robotics teams. You'll be able to create teams, invite members, and handle billing."]})}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Full Name"}),h.jsxs("div",{className:"relative",children:[h.jsx(Rr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",value:u,onChange:Y=>m(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"John Smith",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),h.jsxs("div",{className:"relative",children:[h.jsx(ku,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:o,onChange:Y=>a(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"you@team12345.org",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(w0,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"password",value:c,onChange:Y=>d(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"â¢â¢â¢â¢â¢â¢â¢â¢",required:!0,minLength:6})]})]}),h.jsxs("div",{className:"space-y-3 pt-2",children:[h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:k,onChange:Y=>T(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-orange-500 focus:ring-orange-500 focus:ring-offset-slate-800",required:!0}),h.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:["I confirm that I am ",h.jsx("strong",{children:"18 years of age or older"})]})]}),h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:N,onChange:Y=>I(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-orange-500 focus:ring-orange-500 focus:ring-offset-slate-800",required:!0}),h.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:["I agree to the"," ",h.jsx("a",{href:"/#/terms",target:"_blank",className:"text-orange-400 hover:underline",children:"Terms and Conditions"})]})]}),h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:D,onChange:Y=>P(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-orange-500 focus:ring-orange-500 focus:ring-offset-slate-800",required:!0}),h.jsx("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:"I acknowledge that I am responsible for obtaining necessary parental/guardian consent for any minors I invite to my team (COPPA compliance)"})]})]}),h.jsx("button",{type:"submit",disabled:v||!k||!N||!D,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25 disabled:opacity-50 disabled:cursor-not-allowed",children:v?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Create Coach Account",h.jsx(Nr,{className:"w-4 h-4"})]})}),h.jsx("p",{className:"text-center text-sm text-slate-400",children:h.jsx("button",{type:"button",onClick:()=>{U(),r("signup-choice")},className:"text-orange-400 hover:text-orange-300 font-medium",children:"â Back to account type selection"})})]}),i==="signup-student"&&h.jsxs("form",{onSubmit:H,className:"space-y-4",children:[h.jsx("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-3 mb-2",children:h.jsxs("p",{className:"text-blue-300 text-xs",children:[h.jsx("strong",{children:"Student/Mentor accounts"})," are for team members joining via invite. You'll need an invite code from your coach to access team data."]})}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Full Name"}),h.jsxs("div",{className:"relative",children:[h.jsx(Rr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",value:u,onChange:Y=>m(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Jane Doe",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),h.jsxs("div",{className:"relative",children:[h.jsx(ku,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:o,onChange:Y=>a(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"you@email.com",required:!0})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Password"}),h.jsxs("div",{className:"relative",children:[h.jsx(w0,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"password",value:c,onChange:Y=>d(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"â¢â¢â¢â¢â¢â¢â¢â¢",required:!0,minLength:6})]})]}),h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:["Invite Code ",h.jsx("span",{className:"text-slate-500",children:"(optional - can add later)"})]}),h.jsx("input",{type:"text",value:p,onChange:Y=>y(Y.target.value.toUpperCase()),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent uppercase tracking-wider",placeholder:"ABC123"})]}),h.jsxs("div",{className:"space-y-3 pt-2",children:[h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:R,onChange:Y=>j(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800",required:!0}),h.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:["I confirm that I am ",h.jsx("strong",{children:"at least 13 years old"})]})]}),h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:$,onChange:Y=>B(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800",required:!0}),h.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:["I have read and understand the"," ",h.jsx("a",{href:"/#/privacy",target:"_blank",className:"text-blue-400 hover:underline",children:"Privacy Policy"})]})]}),h.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[h.jsx("input",{type:"checkbox",checked:V,onChange:Y=>L(Y.target.checked),className:"mt-1 w-4 h-4 rounded border-slate-500 text-blue-500 focus:ring-blue-500 focus:ring-offset-slate-800",required:!0}),h.jsxs("span",{className:"text-sm text-slate-300 group-hover:text-white transition-colors",children:["I have read and will follow the"," ",h.jsx("a",{href:"/#/terms",target:"_blank",className:"text-blue-400 hover:underline",children:"Community Guidelines"})]})]})]}),h.jsx("button",{type:"submit",disabled:v||!R||!$||!V,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg shadow-blue-500/25 disabled:opacity-50 disabled:cursor-not-allowed",children:v?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Create Account",h.jsx(Nr,{className:"w-4 h-4"})]})}),h.jsx("p",{className:"text-center text-sm text-slate-400",children:h.jsx("button",{type:"button",onClick:()=>{U(),r("signup-choice")},className:"text-blue-400 hover:text-blue-300 font-medium",children:"â Back to account type selection"})})]}),i==="forgot"&&h.jsxs("form",{onSubmit:H,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:"Email"}),h.jsxs("div",{className:"relative",children:[h.jsx(ku,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"email",value:o,onChange:Y=>a(Y.target.value),className:"w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"you@team12345.org",required:!0})]})]}),h.jsx("button",{type:"submit",disabled:v,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25 disabled:opacity-50",children:v?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Send Reset Link",h.jsx(Nr,{className:"w-4 h-4"})]})}),h.jsx("p",{className:"text-center text-sm",children:h.jsx("button",{type:"button",onClick:()=>{U(),r("login")},className:"text-orange-400 hover:text-orange-300 font-medium",children:"Back to sign in"})})]})]})]})})}function KI(){const{code:n}=Pk(),e=ub(),{user:t,isLoading:s,isConfigured:i}=Cn(),{joinOrganization:r,refreshOrganizations:o}=Br(),[a,c]=F.useState(null),[d,u]=F.useState(!0),[m,p]=F.useState(!1),[y,v]=F.useState(null),[x,b]=F.useState(!1);F.useEffect(()=>{if(!n||!z){v("Invalid invite link"),u(!1);return}w()},[n]);const w=async()=>{if(!(!n||!z)){u(!0),v(null);try{const A=z,{data:k,error:T}=await A.from("organization_invites").select(`
                    *,
                    organization:organizations(*)
                `).eq("invite_code",n.toUpperCase()).eq("active",!0).single();if(T||!k){v("This invite link is invalid or has expired."),u(!1);return}if(k.expires_at&&new Date(k.expires_at)<new Date){v("This invite link has expired."),u(!1);return}if(k.max_uses!==null&&k.use_count>=k.max_uses){v("This invite link has reached its maximum uses."),u(!1);return}c({invite:k,organization:k.organization})}catch(A){console.error("Error fetching invite:",A),v("Failed to load invite details.")}finally{u(!1)}}},S=async()=>{if(!n)return;p(!0),v(null);const{success:A,error:k}=await r(n);if(k){v(k.message),p(!1);return}A&&(b(!0),await o(),setTimeout(()=>{e("/")},2e3)),p(!1)};return d||s?h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"text-center",children:[h.jsx(Wt,{className:"w-12 h-12 animate-spin text-orange-500 mx-auto mb-4"}),h.jsx("p",{className:"text-slate-400",children:"Loading invite..."})]})}):y&&!a?h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-md w-full text-center",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-500/20 rounded-2xl mb-6",children:h.jsx(Wg,{className:"w-8 h-8 text-red-400"})}),h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Invalid Invite"}),h.jsx("p",{className:"text-slate-400 mb-6",children:y}),h.jsx("button",{onClick:()=>e("/login"),className:"px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-colors",children:"Go to Login"})]})}):x?h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-md w-full text-center",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-green-500/20 rounded-2xl mb-6",children:h.jsx(Ei,{className:"w-8 h-8 text-green-400"})}),h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Request Sent!"}),h.jsxs("p",{className:"text-slate-400 mb-4",children:["Your request to join ",h.jsx("strong",{className:"text-white",children:a==null?void 0:a.organization.name})," has been submitted."]}),h.jsx("p",{className:"text-slate-500 text-sm",children:"A coach will review and approve your request. Redirecting..."})]})}):i&&!t?h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsx("div",{className:"max-w-md w-full",children:h.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6 mb-6",children:[h.jsxs("div",{className:"text-center mb-6",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-500/20 rounded-2xl mb-4",children:h.jsx(Ii,{className:"w-8 h-8 text-orange-400"})}),h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"You're Invited!"}),h.jsxs("p",{className:"text-slate-400",children:["Join ",h.jsx("strong",{className:"text-white",children:a==null?void 0:a.organization.name}),(a==null?void 0:a.organization.team_number)&&h.jsxs("span",{className:"text-slate-500",children:[" (Team #",a.organization.team_number,")"]})]})]}),h.jsx("div",{className:"bg-slate-700/50 rounded-xl p-4 mb-6",children:h.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Sign in or create an account to join this team"})}),h.jsxs("button",{onClick:()=>e(`/login?invite=${n}`),className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25",children:[h.jsx(xy,{className:"w-5 h-5"}),"Sign In or Sign Up"]})]})})}):h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsx("div",{className:"max-w-md w-full",children:h.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6",children:[h.jsxs("div",{className:"text-center mb-6",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-orange-500/20 rounded-2xl mb-4",children:h.jsx(Ii,{className:"w-8 h-8 text-orange-400"})}),h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Join Team"}),h.jsx("p",{className:"text-slate-400",children:"You've been invited to join"})]}),h.jsxs("div",{className:"bg-slate-700/50 rounded-xl p-4 mb-6",children:[h.jsx("h2",{className:"text-xl font-bold text-white text-center",children:a==null?void 0:a.organization.name}),(a==null?void 0:a.organization.team_number)&&h.jsxs("p",{className:"text-slate-400 text-center mt-1",children:["Team #",a.organization.team_number]})]}),y&&h.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-3 mb-4",children:h.jsx("p",{className:"text-red-400 text-sm text-center",children:y})}),h.jsx("button",{onClick:S,disabled:m,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25 disabled:opacity-50",children:m?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:[h.jsx(Ii,{className:"w-5 h-5"}),"Request to Join"]})}),h.jsx("p",{className:"text-slate-500 text-xs text-center mt-4",children:"A coach will need to approve your request before you can access team data."})]})})})}function jv({variant:n="full"}){const{isOnline:e,syncStatus:t,pendingChanges:s,lastSyncTime:i,sync:r,error:o}=ZA();if(!bn())return null;const c=()=>{if(!e)return h.jsx(Xm,{className:"w-4 h-4 text-slate-400"});switch(t){case"syncing":return h.jsx(zg,{className:"w-4 h-4 text-blue-400 animate-spin"});case"error":return h.jsx($g,{className:"w-4 h-4 text-red-400"});case"idle":return s>0?h.jsx(D1,{className:"w-4 h-4 text-amber-400"}):h.jsx(Ei,{className:"w-4 h-4 text-green-400"});default:return h.jsx(Xm,{className:"w-4 h-4 text-slate-400"})}},d=()=>{if(!e)return"Offline";switch(t){case"syncing":return"Syncing...";case"error":return"Sync Error";case"idle":return s>0?`${s} pending`:"Synced";default:return"Offline"}},u=()=>{if(!e)return"bg-slate-500/10 border-slate-500/20";switch(t){case"syncing":return"bg-blue-500/10 border-blue-500/20";case"error":return"bg-red-500/10 border-red-500/20";case"idle":return s>0?"bg-amber-500/10 border-amber-500/20":"bg-green-500/10 border-green-500/20";default:return"bg-slate-500/10 border-slate-500/20"}};return h.jsxs("button",{onClick:()=>r(),disabled:t==="syncing"||!e,className:`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${u()} ${n==="icon"?"aspect-square justify-center":""}`,title:o||(i?`Last synced: ${i.toLocaleTimeString()}`:"Click to sync"),children:[h.jsx("span",{className:t==="syncing"?"animate-spin":"",children:c()}),n==="full"&&h.jsx("span",{children:d()})]})}function dS({onComplete:n}){const{createOrganization:e,joinOrganization:t,pendingOrganizations:s}=Br(),[i,r]=F.useState("choice"),[o,a]=F.useState(!1),[c,d]=F.useState(null),[u,m]=F.useState(""),[p,y]=F.useState(""),[v,x]=F.useState(""),b=async S=>{S.preventDefault(),a(!0),d(null);const{error:A}=await e(u,p||void 0);a(!1),A?d(A.message):n==null||n()},w=async S=>{S.preventDefault(),a(!0),d(null);const{error:A}=await t(v);a(!1),A?d(A.message):r("choice")};return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-lg w-full",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl shadow-xl border border-slate-700/50 mb-4 p-4",children:h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-full h-full object-contain",alt:"FalconForge Logo"})}),h.jsxs("h1",{className:"text-3xl font-black italic tracking-tighter mb-2",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-white",children:"FORGE"})]}),h.jsxs("p",{className:"text-slate-400",children:[i==="choice"&&"Let's get you set up with your team.",i==="create-org"&&"Create your team's workspace.",i==="join-org"&&"Enter your team's invite code."]})]}),s.length>0&&i==="choice"&&h.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4 mb-6",children:[h.jsx("h3",{className:"text-amber-300 font-medium mb-1",children:"Pending Approval"}),h.jsxs("p",{className:"text-amber-300/80 text-sm",children:["You've requested to join ",s.length," team",s.length>1?"s":"",". A coach will need to approve your request before you can access team data."]}),h.jsx("ul",{className:"mt-2 space-y-1",children:s.map(S=>h.jsxs("li",{className:"text-amber-200 text-sm",children:["â¢ ",S.organization.name,S.organization.team_number&&` (Team ${S.organization.team_number})`]},S.organization.id))})]}),h.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6 shadow-xl",children:[c&&h.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-xl p-3 mb-4",children:h.jsx("p",{className:"text-red-400 text-sm",children:c})}),i==="choice"&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("button",{onClick:()=>{d(null),r("create-org")},className:"w-full p-4 bg-slate-700/50 border border-slate-600 rounded-xl hover:border-orange-500/50 hover:bg-slate-700 transition-all text-left group",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center",children:h.jsx(Ti,{className:"w-5 h-5 text-orange-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-white font-semibold group-hover:text-orange-400 transition-colors",children:"Create a Team"}),h.jsx("p",{className:"text-slate-400 text-xs",children:"I'm a coach setting up a new workspace"})]})]}),h.jsx("p",{className:"text-slate-500 text-xs pl-[52px]",children:"Create your team, invite members, and manage billing"})]}),h.jsxs("button",{onClick:()=>{d(null),r("join-org")},className:"w-full p-4 bg-slate-700/50 border border-slate-600 rounded-xl hover:border-blue-500/50 hover:bg-slate-700 transition-all text-left group",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:"w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center",children:h.jsx(W1,{className:"w-5 h-5 text-blue-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-white font-semibold group-hover:text-blue-400 transition-colors",children:"Join a Team"}),h.jsx("p",{className:"text-slate-400 text-xs",children:"I have an invite code from my coach"})]})]}),h.jsx("p",{className:"text-slate-500 text-xs pl-[52px]",children:"Enter your invite code to request access"})]})]}),i==="create-org"&&h.jsxs("form",{onSubmit:b,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:["Team Name ",h.jsx("span",{className:"text-red-400",children:"*"})]}),h.jsx("input",{type:"text",value:u,onChange:S=>m(S.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"e.g., Falcon Robotics",required:!0})]}),h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:["Team Number ",h.jsx("span",{className:"text-slate-500",children:"(optional)"})]}),h.jsx("input",{type:"text",value:p,onChange:S=>y(S.target.value),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"e.g., 12345"}),h.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"Your FTC team number (if applicable)"})]}),h.jsxs("div",{className:"flex gap-3 pt-2",children:[h.jsx("button",{type:"button",onClick:()=>r("choice"),className:"flex-1 px-4 py-3 bg-slate-700 text-slate-300 font-medium rounded-xl hover:bg-slate-600 transition-colors",children:"Back"}),h.jsx("button",{type:"submit",disabled:o||!u.trim(),className:"flex-1 flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25 disabled:opacity-50",children:o?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Create Team",h.jsx(Nr,{className:"w-4 h-4"})]})})]})]}),i==="join-org"&&h.jsxs("form",{onSubmit:w,className:"space-y-4",children:[h.jsxs("div",{children:[h.jsxs("label",{className:"block text-sm font-medium text-slate-300 mb-1.5",children:["Invite Code ",h.jsx("span",{className:"text-red-400",children:"*"})]}),h.jsx("input",{type:"text",value:v,onChange:S=>x(S.target.value.toUpperCase()),className:"w-full px-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-lg uppercase tracking-widest",placeholder:"ABC123",required:!0}),h.jsx("p",{className:"text-slate-500 text-xs mt-1 text-center",children:"Get this code from your team coach"})]}),h.jsxs("div",{className:"flex gap-3 pt-2",children:[h.jsx("button",{type:"button",onClick:()=>r("choice"),className:"flex-1 px-4 py-3 bg-slate-700 text-slate-300 font-medium rounded-xl hover:bg-slate-600 transition-colors",children:"Back"}),h.jsx("button",{type:"submit",disabled:o||!v.trim(),className:"flex-1 flex items-center justify-center gap-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold py-3 px-4 rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg shadow-blue-500/25 disabled:opacity-50",children:o?h.jsx(Wt,{className:"w-5 h-5 animate-spin"}):h.jsxs(h.Fragment,{children:["Request to Join",h.jsx(Nr,{className:"w-4 h-4"})]})})]})]})]}),h.jsxs("p",{className:"text-center text-slate-500 text-sm mt-4",children:["Need help? Contact your team coach or"," ",h.jsx("a",{href:"/support",className:"text-orange-400 hover:underline",children:"our support team"})]})]})})}function YI(){const{pendingOrganizations:n,refreshOrganizations:e,isLoading:t}=Br(),{signOut:s}=Cn(),i=async()=>{await e()};return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-md w-full text-center",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-3xl mb-6",children:h.jsx(ru,{className:"w-10 h-10 text-amber-400"})}),h.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Awaiting Approval"}),h.jsx("p",{className:"text-slate-400 mb-6",children:"Your request to join has been submitted. A coach will review and approve your access soon."}),h.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6 mb-6",children:[h.jsxs("h2",{className:"text-sm font-medium text-slate-400 mb-3 flex items-center justify-center gap-2",children:[h.jsx(Ii,{className:"w-4 h-4"}),"Pending Memberships"]}),h.jsx("div",{className:"space-y-3",children:n.map(r=>h.jsxs("div",{className:"bg-slate-700/50 rounded-xl p-4 text-left",children:[h.jsx("p",{className:"text-white font-medium",children:r.organization.name}),r.organization.team_number&&h.jsxs("p",{className:"text-slate-400 text-sm",children:["Team #",r.organization.team_number]}),h.jsxs("p",{className:"text-amber-400 text-xs mt-1 flex items-center gap-1",children:[h.jsx(ru,{className:"w-3 h-3"}),"Requested ",new Date(r.membership.created_at).toLocaleDateString()]})]},r.organization.id))})]}),h.jsxs("div",{className:"space-y-3",children:[h.jsxs("button",{onClick:i,disabled:t,className:"w-full flex items-center justify-center gap-2 bg-slate-700 text-white font-medium py-3 px-4 rounded-xl hover:bg-slate-600 transition-colors disabled:opacity-50",children:[h.jsx(zg,{className:`w-4 h-4 ${t?"animate-spin":""}`}),"Check Status"]}),h.jsxs("button",{onClick:s,className:"w-full flex items-center justify-center gap-2 text-slate-400 hover:text-white py-2 transition-colors",children:[h.jsx(by,{className:"w-4 h-4"}),"Sign Out"]})]}),h.jsx("p",{className:"text-slate-500 text-sm mt-6",children:"If you haven't received approval within 24 hours, please contact your team coach directly."})]})})}function JI(){const n=ub(),[e,t]=F.useState(!1),s=[{icon:mh,title:"Dashboard",description:"Team overview and quick actions"},{icon:gh,title:"Sprint Planning",description:"Kanban board for task management"},{icon:fh,title:"Scouting Reports",description:"Track opponent capabilities"},{icon:ph,title:"Match Planner",description:"Plan your match strategy"},{icon:my,title:"Portfolio Helper",description:"AI-powered documentation"}],i=()=>{sessionStorage.setItem("explore_mode","true"),n("/")};return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"max-w-lg w-full",children:[h.jsxs("div",{className:"text-center mb-8",children:[h.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-orange-500/20 to-amber-500/20 rounded-3xl mb-4",children:h.jsx(gy,{className:"w-10 h-10 text-orange-400"})}),h.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Explore FalconForge"}),h.jsx("p",{className:"text-slate-400",children:"Take a tour of the app with sample data. No account required."})]}),h.jsx("div",{className:"bg-slate-800/50 backdrop-blur-xl border border-slate-700 rounded-2xl p-6 shadow-xl mb-4",children:h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[h.jsx("h3",{className:"text-amber-300 font-medium mb-1",children:"Read-Only Mode"}),h.jsx("p",{className:"text-amber-300/80 text-sm",children:"Explore mode uses sample data. Changes won't be saved."})]}),h.jsxs("button",{onClick:i,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold py-4 px-6 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all shadow-lg shadow-orange-500/25",children:[h.jsx(gy,{className:"w-5 h-5"}),"Start Exploring",h.jsx(Nr,{className:"w-5 h-5"})]}),h.jsx("button",{onClick:()=>t(!e),className:"w-full text-center text-slate-400 hover:text-slate-200 text-sm py-2 transition-colors",children:e?"Hide features":"What can I explore?"}),e&&h.jsx("div",{className:"space-y-2 pt-2 border-t border-slate-700",children:s.map((r,o)=>h.jsxs("div",{className:"flex items-center gap-3 p-2",children:[h.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-lg flex items-center justify-center",children:h.jsx(r.icon,{className:"w-4 h-4 text-orange-400"})}),h.jsxs("div",{children:[h.jsx("p",{className:"text-white text-sm font-medium",children:r.title}),h.jsx("p",{className:"text-slate-500 text-xs",children:r.description})]})]},o))})]})}),h.jsxs("div",{className:"text-center",children:[h.jsx("p",{className:"text-slate-500 text-sm mb-2",children:"Ready to use FalconForge with your team?"}),h.jsx("button",{onClick:()=>n("/login"),className:"text-orange-400 hover:text-orange-300 font-medium text-sm",children:"Create an account â"})]})]})})}function XI({onCreateTeam:n}){const{organizations:e,currentOrganization:t,setCurrentOrganization:s}=Br(),[i,r]=F.useState(!1),o=F.useRef(null);return F.useEffect(()=>{const a=c=>{o.current&&!o.current.contains(c.target)&&r(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),e.length===0?null:e.length===1?h.jsxs("div",{className:"space-y-2",children:[h.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg",children:[h.jsx(yc,{className:"w-4 h-4 text-orange-500"}),h.jsxs("div",{className:"text-sm flex-1",children:[h.jsx("span",{className:"font-medium text-slate-700 dark:text-white",children:(t==null?void 0:t.name)||"No Team"}),(t==null?void 0:t.team_number)&&h.jsxs("span",{className:"text-slate-500 dark:text-slate-400 ml-1",children:["#",t.team_number]})]})]}),n&&h.jsxs("button",{onClick:n,className:"w-full flex items-center justify-center gap-2 px-3 py-1.5 text-xs font-medium text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-900/20 rounded-lg hover:bg-orange-100 dark:hover:bg-orange-900/40 transition-colors",children:[h.jsx(Ti,{className:"w-3 h-3"}),"Add Another Team"]})]}):h.jsxs("div",{ref:o,className:"relative",children:[h.jsxs("button",{onClick:()=>r(!i),className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors w-full",children:[h.jsx(yc,{className:"w-4 h-4 text-orange-500"}),h.jsxs("div",{className:"text-sm text-left flex-1 min-w-0",children:[h.jsx("span",{className:"font-medium text-slate-700 dark:text-white truncate block",children:(t==null?void 0:t.name)||"Select Team"}),(t==null?void 0:t.team_number)&&h.jsxs("span",{className:"text-slate-500 dark:text-slate-400 text-xs",children:["#",t.team_number]})]}),h.jsx(iu,{className:`w-4 h-4 text-slate-400 transition-transform flex-shrink-0 ${i?"rotate-180":""}`})]}),i&&h.jsxs("div",{className:"absolute top-full left-0 mt-1 w-64 bg-slate-800 border border-slate-700 rounded-xl shadow-xl z-50 overflow-hidden",children:[h.jsx("div",{className:"py-1",children:e.map(a=>h.jsxs("button",{onClick:()=>{s(a.organization.id),r(!1)},className:`w-full flex items-center gap-3 px-4 py-2.5 text-left hover:bg-slate-700/50 transition-colors ${(t==null?void 0:t.id)===a.organization.id?"bg-slate-700/30":""}`,children:[h.jsx("div",{className:"w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center flex-shrink-0",children:h.jsx(yc,{className:"w-4 h-4 text-orange-400"})}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"font-medium text-white truncate",children:a.organization.name}),h.jsxs("p",{className:"text-xs text-slate-400",children:[a.organization.team_number&&`Team #${a.organization.team_number} â¢ `,a.membership.role]})]}),(t==null?void 0:t.id)===a.organization.id&&h.jsx(Ei,{className:"w-4 h-4 text-green-400 flex-shrink-0"})]},a.organization.id))}),n&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"border-t border-slate-700"}),h.jsxs("button",{onClick:()=>{n(),r(!1)},className:"w-full flex items-center gap-3 px-4 py-2.5 text-left hover:bg-slate-700/50 transition-colors text-orange-400",children:[h.jsx(Ti,{className:"w-4 h-4"}),h.jsx("span",{className:"text-sm font-medium",children:"Create New Team"})]})]})]})]})}function QI(){return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-12 px-4",children:h.jsxs("div",{className:"max-w-3xl mx-auto",children:[h.jsxs(Ml,{to:"/login",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition-colors",children:[h.jsx(Eb,{className:"w-4 h-4"}),"Back to Login"]}),h.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Terms of Service"}),h.jsxs("div",{className:"prose prose-invert prose-slate max-w-none",children:[h.jsxs("p",{className:"text-slate-300",children:["Last updated: ",new Date().toLocaleDateString()]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"1. Acceptance of Terms"}),h.jsx("p",{className:"text-slate-300",children:'By accessing and using FalconForge ("the Service"), you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use the Service.'}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"2. Description of Service"}),h.jsx("p",{className:"text-slate-300",children:"FalconForge is a team management platform designed for FIRST Tech Challenge robotics teams. The Service includes task management, scouting reports, match planning, and team collaboration features."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"3. User Accounts"}),h.jsx("p",{className:"text-slate-300",children:"You are responsible for maintaining the confidentiality of your account credentials and for all activities that occur under your account. Coaches/mentors must be at least 18 years old. Student users under 18 require parental consent."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"4. Acceptable Use"}),h.jsx("p",{className:"text-slate-300",children:"You agree not to use the Service for any unlawful purpose or in any way that could damage, disable, or impair the Service."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"5. Billing & Subscriptions"}),h.jsx("p",{className:"text-slate-300",children:"Team owners are responsible for subscription payments. Billing occurs per team member. Subscription terms and pricing are subject to change with notice."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"6. Data & Privacy"}),h.jsxs("p",{className:"text-slate-300",children:["Your use of the Service is also governed by our ",h.jsx(Ml,{to:"/privacy",className:"text-orange-400 hover:text-orange-300",children:"Privacy Policy"}),"."]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"7. Termination"}),h.jsx("p",{className:"text-slate-300",children:"We reserve the right to suspend or terminate accounts that violate these terms."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"8. Contact"}),h.jsx("p",{className:"text-slate-300",children:"For questions about these Terms, please contact us at support@falconforge.app"})]})]})]})})}function ZI(){return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-12 px-4",children:h.jsxs("div",{className:"max-w-3xl mx-auto",children:[h.jsxs(Ml,{to:"/login",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition-colors",children:[h.jsx(Eb,{className:"w-4 h-4"}),"Back to Login"]}),h.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Privacy Policy"}),h.jsxs("div",{className:"prose prose-invert prose-slate max-w-none",children:[h.jsxs("p",{className:"text-slate-300",children:["Last updated: ",new Date().toLocaleDateString()]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"1. Information We Collect"}),h.jsx("p",{className:"text-slate-300",children:"We collect information you provide directly, including:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Account information (name, email, role)"}),h.jsx("li",{children:"Team and organization data"}),h.jsx("li",{children:"Task and project information"}),h.jsx("li",{children:"Scouting reports and match data"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"2. How We Use Information"}),h.jsx("p",{className:"text-slate-300",children:"We use collected information to:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Provide and maintain the Service"}),h.jsx("li",{children:"Process transactions and send related notices"}),h.jsx("li",{children:"Send technical alerts and support messages"}),h.jsx("li",{children:"Improve and develop new features"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"3. Data Sharing"}),h.jsx("p",{className:"text-slate-300",children:"We do not sell your personal information. We may share data with:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Service providers (hosting, analytics)"}),h.jsx("li",{children:"Legal authorities when required by law"}),h.jsx("li",{children:"Team members within your organization"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"4. Data Security"}),h.jsx("p",{className:"text-slate-300",children:"We implement industry-standard security measures including encryption, secure hosting, and access controls."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"5. Children's Privacy"}),h.jsxs("p",{className:"text-slate-300",children:["Users under 18 require parental/guardian consent. See our ",h.jsx(Ml,{to:"/parental-consent",className:"text-orange-400 hover:text-orange-300",children:"Parental Consent Policy"}),"."]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"6. Your Rights"}),h.jsx("p",{className:"text-slate-300",children:"You may request access to, correction of, or deletion of your data by contacting us."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"7. Contact"}),h.jsx("p",{className:"text-slate-300",children:"For privacy questions, contact us at privacy@falconforge.app"})]})]})]})})}function eP(){return h.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 py-12 px-4",children:h.jsxs("div",{className:"max-w-3xl mx-auto",children:[h.jsxs(Ml,{to:"/login",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition-colors",children:[h.jsx(Eb,{className:"w-4 h-4"}),"Back to Login"]}),h.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-8",children:[h.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Parental Consent Information"}),h.jsxs("div",{className:"prose prose-invert prose-slate max-w-none",children:[h.jsxs("p",{className:"text-slate-300",children:["Last updated: ",new Date().toLocaleDateString()]}),h.jsx("div",{className:"bg-amber-900/30 border border-amber-700 rounded-lg p-4 my-6",children:h.jsx("p",{className:"text-amber-200 font-medium",children:"This information is for parents/guardians of students under 18 who wish to use FalconForge."})}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"About FalconForge"}),h.jsx("p",{className:"text-slate-300",children:"FalconForge is a team management platform designed for FIRST Tech Challenge robotics teams. It helps teams organize tasks, track progress, and prepare for competitions."}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"Information Collected from Students"}),h.jsx("p",{className:"text-slate-300",children:"When students use FalconForge, we collect:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Name and email address"}),h.jsx("li",{children:"Team role and sub-team assignments"}),h.jsx("li",{children:"Tasks and project contributions"}),h.jsx("li",{children:"Scouting observations and notes"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"How Student Data is Protected"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"All data is encrypted in transit and at rest"}),h.jsx("li",{children:"Student data is only visible to approved team members"}),h.jsx("li",{children:"Coaches/mentors must verify their identity"}),h.jsx("li",{children:"We do not sell or share student data with third parties"}),h.jsx("li",{children:"Students cannot be contacted by users outside their team"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"Coach/Mentor Supervision"}),h.jsx("p",{className:"text-slate-300",children:"All student accounts are associated with a team managed by verified adult coaches or mentors. These adults are responsible for:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Approving student membership requests"}),h.jsx("li",{children:"Supervising team activity"}),h.jsx("li",{children:"Removing inappropriate content"}),h.jsx("li",{children:"Managing team access"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"Your Rights as a Parent/Guardian"}),h.jsx("p",{className:"text-slate-300",children:"You have the right to:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"Review your child's data"}),h.jsx("li",{children:"Request deletion of your child's account"}),h.jsx("li",{children:"Withdraw consent at any time"}),h.jsx("li",{children:"Contact us with any concerns"})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"Consent Process"}),h.jsx("p",{className:"text-slate-300",children:"By checking the parental consent checkbox during student signup, you confirm that:"}),h.jsxs("ul",{className:"text-slate-300 list-disc pl-6 space-y-2",children:[h.jsx("li",{children:"You are the parent/guardian of the student"}),h.jsx("li",{children:"You consent to the collection of the data described above"}),h.jsxs("li",{children:["You have reviewed the ",h.jsx(Ml,{to:"/terms",className:"text-orange-400 hover:text-orange-300",children:"Terms of Service"})," and ",h.jsx(Ml,{to:"/privacy",className:"text-orange-400 hover:text-orange-300",children:"Privacy Policy"})]})]}),h.jsx("h2",{className:"text-xl font-semibold text-white mt-6 mb-3",children:"Contact"}),h.jsx("p",{className:"text-slate-300",children:"For questions about student privacy, contact us at privacy@falconforge.app"})]})]})]})})}const xn={Backlog:"Backlog",ToDo:"To Do",InProgress:"In Progress",Testing:"Testing",Done:"Done",Archived:"Archived"},gu={Feature:"Feature",Bug:"Bug"},Ov=[xn.Backlog,xn.ToDo,xn.InProgress,xn.Testing,xn.Done],tP=[{id:"m1",firstName:"Abby",lastNameInitial:"B"},{id:"m2",firstName:"Ben",lastNameInitial:"C"},{id:"m3",firstName:"Charlie",lastNameInitial:"D"},{id:"m4",firstName:"Dana",lastNameInitial:"E"},{id:"m5",firstName:"Evan",lastNameInitial:"F"}],sP=[{id:"t1",name:"Programming",memberIds:["m1"]},{id:"t2",name:"Build",memberIds:["m2"]},{id:"t3",name:"Drive",memberIds:["m3"]},{id:"t4",name:"Scouting",memberIds:["m5"]},{id:"t5",name:"Outreach",memberIds:["m4"]}],nP=[{id:"1",text:"Immediately After Match - Return Misplaced Field Artifacts",checked:!1},{id:"2",text:"Immediately After Match - Turn off robot",checked:!1},{id:"3",text:"In Pit - Swap battery",checked:!1},{id:"4",text:"In Pit - Charge old battery",checked:!1},{id:"5",text:"In Pit - Charge driver hub",checked:!1},{id:"6",text:"In Pit - Check for loose screws",checked:!1},{id:"7",text:"In Pit - Check wiring connections",checked:!1},{id:"8",text:"Meet with next alliance team",checked:!1},{id:"9",text:"On Field - Turn on robot",checked:!1},{id:"10",text:"On Field - Preload artifacts",checked:!1},{id:"11",text:"On Field - Check gamepad connections",checked:!1},{id:"12",text:"On Field - Init autonomous",checked:!1}],iP="DecodeField.png",rP=({tasks:n,setTasks:e,members:t,teams:s})=>{const[i,r]=F.useState(null),[o,a]=F.useState(!1),[c,d]=F.useState(!1),[u,m]=F.useState("board"),[p,y]=F.useState(""),[v,x]=F.useState({}),[b,w]=F.useState(null),S=F.useRef(null),A=F.useRef(null),{currentUser:k,displayName:T,initials:N}=nS();F.useEffect(()=>{o&&c&&A.current&&(A.current.focus(),A.current.select())},[o,c]);const I=M=>{const O=t.find(q=>q.id===M);return O?`${O.firstName} ${O.lastNameInitial}.`:"Unassigned"},D=M=>{const O=s.find(q=>q.id===M);return O?O.name:"General"},P=M=>{const O=t.find(q=>q.id===M);return O?`${O.firstName[0]}${O.lastNameInitial}`:"?"},R=M=>{r(M),d(!1),a(!0)},j=()=>{var O,q;const M={id:Date.now().toString(),title:"New Task",description:"",status:xn.Backlog,type:gu.Feature,assignedTo:((O=t[0])==null?void 0:O.id)||"",department:((q=s[0])==null?void 0:q.id)||"",tags:[],checklist:[],timeline:[],createdAt:Date.now()};r(M),d(!0),a(!0)},$=()=>{if(!i)return;const M=n.find(q=>q.id===i.id);let O={...i};if(!c&&M&&M.status!==i.status){const q={id:Date.now().toString(),type:"history",authorId:(k==null?void 0:k.id)||"System",content:`moved to ${i.status}`,timestamp:Date.now()};O.timeline=[q,...O.timeline]}e(c?[...n,O]:n.map(q=>q.id===O.id?O:q)),a(!1)},B=()=>{if(!p.trim()||!i)return;const M={id:Date.now().toString(),type:"comment",authorId:(k==null?void 0:k.id)||"guest",content:p,timestamp:Date.now()},O={...i,timeline:[M,...i.timeline]};r(O),e(c?[...n.filter(q=>q.id!==i.id),O]:n.map(q=>q.id===O.id?O:q)),y("")},V=M=>{if(!i)return;const O={...i,timeline:i.timeline.filter(q=>q.id!==M)};r(O),c||e(n.map(q=>q.id===O.id?O:q))},L=M=>{e(n.filter(O=>O.id!==M)),w(null),a(!1)},U=()=>{if(!i)return;const M={...i,status:xn.Archived,archivedAt:Date.now()};e(n.map(O=>O.id===M.id?M:O)),a(!1)},H=M=>{e(n.map(O=>O.id===M?{...O,status:xn.Done,archivedAt:void 0}:O))},J=M=>{x(O=>({...O,[M]:!O[M]}))},Y=()=>h.jsx("div",{className:"flex flex-col md:flex-row gap-4 h-full md:pb-4 overflow-y-auto md:overflow-x-auto",children:Ov.map(M=>{const O=v[M];return h.jsxs("div",{className:`bg-slate-100 dark:bg-slate-800 rounded-xl flex flex-col flex-shrink-0 transition-all ${O?"md:w-12 h-auto":"md:w-[280px] md:h-full"}`,children:[h.jsxs("div",{className:"p-3 font-semibold text-slate-600 dark:text-slate-300 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center cursor-pointer md:cursor-default",onClick:()=>{window.innerWidth<768&&J(M)},children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("span",{className:"md:hidden",children:O?h.jsx(aS,{size:16}):h.jsx(iu,{size:16})}),h.jsx("span",{className:O?"md:hidden":"",children:M})]}),h.jsx("span",{className:"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs px-2 py-1 rounded-full",children:n.filter(q=>q.status===M).length})]}),h.jsx("div",{className:`flex-1 overflow-y-auto p-2 space-y-2 transition-all ${O?"hidden":"block"} min-h-[50px] md:min-h-0`,children:n.filter(q=>q.status===M).map(q=>h.jsxs("div",{onClick:()=>R(q),className:"bg-white dark:bg-slate-700 p-3 rounded-lg shadow-sm border border-slate-200 dark:border-slate-600 cursor-pointer hover:shadow-md transition group relative",children:[h.jsxs("div",{className:"flex justify-between items-start mb-2",children:[h.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded ${q.type===gu.Bug?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:q.type}),h.jsx("div",{className:"text-xs text-slate-400 dark:text-slate-500",children:new Date(q.createdAt).toLocaleDateString()})]}),h.jsx("h4",{className:"font-medium text-slate-800 dark:text-slate-200 mb-1",children:q.title||"Untitled"}),h.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs text-slate-500 dark:text-slate-400",children:[h.jsx("span",{className:"bg-slate-100 dark:bg-slate-600 px-1.5 py-0.5 rounded",children:D(q.department)}),q.dueDate&&h.jsxs("span",{className:"flex items-center gap-1 text-orange-600 dark:text-orange-400",children:[h.jsx(ru,{size:10}),new Date(q.dueDate).toLocaleDateString()]}),h.jsx("div",{className:"flex-1"}),q.assignedTo&&h.jsx("div",{className:"w-6 h-6 rounded-full bg-orange-100 dark:bg-orange-900 text-orange-600 dark:text-orange-400 flex items-center justify-center font-bold text-[10px] border border-orange-200 dark:border-orange-800",children:P(q.assignedTo)})]})]},q.id))})]},M)})}),re=()=>h.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-x-auto",children:h.jsxs("table",{className:"w-full text-left text-sm text-slate-600 dark:text-slate-300 min-w-[600px]",children:[h.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700 text-xs uppercase font-bold text-slate-500 dark:text-slate-400",children:h.jsxs("tr",{children:[h.jsx("th",{className:"p-4",children:"Title"}),h.jsx("th",{className:"p-4",children:"Type"}),h.jsx("th",{className:"p-4",children:"Status"}),h.jsx("th",{className:"p-4",children:"Assigned"}),h.jsx("th",{className:"p-4",children:"Due Date"}),h.jsx("th",{className:"p-4",children:"Created"})]})}),h.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:n.map(M=>h.jsxs("tr",{onClick:()=>R(M),className:"hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer transition",children:[h.jsx("td",{className:"p-4 font-medium text-slate-900 dark:text-white",children:M.title||"Untitled"}),h.jsx("td",{className:"p-4",children:h.jsx("span",{className:`text-[10px] uppercase font-bold px-2 py-0.5 rounded ${M.type===gu.Bug?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:M.type})}),h.jsx("td",{className:"p-4",children:M.status}),h.jsx("td",{className:"p-4",children:I(M.assignedTo)}),h.jsx("td",{className:"p-4",children:M.dueDate?new Date(M.dueDate).toLocaleDateString():"-"}),h.jsx("td",{className:"p-4 text-slate-400",children:new Date(M.createdAt).toLocaleDateString()})]},M.id))})]})}),xe=()=>{const M=n.filter(O=>O.dueDate).sort((O,q)=>(O.dueDate||0)-(q.dueDate||0));return h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 overflow-y-auto",children:[h.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-white",children:"Upcoming Deadlines"}),M.length===0?h.jsx("div",{className:"text-center text-slate-400 py-10",children:"No tasks with due dates found."}):h.jsx("div",{className:"space-y-6",children:M.map(O=>h.jsxs("div",{onClick:()=>R(O),className:"flex items-center gap-4 p-4 border border-slate-100 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer transition",children:[h.jsxs("div",{className:"bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 p-3 rounded-lg flex flex-col items-center min-w-[60px]",children:[h.jsx("span",{className:"text-xs uppercase font-bold",children:new Date(O.dueDate).toLocaleString("default",{month:"short"})}),h.jsx("span",{className:"text-xl font-bold",children:new Date(O.dueDate).getDate()})]}),h.jsxs("div",{className:"flex-1",children:[h.jsx("h4",{className:"font-bold text-slate-800 dark:text-white",children:O.title}),h.jsxs("div",{className:"flex gap-2 text-xs text-slate-500 dark:text-slate-400 mt-1",children:[h.jsx("span",{className:"bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded",children:O.status}),h.jsx("span",{children:"â¢"}),h.jsx("span",{children:I(O.assignedTo)})]})]})]},O.id))})]})},_e=()=>{const M=n.filter(O=>O.status===xn.Archived).sort((O,q)=>(q.archivedAt||0)-(O.archivedAt||0));return h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 overflow-y-auto",children:[h.jsxs("h3",{className:"font-bold text-lg mb-4 text-slate-800 dark:text-white flex items-center gap-2",children:[h.jsx(v0,{size:20,className:"text-slate-500"}),"Archived Tasks"]}),M.length===0?h.jsx("div",{className:"text-center text-slate-400 py-10",children:"No archived tasks yet. Complete tasks and archive them when done."}):h.jsx("div",{className:"space-y-3",children:M.map(O=>h.jsxs("div",{className:"flex items-center gap-4 p-4 border border-slate-100 dark:border-slate-700 rounded-lg bg-slate-50 dark:bg-slate-700/30 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-700/50 transition",onClick:()=>R(O),children:[h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("h4",{className:"font-medium text-slate-800 dark:text-white truncate",children:O.title}),h.jsxs("div",{className:"flex gap-2 text-xs text-slate-500 dark:text-slate-400 mt-1",children:[h.jsx("span",{className:"bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded",children:D(O.department)}),h.jsx("span",{children:"â¢"}),h.jsx("span",{children:I(O.assignedTo)}),O.archivedAt&&h.jsxs(h.Fragment,{children:[h.jsx("span",{children:"â¢"}),h.jsxs("span",{children:["Archived ",new Date(O.archivedAt).toLocaleDateString()]})]})]})]}),h.jsxs("button",{onClick:q=>{q.stopPropagation(),H(O.id)},className:"flex items-center gap-1 px-3 py-1.5 text-sm font-medium text-orange-600 dark:text-orange-400 border border-orange-300 dark:border-orange-700 rounded-lg hover:bg-orange-50 dark:hover:bg-orange-900/20 transition",children:[h.jsx(cS,{size:14}),"Restore"]})]},O.id))})]})};return h.jsxs("div",{className:"h-full flex flex-col",children:[h.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-3 md:mb-4 px-2 md:px-4 gap-3 md:gap-4",children:[h.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white self-start md:self-auto",children:"Sprint Planning"}),h.jsxs("div",{className:"flex flex-row items-center gap-3 w-full md:w-auto",children:[h.jsxs("div",{className:"flex items-center gap-1 bg-slate-200 dark:bg-slate-700 p-1 rounded-lg",children:[h.jsx("button",{onClick:()=>m("board"),className:`p-2 rounded-md transition flex items-center justify-center ${u==="board"?"bg-white dark:bg-slate-600 shadow text-orange-600 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,title:"Board",children:h.jsx(dI,{size:18})}),h.jsx("button",{onClick:()=>m("list"),className:`p-2 rounded-md transition flex items-center justify-center ${u==="list"?"bg-white dark:bg-slate-600 shadow text-orange-600 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,title:"List",children:h.jsx(Z1,{size:18})}),h.jsx("button",{onClick:()=>m("calendar"),className:`p-2 rounded-md transition flex items-center justify-center ${u==="calendar"?"bg-white dark:bg-slate-600 shadow text-orange-600 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,title:"Calendar",children:h.jsx(oS,{size:18})}),h.jsx("button",{onClick:()=>m("archived"),className:`p-2 rounded-md transition flex items-center justify-center ${u==="archived"?"bg-white dark:bg-slate-600 shadow text-orange-600 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,title:"Archived",children:h.jsx(v0,{size:18})})]}),h.jsxs("button",{onClick:j,className:"flex-1 md:flex-none flex items-center justify-center gap-2 bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition",children:[h.jsx(Ti,{size:20})," ",h.jsx("span",{className:"hidden md:inline",children:"New Item"})]})]})]}),h.jsxs("div",{className:"flex-1 overflow-hidden px-2 md:px-4",children:[u==="board"&&h.jsx(Y,{}),u==="list"&&h.jsx(re,{}),u==="calendar"&&h.jsx(xe,{}),u==="archived"&&h.jsx(_e,{})]}),o&&i&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl overflow-hidden",children:[h.jsxs("div",{className:"p-4 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[h.jsx("div",{className:"flex-1 mr-4",children:h.jsx("input",{ref:A,value:i.title,onChange:M=>r({...i,title:M.target.value}),placeholder:"Task Title",className:"text-xl font-bold bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-600 rounded-lg p-2 focus:ring-2 focus:ring-orange-500 w-full placeholder-slate-400 dark:placeholder-slate-500 text-slate-900 dark:text-white"})}),h.jsxs("button",{onClick:()=>a(!1),className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 bg-slate-100 dark:bg-slate-700 p-2 rounded-full flex items-center justify-center w-8 h-8",children:[h.jsx("span",{className:"sr-only",children:"Close"}),h.jsx(Pi,{size:18})]})]}),h.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Type"}),h.jsxs("select",{value:i.type,onChange:M=>r({...i,type:M.target.value}),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:[h.jsx("option",{value:gu.Feature,children:"Feature"}),h.jsx("option",{value:gu.Bug,children:"Bug"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Status"}),h.jsxs("select",{value:i.status,onChange:M=>r({...i,status:M.target.value}),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:[Ov.map(M=>h.jsx("option",{value:M,children:M},M)),i.status===xn.Archived&&h.jsx("option",{value:xn.Archived,children:"Archived"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Team"}),h.jsx("select",{value:i.department,onChange:M=>r({...i,department:M.target.value}),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:s.map(M=>h.jsx("option",{value:M.id,children:M.name},M.id))})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Assigned To"}),h.jsxs("select",{value:i.assignedTo,onChange:M=>r({...i,assignedTo:M.target.value}),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm",children:[h.jsx("option",{value:"",children:"Unassigned"}),t.map(M=>h.jsxs("option",{value:M.id,children:[M.firstName," ",M.lastNameInitial,"."]},M.id))]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Due Date"}),h.jsx("input",{type:"date",value:i.dueDate?new Date(i.dueDate).toISOString().substr(0,10):"",onChange:M=>r({...i,dueDate:M.target.valueAsNumber}),className:"w-full p-2 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Description / Notes"}),h.jsx("textarea",{value:i.description,onChange:M=>r({...i,description:M.target.value}),className:"w-full h-32 p-3 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm focus:ring-2 focus:ring-orange-500 focus:border-transparent",placeholder:"Describe the task, paste meeting minutes, or log bug details..."})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2",children:"Checklist"}),h.jsxs("div",{className:"space-y-2",children:[i.checklist.map((M,O)=>h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("input",{type:"checkbox",checked:M.completed,onChange:q=>{const le=[...i.checklist];le[O].completed=q.target.checked,r({...i,checklist:le})},className:"rounded text-orange-600 focus:ring-orange-500"}),h.jsx("input",{ref:O===i.checklist.length-1?S:null,type:"text",value:M.text,placeholder:"Enter checklist item...",onChange:q=>{const le=[...i.checklist];le[O].text=q.target.value,r({...i,checklist:le})},className:"flex-1 text-sm border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 rounded px-2 py-1 focus:ring-1 focus:ring-orange-500 text-slate-900 dark:text-white placeholder-slate-400"}),h.jsx("button",{onClick:()=>{const q=i.checklist.filter((le,Se)=>Se!==O);r({...i,checklist:q})},className:"text-slate-400 hover:text-red-500 border border-slate-300 dark:border-slate-600 hover:border-red-400 rounded p-1 transition-colors",children:h.jsx(Pi,{size:14})})]},O)),h.jsx("button",{onClick:()=>{r({...i,checklist:[...i.checklist,{id:Date.now().toString(),text:"",completed:!1}]}),setTimeout(()=>{var M;(M=S.current)==null||M.focus()},50)},className:"text-sm text-orange-600 dark:text-orange-400 font-medium hover:underline",children:"+ Add Checklist Item"})]})]}),h.jsxs("div",{className:"border-t border-slate-100 dark:border-slate-700 pt-6",children:[h.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-4",children:"Activity & Comments"}),h.jsxs("div",{className:"flex gap-2 mb-6",children:[h.jsx("input",{type:"text",value:p,onChange:M=>y(M.target.value),placeholder:"Add a comment...",className:"flex-1 border rounded-lg px-3 py-2 text-sm bg-white dark:bg-slate-700 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-white",onKeyDown:M=>M.key==="Enter"&&B()}),h.jsx("button",{onClick:B,className:"bg-orange-600 text-white p-2 rounded-lg hover:bg-orange-700",children:h.jsx(AI,{size:18})})]}),h.jsx("div",{className:"space-y-4",children:i.timeline.map(M=>{const O=k&&M.authorId===k.id,q=M.authorId==="System",le=!O&&!q&&t.find(K=>K.id===M.authorId),Se=q?"System":O?T:le?I(M.authorId):"Guest",En=q?"S":O?N:le?P(M.authorId):"G";return h.jsxs("div",{className:"flex gap-3 text-sm",children:[h.jsx("div",{className:"mt-1 w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-600 flex items-center justify-center text-xs font-bold text-slate-600 dark:text-slate-300 flex-shrink-0",children:En}),h.jsxs("div",{className:"flex-1 bg-slate-50 dark:bg-slate-700/50 p-3 rounded-r-lg rounded-bl-lg",children:[h.jsxs("div",{className:"flex justify-between items-start mb-1",children:[h.jsx("span",{className:"font-bold text-slate-700 dark:text-slate-200",children:Se}),h.jsx("span",{className:"text-xs text-slate-400",children:new Date(M.timestamp).toLocaleDateString()})]}),h.jsx("div",{className:M.type==="history"?"italic text-slate-500":"text-slate-800 dark:text-slate-300",children:M.content}),M.type==="comment"&&h.jsx("div",{className:"flex justify-end mt-1",children:h.jsxs("button",{onClick:()=>V(M.id),className:"text-xs text-red-400 hover:text-red-600 flex items-center gap-1",children:[h.jsx(Ni,{size:10})," Delete"]})})]})]},M.id)})})]})]}),h.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-slate-700 flex justify-between bg-slate-50 dark:bg-slate-900/50",children:[h.jsxs("div",{className:"flex gap-2",children:[!c&&h.jsxs("button",{onClick:()=>w(i.id),className:"px-3 py-2 rounded-lg text-red-600 dark:text-red-400 border border-red-300 dark:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 font-medium flex items-center gap-1 transition",children:[h.jsx(Ni,{size:16}),"Delete"]}),!c&&i.status===xn.Done&&h.jsxs("button",{onClick:U,className:"px-3 py-2 rounded-lg text-slate-600 dark:text-slate-300 border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 font-medium flex items-center gap-1 transition",children:[h.jsx(v0,{size:16}),"Archive"]})]}),h.jsxs("div",{className:"flex gap-3",children:[h.jsx("button",{onClick:()=>a(!1),className:"px-4 py-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 font-medium",children:"Cancel"}),h.jsx("button",{onClick:$,className:"px-6 py-2 rounded-lg bg-orange-600 text-white font-medium hover:bg-orange-700 shadow-sm",children:"Save Task"})]})]})]})}),b&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-sm w-full shadow-2xl",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"Delete Task?"}),h.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"This task will be permanently deleted. This action cannot be undone."}),h.jsxs("div",{className:"flex justify-end gap-3",children:[h.jsx("button",{onClick:()=>w(null),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition",children:"Cancel"}),h.jsx("button",{onClick:()=>L(b),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition",children:"Delete"})]})]})})]})},oP=()=>{const{scoutingReports:n,addScoutingReport:e,deleteScoutingReport:t}=Xe(),[s,i]=F.useState(!1),[r,o]=F.useState(null),[a,c]=F.useState(null),[d,u]=F.useState({hasAutonomous:!1,autoScore:0,intakeType:"No Intake",autoAim:!1,farShooting:!1,shotsTaken:0,shotsMissed:0,parking:"No Park",rating:3,endGameNotes:""}),m=()=>{d.teamNumber&&(a&&t(a),e({teamNumber:d.teamNumber||"",matchNumber:d.matchNumber||0,hasAutonomous:d.hasAutonomous||!1,autoScore:d.autoScore||0,intakeType:d.intakeType||"No Intake",autoAim:d.autoAim||!1,farShooting:d.farShooting||!1,shotsTaken:d.shotsTaken||0,shotsMissed:d.shotsMissed||0,parking:d.parking||"No Park",endGameNotes:d.endGameNotes||"",rating:d.rating||3}),i(!1),c(null),v())},p=b=>{u({teamNumber:b.teamNumber,matchNumber:b.matchNumber,hasAutonomous:b.hasAutonomous,autoScore:b.autoScore,intakeType:b.intakeType,autoAim:b.autoAim,farShooting:b.farShooting,shotsTaken:b.shotsTaken,shotsMissed:b.shotsMissed,parking:b.parking,rating:b.rating,endGameNotes:b.endGameNotes}),c(b.id),i(!0)},y=b=>{t(b),o(null)},v=()=>{u({hasAutonomous:!1,autoScore:0,intakeType:"No Intake",autoAim:!1,farShooting:!1,shotsTaken:0,shotsMissed:0,parking:"No Park",rating:3,endGameNotes:""})},x=(b,w)=>{u(S=>({...S,[b]:Math.max(0,(S[b]||0)+w)}))};return h.jsxs("div",{className:"h-full flex flex-col max-w-5xl mx-auto w-full p-2 md:p-6",children:[h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex justify-between items-center",children:[h.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Scouting Reports"}),h.jsxs("button",{onClick:()=>i(!0),className:"bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-orange-700 transition shadow-sm",children:[h.jsx(Ti,{size:20})," Scout Match"]})]}),h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4",children:[n.map(b=>h.jsxs("div",{onClick:()=>p(b),className:"bg-white dark:bg-slate-800 p-3 md:p-5 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md hover:border-orange-300 dark:hover:border-orange-600 transition cursor-pointer",children:[h.jsxs("div",{className:"flex justify-between items-start mb-4",children:[h.jsx("div",{children:h.jsxs("div",{className:"text-2xl font-black text-slate-800 dark:text-white",children:["#",b.teamNumber]})}),h.jsxs("div",{className:"bg-slate-100 dark:bg-slate-700 px-2 py-1 rounded text-xs font-bold text-slate-600 dark:text-slate-300",children:["Match ",b.matchNumber]})]}),h.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-300 mb-4",children:[h.jsxs("div",{className:"flex justify-between border-b border-slate-100 dark:border-slate-700 pb-1",children:[h.jsx("span",{children:"Autonomous"}),h.jsx("span",{className:b.hasAutonomous?"text-green-600 dark:text-green-400 font-bold":"text-slate-400",children:b.hasAutonomous?`${b.autoScore} pts`:"No"})]}),h.jsxs("div",{className:"flex justify-between border-b border-slate-100 dark:border-slate-700 pb-1",children:[h.jsx("span",{children:"Intake"}),h.jsx("span",{className:"font-medium",children:b.intakeType})]}),h.jsxs("div",{className:"flex justify-between border-b border-slate-100 dark:border-slate-700 pb-1",children:[h.jsx("span",{children:"Shooting"}),h.jsxs("div",{className:"text-right",children:[h.jsxs("div",{children:[b.shotsTaken-b.shotsMissed," / ",b.shotsTaken," Shots"]}),h.jsxs("div",{className:"text-xs text-slate-400",children:[b.farShooting&&"Far ",b.autoAim&&"Auto-Aim"]})]})]}),h.jsxs("div",{className:"flex justify-between border-b border-slate-100 dark:border-slate-700 pb-1",children:[h.jsx("span",{children:"Parking"}),h.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:b.parking})]})]}),h.jsxs("div",{className:"flex items-center justify-between mb-2",children:[h.jsx("div",{className:"flex items-center gap-1 text-yellow-500",children:[...Array(5)].map((w,S)=>h.jsx(FI,{size:14,fill:S<b.rating?"currentColor":"none",className:S<b.rating?"":"text-slate-300 dark:text-slate-600"},S))}),h.jsx("button",{onClick:w=>{w.stopPropagation(),o(b.id)},className:"p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Delete report",children:h.jsx(Ni,{size:16})})]}),b.endGameNotes&&h.jsxs("p",{className:"text-xs bg-slate-50 dark:bg-slate-700 p-2 rounded text-slate-500 dark:text-slate-300 italic",children:['"',b.endGameNotes,'"']})]},b.id)),n.length===0&&h.jsx("div",{className:"col-span-full text-center py-12 text-slate-400 bg-slate-50 dark:bg-slate-800 rounded-xl border border-dashed border-slate-300 dark:border-slate-700",children:'No scouting data yet. Click "Scout Match" to begin.'})]})]}),r&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-sm w-full shadow-2xl",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"Delete Report?"}),h.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"This scouting report will be permanently deleted. This action cannot be undone."}),h.jsxs("div",{className:"flex justify-end gap-3",children:[h.jsx("button",{onClick:()=>o(null),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition",children:"Cancel"}),h.jsx("button",{onClick:()=>y(r),className:"px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition",children:"Delete"})]})]})}),s&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh] shadow-2xl",children:[h.jsx("div",{className:"p-4 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 font-bold text-lg text-slate-900 dark:text-white",children:a?"Edit Scouting Report":"New Scouting Report"}),h.jsxs("div",{className:"p-6 space-y-4 overflow-y-auto",children:[h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase",children:"Team #"}),h.jsx("input",{type:"text",className:"w-full border dark:border-slate-600 rounded p-2 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.teamNumber||"",onChange:b=>u({...d,teamNumber:b.target.value})})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase",children:"Match #"}),h.jsx("input",{type:"number",className:"w-full border dark:border-slate-600 rounded p-2 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.matchNumber||"",onChange:b=>u({...d,matchNumber:parseInt(b.target.value)})})]})]}),h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg space-y-3",children:[h.jsx("h4",{className:"font-bold text-slate-700 dark:text-white text-sm",children:"Autonomous"}),h.jsxs("label",{className:"flex items-center gap-3 text-slate-800 dark:text-white",children:[h.jsx("input",{type:"checkbox",className:"w-5 h-5 rounded text-orange-600",checked:d.hasAutonomous,onChange:b=>u({...d,hasAutonomous:b.target.checked})}),h.jsx("span",{className:"font-medium",children:"Has Autonomous"})]}),d.hasAutonomous&&h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase",children:"Auto Score"}),h.jsx("input",{type:"number",className:"w-full border dark:border-slate-600 rounded p-2 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.autoScore,onChange:b=>u({...d,autoScore:parseInt(b.target.value)})})]})]}),h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg space-y-3",children:[h.jsx("h4",{className:"font-bold text-slate-700 dark:text-white text-sm",children:"TeleOp"}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase mb-1 block",children:"Intake Type"}),h.jsxs("select",{className:"w-full border dark:border-slate-600 rounded p-2 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.intakeType,onChange:b=>u({...d,intakeType:b.target.value}),children:[h.jsx("option",{children:"No Intake"}),h.jsx("option",{children:"Human Player"}),h.jsx("option",{children:"Automatic"})]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("label",{className:"flex items-center gap-2 text-slate-800 dark:text-white text-sm",children:[h.jsx("input",{type:"checkbox",checked:d.autoAim,onChange:b=>u({...d,autoAim:b.target.checked})}),"Auto Aim"]}),h.jsxs("label",{className:"flex items-center gap-2 text-slate-800 dark:text-white text-sm",children:[h.jsx("input",{type:"checkbox",checked:d.farShooting,onChange:b=>u({...d,farShooting:b.target.checked})}),"Far Shooting"]})]}),h.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-1",children:"Shots Taken"}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:()=>x("shotsTaken",-1),className:"p-2 bg-slate-200 dark:bg-slate-600 rounded",children:h.jsx(Mv,{size:14})}),h.jsx("span",{className:"flex-1 text-center font-mono font-bold text-lg dark:text-white",children:d.shotsTaken}),h.jsx("button",{onClick:()=>x("shotsTaken",1),className:"p-2 bg-slate-200 dark:bg-slate-600 rounded",children:h.jsx(Ti,{size:14})})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-1",children:"Shots Missed"}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:()=>x("shotsMissed",-1),className:"p-2 bg-slate-200 dark:bg-slate-600 rounded",children:h.jsx(Mv,{size:14})}),h.jsx("span",{className:"flex-1 text-center font-mono font-bold text-lg dark:text-white",children:d.shotsMissed}),h.jsx("button",{onClick:()=>x("shotsMissed",1),className:"p-2 bg-slate-200 dark:bg-slate-600 rounded",children:h.jsx(Ti,{size:14})})]})]})]})]}),h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg space-y-3",children:[h.jsx("h4",{className:"font-bold text-slate-700 dark:text-white text-sm",children:"End Game"}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-1",children:"Parking"}),h.jsxs("select",{className:"w-full border dark:border-slate-600 rounded p-2 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.parking,onChange:b=>u({...d,parking:b.target.value}),children:[h.jsx("option",{children:"No Park"}),h.jsx("option",{children:"Partial Park"}),h.jsx("option",{children:"Full Park"})]})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase",children:"Driver Rating (1-5)"}),h.jsx("input",{type:"range",min:"1",max:"5",className:"w-full accent-orange-600",value:d.rating||3,onChange:b=>u({...d,rating:parseInt(b.target.value)})}),h.jsxs("div",{className:"flex justify-between text-xs text-slate-400",children:[h.jsx("span",{children:"Novice"}),h.jsx("span",{children:"Expert"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase",children:"Notes"}),h.jsx("textarea",{className:"w-full border dark:border-slate-600 rounded p-2 h-20 bg-white dark:bg-slate-700 text-slate-900 dark:text-white",value:d.endGameNotes||"",onChange:b=>u({...d,endGameNotes:b.target.value})})]})]}),h.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-end gap-3",children:[h.jsx("button",{onClick:()=>i(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700 rounded",children:"Cancel"}),h.jsx("button",{onClick:m,className:"px-6 py-2 bg-orange-600 text-white rounded font-medium hover:bg-orange-700",children:"Save Report"})]})]})})]})},aP=()=>{const[n,e]=F.useState(nP),[t,s]=F.useState(!1),[i,r]=F.useState(""),o=p=>{t||e(n.map(y=>y.id===p?{...y,checked:!y.checked}:y))},a=()=>{e(n.map(p=>({...p,checked:!1})))},c=()=>{i.trim()&&(e([...n,{id:Date.now().toString(),text:i.trim(),checked:!1}]),r(""))},d=p=>{e(n.filter(y=>y.id!==p))},u=(p,y)=>{e(n.map(v=>v.id===p?{...v,assignedTo:y}:v))},m=(p,y)=>{const v=n.findIndex(w=>w.id===p);if(v===-1||y==="up"&&v===0||y==="down"&&v===n.length-1)return;const x=[...n],b=y==="up"?v-1:v+1;[x[v],x[b]]=[x[b],x[v]],e(x)};return h.jsx("div",{className:"h-full flex flex-col max-w-3xl mx-auto w-full p-2 md:p-6",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col h-full",children:[h.jsxs("div",{className:"p-4 md:p-6 border-b border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 bg-slate-50 dark:bg-slate-900/50",children:[h.jsxs("div",{children:[h.jsx("h2",{className:"text-xl font-bold text-slate-800 dark:text-white",children:"Pre-Match Checklist"}),h.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Reset this list before every match."})]}),h.jsxs("div",{className:"flex gap-2 self-end sm:self-auto",children:[h.jsx("button",{onClick:()=>s(!t),className:`p-2 rounded-full transition flex items-center justify-center w-9 h-9 ${t?"bg-orange-100 text-orange-600":"text-slate-500 hover:text-slate-900 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-700"}`,title:"Edit Checklist",children:h.jsx(NI,{size:20})}),h.jsx("button",{onClick:a,className:"text-slate-500 hover:text-orange-600 p-2 rounded-full hover:bg-orange-50 dark:text-slate-400 dark:hover:bg-slate-700 transition flex items-center justify-center w-9 h-9",title:"Reset Checklist",children:h.jsx(cS,{size:20})})]})]}),h.jsxs("div",{className:"divide-y divide-slate-100 dark:divide-slate-700 overflow-y-auto flex-1 pr-1 custom-scrollbar",children:[n.map((p,y)=>h.jsxs("div",{className:`p-4 transition ${p.checked?"bg-green-50/50 dark:bg-green-900/20":"hover:bg-slate-50 dark:hover:bg-slate-700/50"} ${t?"flex flex-col gap-2":"flex items-center gap-4"}`,children:[h.jsxs("div",{className:"flex items-center gap-4 w-full",children:[h.jsx("div",{className:"cursor-pointer flex-shrink-0",onClick:()=>o(p.id),children:!t&&h.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center transition ${p.checked?"bg-green-500 border-green-500 text-white":"border-slate-300 dark:border-slate-500 text-transparent"}`,children:h.jsx(lS,{size:16,fill:"currentColor",className:p.checked?"text-white":""})})}),h.jsx("span",{onClick:()=>o(p.id),className:`text-lg font-medium flex-1 cursor-pointer transition ${p.checked?"text-slate-400 line-through dark:text-slate-500":"text-slate-700 dark:text-slate-200"}`,children:p.text}),!t&&p.assignedTo&&h.jsx("span",{className:"text-xs bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-400 px-2 py-1 rounded flex-shrink-0",children:p.assignedTo})]}),t&&h.jsxs("div",{className:"flex items-center justify-between gap-2 pl-0 md:pl-10",children:[h.jsxs("select",{className:"text-xs border border-slate-200 dark:border-slate-600 rounded p-1.5 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 flex-1 max-w-[150px]",value:p.assignedTo||"",onChange:v=>u(p.id,v.target.value),children:[h.jsx("option",{value:"",children:"Anyone"}),h.jsx("optgroup",{label:"Teams",children:sP.map(v=>h.jsx("option",{value:v.name,children:v.name},v.id))}),h.jsx("optgroup",{label:"Members",children:tP.map(v=>h.jsxs("option",{value:v.firstName,children:[v.firstName," ",v.lastNameInitial,"."]},v.id))})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("button",{onClick:v=>{v.stopPropagation(),m(p.id,"up")},className:"text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 p-1.5 disabled:opacity-30",disabled:y===0,title:"Move up",children:h.jsx(w1,{size:18})}),h.jsx("button",{onClick:v=>{v.stopPropagation(),m(p.id,"down")},className:"text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 p-1.5 disabled:opacity-30",disabled:y===n.length-1,title:"Move down",children:h.jsx(iu,{size:18})}),h.jsx("button",{onClick:v=>{v.stopPropagation(),d(p.id)},className:"text-red-500 hover:text-red-700 p-1.5 ml-1",children:h.jsx(Ni,{size:18})})]})]})]},p.id)),t&&h.jsxs("div",{className:"p-4 flex gap-2 bg-slate-50 dark:bg-slate-700/50",children:[h.jsx("input",{type:"text",value:i,onChange:p=>r(p.target.value),onKeyDown:p=>p.key==="Enter"&&c(),placeholder:"Add new item...",className:"flex-1 border rounded px-3 py-2 bg-white dark:bg-slate-800 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-white"}),h.jsx("button",{onClick:c,className:"bg-orange-600 text-white px-4 py-2 rounded font-bold",children:"Add"})]})]})]})})},lP=()=>{const n=F.useRef(null),[e,t]=F.useState("#ef4444"),[s,i]=F.useState(!0),{matchPlans:r,addMatchPlan:o,deleteMatchPlan:a,getCurrentSeason:c,currentSeasonId:d}=Xe(),u=c(),m=(u==null?void 0:u.fieldImageUrl)||iP,p=r.filter(O=>!O.seasonId||O.seasonId===d),[y,v]=F.useState([]),[x,b]=F.useState([]),[w,S]=F.useState(""),[A,k]=F.useState(""),[T,N]=F.useState(""),[I,D]=F.useState(!1),[P,R]=F.useState(!1),[j,$]=F.useState(!1),[B,V]=F.useState(!1),[L,U]=F.useState(""),H=()=>{o({title:L||`Match Plan ${new Date().toLocaleString()}`,drawingData:y,notes:T,allianceTeam:A,partnerAutonomous:I,partnerPark:P}),$(!1),U(""),alert("Plan saved!")},J=O=>{v(O.drawingData),k(O.allianceTeam),N(O.notes),D(O.partnerAutonomous),R(O.partnerPark),V(!1)};F.useEffect(()=>{if(!n.current)return;const O=Tp(n.current),q=Lk().on("start",function(le){Tp(this).raise().attr("stroke","white").attr("stroke-width",3)}).on("drag",function(le){s||Tp(this).attr("cx",le.x).attr("cy",le.y)}).on("end",function(le){Tp(this).attr("stroke","white").attr("stroke-width",2)});O.selectAll(".draggable-robot").call(q)},[s]);const Y=O=>{if(!s)return;const q=n.current;if(!q)return;const le=q.createSVGPoint();le.x=O.nativeEvent.offsetX,le.y=O.nativeEvent.offsetY,S(`M ${le.x} ${le.y}`),q.setPointerCapture(O.pointerId)},re=O=>{!s||!w||S(q=>`${q} L ${O.nativeEvent.offsetX} ${O.nativeEvent.offsetY}`)},xe=O=>{!s||!w||(v([...y,{d:w,stroke:e,width:3}]),b([]),S(""),n.current&&n.current.releasePointerCapture(O.pointerId))},_e=()=>{if(y.length===0)return;const O=[...y],q=O.pop();q&&b([...x,q]),v(O)},M=()=>{if(x.length===0)return;const O=[...x],q=O.pop();q&&v([...y,q]),b(O)};return h.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 md:gap-4 lg:h-full h-auto lg:overflow-hidden overflow-visible",children:[h.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 flex flex-col overflow-hidden relative min-h-[500px] lg:min-h-0",children:[h.jsxs("div",{className:"sticky top-0 z-20 bg-slate-100 dark:bg-slate-700 p-2 flex items-center justify-between border-b border-slate-200 dark:border-slate-600 shadow-sm",children:[h.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[h.jsx("button",{onClick:()=>i(!s),className:`p-2 rounded flex items-center justify-center ${s?"bg-white dark:bg-slate-600 shadow text-orange-600 dark:text-orange-400":"text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600"}`,title:s?"Drawing ON (click to toggle)":"Drawing OFF (click to toggle)",children:h.jsx(hI,{size:18})}),h.jsx("div",{className:"h-6 w-px bg-slate-300 dark:bg-slate-600"}),h.jsx("button",{onClick:()=>t("#ef4444"),className:`w-4 h-4 md:w-5 md:h-5 rounded-full bg-red-500 border-2 ${e==="#ef4444"?"border-slate-800 dark:border-white":"border-transparent"}`}),h.jsx("button",{onClick:()=>t("#3b82f6"),className:`w-4 h-4 md:w-5 md:h-5 rounded-full bg-blue-500 border-2 ${e==="#3b82f6"?"border-slate-800 dark:border-white":"border-transparent"}`}),h.jsx("button",{onClick:()=>t("#22c55e"),className:`w-4 h-4 md:w-5 md:h-5 rounded-full bg-green-500 border-2 ${e==="#22c55e"?"border-slate-800 dark:border-white":"border-transparent"}`}),h.jsx("button",{onClick:()=>t("#facc15"),className:`w-4 h-4 md:w-5 md:h-5 rounded-full bg-yellow-400 border-2 ${e==="#facc15"?"border-slate-800 dark:border-white":"border-transparent"}`})]}),h.jsxs("div",{className:"flex items-center gap-1",children:[h.jsx("button",{onClick:_e,disabled:y.length===0,className:"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-600 rounded disabled:opacity-30",title:"Undo",children:h.jsx(OI,{size:18})}),h.jsx("button",{onClick:M,disabled:x.length===0,className:"p-2 text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-600 rounded disabled:opacity-30",title:"Redo",children:h.jsx(yI,{size:18})}),h.jsx("button",{onClick:()=>{v([]),b([])},className:"p-2 text-slate-500 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded",title:"Clear",children:h.jsx(Ni,{size:18})}),h.jsx("div",{className:"h-6 w-px bg-slate-300 dark:bg-slate-600 mx-1"}),h.jsx("button",{onClick:()=>V(!0),className:"p-2 text-slate-500 dark:text-slate-400 hover:text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/30 rounded",title:"Load Plans",children:h.jsx(Pv,{size:18})}),h.jsx("button",{onClick:()=>$(!0),className:"p-2 text-slate-500 dark:text-slate-400 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-900/30 rounded",title:"Save Plan",children:h.jsx(vy,{size:18})})]})]}),h.jsxs("div",{className:"relative flex-1 bg-slate-900 overflow-hidden cursor-crosshair",children:[h.jsx("img",{src:m,className:"absolute inset-0 w-full h-full object-contain opacity-50 pointer-events-none select-none",alt:"Field"}),h.jsxs("svg",{ref:n,className:"absolute inset-0 w-full h-full z-10 touch-none",onPointerDown:Y,onPointerMove:re,onPointerUp:xe,onPointerCancel:xe,onPointerLeave:xe,children:[y.map((O,q)=>h.jsx("path",{d:O.d,stroke:O.stroke,strokeWidth:O.width,fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},q)),w&&h.jsx("path",{d:w,stroke:e,strokeWidth:3,fill:"none",strokeLinecap:"round",strokeLinejoin:"round"})]})]})]}),h.jsxs("div",{className:"w-full lg:w-80 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-3 md:p-4 flex flex-col",children:[h.jsx("h3",{className:"font-bold text-slate-800 dark:text-white mb-4",children:"Match Notes"}),h.jsxs("div",{className:"space-y-3 md:space-y-4 flex-1",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Alliance Partner"}),h.jsx("input",{type:"text",value:A,onChange:O=>k(O.target.value),placeholder:"Team # / Name",className:"w-full p-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-sm text-slate-900 dark:text-white"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Our Strategy"}),h.jsx("textarea",{value:T,onChange:O=>N(O.target.value),className:"w-full h-32 p-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-sm resize-none text-slate-900 dark:text-white",placeholder:`1. Autonomous path...
2. TeleOp focus...`})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1",children:"Partner Capabilities"}),h.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[h.jsxs("label",{className:"flex items-center gap-2 p-2 border border-slate-200 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-700 text-xs text-slate-800 dark:text-slate-200",children:[h.jsx("input",{type:"checkbox",checked:I,onChange:O=>D(O.target.checked)})," Autonomous"]}),h.jsxs("label",{className:"flex items-center gap-2 p-2 border border-slate-200 dark:border-slate-600 rounded bg-slate-50 dark:bg-slate-700 text-xs text-slate-800 dark:text-slate-200",children:[h.jsx("input",{type:"checkbox",checked:P,onChange:O=>R(O.target.checked)})," Lifted Park"]})]})]})]}),h.jsxs("div",{className:"flex gap-2 mt-4 lg:hidden",children:[h.jsxs("button",{onClick:()=>V(!0),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-lg font-semibold text-sm",children:[h.jsx(Pv,{size:18})," Load"]}),h.jsxs("button",{onClick:()=>$(!0),className:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2.5 bg-green-600 text-white rounded-lg font-semibold text-sm shadow-md",children:[h.jsx(vy,{size:18})," Save"]})]})]}),j&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 w-full max-w-sm",children:[h.jsx("h3",{className:"text-lg font-bold mb-4 text-slate-900 dark:text-white",children:"Save Match Plan"}),h.jsx("input",{autoFocus:!0,type:"text",placeholder:"Plan Name (e.g. Match 1)",value:L,onChange:O=>U(O.target.value),onKeyDown:O=>O.key==="Enter"&&H(),className:"w-full p-2 border border-slate-300 dark:border-slate-600 rounded mb-4 bg-white dark:bg-slate-700 text-slate-900 dark:text-white"}),h.jsxs("div",{className:"flex justify-end gap-2",children:[h.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-300",children:"Cancel"}),h.jsx("button",{onClick:H,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Save"})]})]})}),B&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 w-full max-w-md max-h-[80vh] flex flex-col",children:[h.jsxs("div",{className:"flex justify-between items-center mb-4",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white",children:"Saved Plans"}),h.jsx("button",{onClick:()=>V(!1),children:h.jsx(Pi,{})})]}),h.jsx("div",{className:"flex-1 overflow-y-auto space-y-2",children:p.length===0?h.jsx("div",{className:"text-center text-slate-500 py-8",children:"No saved plans found."}):p.map(O=>h.jsxs("div",{className:"flex items-center justify-between p-3 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[h.jsxs("div",{className:"cursor-pointer flex-1",onClick:()=>J(O),children:[h.jsx("div",{className:"font-bold text-slate-800 dark:text-white",children:O.title}),h.jsxs("div",{className:"text-xs text-slate-500",children:[new Date(O.updatedAt).toLocaleDateString()," â¢ ",O.allianceTeam||"No Team"]})]}),h.jsx("button",{onClick:()=>{a(O.id)},className:"p-2 text-red-400 hover:text-red-600",children:h.jsx(Ni,{size:16})})]},O.id))})]})})]})};var cP={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let dP,uP;function hP(){return{geminiUrl:dP,vertexUrl:uP}}function fP(n,e,t,s){var i,r;if(!(n!=null&&n.baseUrl)){const o=hP();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:t:(r=o.geminiUrl)!==null&&r!==void 0?r:s}return n.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hr{}function Q(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function g(n,e,t){for(let r=0;r<e.length-1;r++){const o=e[r];if(o.endsWith("[]")){const a=o.slice(0,-2);if(!(a in n))if(Array.isArray(t))n[a]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[a])){const c=n[a];if(Array.isArray(t))for(let d=0;d<c.length;d++){const u=c[d];g(u,e.slice(r+1),t[d])}else for(const d of c)g(d,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){const a=o.slice(0,-3);a in n||(n[a]=[{}]);const c=n[a];g(c[0],e.slice(r+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const s=e[e.length-1],i=n[s];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[s]=t}function f(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let s=0;s<e.length;s++){if(typeof n!="object"||n===null)return t;const i=e[s];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in n){const o=n[r];return Array.isArray(o)?o.map(a=>f(a,e.slice(s+1),t)):t}else return t}else n=n[i]}return n}catch(s){if(s instanceof TypeError)return t;throw s}}function pP(n,e){for(const[t,s]of Object.entries(e)){const i=t.split("."),r=s.split("."),o=new Set;let a=-1;for(let c=0;c<i.length;c++)if(i[c]==="*"){a=c;break}if(a!==-1&&r.length>a)for(let c=a;c<r.length;c++){const d=r[c];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&o.add(d)}_y(n,i,r,0,o)}}function _y(n,e,t,s,i){if(s>=e.length||typeof n!="object"||n===null)return;const r=e[s];if(r.endsWith("[]")){const o=r.slice(0,-2),a=n;if(o in a&&Array.isArray(a[o]))for(const c of a[o])_y(c,e,t,s+1,i)}else if(r==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const o=n,a=Object.keys(o).filter(d=>!d.startsWith("_")&&!i.has(d)),c={};for(const d of a)c[d]=o[d];for(const[d,u]of Object.entries(c)){const m=[];for(const p of t.slice(s))p==="*"?m.push(d):m.push(p);g(o,m,u)}for(const d of a)delete o[d]}}else{const o=n;r in o&&_y(o[r],e,t,s+1,i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function kb(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mP(n){const e={},t=f(n,["operationName"]);t!=null&&g(e,["operationName"],t);const s=f(n,["resourceName"]);return s!=null&&g(e,["_url","resourceName"],s),e}function gP(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],xP(o)),e}function yP(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response"]);return o!=null&&g(e,["response"],bP(o)),e}function xP(n){const e={},t=f(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>vP(o))),g(e,["generatedVideos"],r)}const s=f(n,["raiMediaFilteredCount"]);s!=null&&g(e,["raiMediaFilteredCount"],s);const i=f(n,["raiMediaFilteredReasons"]);return i!=null&&g(e,["raiMediaFilteredReasons"],i),e}function bP(n){const e={},t=f(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>wP(o))),g(e,["generatedVideos"],r)}const s=f(n,["raiMediaFilteredCount"]);s!=null&&g(e,["raiMediaFilteredCount"],s);const i=f(n,["raiMediaFilteredReasons"]);return i!=null&&g(e,["raiMediaFilteredReasons"],i),e}function vP(n){const e={},t=f(n,["video"]);return t!=null&&g(e,["video"],kP(t)),e}function wP(n){const e={},t=f(n,["_self"]);return t!=null&&g(e,["video"],TP(t)),e}function _P(n){const e={},t=f(n,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function AP(n){const e={},t=f(n,["operationName"]);return t!=null&&g(e,["_url","operationName"],t),e}function SP(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response"]);return o!=null&&g(e,["response"],CP(o)),e}function CP(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["parent"]);s!=null&&g(e,["parent"],s);const i=f(n,["documentName"]);return i!=null&&g(e,["documentName"],i),e}function uS(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response"]);return o!=null&&g(e,["response"],EP(o)),e}function EP(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["parent"]);s!=null&&g(e,["parent"],s);const i=f(n,["documentName"]);return i!=null&&g(e,["documentName"],i),e}function kP(n){const e={},t=f(n,["uri"]);t!=null&&g(e,["uri"],t);const s=f(n,["encodedVideo"]);s!=null&&g(e,["videoBytes"],kb(s));const i=f(n,["encoding"]);return i!=null&&g(e,["mimeType"],i),e}function TP(n){const e={},t=f(n,["gcsUri"]);t!=null&&g(e,["uri"],t);const s=f(n,["bytesBase64Encoded"]);s!=null&&g(e,["videoBytes"],kb(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Uv;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Uv||(Uv={}));var Bv;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Bv||(Bv={}));var Hv;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(Hv||(Hv={}));var Yo;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Yo||(Yo={}));var Gv;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Gv||(Gv={}));var qv;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(qv||(qv={}));var Vv;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(Vv||(Vv={}));var $v;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})($v||($v={}));var zv;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(zv||(zv={}));var Wv;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH",n.MINIMAL="MINIMAL"})(Wv||(Wv={}));var Kv;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Kv||(Kv={}));var Yv;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Yv||(Yv={}));var Jv;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(Jv||(Jv={}));var Xv;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE",n.IMAGE_RECITATION="IMAGE_RECITATION",n.IMAGE_OTHER="IMAGE_OTHER"})(Xv||(Xv={}));var Qv;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Qv||(Qv={}));var Zv;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(Zv||(Zv={}));var ew;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(ew||(ew={}));var tw;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(tw||(tw={}));var sw;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(sw||(sw={}));var eg;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(eg||(eg={}));var nw;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(nw||(nw={}));var iw;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(iw||(iw={}));var rw;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(rw||(rw={}));var Ay;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Ay||(Ay={}));var ow;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(ow||(ow={}));var aw;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",n.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(aw||(aw={}));var lw;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(lw||(lw={}));var cw;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(cw||(cw={}));var dw;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(dw||(dw={}));var uw;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(uw||(uw={}));var hw;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(hw||(hw={}));var fw;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(fw||(fw={}));var pw;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(pw||(pw={}));var mw;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(mw||(mw={}));var gw;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(gw||(gw={}));var yw;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(yw||(yw={}));var xw;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(xw||(xw={}));var bw;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(bw||(bw={}));var vw;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(vw||(vw={}));var ww;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(ww||(ww={}));var _w;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(_w||(_w={}));var Aw;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Aw||(Aw={}));var Sw;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Sw||(Sw={}));var Cw;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(Cw||(Cw={}));var Ew;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Ew||(Ew={}));var kw;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(kw||(kw={}));var Tw;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Tw||(Tw={}));var Nw;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Nw||(Nw={}));var Iw;(function(n){n.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",n.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",n.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(Iw||(Iw={}));var Pw;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Pw||(Pw={}));var Rw;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Rw||(Rw={}));var Mw;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Mw||(Mw={}));var Dw;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Dw||(Dw={}));var Lw;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Lw||(Lw={}));var Fw;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(Fw||(Fw={}));var oc;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(oc||(oc={}));class Sy{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class yu{get text(){var e,t,s,i,r,o,a,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",u=!1;const m=[];for(const p of(c=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[y,v]of Object.entries(p))y!=="text"&&y!=="thought"&&y!=="thoughtSignature"&&(v!==null||v!==void 0)&&m.push(y);if(typeof p.text=="string"){if(typeof p.thought=="boolean"&&p.thought)continue;u=!0,d+=p.text}}return m.length>0&&console.warn(`there are non-text parts ${m} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?d:void 0}get data(){var e,t,s,i,r,o,a,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const u=[];for(const m of(c=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)!==null&&c!==void 0?c:[]){for(const[p,y]of Object.entries(m))p!=="inlineData"&&(y!==null||y!==void 0)&&u.push(p);m.inlineData&&typeof m.inlineData.data=="string"&&(d+=atob(m.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,s,i,r,o,a,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(u=>u.functionCall).map(u=>u.functionCall).filter(u=>u!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,s,i,r,o,a,c,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const u=(c=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(m=>m.executableCode).map(m=>m.executableCode).filter(m=>m!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,s,i,r,o,a,c,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const u=(c=(a=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||a===void 0?void 0:a.parts)===null||c===void 0?void 0:c.filter(m=>m.codeExecutionResult).map(m=>m.codeExecutionResult).filter(m=>m!==void 0);if((u==null?void 0:u.length)!==0)return(d=u==null?void 0:u[0])===null||d===void 0?void 0:d.output}}class jw{}class Ow{}class NP{}class IP{}class PP{}class RP{}class Uw{}class Bw{}class Hw{}class MP{}class tg{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new tg;let i;const r=e;return t?i=yP(r):i=gP(r),Object.assign(s,i),s}}class Gw{}class qw{}class Vw{}class $w{}class DP{}class LP{}class FP{}class Tb{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new Tb,r=SP(e);return Object.assign(s,r),s}}class jP{}class OP{}class UP{}class zw{}class BP{get text(){var e,t,s;let i="",r=!1;const o=[];for(const a of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[c,d]of Object.entries(a))c!=="text"&&c!=="thought"&&d!==null&&o.push(c);if(typeof a.text=="string"){if(typeof a.thought=="boolean"&&a.thought)continue;r=!0,i+=a.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,s;let i="";const r=[];for(const o of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[a,c]of Object.entries(o))a!=="inlineData"&&c!==null&&r.push(a);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class HP{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Nb{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new Nb,r=uS(e);return Object.assign(s,r),s}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Pe(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function hS(n,e){const t=Pe(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function fS(n){return Array.isArray(n)?n.map(e=>sg(e)):[sg(n)]}function sg(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function pS(n){const e=sg(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function mS(n){const e=sg(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Ww(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function gS(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>Ww(e)):[Ww(n)]}function Cy(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Kw(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Yw(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function is(n){if(n==null)throw new Error("ContentUnion is required");return Cy(n)?n:{role:"user",parts:gS(n)}}function Ib(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=is(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=is(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>is(t)):[is(e)]}function wn(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Kw(n)||Yw(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[is(n)]}const e=[],t=[],s=Cy(n[0]);for(const i of n){const r=Cy(i);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(Kw(i)||Yw(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return s||e.push({role:"user",parts:gS(t)}),e}function GP(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.values(Yo).includes(t[0].toUpperCase())?t[0].toUpperCase():Yo.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.values(Yo).includes(s.toUpperCase())?s.toUpperCase():Yo.TYPE_UNSPECIFIED})}}function xc(n){const e={},t=["items"],s=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=n.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,n=r[1]):r[1].type==="null"&&(e.nullable=!0,n=r[0])),n.type instanceof Array&&GP(n.type,e);for(const[o,a]of Object.entries(n))if(a!=null)if(o=="type"){if(a==="null")throw new Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;e.type=Object.values(Yo).includes(a.toUpperCase())?a.toUpperCase():Yo.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=xc(a);else if(s.includes(o)){const c=[];for(const d of a){if(d.type=="null"){e.nullable=!0;continue}c.push(xc(d))}e[o]=c}else if(i.includes(o)){const c={};for(const[d,u]of Object.entries(a))c[d]=xc(u);e[o]=c}else{if(o==="additionalProperties")continue;e[o]=a}return e}function Pb(n){return xc(n)}function Rb(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Mb(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function du(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=xc(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=xc(e.response));return n}function uu(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function qP(n,e,t,s=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Gr(n,e){if(typeof e!="string")throw new Error("name must be a string");return qP(n,e,"cachedContents")}function yS(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function sa(n){return kb(n)}function VP(n){return n!=null&&typeof n=="object"&&"name"in n}function $P(n){return n!=null&&typeof n=="object"&&"video"in n}function zP(n){return n!=null&&typeof n=="object"&&"uri"in n}function xS(n){var e;let t;if(VP(n)&&(t=n.name),!(zP(n)&&(t=n.uri,t===void 0))&&!($P(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function bS(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function vS(n){for(const e of["models","tunedModels","publisherModels"])if(WP(n,e))return n[e];return[]}function WP(n,e){return n!==null&&typeof n=="object"&&e in n}function KP(n,e={}){const t=n,s={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(s.responseJsonSchema=t.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function YP(n,e={}){const t=[],s=new Set;for(const i of n){const r=i.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const o=KP(i,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function wS(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const s=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function JP(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function _S(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return n;let r=!1;for(const o of i){if(typeof o!="object"||o===null)continue;const c=o.response;if(typeof c!="object"||c===null)continue;if(c.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function hu(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function AS(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function XP(n){const e={},t=f(n,["responsesFile"]);t!=null&&g(e,["fileName"],t);const s=f(n,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>PR(o))),g(e,["inlinedResponses"],r)}const i=f(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["inlinedEmbedContentResponses"],r)}return e}function QP(n){const e={},t=f(n,["predictionsFormat"]);t!=null&&g(e,["format"],t);const s=f(n,["gcsDestination","outputUriPrefix"]);s!=null&&g(e,["gcsUri"],s);const i=f(n,["bigqueryDestination","outputUri"]);return i!=null&&g(e,["bigqueryUri"],i),e}function ZP(n){const e={},t=f(n,["format"]);t!=null&&g(e,["predictionsFormat"],t);const s=f(n,["gcsUri"]);s!=null&&g(e,["gcsDestination","outputUriPrefix"],s);const i=f(n,["bigqueryUri"]);if(i!=null&&g(e,["bigqueryDestination","outputUri"],i),f(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(f(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function om(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata","displayName"]);s!=null&&g(e,["displayName"],s);const i=f(n,["metadata","state"]);i!=null&&g(e,["state"],AS(i));const r=f(n,["metadata","createTime"]);r!=null&&g(e,["createTime"],r);const o=f(n,["metadata","endTime"]);o!=null&&g(e,["endTime"],o);const a=f(n,["metadata","updateTime"]);a!=null&&g(e,["updateTime"],a);const c=f(n,["metadata","model"]);c!=null&&g(e,["model"],c);const d=f(n,["metadata","output"]);return d!=null&&g(e,["dest"],XP(_S(d))),e}function Ey(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["displayName"]);s!=null&&g(e,["displayName"],s);const i=f(n,["state"]);i!=null&&g(e,["state"],AS(i));const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["createTime"]);o!=null&&g(e,["createTime"],o);const a=f(n,["startTime"]);a!=null&&g(e,["startTime"],a);const c=f(n,["endTime"]);c!=null&&g(e,["endTime"],c);const d=f(n,["updateTime"]);d!=null&&g(e,["updateTime"],d);const u=f(n,["model"]);u!=null&&g(e,["model"],u);const m=f(n,["inputConfig"]);m!=null&&g(e,["src"],eR(m));const p=f(n,["outputConfig"]);p!=null&&g(e,["dest"],QP(_S(p)));const y=f(n,["completionStats"]);return y!=null&&g(e,["completionStats"],y),e}function eR(n){const e={},t=f(n,["instancesFormat"]);t!=null&&g(e,["format"],t);const s=f(n,["gcsSource","uris"]);s!=null&&g(e,["gcsUri"],s);const i=f(n,["bigquerySource","inputUri"]);return i!=null&&g(e,["bigqueryUri"],i),e}function tR(n,e){const t={};if(f(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(f(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=f(e,["fileName"]);s!=null&&g(t,["fileName"],s);const i=f(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>IR(n,o))),g(t,["requests","requests"],r)}return t}function sR(n){const e={},t=f(n,["format"]);t!=null&&g(e,["instancesFormat"],t);const s=f(n,["gcsUri"]);s!=null&&g(e,["gcsSource","uris"],s);const i=f(n,["bigqueryUri"]);if(i!=null&&g(e,["bigquerySource","inputUri"],i),f(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(f(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function nR(n){const e={},t=f(n,["data"]);if(t!=null&&g(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function iR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function rR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function oR(n){const e={},t=f(n,["content"]);t!=null&&g(e,["content"],t);const s=f(n,["citationMetadata"]);s!=null&&g(e,["citationMetadata"],aR(s));const i=f(n,["tokenCount"]);i!=null&&g(e,["tokenCount"],i);const r=f(n,["finishReason"]);r!=null&&g(e,["finishReason"],r);const o=f(n,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);const a=f(n,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);const c=f(n,["index"]);c!=null&&g(e,["index"],c);const d=f(n,["logprobsResult"]);d!=null&&g(e,["logprobsResult"],d);const u=f(n,["safetyRatings"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(y=>y)),g(e,["safetyRatings"],p)}const m=f(n,["urlContextMetadata"]);return m!=null&&g(e,["urlContextMetadata"],m),e}function aR(n){const e={},t=f(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),g(e,["citations"],s)}return e}function SS(n){const e={},t=f(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>OR(r))),g(e,["parts"],i)}const s=f(n,["role"]);return s!=null&&g(e,["role"],s),e}function lR(n,e){const t={},s=f(n,["displayName"]);if(e!==void 0&&s!=null&&g(e,["batch","displayName"],s),f(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function cR(n,e){const t={},s=f(n,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);const i=f(n,["dest"]);return e!==void 0&&i!=null&&g(e,["outputConfig"],ZP(JP(i))),t}function Jw(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["src"]);i!=null&&g(t,["batch","inputConfig"],tR(n,wS(n,i)));const r=f(e,["config"]);return r!=null&&lR(r,t),t}function dR(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["model"],Pe(n,s));const i=f(e,["src"]);i!=null&&g(t,["inputConfig"],sR(wS(n,i)));const r=f(e,["config"]);return r!=null&&cR(r,t),t}function uR(n,e){const t={},s=f(n,["displayName"]);return e!==void 0&&s!=null&&g(e,["batch","displayName"],s),t}function hR(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["src"]);i!=null&&g(t,["batch","inputConfig"],bR(n,i));const r=f(e,["config"]);return r!=null&&uR(r,t),t}function fR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function pR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function mR(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["name"]);s!=null&&g(e,["name"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);return r!=null&&g(e,["error"],r),e}function gR(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["name"]);s!=null&&g(e,["name"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);return r!=null&&g(e,["error"],r),e}function yR(n,e){const t={},s=f(e,["contents"]);if(s!=null){let r=Ib(n,s);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["requests[]","request","content"],r)}const i=f(e,["config"]);return i!=null&&(g(t,["_self"],xR(i,t)),pP(t,{"requests[].*":"requests[].request.*"})),t}function xR(n,e){const t={},s=f(n,["taskType"]);e!==void 0&&s!=null&&g(e,["requests[]","taskType"],s);const i=f(n,["title"]);e!==void 0&&i!=null&&g(e,["requests[]","title"],i);const r=f(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function bR(n,e){const t={},s=f(e,["fileName"]);s!=null&&g(t,["file_name"],s);const i=f(e,["inlinedRequests"]);return i!=null&&g(t,["requests"],yR(n,i)),t}function vR(n){const e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=f(n,["fileUri"]);t!=null&&g(e,["fileUri"],t);const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function wR(n){const e={},t=f(n,["id"]);t!=null&&g(e,["id"],t);const s=f(n,["args"]);s!=null&&g(e,["args"],s);const i=f(n,["name"]);if(i!=null&&g(e,["name"],i),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function _R(n){const e={},t=f(n,["mode"]);t!=null&&g(e,["mode"],t);const s=f(n,["allowedFunctionNames"]);if(s!=null&&g(e,["allowedFunctionNames"],s),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function AR(n,e,t){const s={},i=f(e,["systemInstruction"]);t!==void 0&&i!=null&&g(t,["systemInstruction"],SS(is(i)));const r=f(e,["temperature"]);r!=null&&g(s,["temperature"],r);const o=f(e,["topP"]);o!=null&&g(s,["topP"],o);const a=f(e,["topK"]);a!=null&&g(s,["topK"],a);const c=f(e,["candidateCount"]);c!=null&&g(s,["candidateCount"],c);const d=f(e,["maxOutputTokens"]);d!=null&&g(s,["maxOutputTokens"],d);const u=f(e,["stopSequences"]);u!=null&&g(s,["stopSequences"],u);const m=f(e,["responseLogprobs"]);m!=null&&g(s,["responseLogprobs"],m);const p=f(e,["logprobs"]);p!=null&&g(s,["logprobs"],p);const y=f(e,["presencePenalty"]);y!=null&&g(s,["presencePenalty"],y);const v=f(e,["frequencyPenalty"]);v!=null&&g(s,["frequencyPenalty"],v);const x=f(e,["seed"]);x!=null&&g(s,["seed"],x);const b=f(e,["responseMimeType"]);b!=null&&g(s,["responseMimeType"],b);const w=f(e,["responseSchema"]);w!=null&&g(s,["responseSchema"],Pb(w));const S=f(e,["responseJsonSchema"]);if(S!=null&&g(s,["responseJsonSchema"],S),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=f(e,["safetySettings"]);if(t!==void 0&&A!=null){let B=A;Array.isArray(B)&&(B=B.map(V=>UR(V))),g(t,["safetySettings"],B)}const k=f(e,["tools"]);if(t!==void 0&&k!=null){let B=uu(k);Array.isArray(B)&&(B=B.map(V=>HR(du(V)))),g(t,["tools"],B)}const T=f(e,["toolConfig"]);if(t!==void 0&&T!=null&&g(t,["toolConfig"],BR(T)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Gr(n,N));const I=f(e,["responseModalities"]);I!=null&&g(s,["responseModalities"],I);const D=f(e,["mediaResolution"]);D!=null&&g(s,["mediaResolution"],D);const P=f(e,["speechConfig"]);if(P!=null&&g(s,["speechConfig"],Rb(P)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=f(e,["thinkingConfig"]);R!=null&&g(s,["thinkingConfig"],R);const j=f(e,["imageConfig"]);j!=null&&g(s,["imageConfig"],NR(j));const $=f(e,["enableEnhancedCivicAnswers"]);return $!=null&&g(s,["enableEnhancedCivicAnswers"],$),s}function SR(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["candidates"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(d=>oR(d))),g(e,["candidates"],c)}const i=f(n,["modelVersion"]);i!=null&&g(e,["modelVersion"],i);const r=f(n,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);const o=f(n,["responseId"]);o!=null&&g(e,["responseId"],o);const a=f(n,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function CR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function ER(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],hu(n,s)),t}function kR(n){const e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=f(n,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function TR(n){const e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=f(n,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function NR(n){const e={},t=f(n,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);const s=f(n,["imageSize"]);if(s!=null&&g(e,["imageSize"],s),f(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function IR(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["request","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let a=wn(i);Array.isArray(a)&&(a=a.map(c=>SS(c))),g(t,["request","contents"],a)}const r=f(e,["metadata"]);r!=null&&g(t,["metadata"],r);const o=f(e,["config"]);return o!=null&&g(t,["request","generationConfig"],AR(n,o,f(t,["request"],{}))),t}function PR(n){const e={},t=f(n,["response"]);t!=null&&g(e,["response"],SR(t));const s=f(n,["error"]);return s!=null&&g(e,["error"],s),e}function RR(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);if(e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),f(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function MR(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);e!==void 0&&i!=null&&g(e,["_query","pageToken"],i);const r=f(n,["filter"]);return e!==void 0&&r!=null&&g(e,["_query","filter"],r),t}function DR(n){const e={},t=f(n,["config"]);return t!=null&&RR(t,e),e}function LR(n){const e={},t=f(n,["config"]);return t!=null&&MR(t,e),e}function FR(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>om(o))),g(e,["batchJobs"],r)}return e}function jR(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>Ey(o))),g(e,["batchJobs"],r)}return e}function OR(n){const e={},t=f(n,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);const s=f(n,["codeExecutionResult"]);s!=null&&g(e,["codeExecutionResult"],s);const i=f(n,["executableCode"]);i!=null&&g(e,["executableCode"],i);const r=f(n,["fileData"]);r!=null&&g(e,["fileData"],vR(r));const o=f(n,["functionCall"]);o!=null&&g(e,["functionCall"],wR(o));const a=f(n,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);const c=f(n,["inlineData"]);c!=null&&g(e,["inlineData"],nR(c));const d=f(n,["text"]);d!=null&&g(e,["text"],d);const u=f(n,["thought"]);u!=null&&g(e,["thought"],u);const m=f(n,["thoughtSignature"]);m!=null&&g(e,["thoughtSignature"],m);const p=f(n,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function UR(n){const e={},t=f(n,["category"]);if(t!=null&&g(e,["category"],t),f(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=f(n,["threshold"]);return s!=null&&g(e,["threshold"],s),e}function BR(n){const e={},t=f(n,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],_R(t));const s=f(n,["retrievalConfig"]);return s!=null&&g(e,["retrievalConfig"],s),e}function HR(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(m=>m)),g(e,["functionDeclarations"],u)}if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(n,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);const i=f(n,["computerUse"]);i!=null&&g(e,["computerUse"],i);const r=f(n,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);const o=f(n,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=f(n,["googleMaps"]);a!=null&&g(e,["googleMaps"],kR(a));const c=f(n,["googleSearch"]);c!=null&&g(e,["googleSearch"],TR(c));const d=f(n,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var jr;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(jr||(jr={}));class ql{constructor(e,t,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,i)}init(e,t,s){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!s||Object.keys(s).length===0?o={config:{}}:typeof s=="object"?o=Object.assign({},s):o=s,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class GR extends Hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ql(jr.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=Jw(this.apiClient,e),s=t._url,i=Q("{model}:batchGenerateContent",s),a=t.batch.inputConfig.requests,c=a.requests,d=[];for(const u of c){const m=Object.assign({},u);if(m.systemInstruction){const p=m.systemInstruction;delete m.systemInstruction;const y=m.request;y.systemInstruction=p,m.request=y}d.push(m)}return a.requests=d,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const s=t?Object.assign({},t):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${i}`;else if(o)s.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=dR(this.apiClient,e);return a=Q("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>Ey(u))}else{const d=Jw(this.apiClient,e);return a=Q("{model}:batchGenerateContent",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>om(u))}}async createEmbeddingsInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=hR(this.apiClient,e);return r=Q("{model}:asyncBatchEmbedContent",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>om(c))}}async get(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=ER(this.apiClient,e);return a=Q("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>Ey(u))}else{const d=CR(this.apiClient,e);return a=Q("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>om(u))}}async cancel(e){var t,s,i,r;let o="",a={};if(this.apiClient.isVertexAI()){const c=rR(this.apiClient,e);o=Q("batchPredictionJobs/{name}:cancel",c._url),a=c._query,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const c=iR(this.apiClient,e);o=Q("batches/{name}:cancel",c._url),a=c._query,delete c._url,delete c._query,await this.apiClient.request({path:o,queryParams:a,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=LR(e);return a=Q("batchPredictionJobs",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=jR(u),p=new zw;return Object.assign(p,m),p})}else{const d=DR(e);return a=Q("batches",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=FR(u),p=new zw;return Object.assign(p,m),p})}}async delete(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=pR(this.apiClient,e);return a=Q("batchPredictionJobs/{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>gR(u))}else{const d=fR(this.apiClient,e);return a=Q("batches/{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>mR(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qR(n){const e={},t=f(n,["data"]);if(t!=null&&g(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function Xw(n){const e={},t=f(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>hM(r))),g(e,["parts"],i)}const s=f(n,["role"]);return s!=null&&g(e,["role"],s),e}function VR(n,e){const t={},s=f(n,["ttl"]);e!==void 0&&s!=null&&g(e,["ttl"],s);const i=f(n,["expireTime"]);e!==void 0&&i!=null&&g(e,["expireTime"],i);const r=f(n,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const o=f(n,["contents"]);if(e!==void 0&&o!=null){let u=wn(o);Array.isArray(u)&&(u=u.map(m=>Xw(m))),g(e,["contents"],u)}const a=f(n,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],Xw(is(a)));const c=f(n,["tools"]);if(e!==void 0&&c!=null){let u=c;Array.isArray(u)&&(u=u.map(m=>pM(m))),g(e,["tools"],u)}const d=f(n,["toolConfig"]);if(e!==void 0&&d!=null&&g(e,["toolConfig"],fM(d)),f(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function $R(n,e){const t={},s=f(n,["ttl"]);e!==void 0&&s!=null&&g(e,["ttl"],s);const i=f(n,["expireTime"]);e!==void 0&&i!=null&&g(e,["expireTime"],i);const r=f(n,["displayName"]);e!==void 0&&r!=null&&g(e,["displayName"],r);const o=f(n,["contents"]);if(e!==void 0&&o!=null){let m=wn(o);Array.isArray(m)&&(m=m.map(p=>p)),g(e,["contents"],m)}const a=f(n,["systemInstruction"]);e!==void 0&&a!=null&&g(e,["systemInstruction"],is(a));const c=f(n,["tools"]);if(e!==void 0&&c!=null){let m=c;Array.isArray(m)&&(m=m.map(p=>mM(p))),g(e,["tools"],m)}const d=f(n,["toolConfig"]);e!==void 0&&d!=null&&g(e,["toolConfig"],d);const u=f(n,["kmsKeyName"]);return e!==void 0&&u!=null&&g(e,["encryption_spec","kmsKeyName"],u),t}function zR(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["model"],hS(n,s));const i=f(e,["config"]);return i!=null&&VR(i,t),t}function WR(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["model"],hS(n,s));const i=f(e,["config"]);return i!=null&&$R(i,t),t}function KR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],Gr(n,s)),t}function YR(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],Gr(n,s)),t}function JR(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function XR(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function QR(n){const e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=f(n,["fileUri"]);t!=null&&g(e,["fileUri"],t);const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function ZR(n){const e={},t=f(n,["id"]);t!=null&&g(e,["id"],t);const s=f(n,["args"]);s!=null&&g(e,["args"],s);const i=f(n,["name"]);if(i!=null&&g(e,["name"],i),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eM(n){const e={},t=f(n,["mode"]);t!=null&&g(e,["mode"],t);const s=f(n,["allowedFunctionNames"]);if(s!=null&&g(e,["allowedFunctionNames"],s),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tM(n){const e={};if(f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=f(n,["description"]);t!=null&&g(e,["description"],t);const s=f(n,["name"]);s!=null&&g(e,["name"],s);const i=f(n,["parameters"]);i!=null&&g(e,["parameters"],i);const r=f(n,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);const o=f(n,["response"]);o!=null&&g(e,["response"],o);const a=f(n,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function sM(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],Gr(n,s)),t}function nM(n,e){const t={},s=f(e,["name"]);return s!=null&&g(t,["_url","name"],Gr(n,s)),t}function iM(n){const e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=f(n,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function rM(n){const e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=f(n,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function oM(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);return e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),t}function aM(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);return e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),t}function lM(n){const e={},t=f(n,["config"]);return t!=null&&oM(t,e),e}function cM(n){const e={},t=f(n,["config"]);return t!=null&&aM(t,e),e}function dM(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function uM(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["cachedContents"],r)}return e}function hM(n){const e={},t=f(n,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);const s=f(n,["codeExecutionResult"]);s!=null&&g(e,["codeExecutionResult"],s);const i=f(n,["executableCode"]);i!=null&&g(e,["executableCode"],i);const r=f(n,["fileData"]);r!=null&&g(e,["fileData"],QR(r));const o=f(n,["functionCall"]);o!=null&&g(e,["functionCall"],ZR(o));const a=f(n,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);const c=f(n,["inlineData"]);c!=null&&g(e,["inlineData"],qR(c));const d=f(n,["text"]);d!=null&&g(e,["text"],d);const u=f(n,["thought"]);u!=null&&g(e,["thought"],u);const m=f(n,["thoughtSignature"]);m!=null&&g(e,["thoughtSignature"],m);const p=f(n,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function fM(n){const e={},t=f(n,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],eM(t));const s=f(n,["retrievalConfig"]);return s!=null&&g(e,["retrievalConfig"],s),e}function pM(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(m=>m)),g(e,["functionDeclarations"],u)}if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(n,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);const i=f(n,["computerUse"]);i!=null&&g(e,["computerUse"],i);const r=f(n,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);const o=f(n,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=f(n,["googleMaps"]);a!=null&&g(e,["googleMaps"],iM(a));const c=f(n,["googleSearch"]);c!=null&&g(e,["googleSearch"],rM(c));const d=f(n,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function mM(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(p=>tM(p))),g(e,["functionDeclarations"],m)}const s=f(n,["retrieval"]);s!=null&&g(e,["retrieval"],s);const i=f(n,["googleSearchRetrieval"]);i!=null&&g(e,["googleSearchRetrieval"],i);const r=f(n,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=f(n,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);const a=f(n,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);const c=f(n,["googleMaps"]);c!=null&&g(e,["googleMaps"],c);const d=f(n,["googleSearch"]);d!=null&&g(e,["googleSearch"],d);const u=f(n,["urlContext"]);return u!=null&&g(e,["urlContext"],u),e}function gM(n,e){const t={},s=f(n,["ttl"]);e!==void 0&&s!=null&&g(e,["ttl"],s);const i=f(n,["expireTime"]);return e!==void 0&&i!=null&&g(e,["expireTime"],i),t}function yM(n,e){const t={},s=f(n,["ttl"]);e!==void 0&&s!=null&&g(e,["ttl"],s);const i=f(n,["expireTime"]);return e!==void 0&&i!=null&&g(e,["expireTime"],i),t}function xM(n,e){const t={},s=f(e,["name"]);s!=null&&g(t,["_url","name"],Gr(n,s));const i=f(e,["config"]);return i!=null&&gM(i,t),t}function bM(n,e){const t={},s=f(e,["name"]);s!=null&&g(t,["_url","name"],Gr(n,s));const i=f(e,["config"]);return i!=null&&yM(i,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class vM extends Hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ql(jr.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=WR(this.apiClient,e);return a=Q("cachedContents",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>u)}else{const d=zR(this.apiClient,e);return a=Q("cachedContents",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async get(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=nM(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>u)}else{const d=sM(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async delete(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=YR(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=XR(u),p=new Vw;return Object.assign(p,m),p})}else{const d=KR(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=JR(u),p=new Vw;return Object.assign(p,m),p})}}async update(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=bM(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>u)}else{const d=xM(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>u)}}async listInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=cM(e);return a=Q("cachedContents",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=uM(u),p=new $w;return Object.assign(p,m),p})}else{const d=lM(e);return a=Q("cachedContents",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=dM(u),p=new $w;return Object.assign(p,m),p})}}}function ng(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t}function Qw(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function he(n){return this instanceof he?(this.v=n,this):new he(n)}function Wn(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(y){return function(v){return Promise.resolve(v).then(y,m)}}function a(y,v){s[y]&&(i[y]=function(x){return new Promise(function(b,w){r.push([y,x,b,w])>1||c(y,x)})},v&&(i[y]=v(i[y])))}function c(y,v){try{d(s[y](v))}catch(x){p(r[0][3],x)}}function d(y){y.value instanceof he?Promise.resolve(y.value.v).then(u,m):p(r[0][2],y)}function u(y){c("next",y)}function m(y){c("throw",y)}function p(y,v){y(v),r.shift(),r.length&&c(r[0][0],r[0][1])}}function Kn(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Qw=="function"?Qw(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=n[r]&&function(o){return new Promise(function(a,c){o=n[r](o),i(a,c,o.done,o.value)})}}function i(r,o,a,c){Promise.resolve(c).then(function(d){r({value:d,done:a})},o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wM(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:CS(t)}function CS(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function _M(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Zw(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const i=[];let r=!0;for(;s<t&&n[s].role==="model";)i.push(n[s]),r&&!CS(n[s])&&(r=!1),s++;r?e.push(...i):e.pop()}return e}class AM{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new SM(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class SM{constructor(e,t,s,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),_M(r)}async sendMessage(e){var t;await this.sendPromise;const s=is(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,a;const c=await i,d=(o=(r=c.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,u=c.automaticFunctionCallingHistory,m=this.getHistory(!0).length;let p=[];u!=null&&(p=(a=u.slice(m))!==null&&a!==void 0?a:[]);const y=d?[d]:[];this.recordHistory(s,y,p)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const s=is(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,s)}getHistory(e=!1){const t=e?Zw(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Wn(this,arguments,function*(){var i,r,o,a,c,d;const u=[];try{for(var m=!0,p=Kn(e),y;y=yield he(p.next()),i=y.done,!i;m=!0){a=y.value,m=!1;const v=a;if(wM(v)){const x=(d=(c=v.candidates)===null||c===void 0?void 0:c[0])===null||d===void 0?void 0:d.content;x!==void 0&&u.push(x)}yield yield he(v)}}catch(v){r={error:v}}finally{try{!m&&!i&&(o=p.return)&&(yield he(o.call(p)))}finally{if(r)throw r.error}}this.recordHistory(t,u)})}recordHistory(e,t,s){let i=[];t.length>0&&t.every(r=>r.role!==void 0)?i=t:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...Zw(s)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Kg extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Kg.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function CM(n){const e={},t=f(n,["file"]);return t!=null&&g(e,["file"],t),e}function EM(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function kM(n){const e={},t=f(n,["name"]);return t!=null&&g(e,["_url","file"],xS(t)),e}function TM(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function NM(n){const e={},t=f(n,["name"]);return t!=null&&g(e,["_url","file"],xS(t)),e}function IM(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);return e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),t}function PM(n){const e={},t=f(n,["config"]);return t!=null&&IM(t,e),e}function RM(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["files"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class MM extends Hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ql(jr.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=PM(e);return r=Q("files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>{const d=RM(c),u=new jP;return Object.assign(u,d),u})}}async createInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=CM(e);return r=Q("upload/v1beta/files",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=EM(c),u=new OP;return Object.assign(u,d),u})}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=NM(e);return r=Q("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}async delete(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=kM(e);return r=Q("files/{file}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>{const d=TM(c),u=new UP;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function am(n){const e={},t=f(n,["data"]);if(t!=null&&g(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function DM(n){const e={},t=f(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>JM(r))),g(e,["parts"],i)}const s=f(n,["role"]);return s!=null&&g(e,["role"],s),e}function LM(n){const e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=f(n,["fileUri"]);t!=null&&g(e,["fileUri"],t);const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function FM(n){const e={},t=f(n,["id"]);t!=null&&g(e,["id"],t);const s=f(n,["args"]);s!=null&&g(e,["args"],s);const i=f(n,["name"]);if(i!=null&&g(e,["name"],i),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function jM(n){const e={};if(f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=f(n,["description"]);t!=null&&g(e,["description"],t);const s=f(n,["name"]);s!=null&&g(e,["name"],s);const i=f(n,["parameters"]);i!=null&&g(e,["parameters"],i);const r=f(n,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);const o=f(n,["response"]);o!=null&&g(e,["response"],o);const a=f(n,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function OM(n){const e={},t=f(n,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);const s=f(n,["responseJsonSchema"]);s!=null&&g(e,["responseJsonSchema"],s);const i=f(n,["audioTimestamp"]);i!=null&&g(e,["audioTimestamp"],i);const r=f(n,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);const o=f(n,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);const a=f(n,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);const c=f(n,["logprobs"]);c!=null&&g(e,["logprobs"],c);const d=f(n,["maxOutputTokens"]);d!=null&&g(e,["maxOutputTokens"],d);const u=f(n,["mediaResolution"]);u!=null&&g(e,["mediaResolution"],u);const m=f(n,["presencePenalty"]);m!=null&&g(e,["presencePenalty"],m);const p=f(n,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);const y=f(n,["responseMimeType"]);y!=null&&g(e,["responseMimeType"],y);const v=f(n,["responseModalities"]);v!=null&&g(e,["responseModalities"],v);const x=f(n,["responseSchema"]);x!=null&&g(e,["responseSchema"],x);const b=f(n,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);const w=f(n,["seed"]);w!=null&&g(e,["seed"],w);const S=f(n,["speechConfig"]);S!=null&&g(e,["speechConfig"],S);const A=f(n,["stopSequences"]);A!=null&&g(e,["stopSequences"],A);const k=f(n,["temperature"]);k!=null&&g(e,["temperature"],k);const T=f(n,["thinkingConfig"]);T!=null&&g(e,["thinkingConfig"],T);const N=f(n,["topK"]);N!=null&&g(e,["topK"],N);const I=f(n,["topP"]);if(I!=null&&g(e,["topP"],I),f(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function UM(n){const e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=f(n,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function BM(n){const e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=f(n,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function HM(n,e){const t={},s=f(n,["generationConfig"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig"],s);const i=f(n,["responseModalities"]);e!==void 0&&i!=null&&g(e,["setup","generationConfig","responseModalities"],i);const r=f(n,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);const o=f(n,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);const a=f(n,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);const c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","maxOutputTokens"],c);const d=f(n,["mediaResolution"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","mediaResolution"],d);const u=f(n,["seed"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","seed"],u);const m=f(n,["speechConfig"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","speechConfig"],Mb(m));const p=f(n,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);const y=f(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=f(n,["systemInstruction"]);e!==void 0&&v!=null&&g(e,["setup","systemInstruction"],DM(is(v)));const x=f(n,["tools"]);if(e!==void 0&&x!=null){let N=uu(x);Array.isArray(N)&&(N=N.map(I=>QM(du(I)))),g(e,["setup","tools"],N)}const b=f(n,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],XM(b));const w=f(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);const S=f(n,["outputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","outputAudioTranscription"],S);const A=f(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const k=f(n,["contextWindowCompression"]);e!==void 0&&k!=null&&g(e,["setup","contextWindowCompression"],k);const T=f(n,["proactivity"]);if(e!==void 0&&T!=null&&g(e,["setup","proactivity"],T),f(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function GM(n,e){const t={},s=f(n,["generationConfig"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig"],OM(s));const i=f(n,["responseModalities"]);e!==void 0&&i!=null&&g(e,["setup","generationConfig","responseModalities"],i);const r=f(n,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);const o=f(n,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);const a=f(n,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);const c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","maxOutputTokens"],c);const d=f(n,["mediaResolution"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","mediaResolution"],d);const u=f(n,["seed"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","seed"],u);const m=f(n,["speechConfig"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","speechConfig"],Mb(m));const p=f(n,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);const y=f(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=f(n,["systemInstruction"]);e!==void 0&&v!=null&&g(e,["setup","systemInstruction"],is(v));const x=f(n,["tools"]);if(e!==void 0&&x!=null){let I=uu(x);Array.isArray(I)&&(I=I.map(D=>ZM(du(D)))),g(e,["setup","tools"],I)}const b=f(n,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],b);const w=f(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);const S=f(n,["outputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","outputAudioTranscription"],S);const A=f(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const k=f(n,["contextWindowCompression"]);e!==void 0&&k!=null&&g(e,["setup","contextWindowCompression"],k);const T=f(n,["proactivity"]);e!==void 0&&T!=null&&g(e,["setup","proactivity"],T);const N=f(n,["explicitVadSignal"]);return e!==void 0&&N!=null&&g(e,["setup","explicitVadSignal"],N),t}function qM(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["setup","model"],Pe(n,s));const i=f(e,["config"]);return i!=null&&g(t,["config"],HM(i,t)),t}function VM(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["setup","model"],Pe(n,s));const i=f(e,["config"]);return i!=null&&g(t,["config"],GM(i,t)),t}function $M(n){const e={},t=f(n,["musicGenerationConfig"]);return t!=null&&g(e,["musicGenerationConfig"],t),e}function zM(n){const e={},t=f(n,["weightedPrompts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),g(e,["weightedPrompts"],s)}return e}function WM(n){const e={},t=f(n,["media"]);if(t!=null){let d=fS(t);Array.isArray(d)&&(d=d.map(u=>am(u))),g(e,["mediaChunks"],d)}const s=f(n,["audio"]);s!=null&&g(e,["audio"],am(mS(s)));const i=f(n,["audioStreamEnd"]);i!=null&&g(e,["audioStreamEnd"],i);const r=f(n,["video"]);r!=null&&g(e,["video"],am(pS(r)));const o=f(n,["text"]);o!=null&&g(e,["text"],o);const a=f(n,["activityStart"]);a!=null&&g(e,["activityStart"],a);const c=f(n,["activityEnd"]);return c!=null&&g(e,["activityEnd"],c),e}function KM(n){const e={},t=f(n,["media"]);if(t!=null){let d=fS(t);Array.isArray(d)&&(d=d.map(u=>u)),g(e,["mediaChunks"],d)}const s=f(n,["audio"]);s!=null&&g(e,["audio"],mS(s));const i=f(n,["audioStreamEnd"]);i!=null&&g(e,["audioStreamEnd"],i);const r=f(n,["video"]);r!=null&&g(e,["video"],pS(r));const o=f(n,["text"]);o!=null&&g(e,["text"],o);const a=f(n,["activityStart"]);a!=null&&g(e,["activityStart"],a);const c=f(n,["activityEnd"]);return c!=null&&g(e,["activityEnd"],c),e}function YM(n){const e={},t=f(n,["setupComplete"]);t!=null&&g(e,["setupComplete"],t);const s=f(n,["serverContent"]);s!=null&&g(e,["serverContent"],s);const i=f(n,["toolCall"]);i!=null&&g(e,["toolCall"],i);const r=f(n,["toolCallCancellation"]);r!=null&&g(e,["toolCallCancellation"],r);const o=f(n,["usageMetadata"]);o!=null&&g(e,["usageMetadata"],e2(o));const a=f(n,["goAway"]);a!=null&&g(e,["goAway"],a);const c=f(n,["sessionResumptionUpdate"]);c!=null&&g(e,["sessionResumptionUpdate"],c);const d=f(n,["voiceActivityDetectionSignal"]);return d!=null&&g(e,["voiceActivityDetectionSignal"],d),e}function JM(n){const e={},t=f(n,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);const s=f(n,["codeExecutionResult"]);s!=null&&g(e,["codeExecutionResult"],s);const i=f(n,["executableCode"]);i!=null&&g(e,["executableCode"],i);const r=f(n,["fileData"]);r!=null&&g(e,["fileData"],LM(r));const o=f(n,["functionCall"]);o!=null&&g(e,["functionCall"],FM(o));const a=f(n,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);const c=f(n,["inlineData"]);c!=null&&g(e,["inlineData"],am(c));const d=f(n,["text"]);d!=null&&g(e,["text"],d);const u=f(n,["thought"]);u!=null&&g(e,["thought"],u);const m=f(n,["thoughtSignature"]);m!=null&&g(e,["thoughtSignature"],m);const p=f(n,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function XM(n){const e={},t=f(n,["handle"]);if(t!=null&&g(e,["handle"],t),f(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function QM(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(m=>m)),g(e,["functionDeclarations"],u)}if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(n,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);const i=f(n,["computerUse"]);i!=null&&g(e,["computerUse"],i);const r=f(n,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);const o=f(n,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=f(n,["googleMaps"]);a!=null&&g(e,["googleMaps"],UM(a));const c=f(n,["googleSearch"]);c!=null&&g(e,["googleSearch"],BM(c));const d=f(n,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function ZM(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(p=>jM(p))),g(e,["functionDeclarations"],m)}const s=f(n,["retrieval"]);s!=null&&g(e,["retrieval"],s);const i=f(n,["googleSearchRetrieval"]);i!=null&&g(e,["googleSearchRetrieval"],i);const r=f(n,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=f(n,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);const a=f(n,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);const c=f(n,["googleMaps"]);c!=null&&g(e,["googleMaps"],c);const d=f(n,["googleSearch"]);d!=null&&g(e,["googleSearch"],d);const u=f(n,["urlContext"]);return u!=null&&g(e,["urlContext"],u),e}function e2(n){const e={},t=f(n,["promptTokenCount"]);t!=null&&g(e,["promptTokenCount"],t);const s=f(n,["cachedContentTokenCount"]);s!=null&&g(e,["cachedContentTokenCount"],s);const i=f(n,["candidatesTokenCount"]);i!=null&&g(e,["responseTokenCount"],i);const r=f(n,["toolUsePromptTokenCount"]);r!=null&&g(e,["toolUsePromptTokenCount"],r);const o=f(n,["thoughtsTokenCount"]);o!=null&&g(e,["thoughtsTokenCount"],o);const a=f(n,["totalTokenCount"]);a!=null&&g(e,["totalTokenCount"],a);const c=f(n,["promptTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(v=>v)),g(e,["promptTokensDetails"],y)}const d=f(n,["cacheTokensDetails"]);if(d!=null){let y=d;Array.isArray(y)&&(y=y.map(v=>v)),g(e,["cacheTokensDetails"],y)}const u=f(n,["candidatesTokensDetails"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(v=>v)),g(e,["responseTokensDetails"],y)}const m=f(n,["toolUsePromptTokensDetails"]);if(m!=null){let y=m;Array.isArray(y)&&(y=y.map(v=>v)),g(e,["toolUsePromptTokensDetails"],y)}const p=f(n,["trafficType"]);return p!=null&&g(e,["trafficType"],p),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function t2(n){const e={},t=f(n,["data"]);if(t!=null&&g(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function s2(n){const e={},t=f(n,["content"]);t!=null&&g(e,["content"],t);const s=f(n,["citationMetadata"]);s!=null&&g(e,["citationMetadata"],n2(s));const i=f(n,["tokenCount"]);i!=null&&g(e,["tokenCount"],i);const r=f(n,["finishReason"]);r!=null&&g(e,["finishReason"],r);const o=f(n,["avgLogprobs"]);o!=null&&g(e,["avgLogprobs"],o);const a=f(n,["groundingMetadata"]);a!=null&&g(e,["groundingMetadata"],a);const c=f(n,["index"]);c!=null&&g(e,["index"],c);const d=f(n,["logprobsResult"]);d!=null&&g(e,["logprobsResult"],d);const u=f(n,["safetyRatings"]);if(u!=null){let p=u;Array.isArray(p)&&(p=p.map(y=>y)),g(e,["safetyRatings"],p)}const m=f(n,["urlContextMetadata"]);return m!=null&&g(e,["urlContextMetadata"],m),e}function n2(n){const e={},t=f(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),g(e,["citations"],s)}return e}function i2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let r=wn(i);Array.isArray(r)&&(r=r.map(o=>o)),g(t,["contents"],r)}return t}function r2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),g(e,["tokensInfo"],i)}return e}function o2(n){const e={},t=f(n,["values"]);t!=null&&g(e,["values"],t);const s=f(n,["statistics"]);return s!=null&&g(e,["statistics"],a2(s)),e}function a2(n){const e={},t=f(n,["truncated"]);t!=null&&g(e,["truncated"],t);const s=f(n,["token_count"]);return s!=null&&g(e,["tokenCount"],s),e}function Yg(n){const e={},t=f(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>gD(r))),g(e,["parts"],i)}const s=f(n,["role"]);return s!=null&&g(e,["role"],s),e}function l2(n){const e={},t=f(n,["controlType"]);t!=null&&g(e,["controlType"],t);const s=f(n,["enableControlImageComputation"]);return s!=null&&g(e,["computeControl"],s),e}function c2(n){const e={};if(f(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(f(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(f(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function d2(n,e){const t={},s=f(n,["systemInstruction"]);e!==void 0&&s!=null&&g(e,["systemInstruction"],is(s));const i=f(n,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(a=>NS(a))),g(e,["tools"],o)}const r=f(n,["generationConfig"]);return e!==void 0&&r!=null&&g(e,["generationConfig"],tD(r)),t}function u2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let o=wn(i);Array.isArray(o)&&(o=o.map(a=>Yg(a))),g(t,["contents"],o)}const r=f(e,["config"]);return r!=null&&c2(r),t}function h2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let o=wn(i);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}const r=f(e,["config"]);return r!=null&&d2(r,t),t}function f2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["totalTokens"]);s!=null&&g(e,["totalTokens"],s);const i=f(n,["cachedContentTokenCount"]);return i!=null&&g(e,["cachedContentTokenCount"],i),e}function p2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["totalTokens"]);return s!=null&&g(e,["totalTokens"],s),e}function m2(n,e){const t={},s=f(e,["model"]);return s!=null&&g(t,["_url","name"],Pe(n,s)),t}function g2(n,e){const t={},s=f(e,["model"]);return s!=null&&g(t,["_url","name"],Pe(n,s)),t}function y2(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function x2(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}function b2(n,e){const t={},s=f(n,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);const i=f(n,["negativePrompt"]);e!==void 0&&i!=null&&g(e,["parameters","negativePrompt"],i);const r=f(n,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const o=f(n,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);const a=f(n,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);const c=f(n,["seed"]);e!==void 0&&c!=null&&g(e,["parameters","seed"],c);const d=f(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&g(e,["parameters","safetySetting"],d);const u=f(n,["personGeneration"]);e!==void 0&&u!=null&&g(e,["parameters","personGeneration"],u);const m=f(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&g(e,["parameters","includeSafetyAttributes"],m);const p=f(n,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);const y=f(n,["language"]);e!==void 0&&y!=null&&g(e,["parameters","language"],y);const v=f(n,["outputMimeType"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","mimeType"],v);const x=f(n,["outputCompressionQuality"]);e!==void 0&&x!=null&&g(e,["parameters","outputOptions","compressionQuality"],x);const b=f(n,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);const w=f(n,["labels"]);e!==void 0&&w!=null&&g(e,["labels"],w);const S=f(n,["editMode"]);e!==void 0&&S!=null&&g(e,["parameters","editMode"],S);const A=f(n,["baseSteps"]);return e!==void 0&&A!=null&&g(e,["parameters","editConfig","baseSteps"],A),t}function v2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["prompt"]);i!=null&&g(t,["instances[0]","prompt"],i);const r=f(e,["referenceImages"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(c=>_D(c))),g(t,["instances[0]","referenceImages"],a)}const o=f(e,["config"]);return o!=null&&b2(o,t),t}function w2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>Jg(r))),g(e,["generatedImages"],i)}return e}function _2(n,e){const t={},s=f(n,["taskType"]);e!==void 0&&s!=null&&g(e,["requests[]","taskType"],s);const i=f(n,["title"]);e!==void 0&&i!=null&&g(e,["requests[]","title"],i);const r=f(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&g(e,["requests[]","outputDimensionality"],r),f(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(f(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function A2(n,e){const t={},s=f(n,["taskType"]);e!==void 0&&s!=null&&g(e,["instances[]","task_type"],s);const i=f(n,["title"]);e!==void 0&&i!=null&&g(e,["instances[]","title"],i);const r=f(n,["outputDimensionality"]);e!==void 0&&r!=null&&g(e,["parameters","outputDimensionality"],r);const o=f(n,["mimeType"]);e!==void 0&&o!=null&&g(e,["instances[]","mimeType"],o);const a=f(n,["autoTruncate"]);return e!==void 0&&a!=null&&g(e,["parameters","autoTruncate"],a),t}function S2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let a=Ib(n,i);Array.isArray(a)&&(a=a.map(c=>c)),g(t,["requests[]","content"],a)}const r=f(e,["config"]);r!=null&&_2(r,t);const o=f(e,["model"]);return o!==void 0&&g(t,["requests[]","model"],Pe(n,o)),t}function C2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let o=Ib(n,i);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["instances[]","content"],o)}const r=f(e,["config"]);return r!=null&&A2(r,t),t}function E2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["embeddings"],r)}const i=f(n,["metadata"]);return i!=null&&g(e,["metadata"],i),e}function k2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o2(o))),g(e,["embeddings"],r)}const i=f(n,["metadata"]);return i!=null&&g(e,["metadata"],i),e}function T2(n){const e={},t=f(n,["endpoint"]);t!=null&&g(e,["name"],t);const s=f(n,["deployedModelId"]);return s!=null&&g(e,["deployedModelId"],s),e}function N2(n){const e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=f(n,["fileUri"]);t!=null&&g(e,["fileUri"],t);const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function I2(n){const e={},t=f(n,["id"]);t!=null&&g(e,["id"],t);const s=f(n,["args"]);s!=null&&g(e,["args"],s);const i=f(n,["name"]);if(i!=null&&g(e,["name"],i),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function P2(n){const e={},t=f(n,["mode"]);t!=null&&g(e,["mode"],t);const s=f(n,["allowedFunctionNames"]);if(s!=null&&g(e,["allowedFunctionNames"],s),f(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function R2(n){const e={};if(f(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=f(n,["description"]);t!=null&&g(e,["description"],t);const s=f(n,["name"]);s!=null&&g(e,["name"],s);const i=f(n,["parameters"]);i!=null&&g(e,["parameters"],i);const r=f(n,["parametersJsonSchema"]);r!=null&&g(e,["parametersJsonSchema"],r);const o=f(n,["response"]);o!=null&&g(e,["response"],o);const a=f(n,["responseJsonSchema"]);return a!=null&&g(e,["responseJsonSchema"],a),e}function M2(n,e,t){const s={},i=f(e,["systemInstruction"]);t!==void 0&&i!=null&&g(t,["systemInstruction"],Yg(is(i)));const r=f(e,["temperature"]);r!=null&&g(s,["temperature"],r);const o=f(e,["topP"]);o!=null&&g(s,["topP"],o);const a=f(e,["topK"]);a!=null&&g(s,["topK"],a);const c=f(e,["candidateCount"]);c!=null&&g(s,["candidateCount"],c);const d=f(e,["maxOutputTokens"]);d!=null&&g(s,["maxOutputTokens"],d);const u=f(e,["stopSequences"]);u!=null&&g(s,["stopSequences"],u);const m=f(e,["responseLogprobs"]);m!=null&&g(s,["responseLogprobs"],m);const p=f(e,["logprobs"]);p!=null&&g(s,["logprobs"],p);const y=f(e,["presencePenalty"]);y!=null&&g(s,["presencePenalty"],y);const v=f(e,["frequencyPenalty"]);v!=null&&g(s,["frequencyPenalty"],v);const x=f(e,["seed"]);x!=null&&g(s,["seed"],x);const b=f(e,["responseMimeType"]);b!=null&&g(s,["responseMimeType"],b);const w=f(e,["responseSchema"]);w!=null&&g(s,["responseSchema"],Pb(w));const S=f(e,["responseJsonSchema"]);if(S!=null&&g(s,["responseJsonSchema"],S),f(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(f(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const A=f(e,["safetySettings"]);if(t!==void 0&&A!=null){let B=A;Array.isArray(B)&&(B=B.map(V=>AD(V))),g(t,["safetySettings"],B)}const k=f(e,["tools"]);if(t!==void 0&&k!=null){let B=uu(k);Array.isArray(B)&&(B=B.map(V=>ID(du(V)))),g(t,["tools"],B)}const T=f(e,["toolConfig"]);if(t!==void 0&&T!=null&&g(t,["toolConfig"],ND(T)),f(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const N=f(e,["cachedContent"]);t!==void 0&&N!=null&&g(t,["cachedContent"],Gr(n,N));const I=f(e,["responseModalities"]);I!=null&&g(s,["responseModalities"],I);const D=f(e,["mediaResolution"]);D!=null&&g(s,["mediaResolution"],D);const P=f(e,["speechConfig"]);if(P!=null&&g(s,["speechConfig"],Rb(P)),f(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const R=f(e,["thinkingConfig"]);R!=null&&g(s,["thinkingConfig"],R);const j=f(e,["imageConfig"]);j!=null&&g(s,["imageConfig"],oD(j));const $=f(e,["enableEnhancedCivicAnswers"]);return $!=null&&g(s,["enableEnhancedCivicAnswers"],$),s}function D2(n,e,t){const s={},i=f(e,["systemInstruction"]);t!==void 0&&i!=null&&g(t,["systemInstruction"],is(i));const r=f(e,["temperature"]);r!=null&&g(s,["temperature"],r);const o=f(e,["topP"]);o!=null&&g(s,["topP"],o);const a=f(e,["topK"]);a!=null&&g(s,["topK"],a);const c=f(e,["candidateCount"]);c!=null&&g(s,["candidateCount"],c);const d=f(e,["maxOutputTokens"]);d!=null&&g(s,["maxOutputTokens"],d);const u=f(e,["stopSequences"]);u!=null&&g(s,["stopSequences"],u);const m=f(e,["responseLogprobs"]);m!=null&&g(s,["responseLogprobs"],m);const p=f(e,["logprobs"]);p!=null&&g(s,["logprobs"],p);const y=f(e,["presencePenalty"]);y!=null&&g(s,["presencePenalty"],y);const v=f(e,["frequencyPenalty"]);v!=null&&g(s,["frequencyPenalty"],v);const x=f(e,["seed"]);x!=null&&g(s,["seed"],x);const b=f(e,["responseMimeType"]);b!=null&&g(s,["responseMimeType"],b);const w=f(e,["responseSchema"]);w!=null&&g(s,["responseSchema"],Pb(w));const S=f(e,["responseJsonSchema"]);S!=null&&g(s,["responseJsonSchema"],S);const A=f(e,["routingConfig"]);A!=null&&g(s,["routingConfig"],A);const k=f(e,["modelSelectionConfig"]);k!=null&&g(s,["modelConfig"],k);const T=f(e,["safetySettings"]);if(t!==void 0&&T!=null){let U=T;Array.isArray(U)&&(U=U.map(H=>H)),g(t,["safetySettings"],U)}const N=f(e,["tools"]);if(t!==void 0&&N!=null){let U=uu(N);Array.isArray(U)&&(U=U.map(H=>NS(du(H)))),g(t,["tools"],U)}const I=f(e,["toolConfig"]);t!==void 0&&I!=null&&g(t,["toolConfig"],I);const D=f(e,["labels"]);t!==void 0&&D!=null&&g(t,["labels"],D);const P=f(e,["cachedContent"]);t!==void 0&&P!=null&&g(t,["cachedContent"],Gr(n,P));const R=f(e,["responseModalities"]);R!=null&&g(s,["responseModalities"],R);const j=f(e,["mediaResolution"]);j!=null&&g(s,["mediaResolution"],j);const $=f(e,["speechConfig"]);$!=null&&g(s,["speechConfig"],Rb($));const B=f(e,["audioTimestamp"]);B!=null&&g(s,["audioTimestamp"],B);const V=f(e,["thinkingConfig"]);V!=null&&g(s,["thinkingConfig"],V);const L=f(e,["imageConfig"]);if(L!=null&&g(s,["imageConfig"],aD(L)),f(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function e_(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let o=wn(i);Array.isArray(o)&&(o=o.map(a=>Yg(a))),g(t,["contents"],o)}const r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],M2(n,r,t)),t}function t_(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["contents"]);if(i!=null){let o=wn(i);Array.isArray(o)&&(o=o.map(a=>a)),g(t,["contents"],o)}const r=f(e,["config"]);return r!=null&&g(t,["generationConfig"],D2(n,r,t)),t}function s_(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["candidates"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(d=>s2(d))),g(e,["candidates"],c)}const i=f(n,["modelVersion"]);i!=null&&g(e,["modelVersion"],i);const r=f(n,["promptFeedback"]);r!=null&&g(e,["promptFeedback"],r);const o=f(n,["responseId"]);o!=null&&g(e,["responseId"],o);const a=f(n,["usageMetadata"]);return a!=null&&g(e,["usageMetadata"],a),e}function n_(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(u=>u)),g(e,["candidates"],d)}const i=f(n,["createTime"]);i!=null&&g(e,["createTime"],i);const r=f(n,["modelVersion"]);r!=null&&g(e,["modelVersion"],r);const o=f(n,["promptFeedback"]);o!=null&&g(e,["promptFeedback"],o);const a=f(n,["responseId"]);a!=null&&g(e,["responseId"],a);const c=f(n,["usageMetadata"]);return c!=null&&g(e,["usageMetadata"],c),e}function L2(n,e){const t={};if(f(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=f(n,["numberOfImages"]);e!==void 0&&s!=null&&g(e,["parameters","sampleCount"],s);const i=f(n,["aspectRatio"]);e!==void 0&&i!=null&&g(e,["parameters","aspectRatio"],i);const r=f(n,["guidanceScale"]);if(e!==void 0&&r!=null&&g(e,["parameters","guidanceScale"],r),f(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=f(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&g(e,["parameters","safetySetting"],o);const a=f(n,["personGeneration"]);e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a);const c=f(n,["includeSafetyAttributes"]);e!==void 0&&c!=null&&g(e,["parameters","includeSafetyAttributes"],c);const d=f(n,["includeRaiReason"]);e!==void 0&&d!=null&&g(e,["parameters","includeRaiReason"],d);const u=f(n,["language"]);e!==void 0&&u!=null&&g(e,["parameters","language"],u);const m=f(n,["outputMimeType"]);e!==void 0&&m!=null&&g(e,["parameters","outputOptions","mimeType"],m);const p=f(n,["outputCompressionQuality"]);if(e!==void 0&&p!=null&&g(e,["parameters","outputOptions","compressionQuality"],p),f(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(f(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const y=f(n,["imageSize"]);if(e!==void 0&&y!=null&&g(e,["parameters","sampleImageSize"],y),f(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function F2(n,e){const t={},s=f(n,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);const i=f(n,["negativePrompt"]);e!==void 0&&i!=null&&g(e,["parameters","negativePrompt"],i);const r=f(n,["numberOfImages"]);e!==void 0&&r!=null&&g(e,["parameters","sampleCount"],r);const o=f(n,["aspectRatio"]);e!==void 0&&o!=null&&g(e,["parameters","aspectRatio"],o);const a=f(n,["guidanceScale"]);e!==void 0&&a!=null&&g(e,["parameters","guidanceScale"],a);const c=f(n,["seed"]);e!==void 0&&c!=null&&g(e,["parameters","seed"],c);const d=f(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&g(e,["parameters","safetySetting"],d);const u=f(n,["personGeneration"]);e!==void 0&&u!=null&&g(e,["parameters","personGeneration"],u);const m=f(n,["includeSafetyAttributes"]);e!==void 0&&m!=null&&g(e,["parameters","includeSafetyAttributes"],m);const p=f(n,["includeRaiReason"]);e!==void 0&&p!=null&&g(e,["parameters","includeRaiReason"],p);const y=f(n,["language"]);e!==void 0&&y!=null&&g(e,["parameters","language"],y);const v=f(n,["outputMimeType"]);e!==void 0&&v!=null&&g(e,["parameters","outputOptions","mimeType"],v);const x=f(n,["outputCompressionQuality"]);e!==void 0&&x!=null&&g(e,["parameters","outputOptions","compressionQuality"],x);const b=f(n,["addWatermark"]);e!==void 0&&b!=null&&g(e,["parameters","addWatermark"],b);const w=f(n,["labels"]);e!==void 0&&w!=null&&g(e,["labels"],w);const S=f(n,["imageSize"]);e!==void 0&&S!=null&&g(e,["parameters","sampleImageSize"],S);const A=f(n,["enhancePrompt"]);return e!==void 0&&A!=null&&g(e,["parameters","enhancePrompt"],A),t}function j2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["prompt"]);i!=null&&g(t,["instances[0]","prompt"],i);const r=f(e,["config"]);return r!=null&&L2(r,t),t}function O2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["prompt"]);i!=null&&g(t,["instances[0]","prompt"],i);const r=f(e,["config"]);return r!=null&&F2(r,t),t}function U2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>X2(o))),g(e,["generatedImages"],r)}const i=f(n,["positivePromptSafetyAttributes"]);return i!=null&&g(e,["positivePromptSafetyAttributes"],kS(i)),e}function B2(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>Jg(o))),g(e,["generatedImages"],r)}const i=f(n,["positivePromptSafetyAttributes"]);return i!=null&&g(e,["positivePromptSafetyAttributes"],TS(i)),e}function H2(n,e){const t={},s=f(n,["numberOfVideos"]);if(e!==void 0&&s!=null&&g(e,["parameters","sampleCount"],s),f(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(f(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=f(n,["durationSeconds"]);if(e!==void 0&&i!=null&&g(e,["parameters","durationSeconds"],i),f(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=f(n,["aspectRatio"]);e!==void 0&&r!=null&&g(e,["parameters","aspectRatio"],r);const o=f(n,["resolution"]);e!==void 0&&o!=null&&g(e,["parameters","resolution"],o);const a=f(n,["personGeneration"]);if(e!==void 0&&a!=null&&g(e,["parameters","personGeneration"],a),f(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=f(n,["negativePrompt"]);e!==void 0&&c!=null&&g(e,["parameters","negativePrompt"],c);const d=f(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&g(e,["parameters","enhancePrompt"],d),f(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const u=f(n,["lastFrame"]);e!==void 0&&u!=null&&g(e,["instances[0]","lastFrame"],Xg(u));const m=f(n,["referenceImages"]);if(e!==void 0&&m!=null){let p=m;Array.isArray(p)&&(p=p.map(y=>qD(y))),g(e,["instances[0]","referenceImages"],p)}if(f(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(f(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function G2(n,e){const t={},s=f(n,["numberOfVideos"]);e!==void 0&&s!=null&&g(e,["parameters","sampleCount"],s);const i=f(n,["outputGcsUri"]);e!==void 0&&i!=null&&g(e,["parameters","storageUri"],i);const r=f(n,["fps"]);e!==void 0&&r!=null&&g(e,["parameters","fps"],r);const o=f(n,["durationSeconds"]);e!==void 0&&o!=null&&g(e,["parameters","durationSeconds"],o);const a=f(n,["seed"]);e!==void 0&&a!=null&&g(e,["parameters","seed"],a);const c=f(n,["aspectRatio"]);e!==void 0&&c!=null&&g(e,["parameters","aspectRatio"],c);const d=f(n,["resolution"]);e!==void 0&&d!=null&&g(e,["parameters","resolution"],d);const u=f(n,["personGeneration"]);e!==void 0&&u!=null&&g(e,["parameters","personGeneration"],u);const m=f(n,["pubsubTopic"]);e!==void 0&&m!=null&&g(e,["parameters","pubsubTopic"],m);const p=f(n,["negativePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","negativePrompt"],p);const y=f(n,["enhancePrompt"]);e!==void 0&&y!=null&&g(e,["parameters","enhancePrompt"],y);const v=f(n,["generateAudio"]);e!==void 0&&v!=null&&g(e,["parameters","generateAudio"],v);const x=f(n,["lastFrame"]);e!==void 0&&x!=null&&g(e,["instances[0]","lastFrame"],Jn(x));const b=f(n,["referenceImages"]);if(e!==void 0&&b!=null){let A=b;Array.isArray(A)&&(A=A.map(k=>VD(k))),g(e,["instances[0]","referenceImages"],A)}const w=f(n,["mask"]);e!==void 0&&w!=null&&g(e,["instances[0]","mask"],GD(w));const S=f(n,["compressionQuality"]);return e!==void 0&&S!=null&&g(e,["parameters","compressionQuality"],S),t}function q2(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response","generateVideoResponse"]);return o!=null&&g(e,["response"],W2(o)),e}function V2(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response"]);return o!=null&&g(e,["response"],K2(o)),e}function $2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["prompt"]);i!=null&&g(t,["instances[0]","prompt"],i);const r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Xg(r));const o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],IS(o));const a=f(e,["source"]);a!=null&&Y2(a,t);const c=f(e,["config"]);return c!=null&&H2(c,t),t}function z2(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["prompt"]);i!=null&&g(t,["instances[0]","prompt"],i);const r=f(e,["image"]);r!=null&&g(t,["instances[0]","image"],Jn(r));const o=f(e,["video"]);o!=null&&g(t,["instances[0]","video"],PS(o));const a=f(e,["source"]);a!=null&&J2(a,t);const c=f(e,["config"]);return c!=null&&G2(c,t),t}function W2(n){const e={},t=f(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Z2(o))),g(e,["generatedVideos"],r)}const s=f(n,["raiMediaFilteredCount"]);s!=null&&g(e,["raiMediaFilteredCount"],s);const i=f(n,["raiMediaFilteredReasons"]);return i!=null&&g(e,["raiMediaFilteredReasons"],i),e}function K2(n){const e={},t=f(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>eD(o))),g(e,["generatedVideos"],r)}const s=f(n,["raiMediaFilteredCount"]);s!=null&&g(e,["raiMediaFilteredCount"],s);const i=f(n,["raiMediaFilteredReasons"]);return i!=null&&g(e,["raiMediaFilteredReasons"],i),e}function Y2(n,e){const t={},s=f(n,["prompt"]);e!==void 0&&s!=null&&g(e,["instances[0]","prompt"],s);const i=f(n,["image"]);e!==void 0&&i!=null&&g(e,["instances[0]","image"],Xg(i));const r=f(n,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],IS(r)),t}function J2(n,e){const t={},s=f(n,["prompt"]);e!==void 0&&s!=null&&g(e,["instances[0]","prompt"],s);const i=f(n,["image"]);e!==void 0&&i!=null&&g(e,["instances[0]","image"],Jn(i));const r=f(n,["video"]);return e!==void 0&&r!=null&&g(e,["instances[0]","video"],PS(r)),t}function X2(n){const e={},t=f(n,["_self"]);t!=null&&g(e,["image"],lD(t));const s=f(n,["raiFilteredReason"]);s!=null&&g(e,["raiFilteredReason"],s);const i=f(n,["_self"]);return i!=null&&g(e,["safetyAttributes"],kS(i)),e}function Jg(n){const e={},t=f(n,["_self"]);t!=null&&g(e,["image"],ES(t));const s=f(n,["raiFilteredReason"]);s!=null&&g(e,["raiFilteredReason"],s);const i=f(n,["_self"]);i!=null&&g(e,["safetyAttributes"],TS(i));const r=f(n,["prompt"]);return r!=null&&g(e,["enhancedPrompt"],r),e}function Q2(n){const e={},t=f(n,["_self"]);t!=null&&g(e,["mask"],ES(t));const s=f(n,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),g(e,["labels"],i)}return e}function Z2(n){const e={},t=f(n,["video"]);return t!=null&&g(e,["video"],BD(t)),e}function eD(n){const e={},t=f(n,["_self"]);return t!=null&&g(e,["video"],HD(t)),e}function tD(n){const e={},t=f(n,["modelSelectionConfig"]);t!=null&&g(e,["modelConfig"],t);const s=f(n,["responseJsonSchema"]);s!=null&&g(e,["responseJsonSchema"],s);const i=f(n,["audioTimestamp"]);i!=null&&g(e,["audioTimestamp"],i);const r=f(n,["candidateCount"]);r!=null&&g(e,["candidateCount"],r);const o=f(n,["enableAffectiveDialog"]);o!=null&&g(e,["enableAffectiveDialog"],o);const a=f(n,["frequencyPenalty"]);a!=null&&g(e,["frequencyPenalty"],a);const c=f(n,["logprobs"]);c!=null&&g(e,["logprobs"],c);const d=f(n,["maxOutputTokens"]);d!=null&&g(e,["maxOutputTokens"],d);const u=f(n,["mediaResolution"]);u!=null&&g(e,["mediaResolution"],u);const m=f(n,["presencePenalty"]);m!=null&&g(e,["presencePenalty"],m);const p=f(n,["responseLogprobs"]);p!=null&&g(e,["responseLogprobs"],p);const y=f(n,["responseMimeType"]);y!=null&&g(e,["responseMimeType"],y);const v=f(n,["responseModalities"]);v!=null&&g(e,["responseModalities"],v);const x=f(n,["responseSchema"]);x!=null&&g(e,["responseSchema"],x);const b=f(n,["routingConfig"]);b!=null&&g(e,["routingConfig"],b);const w=f(n,["seed"]);w!=null&&g(e,["seed"],w);const S=f(n,["speechConfig"]);S!=null&&g(e,["speechConfig"],S);const A=f(n,["stopSequences"]);A!=null&&g(e,["stopSequences"],A);const k=f(n,["temperature"]);k!=null&&g(e,["temperature"],k);const T=f(n,["thinkingConfig"]);T!=null&&g(e,["thinkingConfig"],T);const N=f(n,["topK"]);N!=null&&g(e,["topK"],N);const I=f(n,["topP"]);if(I!=null&&g(e,["topP"],I),f(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function sD(n,e){const t={},s=f(e,["model"]);return s!=null&&g(t,["_url","name"],Pe(n,s)),t}function nD(n,e){const t={},s=f(e,["model"]);return s!=null&&g(t,["_url","name"],Pe(n,s)),t}function iD(n){const e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=f(n,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function rD(n){const e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=f(n,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function oD(n){const e={},t=f(n,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);const s=f(n,["imageSize"]);if(s!=null&&g(e,["imageSize"],s),f(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(f(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function aD(n){const e={},t=f(n,["aspectRatio"]);t!=null&&g(e,["aspectRatio"],t);const s=f(n,["imageSize"]);s!=null&&g(e,["imageSize"],s);const i=f(n,["outputMimeType"]);i!=null&&g(e,["imageOutputOptions","mimeType"],i);const r=f(n,["outputCompressionQuality"]);return r!=null&&g(e,["imageOutputOptions","compressionQuality"],r),e}function lD(n){const e={},t=f(n,["bytesBase64Encoded"]);t!=null&&g(e,["imageBytes"],sa(t));const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function ES(n){const e={},t=f(n,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);const s=f(n,["bytesBase64Encoded"]);s!=null&&g(e,["imageBytes"],sa(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["mimeType"],i),e}function Xg(n){const e={};if(f(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=f(n,["imageBytes"]);t!=null&&g(e,["bytesBase64Encoded"],sa(t));const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function Jn(n){const e={},t=f(n,["gcsUri"]);t!=null&&g(e,["gcsUri"],t);const s=f(n,["imageBytes"]);s!=null&&g(e,["bytesBase64Encoded"],sa(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["mimeType"],i),e}function cD(n,e,t){const s={},i=f(e,["pageSize"]);t!==void 0&&i!=null&&g(t,["_query","pageSize"],i);const r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);const o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);const a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],bS(n,a)),s}function dD(n,e,t){const s={},i=f(e,["pageSize"]);t!==void 0&&i!=null&&g(t,["_query","pageSize"],i);const r=f(e,["pageToken"]);t!==void 0&&r!=null&&g(t,["_query","pageToken"],r);const o=f(e,["filter"]);t!==void 0&&o!=null&&g(t,["_query","filter"],o);const a=f(e,["queryBase"]);return t!==void 0&&a!=null&&g(t,["_url","models_url"],bS(n,a)),s}function uD(n,e){const t={},s=f(e,["config"]);return s!=null&&cD(n,s,t),t}function hD(n,e){const t={},s=f(e,["config"]);return s!=null&&dD(n,s,t),t}function fD(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["_self"]);if(i!=null){let r=vS(i);Array.isArray(r)&&(r=r.map(o=>ky(o))),g(e,["models"],r)}return e}function pD(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["_self"]);if(i!=null){let r=vS(i);Array.isArray(r)&&(r=r.map(o=>Ty(o))),g(e,["models"],r)}return e}function mD(n){const e={},t=f(n,["maskMode"]);t!=null&&g(e,["maskMode"],t);const s=f(n,["segmentationClasses"]);s!=null&&g(e,["maskClasses"],s);const i=f(n,["maskDilation"]);return i!=null&&g(e,["dilation"],i),e}function ky(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["displayName"]);s!=null&&g(e,["displayName"],s);const i=f(n,["description"]);i!=null&&g(e,["description"],i);const r=f(n,["version"]);r!=null&&g(e,["version"],r);const o=f(n,["_self"]);o!=null&&g(e,["tunedModelInfo"],PD(o));const a=f(n,["inputTokenLimit"]);a!=null&&g(e,["inputTokenLimit"],a);const c=f(n,["outputTokenLimit"]);c!=null&&g(e,["outputTokenLimit"],c);const d=f(n,["supportedGenerationMethods"]);d!=null&&g(e,["supportedActions"],d);const u=f(n,["temperature"]);u!=null&&g(e,["temperature"],u);const m=f(n,["maxTemperature"]);m!=null&&g(e,["maxTemperature"],m);const p=f(n,["topP"]);p!=null&&g(e,["topP"],p);const y=f(n,["topK"]);y!=null&&g(e,["topK"],y);const v=f(n,["thinking"]);return v!=null&&g(e,["thinking"],v),e}function Ty(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["displayName"]);s!=null&&g(e,["displayName"],s);const i=f(n,["description"]);i!=null&&g(e,["description"],i);const r=f(n,["versionId"]);r!=null&&g(e,["version"],r);const o=f(n,["deployedModels"]);if(o!=null){let m=o;Array.isArray(m)&&(m=m.map(p=>T2(p))),g(e,["endpoints"],m)}const a=f(n,["labels"]);a!=null&&g(e,["labels"],a);const c=f(n,["_self"]);c!=null&&g(e,["tunedModelInfo"],RD(c));const d=f(n,["defaultCheckpointId"]);d!=null&&g(e,["defaultCheckpointId"],d);const u=f(n,["checkpoints"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(p=>p)),g(e,["checkpoints"],m)}return e}function gD(n){const e={},t=f(n,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);const s=f(n,["codeExecutionResult"]);s!=null&&g(e,["codeExecutionResult"],s);const i=f(n,["executableCode"]);i!=null&&g(e,["executableCode"],i);const r=f(n,["fileData"]);r!=null&&g(e,["fileData"],N2(r));const o=f(n,["functionCall"]);o!=null&&g(e,["functionCall"],I2(o));const a=f(n,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);const c=f(n,["inlineData"]);c!=null&&g(e,["inlineData"],t2(c));const d=f(n,["text"]);d!=null&&g(e,["text"],d);const u=f(n,["thought"]);u!=null&&g(e,["thought"],u);const m=f(n,["thoughtSignature"]);m!=null&&g(e,["thoughtSignature"],m);const p=f(n,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function yD(n){const e={},t=f(n,["productImage"]);return t!=null&&g(e,["image"],Jn(t)),e}function xD(n,e){const t={},s=f(n,["numberOfImages"]);e!==void 0&&s!=null&&g(e,["parameters","sampleCount"],s);const i=f(n,["baseSteps"]);e!==void 0&&i!=null&&g(e,["parameters","baseSteps"],i);const r=f(n,["outputGcsUri"]);e!==void 0&&r!=null&&g(e,["parameters","storageUri"],r);const o=f(n,["seed"]);e!==void 0&&o!=null&&g(e,["parameters","seed"],o);const a=f(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&g(e,["parameters","safetySetting"],a);const c=f(n,["personGeneration"]);e!==void 0&&c!=null&&g(e,["parameters","personGeneration"],c);const d=f(n,["addWatermark"]);e!==void 0&&d!=null&&g(e,["parameters","addWatermark"],d);const u=f(n,["outputMimeType"]);e!==void 0&&u!=null&&g(e,["parameters","outputOptions","mimeType"],u);const m=f(n,["outputCompressionQuality"]);e!==void 0&&m!=null&&g(e,["parameters","outputOptions","compressionQuality"],m);const p=f(n,["enhancePrompt"]);e!==void 0&&p!=null&&g(e,["parameters","enhancePrompt"],p);const y=f(n,["labels"]);return e!==void 0&&y!=null&&g(e,["labels"],y),t}function bD(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["source"]);i!=null&&wD(i,t);const r=f(e,["config"]);return r!=null&&xD(r,t),t}function vD(n){const e={},t=f(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>Jg(i))),g(e,["generatedImages"],s)}return e}function wD(n,e){const t={},s=f(n,["prompt"]);e!==void 0&&s!=null&&g(e,["instances[0]","prompt"],s);const i=f(n,["personImage"]);e!==void 0&&i!=null&&g(e,["instances[0]","personImage","image"],Jn(i));const r=f(n,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>yD(a))),g(e,["instances[0]","productImages"],o)}return t}function _D(n){const e={},t=f(n,["referenceImage"]);t!=null&&g(e,["referenceImage"],Jn(t));const s=f(n,["referenceId"]);s!=null&&g(e,["referenceId"],s);const i=f(n,["referenceType"]);i!=null&&g(e,["referenceType"],i);const r=f(n,["maskImageConfig"]);r!=null&&g(e,["maskImageConfig"],mD(r));const o=f(n,["controlImageConfig"]);o!=null&&g(e,["controlImageConfig"],l2(o));const a=f(n,["styleImageConfig"]);a!=null&&g(e,["styleImageConfig"],a);const c=f(n,["subjectImageConfig"]);return c!=null&&g(e,["subjectImageConfig"],c),e}function kS(n){const e={},t=f(n,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);const s=f(n,["safetyAttributes","scores"]);s!=null&&g(e,["scores"],s);const i=f(n,["contentType"]);return i!=null&&g(e,["contentType"],i),e}function TS(n){const e={},t=f(n,["safetyAttributes","categories"]);t!=null&&g(e,["categories"],t);const s=f(n,["safetyAttributes","scores"]);s!=null&&g(e,["scores"],s);const i=f(n,["contentType"]);return i!=null&&g(e,["contentType"],i),e}function AD(n){const e={},t=f(n,["category"]);if(t!=null&&g(e,["category"],t),f(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=f(n,["threshold"]);return s!=null&&g(e,["threshold"],s),e}function SD(n){const e={},t=f(n,["image"]);return t!=null&&g(e,["image"],Jn(t)),e}function CD(n,e){const t={},s=f(n,["mode"]);e!==void 0&&s!=null&&g(e,["parameters","mode"],s);const i=f(n,["maxPredictions"]);e!==void 0&&i!=null&&g(e,["parameters","maxPredictions"],i);const r=f(n,["confidenceThreshold"]);e!==void 0&&r!=null&&g(e,["parameters","confidenceThreshold"],r);const o=f(n,["maskDilation"]);e!==void 0&&o!=null&&g(e,["parameters","maskDilation"],o);const a=f(n,["binaryColorThreshold"]);e!==void 0&&a!=null&&g(e,["parameters","binaryColorThreshold"],a);const c=f(n,["labels"]);return e!==void 0&&c!=null&&g(e,["labels"],c),t}function ED(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["source"]);i!=null&&TD(i,t);const r=f(e,["config"]);return r!=null&&CD(r,t),t}function kD(n){const e={},t=f(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>Q2(i))),g(e,["generatedMasks"],s)}return e}function TD(n,e){const t={},s=f(n,["prompt"]);e!==void 0&&s!=null&&g(e,["instances[0]","prompt"],s);const i=f(n,["image"]);e!==void 0&&i!=null&&g(e,["instances[0]","image"],Jn(i));const r=f(n,["scribbleImage"]);return e!==void 0&&r!=null&&g(e,["instances[0]","scribble"],SD(r)),t}function ND(n){const e={},t=f(n,["functionCallingConfig"]);t!=null&&g(e,["functionCallingConfig"],P2(t));const s=f(n,["retrievalConfig"]);return s!=null&&g(e,["retrievalConfig"],s),e}function ID(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(m=>m)),g(e,["functionDeclarations"],u)}if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(n,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);const i=f(n,["computerUse"]);i!=null&&g(e,["computerUse"],i);const r=f(n,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);const o=f(n,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=f(n,["googleMaps"]);a!=null&&g(e,["googleMaps"],iD(a));const c=f(n,["googleSearch"]);c!=null&&g(e,["googleSearch"],rD(c));const d=f(n,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}function NS(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let m=t;Array.isArray(m)&&(m=m.map(p=>R2(p))),g(e,["functionDeclarations"],m)}const s=f(n,["retrieval"]);s!=null&&g(e,["retrieval"],s);const i=f(n,["googleSearchRetrieval"]);i!=null&&g(e,["googleSearchRetrieval"],i);const r=f(n,["computerUse"]);if(r!=null&&g(e,["computerUse"],r),f(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=f(n,["codeExecution"]);o!=null&&g(e,["codeExecution"],o);const a=f(n,["enterpriseWebSearch"]);a!=null&&g(e,["enterpriseWebSearch"],a);const c=f(n,["googleMaps"]);c!=null&&g(e,["googleMaps"],c);const d=f(n,["googleSearch"]);d!=null&&g(e,["googleSearch"],d);const u=f(n,["urlContext"]);return u!=null&&g(e,["urlContext"],u),e}function PD(n){const e={},t=f(n,["baseModel"]);t!=null&&g(e,["baseModel"],t);const s=f(n,["createTime"]);s!=null&&g(e,["createTime"],s);const i=f(n,["updateTime"]);return i!=null&&g(e,["updateTime"],i),e}function RD(n){const e={},t=f(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&g(e,["baseModel"],t);const s=f(n,["createTime"]);s!=null&&g(e,["createTime"],s);const i=f(n,["updateTime"]);return i!=null&&g(e,["updateTime"],i),e}function MD(n,e){const t={},s=f(n,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);const i=f(n,["description"]);e!==void 0&&i!=null&&g(e,["description"],i);const r=f(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function DD(n,e){const t={},s=f(n,["displayName"]);e!==void 0&&s!=null&&g(e,["displayName"],s);const i=f(n,["description"]);e!==void 0&&i!=null&&g(e,["description"],i);const r=f(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&g(e,["defaultCheckpointId"],r),t}function LD(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","name"],Pe(n,s));const i=f(e,["config"]);return i!=null&&MD(i,t),t}function FD(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["config"]);return i!=null&&DD(i,t),t}function jD(n,e){const t={},s=f(n,["outputGcsUri"]);e!==void 0&&s!=null&&g(e,["parameters","storageUri"],s);const i=f(n,["safetyFilterLevel"]);e!==void 0&&i!=null&&g(e,["parameters","safetySetting"],i);const r=f(n,["personGeneration"]);e!==void 0&&r!=null&&g(e,["parameters","personGeneration"],r);const o=f(n,["includeRaiReason"]);e!==void 0&&o!=null&&g(e,["parameters","includeRaiReason"],o);const a=f(n,["outputMimeType"]);e!==void 0&&a!=null&&g(e,["parameters","outputOptions","mimeType"],a);const c=f(n,["outputCompressionQuality"]);e!==void 0&&c!=null&&g(e,["parameters","outputOptions","compressionQuality"],c);const d=f(n,["enhanceInputImage"]);e!==void 0&&d!=null&&g(e,["parameters","upscaleConfig","enhanceInputImage"],d);const u=f(n,["imagePreservationFactor"]);e!==void 0&&u!=null&&g(e,["parameters","upscaleConfig","imagePreservationFactor"],u);const m=f(n,["labels"]);e!==void 0&&m!=null&&g(e,["labels"],m);const p=f(n,["numberOfImages"]);e!==void 0&&p!=null&&g(e,["parameters","sampleCount"],p);const y=f(n,["mode"]);return e!==void 0&&y!=null&&g(e,["parameters","mode"],y),t}function OD(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["_url","model"],Pe(n,s));const i=f(e,["image"]);i!=null&&g(t,["instances[0]","image"],Jn(i));const r=f(e,["upscaleFactor"]);r!=null&&g(t,["parameters","upscaleConfig","upscaleFactor"],r);const o=f(e,["config"]);return o!=null&&jD(o,t),t}function UD(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>Jg(r))),g(e,["generatedImages"],i)}return e}function BD(n){const e={},t=f(n,["uri"]);t!=null&&g(e,["uri"],t);const s=f(n,["encodedVideo"]);s!=null&&g(e,["videoBytes"],sa(s));const i=f(n,["encoding"]);return i!=null&&g(e,["mimeType"],i),e}function HD(n){const e={},t=f(n,["gcsUri"]);t!=null&&g(e,["uri"],t);const s=f(n,["bytesBase64Encoded"]);s!=null&&g(e,["videoBytes"],sa(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["mimeType"],i),e}function GD(n){const e={},t=f(n,["image"]);t!=null&&g(e,["_self"],Jn(t));const s=f(n,["maskMode"]);return s!=null&&g(e,["maskMode"],s),e}function qD(n){const e={},t=f(n,["image"]);t!=null&&g(e,["image"],Xg(t));const s=f(n,["referenceType"]);return s!=null&&g(e,["referenceType"],s),e}function VD(n){const e={},t=f(n,["image"]);t!=null&&g(e,["image"],Jn(t));const s=f(n,["referenceType"]);return s!=null&&g(e,["referenceType"],s),e}function IS(n){const e={},t=f(n,["uri"]);t!=null&&g(e,["uri"],t);const s=f(n,["videoBytes"]);s!=null&&g(e,["encodedVideo"],sa(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["encoding"],i),e}function PS(n){const e={},t=f(n,["uri"]);t!=null&&g(e,["gcsUri"],t);const s=f(n,["videoBytes"]);s!=null&&g(e,["bytesBase64Encoded"],sa(s));const i=f(n,["mimeType"]);return i!=null&&g(e,["mimeType"],i),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $D(n,e){const t={},s=f(n,["displayName"]);return e!==void 0&&s!=null&&g(e,["displayName"],s),t}function zD(n){const e={},t=f(n,["config"]);return t!=null&&$D(t,e),e}function WD(n,e){const t={},s=f(n,["force"]);return e!==void 0&&s!=null&&g(e,["_query","force"],s),t}function KD(n){const e={},t=f(n,["name"]);t!=null&&g(e,["_url","name"],t);const s=f(n,["config"]);return s!=null&&WD(s,e),e}function YD(n){const e={},t=f(n,["name"]);return t!=null&&g(e,["_url","name"],t),e}function JD(n,e){const t={},s=f(n,["customMetadata"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["customMetadata"],r)}const i=f(n,["chunkingConfig"]);return e!==void 0&&i!=null&&g(e,["chunkingConfig"],i),t}function XD(n){const e={},t=f(n,["name"]);t!=null&&g(e,["name"],t);const s=f(n,["metadata"]);s!=null&&g(e,["metadata"],s);const i=f(n,["done"]);i!=null&&g(e,["done"],i);const r=f(n,["error"]);r!=null&&g(e,["error"],r);const o=f(n,["response"]);return o!=null&&g(e,["response"],ZD(o)),e}function QD(n){const e={},t=f(n,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);const s=f(n,["fileName"]);s!=null&&g(e,["fileName"],s);const i=f(n,["config"]);return i!=null&&JD(i,e),e}function ZD(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["parent"]);s!=null&&g(e,["parent"],s);const i=f(n,["documentName"]);return i!=null&&g(e,["documentName"],i),e}function eL(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);return e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),t}function tL(n){const e={},t=f(n,["config"]);return t!=null&&eL(t,e),e}function sL(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["fileSearchStores"],r)}return e}function RS(n,e){const t={},s=f(n,["mimeType"]);e!==void 0&&s!=null&&g(e,["mimeType"],s);const i=f(n,["displayName"]);e!==void 0&&i!=null&&g(e,["displayName"],i);const r=f(n,["customMetadata"]);if(e!==void 0&&r!=null){let a=r;Array.isArray(a)&&(a=a.map(c=>c)),g(e,["customMetadata"],a)}const o=f(n,["chunkingConfig"]);return e!==void 0&&o!=null&&g(e,["chunkingConfig"],o),t}function nL(n){const e={},t=f(n,["fileSearchStoreName"]);t!=null&&g(e,["_url","file_search_store_name"],t);const s=f(n,["config"]);return s!=null&&RS(s,e),e}function iL(n){const e={},t=f(n,["sdkHttpResponse"]);return t!=null&&g(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const rL="Content-Type",oL="X-Server-Timeout",aL="User-Agent",Ny="x-goog-api-client",lL="1.34.0",cL=`google-genai-sdk/${lL}`,dL="v1beta1",uL="v1beta";class hL{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:dL,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:uL,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const i=[this.getRequestUrlInternal(t)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[o,a]of Object.entries(e.queryParams))i.searchParams.append(o,String(a));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(t))typeof r=="object"?s[i]=Object.assign(Object.assign({},s[i]),r):r!==void 0&&(s[i]=r);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s,i){if(t&&t.timeout||i){const r=new AbortController,o=r.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const a=setTimeout(()=>r.abort(),t.timeout);a&&typeof a.unref=="function"&&a.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&fL(e,t.extraBody),e.headers=await this.getHeadersInternal(t,s),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await i_(i),new Sy(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await i_(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Wn(this,arguments,function*(){var s;const i=(s=e==null?void 0:e.body)===null||s===void 0?void 0:s.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="";const a="data:",c=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:d,value:u}=yield he(i.read());if(d){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const m=r.decode(u,{stream:!0});try{const v=JSON.parse(m);if("error"in v){const x=JSON.parse(JSON.stringify(v.error)),b=x.status,w=x.code,S=`got status: ${b}. ${JSON.stringify(v)}`;if(w>=400&&w<600)throw new Kg({message:S,status:w})}}catch(v){if(v.name==="ApiError")throw v}o+=m;let p=-1,y=0;for(;;){p=-1,y=0;for(const b of c){const w=o.indexOf(b);w!==-1&&(p===-1||w<p)&&(p=w,y=b.length)}if(p===-1)break;const v=o.substring(0,p);o=o.substring(p+y);const x=v.trim();if(x.startsWith(a)){const b=x.substring(a.length).trim();try{const w=new Response(b,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield he(new Sy(w))}catch(w){throw new Error(`exception parsing stream chunk ${b}. ${w}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=cL+" "+this.clientOptions.userAgentExtra;return e[aL]=t,e[Ny]=t,e[rL]="application/json",e}async getHeadersInternal(e,t){const s=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))s.append(i,r);e.timeout&&e.timeout>0&&s.append(oL,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,t),s}getFileName(e){var t;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(t=s.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),s}async uploadFile(e,t){var s;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);const a=(s=t==null?void 0:t.mimeType)!==null&&s!==void 0?s:o.type;if(a===void 0||a==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=a;const c={file:i},d=this.getFileName(e),u=Q("upload/v1beta/files",c._url),m=await this.fetchUploadUrl(u,i.sizeBytes,i.mimeType,d,c,t==null?void 0:t.httpOptions);return r.upload(e,m,this)}async uploadFileToFileSearchStore(e,t,s){var i;const r=this.clientOptions.uploader,o=await r.stat(t),a=String(o.size),c=(i=s==null?void 0:s.mimeType)!==null&&i!==void 0?i:o.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),m={};s!=null&&RS(s,m);const p=await this.fetchUploadUrl(d,a,c,u,m,s==null?void 0:s.httpOptions);return r.uploadToFileSearchStore(t,p,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,s,i,r,o){var a;let c={};o?c=o:c={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const d=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:c});if(!d||!(d!=null&&d.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const u=(a=d==null?void 0:d.headers)===null||a===void 0?void 0:a["x-goog-upload-url"];if(u===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function i_(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let s;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await n.json():s={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(s);throw t>=400&&t<600?new Kg({message:i,status:t}):new Error(i)}}function fL(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const r=JSON.parse(n.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,o){const a=Object.assign({},r);for(const c in o)if(Object.prototype.hasOwnProperty.call(o,c)){const d=o[c],u=a[c];d&&typeof d=="object"&&!Array.isArray(d)&&u&&typeof u=="object"&&!Array.isArray(u)?a[c]=s(u,d):(u&&d&&typeof u!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${c}". Original type: ${typeof u}, New type: ${typeof d}. Overwriting.`),a[c]=d)}return a}const i=s(t,e);n.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const pL="mcp_used/unknown";let mL=!1;function MS(n){for(const e of n)if(gL(e)||typeof e=="object"&&"inputSchema"in e)return!0;return mL}function DS(n){var e;const t=(e=n[Ny])!==null&&e!==void 0?e:"";n[Ny]=(t+` ${pL}`).trimStart()}function gL(n){return n!==null&&typeof n=="object"&&n instanceof Db}function yL(n){return Wn(this,arguments,function*(t,s=100){let i,r=0;for(;r<s;){const o=yield he(t.listTools({cursor:i}));for(const a of o.tools)yield yield he(a),r++;if(!o.nextCursor)break;i=o.nextCursor}})}class Db{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Db(e,t)}async initialize(){var e,t,s,i;if(this.mcpTools.length>0)return;const r={},o=[];for(const u of this.mcpClients)try{for(var a=!0,c=(t=void 0,Kn(yL(u))),d;d=await c.next(),e=d.done,!e;a=!0){i=d.value,a=!1;const m=i;o.push(m);const p=m.name;if(r[p])throw new Error(`Duplicate function name ${p} found in MCP tools. Please ensure function names are unique.`);r[p]=u}}catch(m){t={error:m}}finally{try{!a&&!e&&(s=c.return)&&await s.call(c)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),YP(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const o=await i.callTool({name:s.name,arguments:s.args},void 0,r);t.push({functionResponse:{name:s.name,response:o.isError?{error:o}:o}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function xL(n,e,t){const s=new HP;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(s,i),e(s)}class bL{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=_L(this.apiClient.getDefaultHeaders()),a=this.apiClient.getApiKey(),c=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${a}`;let d=()=>{};const u=new Promise(A=>{d=A}),m=e.callbacks,p=function(){d({})},y=this.apiClient,v={onopen:p,onmessage:A=>{xL(y,m.onmessage,A)},onerror:(t=m==null?void 0:m.onerror)!==null&&t!==void 0?t:function(A){},onclose:(s=m==null?void 0:m.onclose)!==null&&s!==void 0?s:function(A){}},x=this.webSocketFactory.create(c,wL(o),v);x.connect(),await u;const S={setup:{model:Pe(this.apiClient,e.model)}};return x.send(JSON.stringify(S)),new vL(x,this.apiClient)}}class vL{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=zM(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=$M(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(oc.PLAY)}pause(){this.sendPlaybackControl(oc.PAUSE)}stop(){this.sendPlaybackControl(oc.STOP)}resetContext(){this.sendPlaybackControl(oc.RESET_CONTEXT)}close(){this.conn.close()}}function wL(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function _L(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const AL="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function SL(n,e,t){const s=new BP;let i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;const r=JSON.parse(i);if(n.isVertexAI()){const o=YM(r);Object.assign(s,o)}else Object.assign(s,r);e(s)}class CL{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new bL(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,i,r,o,a;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const c=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let u;const m=this.apiClient.getHeaders();e.config&&e.config.tools&&MS(e.config.tools)&&DS(m);const p=NL(m);if(this.apiClient.isVertexAI())u=`${c}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(p,u);else{const P=this.apiClient.getApiKey();let R="BidiGenerateContent",j="key";P!=null&&P.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),R="BidiGenerateContentConstrained",j="access_token"),u=`${c}/ws/google.ai.generativelanguage.${d}.GenerativeService.${R}?${j}=${P}`}let y=()=>{};const v=new Promise(P=>{y=P}),x=e.callbacks,b=function(){var P;(P=x==null?void 0:x.onopen)===null||P===void 0||P.call(x),y({})},w=this.apiClient,S={onopen:b,onmessage:P=>{SL(w,x.onmessage,P)},onerror:(t=x==null?void 0:x.onerror)!==null&&t!==void 0?t:function(P){},onclose:(s=x==null?void 0:x.onclose)!==null&&s!==void 0?s:function(P){}},A=this.webSocketFactory.create(u,TL(p),S);A.connect(),await v;let k=Pe(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&k.startsWith("publishers/")){const P=this.apiClient.getProject(),R=this.apiClient.getLocation();k=`projects/${P}/locations/${R}/`+k}let T={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[eg.AUDIO]}:e.config.responseModalities=[eg.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const N=(a=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[],I=[];for(const P of N)if(this.isCallableTool(P)){const R=P;I.push(await R.tool())}else I.push(P);I.length>0&&(e.config.tools=I);const D={model:k,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?T=VM(this.apiClient,D):T=qM(this.apiClient,D),delete T.config,A.send(JSON.stringify(T)),new kL(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const EL={turnComplete:!0};class kL{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=wn(t.turns),e.isVertexAI()||(s=s.map(i=>Yg(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(AL)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},EL),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:KM(e)}:t={realtimeInput:WM(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function TL(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function NL(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const r_=10;function o_(n){var e,t,s;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const o of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(bc(o)){i=!0;break}if(!i)return!0;const r=(s=n==null?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function bc(n){return"callTool"in n&&typeof n.callTool=="function"}function IL(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>bc(i)))!==null&&s!==void 0?s:!1}function a_(n){var e;const t=[];return!((e=n==null?void 0:n.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((s,i)=>{if(bc(s))return;const r=s;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(i)}),t}function l_(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class PL extends Hr{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,i,r,o,a;const c=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!IL(t)||o_(t.config))return await this.generateContentInternal(c);const d=a_(t);if(d.length>0){const x=d.map(b=>`tools[${b}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${x}.`)}let u,m;const p=wn(c.contents),y=(r=(i=(s=c.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:r_;let v=0;for(;v<y&&(u=await this.generateContentInternal(c),!(!u.functionCalls||u.functionCalls.length===0));){const x=u.candidates[0].content,b=[];for(const w of(a=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&a!==void 0?a:[])if(bc(w)){const A=await w.callTool(u.functionCalls);b.push(...A)}v++,m={role:"user",parts:b},c.contents=wn(c.contents),c.contents.push(x),c.contents.push(m),l_(c.config)&&(p.push(x),p.push(m))}return l_(c.config)&&(u.automaticFunctionCallingHistory=p),u},this.generateContentStream=async t=>{var s,i,r,o,a;if(this.maybeMoveToResponseJsonSchem(t),o_(t.config)){const m=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(m)}const c=a_(t);if(c.length>0){const m=c.map(p=>`tools[${p}]`).join(", ");throw new Error(`Incompatible tools found at ${m}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const d=(r=(i=(s=t==null?void 0:t.config)===null||s===void 0?void 0:s.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,u=(a=(o=t==null?void 0:t.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||a===void 0?void 0:a.disable;if(d&&!u)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var i;let r;const o=[];if(s!=null&&s.generatedImages)for(const c of s.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((i=c==null?void 0:c.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=c==null?void 0:c.safetyAttributes:o.push(c);let a;return r?a={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:a={generatedImages:o,sdkHttpResponse:s.sdkHttpResponse},a}),this.list=async t=>{var s;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((s=o.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new ql(jr.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(o),o)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var s,i,r,o,a,c;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=t.video)===null||s===void 0)&&s.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((c=(a=t.source)===null||a===void 0?void 0:a.video)===null||c===void 0)&&c.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,s,i;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const o=await Promise.all(r.map(async c=>bc(c)?await c.tool():c)),a={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(a.config.tools=o,e.config&&e.config.tools&&MS(e.config.tools)){const c=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let d=Object.assign({},c);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),DS(d),a.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return a}async initAfcToolsMap(e){var t,s,i;const r=new Map;for(const o of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(bc(o)){const a=o,c=await a.tool();for(const d of(i=c.functionDeclarations)!==null&&i!==void 0?i:[]){if(!d.name)throw new Error("Function declaration name is required.");if(r.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);r.set(d.name,a)}}return r}async processAfcStream(e){var t,s,i;const r=(i=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:r_;let o=!1,a=0;const c=await this.initAfcToolsMap(e);return function(d,u,m){return Wn(this,arguments,function*(){for(var p,y,v,x,b,w;a<r;){o&&(a++,o=!1);const T=yield he(d.processParamsMaybeAddMcpUsage(m)),N=yield he(d.generateContentStreamInternal(T)),I=[],D=[];try{for(var S=!0,A=(y=void 0,Kn(N)),k;k=yield he(A.next()),p=k.done,!p;S=!0){x=k.value,S=!1;const P=x;if(yield yield he(P),P.candidates&&(!((b=P.candidates[0])===null||b===void 0)&&b.content)){D.push(P.candidates[0].content);for(const R of(w=P.candidates[0].content.parts)!==null&&w!==void 0?w:[])if(a<r&&R.functionCall){if(!R.functionCall.name)throw new Error("Function call name was not returned by the model.");if(u.has(R.functionCall.name)){const j=yield he(u.get(R.functionCall.name).callTool([R.functionCall]));I.push(...j)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${u.keys()}, mising tool: ${R.functionCall.name}`)}}}}catch(P){y={error:P}}finally{try{!S&&!p&&(v=A.return)&&(yield he(v.call(A)))}finally{if(y)throw y.error}}if(I.length>0){o=!0;const P=new yu;P.candidates=[{content:{role:"user",parts:I}}],yield yield he(P);const R=[];R.push(...D),R.push({role:"user",parts:I});const j=wn(m.contents).concat(R);m.contents=j}else break}})}(this,c,e)}async generateContentInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=t_(this.apiClient,e);return a=Q("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=n_(u),p=new yu;return Object.assign(p,m),p})}else{const d=e_(this.apiClient,e);return a=Q("{model}:generateContent",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=s_(u),p=new yu;return Object.assign(p,m),p})}}async generateContentStreamInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=t_(this.apiClient,e);return a=Q("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(m){return Wn(this,arguments,function*(){var p,y,v,x;try{for(var b=!0,w=Kn(m),S;S=yield he(w.next()),p=S.done,!p;b=!0){x=S.value,b=!1;const A=x,k=n_(yield he(A.json()));k.sdkHttpResponse={headers:A.headers};const T=new yu;Object.assign(T,k),yield yield he(T)}}catch(A){y={error:A}}finally{try{!b&&!p&&(v=w.return)&&(yield he(v.call(w)))}finally{if(y)throw y.error}}})})}else{const d=e_(this.apiClient,e);return a=Q("{model}:streamGenerateContent?alt=sse",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.requestStream({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(m){return Wn(this,arguments,function*(){var p,y,v,x;try{for(var b=!0,w=Kn(m),S;S=yield he(w.next()),p=S.done,!p;b=!0){x=S.value,b=!1;const A=x,k=s_(yield he(A.json()));k.sdkHttpResponse={headers:A.headers};const T=new yu;Object.assign(T,k),yield yield he(T)}}catch(A){y={error:A}}finally{try{!b&&!p&&(v=w.return)&&(yield he(v.call(w)))}finally{if(y)throw y.error}}})})}}async embedContent(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=C2(this.apiClient,e);return a=Q("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=k2(u),p=new jw;return Object.assign(p,m),p})}else{const d=S2(this.apiClient,e);return a=Q("{model}:batchEmbedContents",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=E2(u),p=new jw;return Object.assign(p,m),p})}}async generateImagesInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=O2(this.apiClient,e);return a=Q("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=B2(u),p=new Ow;return Object.assign(p,m),p})}else{const d=j2(this.apiClient,e);return a=Q("{model}:predict",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=U2(u),p=new Ow;return Object.assign(p,m),p})}}async editImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=v2(this.apiClient,e);return r=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>{const d=w2(c),u=new NP;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=OD(this.apiClient,e);return r=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>{const d=UD(c),u=new IP;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=bD(this.apiClient,e);return r=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=vD(c),u=new PP;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=ED(this.apiClient,e);return r=Q("{model}:predict",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=kD(c),u=new RP;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=nD(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>Ty(u))}else{const d=sD(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>ky(u))}}async listInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=hD(this.apiClient,e);return a=Q("{models_url}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=pD(u),p=new Uw;return Object.assign(p,m),p})}else{const d=uD(this.apiClient,e);return a=Q("{models_url}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=fD(u),p=new Uw;return Object.assign(p,m),p})}}async update(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=FD(this.apiClient,e);return a=Q("{model}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>Ty(u))}else{const d=LD(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>ky(u))}}async delete(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=g2(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=x2(u),p=new Bw;return Object.assign(p,m),p})}else{const d=m2(this.apiClient,e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=y2(u),p=new Bw;return Object.assign(p,m),p})}}async countTokens(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=h2(this.apiClient,e);return a=Q("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=p2(u),p=new Hw;return Object.assign(p,m),p})}else{const d=u2(this.apiClient,e);return a=Q("{model}:countTokens",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=f2(u),p=new Hw;return Object.assign(p,m),p})}}async computeTokens(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=i2(this.apiClient,e);return r=Q("{model}:computeTokens",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>{const d=r2(c),u=new MP;return Object.assign(u,d),u})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=z2(this.apiClient,e);return a=Q("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o.then(u=>{const m=V2(u),p=new tg;return Object.assign(p,m),p})}else{const d=$2(this.apiClient,e);return a=Q("{model}:predictLongRunning",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o.then(u=>{const m=q2(u),p=new tg;return Object.assign(p,m),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class RL extends Hr{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=AP(e);return a=Q("{operationName}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json()),o}else{const d=_P(e);return a=Q("{operationName}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),o}}async fetchPredictVideosOperationInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=mP(e);return r=Q("{resourceName}:fetchPredictOperation",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ML(n){const e={},t=f(n,["data"]);if(t!=null&&g(e,["data"],t),f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function DL(n){const e={},t=f(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>qL(r))),g(e,["parts"],i)}const s=f(n,["role"]);return s!=null&&g(e,["role"],s),e}function LL(n,e,t){const s={},i=f(e,["expireTime"]);t!==void 0&&i!=null&&g(t,["expireTime"],i);const r=f(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&g(t,["newSessionExpireTime"],r);const o=f(e,["uses"]);t!==void 0&&o!=null&&g(t,["uses"],o);const a=f(e,["liveConnectConstraints"]);t!==void 0&&a!=null&&g(t,["bidiGenerateContentSetup"],GL(n,a));const c=f(e,["lockAdditionalFields"]);return t!==void 0&&c!=null&&g(t,["fieldMask"],c),s}function FL(n,e){const t={},s=f(e,["config"]);return s!=null&&g(t,["config"],LL(n,s,t)),t}function jL(n){const e={};if(f(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=f(n,["fileUri"]);t!=null&&g(e,["fileUri"],t);const s=f(n,["mimeType"]);return s!=null&&g(e,["mimeType"],s),e}function OL(n){const e={},t=f(n,["id"]);t!=null&&g(e,["id"],t);const s=f(n,["args"]);s!=null&&g(e,["args"],s);const i=f(n,["name"]);if(i!=null&&g(e,["name"],i),f(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(f(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function UL(n){const e={};if(f(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=f(n,["enableWidget"]);return t!=null&&g(e,["enableWidget"],t),e}function BL(n){const e={};if(f(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(f(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=f(n,["timeRangeFilter"]);return t!=null&&g(e,["timeRangeFilter"],t),e}function HL(n,e){const t={},s=f(n,["generationConfig"]);e!==void 0&&s!=null&&g(e,["setup","generationConfig"],s);const i=f(n,["responseModalities"]);e!==void 0&&i!=null&&g(e,["setup","generationConfig","responseModalities"],i);const r=f(n,["temperature"]);e!==void 0&&r!=null&&g(e,["setup","generationConfig","temperature"],r);const o=f(n,["topP"]);e!==void 0&&o!=null&&g(e,["setup","generationConfig","topP"],o);const a=f(n,["topK"]);e!==void 0&&a!=null&&g(e,["setup","generationConfig","topK"],a);const c=f(n,["maxOutputTokens"]);e!==void 0&&c!=null&&g(e,["setup","generationConfig","maxOutputTokens"],c);const d=f(n,["mediaResolution"]);e!==void 0&&d!=null&&g(e,["setup","generationConfig","mediaResolution"],d);const u=f(n,["seed"]);e!==void 0&&u!=null&&g(e,["setup","generationConfig","seed"],u);const m=f(n,["speechConfig"]);e!==void 0&&m!=null&&g(e,["setup","generationConfig","speechConfig"],Mb(m));const p=f(n,["thinkingConfig"]);e!==void 0&&p!=null&&g(e,["setup","generationConfig","thinkingConfig"],p);const y=f(n,["enableAffectiveDialog"]);e!==void 0&&y!=null&&g(e,["setup","generationConfig","enableAffectiveDialog"],y);const v=f(n,["systemInstruction"]);e!==void 0&&v!=null&&g(e,["setup","systemInstruction"],DL(is(v)));const x=f(n,["tools"]);if(e!==void 0&&x!=null){let N=uu(x);Array.isArray(N)&&(N=N.map(I=>$L(du(I)))),g(e,["setup","tools"],N)}const b=f(n,["sessionResumption"]);e!==void 0&&b!=null&&g(e,["setup","sessionResumption"],VL(b));const w=f(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&g(e,["setup","inputAudioTranscription"],w);const S=f(n,["outputAudioTranscription"]);e!==void 0&&S!=null&&g(e,["setup","outputAudioTranscription"],S);const A=f(n,["realtimeInputConfig"]);e!==void 0&&A!=null&&g(e,["setup","realtimeInputConfig"],A);const k=f(n,["contextWindowCompression"]);e!==void 0&&k!=null&&g(e,["setup","contextWindowCompression"],k);const T=f(n,["proactivity"]);if(e!==void 0&&T!=null&&g(e,["setup","proactivity"],T),f(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function GL(n,e){const t={},s=f(e,["model"]);s!=null&&g(t,["setup","model"],Pe(n,s));const i=f(e,["config"]);return i!=null&&g(t,["config"],HL(i,t)),t}function qL(n){const e={},t=f(n,["mediaResolution"]);t!=null&&g(e,["mediaResolution"],t);const s=f(n,["codeExecutionResult"]);s!=null&&g(e,["codeExecutionResult"],s);const i=f(n,["executableCode"]);i!=null&&g(e,["executableCode"],i);const r=f(n,["fileData"]);r!=null&&g(e,["fileData"],jL(r));const o=f(n,["functionCall"]);o!=null&&g(e,["functionCall"],OL(o));const a=f(n,["functionResponse"]);a!=null&&g(e,["functionResponse"],a);const c=f(n,["inlineData"]);c!=null&&g(e,["inlineData"],ML(c));const d=f(n,["text"]);d!=null&&g(e,["text"],d);const u=f(n,["thought"]);u!=null&&g(e,["thought"],u);const m=f(n,["thoughtSignature"]);m!=null&&g(e,["thoughtSignature"],m);const p=f(n,["videoMetadata"]);return p!=null&&g(e,["videoMetadata"],p),e}function VL(n){const e={},t=f(n,["handle"]);if(t!=null&&g(e,["handle"],t),f(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function $L(n){const e={},t=f(n,["functionDeclarations"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(m=>m)),g(e,["functionDeclarations"],u)}if(f(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=f(n,["googleSearchRetrieval"]);s!=null&&g(e,["googleSearchRetrieval"],s);const i=f(n,["computerUse"]);i!=null&&g(e,["computerUse"],i);const r=f(n,["fileSearch"]);r!=null&&g(e,["fileSearch"],r);const o=f(n,["codeExecution"]);if(o!=null&&g(e,["codeExecution"],o),f(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const a=f(n,["googleMaps"]);a!=null&&g(e,["googleMaps"],UL(a));const c=f(n,["googleSearch"]);c!=null&&g(e,["googleSearch"],BL(c));const d=f(n,["urlContext"]);return d!=null&&g(e,["urlContext"],d),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zL(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(r=>`${t}.${r}`);e.push(...i)}else e.push(t)}return e.join(",")}function WL(n,e){let t=null;const s=n.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(n.bidiGenerateContentSetup=r,t=r):delete n.bidiGenerateContentSetup}else s!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const r=zL(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)r?n.fieldMask=r:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let a=[];i.length>0&&(a=i.map(d=>o.includes(d)?`generationConfig.${d}`:d));const c=[];r&&c.push(r),a.length>0&&c.push(...a),c.length>0?n.fieldMask=c.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class KL extends Hr{constructor(e){super(),this.apiClient=e}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const a=FL(this.apiClient,e);r=Q("auth_tokens",a._url),o=a._query,delete a.config,delete a._url,delete a._query;const c=WL(a,e.config);return i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function YL(n,e){const t={},s=f(n,["force"]);return e!==void 0&&s!=null&&g(e,["_query","force"],s),t}function JL(n){const e={},t=f(n,["name"]);t!=null&&g(e,["_url","name"],t);const s=f(n,["config"]);return s!=null&&YL(s,e),e}function XL(n){const e={},t=f(n,["name"]);return t!=null&&g(e,["_url","name"],t),e}function QL(n,e){const t={},s=f(n,["pageSize"]);e!==void 0&&s!=null&&g(e,["_query","pageSize"],s);const i=f(n,["pageToken"]);return e!==void 0&&i!=null&&g(e,["_query","pageToken"],i),t}function ZL(n){const e={},t=f(n,["parent"]);t!=null&&g(e,["_url","parent"],t);const s=f(n,["config"]);return s!=null&&QL(s,e),e}function eF(n){const e={},t=f(n,["sdkHttpResponse"]);t!=null&&g(e,["sdkHttpResponse"],t);const s=f(n,["nextPageToken"]);s!=null&&g(e,["nextPageToken"],s);const i=f(n,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),g(e,["documents"],r)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class tF extends Hr{constructor(e){super(),this.apiClient=e,this.list=async t=>new ql(jr.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:t.parent,config:s.config}),await this.listInternal(t),t)}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=XL(e);return r=Q("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=JL(e);i=Q("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ZL(e);return r=Q("{parent}/documents",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=eF(c),u=new DP;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class sF extends Hr{constructor(e,t=new tF(e)){super(),this.apiClient=e,this.documents=t,this.list=async(s={})=>new ql(jr.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=zD(e);return r=Q("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=YD(e);return r=Q("{name}",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=KD(e);i=Q("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=tL(e);return r=Q("fileSearchStores",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=sL(c),u=new LP;return Object.assign(u,d),u})}}async uploadToFileSearchStoreInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=nL(e);return r=Q("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=iL(c),u=new FP;return Object.assign(u,d),u})}}async importFile(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=QD(e);return r=Q("{file_search_store_name}:importFile",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>{const d=XD(c),u=new Tb;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let LS=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return LS=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};const nF=()=>LS();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Iy(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const Py=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class An extends Error{}class bs extends An{constructor(e,t,s,i){super(`${bs.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,s){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e||!i)return new Qg({message:s,cause:Py(t)});const r=t;return e===400?new jS(e,r,s,i):e===401?new OS(e,r,s,i):e===403?new US(e,r,s,i):e===404?new BS(e,r,s,i):e===409?new HS(e,r,s,i):e===422?new GS(e,r,s,i):e===429?new qS(e,r,s,i):e>=500?new VS(e,r,s,i):new bs(e,r,s,i)}}class Ry extends bs{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Qg extends bs{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class FS extends Qg{constructor({message:e}={}){super({message:e??"Request timed out."})}}class jS extends bs{}class OS extends bs{}class US extends bs{}class BS extends bs{}class HS extends bs{}class GS extends bs{}class qS extends bs{}class VS extends bs{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const iF=/^[a-z][a-z0-9+.-]*:/i,rF=n=>iF.test(n);let My=n=>(My=Array.isArray,My(n));const oF=My;let aF=oF;const c_=aF;function lF(n){if(!n)return!0;for(const e in n)return!1;return!0}function cF(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const dF=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new An(`${n} must be an integer`);if(e<0)throw new An(`${n} must be a positive integer`);return e},uF=n=>{try{return JSON.parse(n)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hF=n=>new Promise(e=>setTimeout(e,n));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Xl="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fF(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const pF=()=>{var n,e,t,s,i;const r=fF();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xl,"X-Stainless-OS":u_(Deno.build.os),"X-Stainless-Arch":d_(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xl,"X-Stainless-OS":u_((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":d_((s=globalThis.process.arch)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const o=mF();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Xl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function mF(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}const d_=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",u_=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Op;const gF=()=>Op??(Op=pF());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yF(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function $S(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function xF(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return $S({start(){},async pull(t){const{done:s,value:i}=await e.next();s?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function zS(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function bF(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const s=n.getReader(),i=s.cancel();s.releaseLock(),await i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const vF=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const WS=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function _0(n,e,t){return WS(),new File(n,e??"unknown_file",t)}function wF(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const _F=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KS=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",AF=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&KS(n),SF=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function CF(n,e,t){if(WS(),n=await n,AF(n))return n instanceof File?n:_0([await n.arrayBuffer()],n.name);if(SF(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),_0(await Dy(i),e,t)}const s=await Dy(n);if(e||(e=wF(n)),!(t!=null&&t.type)){const i=s.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(t=Object.assign(Object.assign({},t),{type:i}))}return _0(s,e,t)}async function Dy(n){var e,t,s,i,r;let o=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)o.push(n);else if(KS(n))o.push(n instanceof Blob?n:await n.arrayBuffer());else if(_F(n))try{for(var a=!0,c=Kn(n),d;d=await c.next(),e=d.done,!e;a=!0){i=d.value,a=!1;const u=i;o.push(...await Dy(u))}}catch(u){t={error:u}}finally{try{!a&&!e&&(s=c.return)&&await s.call(c)}finally{if(t)throw t.error}}else{const u=(r=n==null?void 0:n.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof n}${u?`; constructor: ${u}`:""}${EF(n)}`)}return o}function EF(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class YS{constructor(e){this._client=e}}YS._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function JS(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const h_=Object.freeze(Object.create(null)),kF=(n=JS)=>function(t,...s){if(t.length===1)return t[0];let i=!1;const r=[],o=t.reduce((u,m,p)=>{var y,v,x;/[?#]/.test(m)&&(i=!0);const b=s[p];let w=(i?encodeURIComponent:n)(""+b);return p!==s.length&&(b==null||typeof b=="object"&&b.toString===((x=Object.getPrototypeOf((v=Object.getPrototypeOf((y=b.hasOwnProperty)!==null&&y!==void 0?y:h_))!==null&&v!==void 0?v:h_))===null||x===void 0?void 0:x.toString))&&(w=b+"",r.push({start:u.length+m.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(b).slice(8,-1)} is not a valid path parameter`})),u+m+(p===s.length?"":w)},""),a=o.split(/[?#]/,1)[0],c=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let d;for(;(d=c.exec(a))!==null;)r.push({start:d.index,length:d[0].length,error:`Value "${d[0]}" can't be safely passed as a path parameter`});if(r.sort((u,m)=>u.start-m.start),r.length>0){let u=0;const m=r.reduce((p,y)=>{const v=" ".repeat(y.start-u),x="^".repeat(y.length);return u=y.start+y.length,p+v+x},"");throw new An(`Path parameters result in path with invalid segments:
${r.map(p=>p.error).join(`
`)}
${o}
${m}`)}return o},Up=kF(JS);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class XS extends YS{create(e,t){var s;const{api_version:i=this._client.apiVersion}=e,r=ng(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new An("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new An("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(Up`/${i}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(s=e.stream)!==null&&s!==void 0?s:!1}))}delete(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.delete(Up`/${i}/interactions/${e}`,s)}cancel(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.post(Up`/${i}/interactions/${e}/cancel`,s)}get(e,t={},s){var i;const r=t??{},{api_version:o=this._client.apiVersion}=r,a=ng(r,["api_version"]);return this._client.get(Up`/${o}/interactions/${e}`,Object.assign(Object.assign({query:a},s),{stream:(i=t==null?void 0:t.stream)!==null&&i!==void 0?i:!1}))}}XS._key=Object.freeze(["interactions"]);class QS extends XS{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function TF(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}let Bp;function Lb(n){let e;return(Bp??(e=new globalThis.TextEncoder,Bp=e.encode.bind(e)))(n)}let Hp;function f_(n){let e;return(Hp??(e=new globalThis.TextDecoder,Hp=e.decode.bind(e)))(n)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Zg{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Lb(e):e;this.buffer=TF([this.buffer,t]);const s=[];let i;for(;(i=NF(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){s.push(f_(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,o=f_(this.buffer.subarray(0,r));s.push(o),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return s}flush(){return this.buffer.length?this.decode(`
`):[]}}Zg.NEWLINE_CHARS=new Set([`
`,"\r"]);Zg.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function NF(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function IF(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ig={off:0,error:200,warn:300,info:400,debug:500},p_=(n,e,t)=>{if(n){if(cF(ig,n))return n;us(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(ig))}`)}};function Tu(){}function Gp(n,e,t){return!e||ig[n]>ig[t]?Tu:e[n].bind(e)}const PF={error:Tu,warn:Tu,info:Tu,debug:Tu};let m_=new WeakMap;function us(n){var e;const t=n.logger,s=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return PF;const i=m_.get(t);if(i&&i[0]===s)return i[1];const r={error:Gp("error",t,s),warn:Gp("warn",t,s),info:Gp("info",t,s),debug:Gp("debug",t,s)};return m_.set(t,[s,r]),r}const ia=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ac{constructor(e,t,s){this.iterator=e,this.controller=t,this.client=s}static fromSSEResponse(e,t,s){let i=!1;const r=s?us(s):console;function o(){return Wn(this,arguments,function*(){var c,d,u,m;if(i)throw new An("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let p=!1;try{try{for(var y=!0,v=Kn(RF(e,t)),x;x=yield he(v.next()),c=x.done,!c;y=!0){m=x.value,y=!1;const b=m;if(!p)if(b.data.startsWith("[DONE]")){p=!0;continue}else try{yield yield he(JSON.parse(b.data))}catch(w){throw r.error("Could not parse message into JSON:",b.data),r.error("From chunk:",b.raw),w}}}catch(b){d={error:b}}finally{try{!y&&!c&&(u=v.return)&&(yield he(u.call(v)))}finally{if(d)throw d.error}}p=!0}catch(b){if(Iy(b))return yield he(void 0);throw b}finally{p||t.abort()}})}return new ac(o,t,s)}static fromReadableStream(e,t,s){let i=!1;function r(){return Wn(this,arguments,function*(){var c,d,u,m;const p=new Zg,y=zS(e);try{for(var v=!0,x=Kn(y),b;b=yield he(x.next()),c=b.done,!c;v=!0){m=b.value,v=!1;const w=m;for(const S of p.decode(w))yield yield he(S)}}catch(w){d={error:w}}finally{try{!v&&!c&&(u=x.return)&&(yield he(u.call(x)))}finally{if(d)throw d.error}}for(const w of p.flush())yield yield he(w)})}function o(){return Wn(this,arguments,function*(){var c,d,u,m;if(i)throw new An("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let p=!1;try{try{for(var y=!0,v=Kn(r()),x;x=yield he(v.next()),c=x.done,!c;y=!0){m=x.value,y=!1;const b=m;p||b&&(yield yield he(JSON.parse(b)))}}catch(b){d={error:b}}finally{try{!y&&!c&&(u=v.return)&&(yield he(u.call(v)))}finally{if(d)throw d.error}}p=!0}catch(b){if(Iy(b))return yield he(void 0);throw b}finally{p||t.abort()}})}return new ac(o,t,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();e.push(o),t.push(o)}return r.shift()}});return[new ac(()=>i(e),this.controller,this.client),new ac(()=>i(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return $S({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:r}=await t.next();if(r)return s.close();const o=Lb(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)===null||s===void 0?void 0:s.call(t))}})}}function RF(n,e){return Wn(this,arguments,function*(){var s,i,r,o;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new An("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new An("Attempted to iterate over a response with no body");const a=new DF,c=new Zg,d=zS(n.body);try{for(var u=!0,m=Kn(MF(d)),p;p=yield he(m.next()),s=p.done,!s;u=!0){o=p.value,u=!1;const y=o;for(const v of c.decode(y)){const x=a.decode(v);x&&(yield yield he(x))}}}catch(y){i={error:y}}finally{try{!u&&!s&&(r=m.return)&&(yield he(r.call(m)))}finally{if(i)throw i.error}}for(const y of c.flush()){const v=a.decode(y);v&&(yield yield he(v))}})}function MF(n){return Wn(this,arguments,function*(){var t,s,i,r;let o=new Uint8Array;try{for(var a=!0,c=Kn(n),d;d=yield he(c.next()),t=d.done,!t;a=!0){r=d.value,a=!1;const u=r;if(u==null)continue;const m=u instanceof ArrayBuffer?new Uint8Array(u):typeof u=="string"?Lb(u):u;let p=new Uint8Array(o.length+m.length);p.set(o),p.set(m,o.length),o=p;let y;for(;(y=IF(o))!==-1;)yield yield he(o.slice(0,y)),o=o.slice(y)}}catch(u){s={error:u}}finally{try{!a&&!t&&(i=c.return)&&(yield he(i.call(c)))}finally{if(s)throw s.error}}o.length>0&&(yield yield he(o))})}class DF{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=LF(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function LF(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function FF(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:i,startTime:r}=e,o=await(async()=>{var a;if(e.options.stream)return us(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):ac.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const c=t.headers.get("content-type"),d=(a=c==null?void 0:c.split(";")[0])===null||a===void 0?void 0:a.trim();return(d==null?void 0:d.includes("application/json"))||(d==null?void 0:d.endsWith("+json"))?await t.json():await t.text()})();return us(n).debug(`[${s}] response parsed`,ia({retryOfRequestLogID:i,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Fb extends Promise{constructor(e,t,s=FF){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=s,this.client=e}_thenUnwrap(e){return new Fb(this.client,this.responsePromise,async(t,s)=>e(await this.parseResponse(t,s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ZS=Symbol("brand.privateNullableHeaders");function*jF(n){if(!n)return;if(ZS in n){const{values:s,nulls:i}=n;yield*s.entries();for(const r of i)yield[r,null];return}let e=!1,t;n instanceof Headers?t=n.entries():c_(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const i=s[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=c_(s[1])?s[1]:[s[1]];let o=!1;for(const a of r)a!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,a])}}const xu=n=>{const e=new Headers,t=new Set;for(const s of n){const i=new Set;for(const[r,o]of jF(s)){const a=r.toLowerCase();i.has(a)||(e.delete(r),i.add(a)),o===null?(e.delete(r),t.add(a)):(e.append(r,o),t.delete(a))}}return{[ZS]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const A0=n=>{var e,t,s,i,r,o;if(typeof globalThis.process<"u")return(s=(t=(e=cP)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&s!==void 0?s:void 0;if(typeof globalThis.Deno<"u")return(o=(r=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||r===void 0?void 0:r.call(i,n))===null||o===void 0?void 0:o.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var eC;class e0{constructor(e){var t,s,i,r,o,a,c,{baseURL:d=A0("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:u=(t=A0("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:m="v1beta"}=e,p=ng(e,["baseURL","apiKey","apiVersion"]);const y=Object.assign(Object.assign({apiKey:u,apiVersion:m},p),{baseURL:d||"https://generativelanguage.googleapis.com"});this.baseURL=y.baseURL,this.timeout=(s=y.timeout)!==null&&s!==void 0?s:e0.DEFAULT_TIMEOUT,this.logger=(i=y.logger)!==null&&i!==void 0?i:console;const v="warn";this.logLevel=v,this.logLevel=(o=(r=p_(y.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:p_(A0("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:v,this.fetchOptions=y.fetchOptions,this.maxRetries=(a=y.maxRetries)!==null&&a!==void 0?a:2,this.fetch=(c=y.fetch)!==null&&c!==void 0?c:yF(),this.encoder=vF,this._options=y,this.apiKey=u,this.apiVersion=m,this.clientAdapter=y.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=xu([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return xu([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return xu([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new An(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Xl}`}defaultIdempotencyKey(){return`stainless-node-retry-${nF()}`}makeStatusError(e,t,s,i){return bs.generate(e,t,s,i)}buildURL(e,t,s){const i=!this.baseURLOverridden()&&s||this.baseURL,r=rF(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return lF(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(i=>Object.assign({method:e,path:t},i)))}request(e,t=null){return new Fb(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var i,r,o;const a=await e,c=(i=a.maxRetries)!==null&&i!==void 0?i:this.maxRetries;t==null&&(t=c),await this.prepareOptions(a);const{req:d,url:u,timeout:m}=await this.buildRequest(a,{retryCount:c-t});await this.prepareRequest(d,{url:u,options:a});const p="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),y=s===void 0?"":`, retryOf: ${s}`,v=Date.now();if(us(this).debug(`[${p}] sending request`,ia({retryOfRequestLogID:s,method:a.method,url:u,options:a,headers:d.headers})),!((r=a.signal)===null||r===void 0)&&r.aborted)throw new Ry;const x=new AbortController,b=await this.fetchWithTimeout(u,d,m,x).catch(Py),w=Date.now();if(b instanceof globalThis.Error){const A=`retrying, ${t} attempts remaining`;if(!((o=a.signal)===null||o===void 0)&&o.aborted)throw new Ry;const k=Iy(b)||/timed? ?out/i.test(String(b)+("cause"in b?String(b.cause):""));if(t)return us(this).info(`[${p}] connection ${k?"timed out":"failed"} - ${A}`),us(this).debug(`[${p}] connection ${k?"timed out":"failed"} (${A})`,ia({retryOfRequestLogID:s,url:u,durationMs:w-v,message:b.message})),this.retryRequest(a,t,s??p);throw us(this).info(`[${p}] connection ${k?"timed out":"failed"} - error; no more retries left`),us(this).debug(`[${p}] connection ${k?"timed out":"failed"} (error; no more retries left)`,ia({retryOfRequestLogID:s,url:u,durationMs:w-v,message:b.message})),k?new FS:new Qg({cause:b})}const S=`[${p}${y}] ${d.method} ${u} ${b.ok?"succeeded":"failed"} with status ${b.status} in ${w-v}ms`;if(!b.ok){const A=await this.shouldRetry(b);if(t&&A){const P=`retrying, ${t} attempts remaining`;return await bF(b.body),us(this).info(`${S} - ${P}`),us(this).debug(`[${p}] response error (${P})`,ia({retryOfRequestLogID:s,url:b.url,status:b.status,headers:b.headers,durationMs:w-v})),this.retryRequest(a,t,s??p,b.headers)}const k=A?"error; no more retries left":"error; not retryable";us(this).info(`${S} - ${k}`);const T=await b.text().catch(P=>Py(P).message),N=uF(T),I=N?void 0:T;throw us(this).debug(`[${p}] response error (${k})`,ia({retryOfRequestLogID:s,url:b.url,status:b.status,headers:b.headers,message:I,durationMs:Date.now()-v})),this.makeStatusError(b.status,N,I,b.headers)}return us(this).info(S),us(this).debug(`[${p}] response start`,ia({retryOfRequestLogID:s,url:b.url,status:b.status,headers:b.headers,durationMs:w-v})),{response:b,options:a,controller:x,requestLogID:p,retryOfRequestLogID:s,startTime:v}}async fetchWithTimeout(e,t,s,i){const r=t||{},{signal:o,method:a}=r,c=ng(r,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());const d=setTimeout(()=>i.abort(),s),u=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,m=Object.assign(Object.assign(Object.assign({signal:i.signal},u?{duplex:"half"}:{}),{method:"GET"}),c);a&&(m.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,m)}finally{clearTimeout(d)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,i){var r;let o;const a=i==null?void 0:i.get("retry-after-ms");if(a){const d=parseFloat(a);Number.isNaN(d)||(o=d)}const c=i==null?void 0:i.get("retry-after");if(c&&!o){const d=parseFloat(c);Number.isNaN(d)?o=Date.parse(c)-Date.now():o=d*1e3}if(!(o&&0<=o&&o<60*1e3)){const d=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,d)}return await hF(o),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,o=Math.min(.5*Math.pow(2,r),8),a=1-Math.random()*.25;return o*a*1e3}async buildRequest(e,{retryCount:t=0}={}){var s,i,r;const o=Object.assign({},e),{method:a,path:c,query:d,defaultBaseURL:u}=o,m=this.buildURL(c,d,u);"timeout"in o&&dF("timeout",o.timeout),o.timeout=(s=o.timeout)!==null&&s!==void 0?s:this.timeout;const{bodyHeaders:p,body:y}=this.buildBody({options:o}),v=await this.buildHeaders({options:e,method:a,bodyHeaders:p,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:a,headers:v},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&y instanceof globalThis.ReadableStream&&{duplex:"half"}),y&&{body:y}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:m,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:i}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=await this.authHeaders(e);let a=xu([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),gF()),this._options.defaultHeaders,s,e.headers,o]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=xu([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:xF(e)}:this.encoder({body:e,headers:s})}}e0.DEFAULT_TIMEOUT=6e4;class Ot extends e0{constructor(){super(...arguments),this.interactions=new QS(this)}}eC=Ot;Ot.GeminiNextGenAPIClient=eC;Ot.GeminiNextGenAPIClientError=An;Ot.APIError=bs;Ot.APIConnectionError=Qg;Ot.APIConnectionTimeoutError=FS;Ot.APIUserAbortError=Ry;Ot.NotFoundError=BS;Ot.ConflictError=HS;Ot.RateLimitError=qS;Ot.BadRequestError=jS;Ot.AuthenticationError=OS;Ot.InternalServerError=VS;Ot.PermissionDeniedError=US;Ot.UnprocessableEntityError=GS;Ot.toFile=CF;Ot.Interactions=QS;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function OF(n,e){const t={},s=f(n,["name"]);return s!=null&&g(t,["_url","name"],s),t}function UF(n,e){const t={},s=f(n,["name"]);return s!=null&&g(t,["_url","name"],s),t}function BF(n,e){const t={},s=f(n,["sdkHttpResponse"]);return s!=null&&g(t,["sdkHttpResponse"],s),t}function HF(n,e){const t={},s=f(n,["sdkHttpResponse"]);return s!=null&&g(t,["sdkHttpResponse"],s),t}function GF(n,e,t){const s={};if(f(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=f(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&g(e,["displayName"],i),f(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=f(n,["epochCount"]);e!==void 0&&r!=null&&g(e,["tuningTask","hyperparameters","epochCount"],r);const o=f(n,["learningRateMultiplier"]);if(o!=null&&g(s,["tuningTask","hyperparameters","learningRateMultiplier"],o),f(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(f(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(f(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const a=f(n,["batchSize"]);e!==void 0&&a!=null&&g(e,["tuningTask","hyperparameters","batchSize"],a);const c=f(n,["learningRate"]);if(e!==void 0&&c!=null&&g(e,["tuningTask","hyperparameters","learningRate"],c),f(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(f(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function qF(n,e,t){const s={};let i=f(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const y=f(n,["validationDataset"]);e!==void 0&&y!=null&&g(e,["supervisedTuningSpec"],g_(y))}else if(i==="PREFERENCE_TUNING"){const y=f(n,["validationDataset"]);e!==void 0&&y!=null&&g(e,["preferenceOptimizationSpec"],g_(y))}const r=f(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&g(e,["tunedModelDisplayName"],r);const o=f(n,["description"]);e!==void 0&&o!=null&&g(e,["description"],o);let a=f(t,["config","method"]);if(a===void 0&&(a="SUPERVISED_FINE_TUNING"),a==="SUPERVISED_FINE_TUNING"){const y=f(n,["epochCount"]);e!==void 0&&y!=null&&g(e,["supervisedTuningSpec","hyperParameters","epochCount"],y)}else if(a==="PREFERENCE_TUNING"){const y=f(n,["epochCount"]);e!==void 0&&y!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],y)}let c=f(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const y=f(n,["learningRateMultiplier"]);e!==void 0&&y!=null&&g(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],y)}else if(c==="PREFERENCE_TUNING"){const y=f(n,["learningRateMultiplier"]);e!==void 0&&y!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],y)}let d=f(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const y=f(n,["exportLastCheckpointOnly"]);e!==void 0&&y!=null&&g(e,["supervisedTuningSpec","exportLastCheckpointOnly"],y)}else if(d==="PREFERENCE_TUNING"){const y=f(n,["exportLastCheckpointOnly"]);e!==void 0&&y!=null&&g(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],y)}let u=f(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const y=f(n,["adapterSize"]);e!==void 0&&y!=null&&g(e,["supervisedTuningSpec","hyperParameters","adapterSize"],y)}else if(u==="PREFERENCE_TUNING"){const y=f(n,["adapterSize"]);e!==void 0&&y!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],y)}if(f(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(f(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const m=f(n,["labels"]);e!==void 0&&m!=null&&g(e,["labels"],m);const p=f(n,["beta"]);return e!==void 0&&p!=null&&g(e,["preferenceOptimizationSpec","hyperParameters","beta"],p),s}function VF(n,e){const t={},s=f(n,["baseModel"]);s!=null&&g(t,["baseModel"],s);const i=f(n,["preTunedModel"]);i!=null&&g(t,["preTunedModel"],i);const r=f(n,["trainingDataset"]);r!=null&&tj(r);const o=f(n,["config"]);return o!=null&&GF(o,t),t}function $F(n,e){const t={},s=f(n,["baseModel"]);s!=null&&g(t,["baseModel"],s);const i=f(n,["preTunedModel"]);i!=null&&g(t,["preTunedModel"],i);const r=f(n,["trainingDataset"]);r!=null&&sj(r,t,e);const o=f(n,["config"]);return o!=null&&qF(o,t,e),t}function zF(n,e){const t={},s=f(n,["name"]);return s!=null&&g(t,["_url","name"],s),t}function WF(n,e){const t={},s=f(n,["name"]);return s!=null&&g(t,["_url","name"],s),t}function KF(n,e,t){const s={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&g(e,["_query","pageSize"],i);const r=f(n,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);const o=f(n,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),s}function YF(n,e,t){const s={},i=f(n,["pageSize"]);e!==void 0&&i!=null&&g(e,["_query","pageSize"],i);const r=f(n,["pageToken"]);e!==void 0&&r!=null&&g(e,["_query","pageToken"],r);const o=f(n,["filter"]);return e!==void 0&&o!=null&&g(e,["_query","filter"],o),s}function JF(n,e){const t={},s=f(n,["config"]);return s!=null&&KF(s,t),t}function XF(n,e){const t={},s=f(n,["config"]);return s!=null&&YF(s,t),t}function QF(n,e){const t={},s=f(n,["sdkHttpResponse"]);s!=null&&g(t,["sdkHttpResponse"],s);const i=f(n,["nextPageToken"]);i!=null&&g(t,["nextPageToken"],i);const r=f(n,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>tC(a))),g(t,["tuningJobs"],o)}return t}function ZF(n,e){const t={},s=f(n,["sdkHttpResponse"]);s!=null&&g(t,["sdkHttpResponse"],s);const i=f(n,["nextPageToken"]);i!=null&&g(t,["nextPageToken"],i);const r=f(n,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(a=>Ly(a))),g(t,["tuningJobs"],o)}return t}function ej(n,e){const t={},s=f(n,["name"]);s!=null&&g(t,["model"],s);const i=f(n,["name"]);return i!=null&&g(t,["endpoint"],i),t}function tj(n,e){const t={};if(f(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(f(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=f(n,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),g(t,["examples","examples"],i)}return t}function sj(n,e,t){const s={};let i=f(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const o=f(n,["gcsUri"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){const o=f(n,["gcsUri"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=f(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const o=f(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){const o=f(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&g(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(f(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function tC(n,e){const t={},s=f(n,["sdkHttpResponse"]);s!=null&&g(t,["sdkHttpResponse"],s);const i=f(n,["name"]);i!=null&&g(t,["name"],i);const r=f(n,["state"]);r!=null&&g(t,["state"],yS(r));const o=f(n,["createTime"]);o!=null&&g(t,["createTime"],o);const a=f(n,["tuningTask","startTime"]);a!=null&&g(t,["startTime"],a);const c=f(n,["tuningTask","completeTime"]);c!=null&&g(t,["endTime"],c);const d=f(n,["updateTime"]);d!=null&&g(t,["updateTime"],d);const u=f(n,["description"]);u!=null&&g(t,["description"],u);const m=f(n,["baseModel"]);m!=null&&g(t,["baseModel"],m);const p=f(n,["_self"]);return p!=null&&g(t,["tunedModel"],ej(p)),t}function Ly(n,e){const t={},s=f(n,["sdkHttpResponse"]);s!=null&&g(t,["sdkHttpResponse"],s);const i=f(n,["name"]);i!=null&&g(t,["name"],i);const r=f(n,["state"]);r!=null&&g(t,["state"],yS(r));const o=f(n,["createTime"]);o!=null&&g(t,["createTime"],o);const a=f(n,["startTime"]);a!=null&&g(t,["startTime"],a);const c=f(n,["endTime"]);c!=null&&g(t,["endTime"],c);const d=f(n,["updateTime"]);d!=null&&g(t,["updateTime"],d);const u=f(n,["error"]);u!=null&&g(t,["error"],u);const m=f(n,["description"]);m!=null&&g(t,["description"],m);const p=f(n,["baseModel"]);p!=null&&g(t,["baseModel"],p);const y=f(n,["tunedModel"]);y!=null&&g(t,["tunedModel"],y);const v=f(n,["preTunedModel"]);v!=null&&g(t,["preTunedModel"],v);const x=f(n,["supervisedTuningSpec"]);x!=null&&g(t,["supervisedTuningSpec"],x);const b=f(n,["preferenceOptimizationSpec"]);b!=null&&g(t,["preferenceOptimizationSpec"],b);const w=f(n,["tuningDataStats"]);w!=null&&g(t,["tuningDataStats"],w);const S=f(n,["encryptionSpec"]);S!=null&&g(t,["encryptionSpec"],S);const A=f(n,["partnerModelTuningSpec"]);A!=null&&g(t,["partnerModelTuningSpec"],A);const k=f(n,["customBaseModel"]);k!=null&&g(t,["customBaseModel"],k);const T=f(n,["experiment"]);T!=null&&g(t,["experiment"],T);const N=f(n,["labels"]);N!=null&&g(t,["labels"],N);const I=f(n,["outputUri"]);I!=null&&g(t,["outputUri"],I);const D=f(n,["pipelineJob"]);D!=null&&g(t,["pipelineJob"],D);const P=f(n,["serviceAccount"]);P!=null&&g(t,["serviceAccount"],P);const R=f(n,["tunedModelDisplayName"]);R!=null&&g(t,["tunedModelDisplayName"],R);const j=f(n,["veoTuningSpec"]);return j!=null&&g(t,["veoTuningSpec"],j),t}function nj(n,e){const t={},s=f(n,["sdkHttpResponse"]);s!=null&&g(t,["sdkHttpResponse"],s);const i=f(n,["name"]);i!=null&&g(t,["name"],i);const r=f(n,["metadata"]);r!=null&&g(t,["metadata"],r);const o=f(n,["done"]);o!=null&&g(t,["done"],o);const a=f(n,["error"]);return a!=null&&g(t,["error"],a),t}function g_(n,e){const t={},s=f(n,["gcsUri"]);s!=null&&g(t,["validationDatasetUri"],s);const i=f(n,["vertexDatasetResource"]);return i!=null&&g(t,["validationDatasetUri"],i),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ij extends Hr{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new ql(jr.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var s;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const i={tunedModelName:t.baseModel};!((s=t.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},t);return await this.tuneInternal(i)}else{const i=Object.assign({},t),r=await this.tuneMldevInternal(i);let o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:Ay.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=WF(e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>Ly(u))}else{const d=zF(e);return a=Q("{name}",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>tC(u))}}async listInternal(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=XF(e);return a=Q("tuningJobs",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=ZF(u),p=new Gw;return Object.assign(p,m),p})}else{const d=JF(e);return a=Q("tunedModels",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=QF(u),p=new Gw;return Object.assign(p,m),p})}}async cancel(e){var t,s,i,r;let o,a="",c={};if(this.apiClient.isVertexAI()){const d=UF(e);return a=Q("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=HF(u),p=new qw;return Object.assign(p,m),p})}else{const d=OF(e);return a=Q("{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,o=this.apiClient.request({path:a,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json().then(m=>{const p=m;return p.sdkHttpResponse={headers:u.headers},p})),o.then(u=>{const m=BF(u),p=new qw;return Object.assign(p,m),p})}}async tuneInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const a=$F(e,e);return r=Q("tuningJobs",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>Ly(c))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=VF(e);return r=Q("tunedModels",a._url),o=a._query,delete a._url,delete a._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(a),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json().then(d=>{const u=d;return u.sdkHttpResponse={headers:c.headers},u})),i.then(c=>nj(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rj{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const oj=1024*1024*8,aj=3,lj=1e3,cj=2,rg="x-goog-upload-status";async function dj(n,e,t){var s;const i=await sC(n,e,t),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[rg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function uj(n,e,t){var s;const i=await sC(n,e,t),r=await(i==null?void 0:i.json());if(((s=i==null?void 0:i.headers)===null||s===void 0?void 0:s[rg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const o=uS(r),a=new Nb;return Object.assign(a,o),a}async function sC(n,e,t){var s,i;let r=0,o=0,a=new Sy(new Response),c="upload";for(r=n.size;o<r;){const d=Math.min(oj,r-o),u=n.slice(o,o+d);o+d>=r&&(c+=", finalize");let m=0,p=lj;for(;m<aj&&(a=await t.request({path:"",body:u,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(o),"Content-Length":String(d)}}}),!(!((s=a==null?void 0:a.headers)===null||s===void 0)&&s[rg]));)m++,await fj(p),p=p*cj;if(o+=d,((i=a==null?void 0:a.headers)===null||i===void 0?void 0:i[rg])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function hj(n){return{size:n.size,type:n.type}}function fj(n){return new Promise(e=>setTimeout(e,n))}class pj{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await dj(e,t,s)}async uploadToFileSearchStore(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await uj(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await hj(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class mj{create(e,t,s){return new gj(e,t,s)}}class gj{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const y_="x-goog-api-key";class yj{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(y_)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(y_,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const xj="gl-node/";class bj{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e!=null&&e.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new Ot({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e==null?void 0:e.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=fP(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new yj(this.apiKey);this.apiClient=new hL({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:xj+"web",uploader:new pj,downloader:new rj}),this.models=new PL(this.apiClient),this.live=new CL(this.apiClient,i,new mj),this.batches=new GR(this.apiClient),this.chats=new AM(this.models,this.apiClient),this.caches=new vM(this.apiClient),this.files=new MM(this.apiClient),this.operations=new RL(this.apiClient),this.authTokens=new KL(this.apiClient),this.tunings=new ij(this.apiClient),this.fileSearchStores=new sF(this.apiClient)}}const nC=n=>{const e=n||void 0;return e?new bj({apiKey:e}):null},vj=async(n,e)=>{if(console.log("Generating Portfolio Summary. Supabase available:",!!z,"Manual API Key provided:",!!e),z&&!e)try{console.log("[Portfolio] Using Direct Fetch for Proxy...");const o=`${Hg}/functions/v1/gemini-proxy`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tu}`,apikey:tu},body:JSON.stringify({action:"portfolio",payload:{tasks:n}})});if(!a.ok){const d=await a.json().catch(()=>({}));throw console.error("[Portfolio] Proxy Error Details:",d),new Error(d.error||`Proxy error ${a.status}`)}const c=await a.json();return console.log("[Portfolio] Proxy Success! Received result."),c.result}catch(o){console.error("[Portfolio] Secure proxy FETCH FAILED:",o.message||o)}const t=nC(e);if(!t)throw new Error("API Key missing. Please configure it in Admin Settings.");const r=`
    You are helping an FTC Robotics team (high school students) write their Engineering Portfolio summary.
    Write in a casual, enthusiastic voice that sounds like it was actually written BY high school students.
    Use natural student phrases like "we figured out", "it was super cool when", "our team decided", "the hardest part was", "we were really proud of".
    Avoid corporate jargon or overly formal language - keep it authentic and passionate.
    Still highlight technical achievements and problem-solving, but make it sound like excited students explaining their work to judges.
    Format the output as a bulleted Markdown summary.
    
    IMPORTANT: Only use information that is explicitly provided in the tasks below. Do NOT make up, infer, or fabricate any details that are not documented.
    If there is insufficient data to write a comprehensive summary, acknowledge this and only describe what you can determine from the documented tasks.
    If there are no tasks or very few tasks, simply state that more documentation is needed and list only what was actually completed.
    
    Tasks completed this season:
    ${n.filter(o=>o.status==="Done").map(o=>{var a;return`- ${o.title} (${o.type}): ${o.description}. Tags: ${((a=o.tags)==null?void 0:a.join(", "))||""}`}).join(`
`)||"No tasks have been documented yet."}
  `;try{return(await t.models.generateContent({model:"gemini-1.5-flash",contents:r})).text||"Could not generate summary."}catch{throw new Error("AI Generation failed. Check API Key or limit.")}},wj=async(n,e,t)=>{if(z&&!t)try{console.log("[Questions] Using Direct Fetch for Proxy...");const o=`${Hg}/functions/v1/gemini-proxy`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tu}`,apikey:tu},body:JSON.stringify({action:"questions",payload:{context:n,studyGuide:e}})});if(!a.ok)throw new Error(`Proxy error ${a.status}`);const c=await a.json();console.log("[Questions] Proxy Success!");let d=c.result;const u=d.indexOf("{"),m=d.lastIndexOf("}");return u!==-1&&m!==-1&&(d=d.substring(u,m+1)),JSON.parse(d).questions||[]}catch(o){console.error("[Questions] Secure proxy FETCH FAILED:",o.message||o)}const s=nC(t);if(!s)throw new Error("API Key missing. Please configure it in Admin Settings.");const i=`
    Create 5 potential judge interview questions and answers for an FTC Robotics team.
    Base the questions on the provided context about the team's season and robot.
    Return the response as a JSON object with a list of "questions" (each with "question" and "answer" keys).
    
    Context: ${n}
    Study Guide: ${e||"None"}
  `,r=await s.models.generateContent({model:"gemini-1.5-flash",contents:i});try{const o=(r.text||"").replace(/```json|```/g,"").trim();return JSON.parse(o).questions||[]}catch(o){return console.error("Failed to parse AI response",o),[]}},hs=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Fy=[.001,0,0,.001,0,0],S0=1.35,Js={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Xr={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},yh="pdfjs_internal_editor_",ge={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Ee={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},_j={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},jy={TRIANGLES:1,LATTICE:2},_t={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},lm={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},xt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ql={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t0={ERRORS:0,WARNINGS:1,INFOS:5},xh={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},bu={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Aj={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let s0=t0.WARNINGS;function Sj(n){Number.isInteger(n)&&(s0=n)}function Cj(){return s0}function n0(n){s0>=t0.INFOS&&console.info(`Info: ${n}`)}function fe(n){s0>=t0.WARNINGS&&console.warn(`Warning: ${n}`)}function ze(n){throw new Error(n)}function ke(n,e){n||ze(e)}function Ej(n){switch(n==null?void 0:n.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function iC(n,e=null,t=null){if(!n)return null;if(t&&typeof n=="string"){if(t.addDefaultProtocol&&n.startsWith("www.")){const i=n.match(/\./g);(i==null?void 0:i.length)>=2&&(n=`http://${n}`)}if(t.tryConvertEncoding)try{n=Pj(n)}catch{}}const s=e?URL.parse(n,e):URL.parse(n);return Ej(s)?s:null}function rC(n,e,t=!1){const s=URL.parse(n);return s?(s.hash=e,s.href):t&&iC(n,"http://example.com")?n.split("#",1)[0]+`${e?`#${e}`:""}`:""}function pe(n,e,t,s=!1){return Object.defineProperty(n,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const Vl=function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e}();class x_ extends Vl{constructor(e,t){super(e,"PasswordException"),this.code=t}}class C0 extends Vl{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Oy extends Vl{constructor(e){super(e,"InvalidPDFException")}}class og extends Vl{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class kj extends Vl{constructor(e){super(e,"FormatError")}}class Zo extends Vl{constructor(e){super(e,"AbortException")}}function oC(n){(typeof n!="object"||(n==null?void 0:n.length)===void 0)&&ze("Invalid argument for bytesToString");const e=n.length,t=8192;if(e<t)return String.fromCharCode.apply(null,n);const s=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=n.subarray(i,r);s.push(String.fromCharCode.apply(null,o))}return s.join("")}function bp(n){typeof n!="string"&&ze("Invalid argument for stringToBytes");const e=n.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=n.charCodeAt(s)&255;return t}function Tj(n){return String.fromCharCode(n>>24&255,n>>16&255,n>>8&255,n&255)}function Nj(){const n=new Uint8Array(4);return n[0]=1,new Uint32Array(n.buffer,0,1)[0]===1}function Ij(){try{return new Function(""),!0}catch{return!1}}class Tt{static get isLittleEndian(){return pe(this,"isLittleEndian",Nj())}static get isEvalSupported(){return pe(this,"isEvalSupported",Ij())}static get isOffscreenCanvasSupported(){return pe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return pe(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return pe(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return pe(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return pe(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return pe(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const E0=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0"));var Mr,cm,Uy;class Z{static makeHexColor(e,t,s){return`#${E0[e]}${E0[t]}${E0[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const i=e[s],r=e[s+1];e[s]=i*t[0]+r*t[2]+t[4],e[s+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const i=t[0],r=t[1],o=t[2],a=t[3],c=t[4],d=t[5];for(let u=0;u<6;u+=2){const m=e[s+u],p=e[s+u+1];e[s+u]=m*i+p*o+c,e[s+u+1]=m*r+p*a+d}}static applyInverseTransform(e,t){const s=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-s*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,s){const i=t[0],r=t[1],o=t[2],a=t[3],c=t[4],d=t[5],u=e[0],m=e[1],p=e[2],y=e[3];let v=i*u+c,x=v,b=i*p+c,w=b,S=a*m+d,A=S,k=a*y+d,T=k;if(r!==0||o!==0){const N=r*u,I=r*p,D=o*m,P=o*y;v+=D,w+=D,b+=P,x+=P,S+=N,T+=N,k+=I,A+=I}s[0]=Math.min(s[0],v,b,x,w),s[1]=Math.min(s[1],S,k,A,T),s[2]=Math.max(s[2],v,b,x,w),s[3]=Math.max(s[3],S,k,A,T)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],i=e[1],r=e[2],o=e[3],a=s**2+i**2,c=s*r+i*o,d=r**2+o**2,u=(a+d)/2,m=Math.sqrt(u**2-(a*d-c**2));t[0]=Math.sqrt(u+m||1),t[1]=Math.sqrt(u-m||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[s,r,i,o]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,i,r){r[0]=Math.min(r[0],e,s),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,s),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,s,i,r,o,a,c,d){d[0]=Math.min(d[0],e,a),d[1]=Math.min(d[1],t,c),d[2]=Math.max(d[2],e,a),d[3]=Math.max(d[3],t,c),E(this,Mr,Uy).call(this,e,s,r,a,t,i,o,c,3*(-e+3*(s-r)+a),6*(e-2*s+r),3*(s-e),d),E(this,Mr,Uy).call(this,e,s,r,a,t,i,o,c,3*(-t+3*(i-o)+c),6*(t-2*i+o),3*(i-t),d)}}Mr=new WeakSet,cm=function(e,t,s,i,r,o,a,c,d,u){if(d<=0||d>=1)return;const m=1-d,p=d*d,y=p*d,v=m*(m*(m*e+3*d*t)+3*p*s)+y*i,x=m*(m*(m*r+3*d*o)+3*p*a)+y*c;u[0]=Math.min(u[0],v),u[1]=Math.min(u[1],x),u[2]=Math.max(u[2],v),u[3]=Math.max(u[3],x)},Uy=function(e,t,s,i,r,o,a,c,d,u,m,p){if(Math.abs(d)<1e-12){Math.abs(u)>=1e-12&&E(this,Mr,cm).call(this,e,t,s,i,r,o,a,c,-m/u,p);return}const y=u**2-4*m*d;if(y<0)return;const v=Math.sqrt(y),x=2*d;E(this,Mr,cm).call(this,e,t,s,i,r,o,a,c,(-u+v)/x,p),E(this,Mr,cm).call(this,e,t,s,i,r,o,a,c,(-u-v)/x,p)},C(Z,Mr);function Pj(n){return decodeURIComponent(escape(n))}let k0=null,b_=null;function Rj(n){return k0||(k0=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,b_=new Map([["ï¬","Å¿t"]])),n.replaceAll(k0,(e,t,s)=>t?t.normalize("NFKC"):b_.get(s))}function aC(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const n=new Uint8Array(32);return crypto.getRandomValues(n),oC(n)}const lc="pdfjs_internal_id_";function Mj(n,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,i,...r]=t;if(!n(s)&&!Number.isInteger(s)||!e(i))return!1;const o=r.length;let a=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;a=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||a&&c===null))return!1;return!0}function fs(n,e,t){return Math.min(Math.max(n,e),t)}function lC(n){return Uint8Array.prototype.toBase64?n.toBase64():btoa(oC(n))}function Dj(n){return Uint8Array.fromBase64?Uint8Array.fromBase64(n):bp(atob(n))}typeof Promise.try!="function"&&(Promise.try=function(n,...e){return new Promise(t=>{t(n(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(n){return n.reduce((e,t)=>e+t,0)});class bh{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function i(r){var c;if(!r)return;let o=null;const a=r.name;if(a==="#text")o=r.value;else if(bh.shouldBuildText(a))(c=r==null?void 0:r.attributes)!=null&&c.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const d of r.children)i(d)}return i(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class cC{static setupStorage(e,t,s,i,r){const o=i.getValue(t,{value:null});switch(s.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(o.value===s.attributes.xfaOn?e.setAttribute("checked",!0):o.value===s.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",a=>{i.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",a=>{i.setValue(t,{value:a.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const a of s.children)a.attributes.value===o.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const c=a.target.options,d=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(t,{value:d})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:i,linkService:r}){const{attributes:o}=t,a=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[c,d]of Object.entries(o))if(d!=null)switch(c){case"class":d.length&&e.setAttribute(c,d.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",d);break;case"style":Object.assign(e.style,d);break;case"textContent":e.textContent=d;break;default:(!a||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,d)}a&&r.addLinkAttributes(e,o.href,o.newWindow),s&&o.dataId&&this.setupStorage(e,o.dataId,t,s)}static render(e){var m,p;const t=e.annotationStorage,s=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:s});const a=r!=="richText",c=e.div;if(c.append(o),e.viewport){const y=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=y}a&&c.setAttribute("class","xfaLayer xfaFont");const d=[];if(i.children.length===0){if(i.value){const y=document.createTextNode(i.value);o.append(y),a&&bh.shouldBuildText(i.name)&&d.push(y)}return{textDivs:d}}const u=[[i,-1,o]];for(;u.length>0;){const[y,v,x]=u.at(-1);if(v+1===y.children.length){u.pop();continue}const b=y.children[++u.at(-1)[1]];if(b===null)continue;const{name:w}=b;if(w==="#text"){const A=document.createTextNode(b.value);d.push(A),x.append(A);continue}const S=(m=b==null?void 0:b.attributes)!=null&&m.xmlns?document.createElementNS(b.attributes.xmlns,w):document.createElement(w);if(x.append(S),b.attributes&&this.setAttributes({html:S,element:b,storage:t,intent:r,linkService:s}),((p=b.children)==null?void 0:p.length)>0)u.push([b,-1,S]);else if(b.value){const A=document.createTextNode(b.value);a&&bh.shouldBuildText(w)&&d.push(A),S.append(A)}}for(const y of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:d}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ui="http://www.w3.org/2000/svg",la=class la{};W(la,"CSS",96),W(la,"PDF",72),W(la,"PDF_TO_CSS_UNITS",la.CSS/la.PDF);let ea=la;async function vp(n,e="text"){if(Nu(n,document.baseURI)){const t=await fetch(n);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class wp{constructor({viewBox:e,userUnit:t,scale:s,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=i,this.offsetX=r,this.offsetY=o,s*=t;const c=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let u,m,p,y;switch(i%=360,i<0&&(i+=360),i){case 180:u=-1,m=0,p=0,y=1;break;case 90:u=0,m=1,p=1,y=0;break;case 270:u=0,m=-1,p=-1,y=0;break;case 0:u=1,m=0,p=0,y=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(p=-p,y=-y);let v,x,b,w;u===0?(v=Math.abs(d-e[1])*s+r,x=Math.abs(c-e[0])*s+o,b=(e[3]-e[1])*s,w=(e[2]-e[0])*s):(v=Math.abs(c-e[0])*s+r,x=Math.abs(d-e[1])*s+o,b=(e[2]-e[0])*s,w=(e[3]-e[1])*s),this.transform=[u*s,m*s,p*s,y*s,v-u*s*c-p*s*d,x-m*s*c-y*s*d],this.width=b,this.height=w}get rawDims(){const e=this.viewBox;return pe(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new wp({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const s=[e,t];return Z.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];Z.applyTransform(t,this.transform);const s=[e[2],e[3]];return Z.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return Z.applyInverseTransform(s,this.transform),s}}class jb extends Vl{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function i0(n){const e=n.length;let t=0;for(;t<e&&n[t].trim()==="";)t++;return n.substring(t,t+5).toLowerCase()==="data:"}function Ob(n){return typeof n=="string"&&/\.pdf$/i.test(n)}function Lj(n){return[n]=n.split(/[#?]/,1),n.substring(n.lastIndexOf("/")+1)}function Fj(n,e="document.pdf"){if(typeof n!="string")return e;if(i0(n))return fe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(n);if(!s)return e;const i=a=>{try{let c=decodeURIComponent(a);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:a):c}catch{return a}},r=/\.pdf$/i,o=s.pathname.split("/").at(-1);if(r.test(o))return i(o);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const d of a)if(r.test(d))return i(d);const c=Array.from(s.searchParams.keys()).reverse();for(const d of c)if(r.test(d))return i(d)}if(s.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(c)return i(c[0])}return e}class v_{constructor(){W(this,"started",Object.create(null));W(this,"times",[])}time(e){e in this.started&&fe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||fe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:i,end:r}of this.times)e.push(`${s.padEnd(t)} ${r-i}ms
`);return e.join("")}}function Nu(n,e){const t=e?URL.parse(n,e):URL.parse(n);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Sn(n){n.preventDefault()}function ft(n){n.preventDefault(),n.stopPropagation()}function jj(n){console.log("Deprecated API usage: "+n)}var Ch;class ag{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;l(this,Ch)||_(this,Ch,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=l(this,Ch).exec(e);if(!t)return null;const s=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const d=t[7]||"Z";let u=parseInt(t[8],10);u=u>=0&&u<=23?u:0;let m=parseInt(t[9],10)||0;return m=m>=0&&m<=59?m:0,d==="-"?(o+=u,a+=m):d==="+"&&(o-=u,a-=m),new Date(Date.UTC(s,i,r,o,a,c))}}Ch=new WeakMap,C(ag,Ch);function Oj(n,{scale:e=1,rotation:t=0}){const{width:s,height:i}=n.attributes.style,r=[0,0,parseInt(s),parseInt(i)];return new wp({viewBox:r,userUnit:1,scale:e,rotation:t})}function _p(n){if(n.startsWith("#")){const e=parseInt(n.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return n.startsWith("rgb(")?n.slice(4,-1).split(",").map(e=>parseInt(e)):n.startsWith("rgba(")?n.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(fe(`Not a valid color format: "${n}"`),[0,0,0])}function Uj(n){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of n.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;n.set(t,_p(s))}e.remove()}function it(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform();return[e,t,s,i,r,o]}function Xn(n){const{a:e,b:t,c:s,d:i,e:r,f:o}=n.getTransform().invertSelf();return[e,t,s,i,r,o]}function Ul(n,e,t=!1,s=!0){if(e instanceof wp){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=n,a=Tt.isCSSRoundSupported,c=`var(--total-scale-factor) * ${i}px`,d=`var(--total-scale-factor) * ${r}px`,u=a?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,m=a?`round(down, ${d}, var(--scale-round-y))`:`calc(${d})`;!t||e.rotation%180===0?(o.width=u,o.height=m):(o.width=m,o.height=u)}s&&n.setAttribute("data-main-rotation",e.rotation)}class Ri{constructor(){const{pixelRatio:e}=Ri;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,i,r=-1){let o=1/0,a=1/0,c=1/0;s=Ri.capPixels(s,r),s>0&&(o=Math.sqrt(s/(e*t))),i!==-1&&(a=i/e,c=i/t);const d=Math.min(o,a,c);return this.sx>d||this.sy>d?(this.sx=d,this.sy=d,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const By=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Bj{static get isDarkMode(){var e;return pe(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class Hj{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),pe(this,"commentForegroundColor",_p(s))}}function Gj(n,e,t,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return n=Math.round(n*s+i),e=Math.round(e*s+i),t=Math.round(t*s+i),[n,e,t]}function w_(n,e){const t=n[0]/255,s=n[1]/255,i=n[2]/255,r=Math.max(t,s,i),o=Math.min(t,s,i),a=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const c=r-o;switch(e[1]=a<.5?c/(r+o):c/(2-r-o),r){case t:e[0]=((s-i)/c+(s<i?6:0))*60;break;case s:e[0]=((i-t)/c+2)*60;break;case i:e[0]=((t-s)/c+4)*60;break}}e[2]=a}function Hy(n,e){const t=n[0],s=n[1],i=n[2],r=(1-Math.abs(2*i-1))*s,o=r*(1-Math.abs(t/60%2-1)),a=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+a,e[1]=o+a,e[2]=a;break;case 1:e[0]=o+a,e[1]=r+a,e[2]=a;break;case 2:e[0]=a,e[1]=r+a,e[2]=o+a;break;case 3:e[0]=a,e[1]=o+a,e[2]=r+a;break;case 4:e[0]=o+a,e[1]=a,e[2]=r+a;break;case 5:case 6:e[0]=r+a,e[1]=a,e[2]=o+a;break}}function __(n){return n<=.03928?n/12.92:((n+.055)/1.055)**2.4}function A_(n,e,t){Hy(n,t),t.map(__);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];Hy(e,t),t.map(__);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const S_=new Map;function qj(n,e){const t=n[0]+n[1]*256+n[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=S_.get(t);if(s)return s;const i=new Float32Array(9),r=i.subarray(0,3),o=i.subarray(3,6);w_(n,o);const a=i.subarray(6,9);w_(e,a);const c=a[2]<.5,d=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),A_(o,a,r)<d){let u,m;c?(u=o[2],m=1):(u=0,m=o[2]);const p=.005;for(;m-u>p;){const y=o[2]=(u+m)/2;c===A_(o,a,r)<d?u=y:m=y}o[2]=c?m:u}return Hy(o,r),s=Z.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),S_.set(t,s),s}function dC({html:n,dir:e,className:t},s){const i=document.createDocumentFragment();if(typeof n=="string"){const r=document.createElement("p");r.dir=e||"auto";const o=n.split(/(?:\r\n?|\n)/);for(let a=0,c=o.length;a<c;++a){const d=o[a];r.append(document.createTextNode(d)),a<c-1&&r.append(document.createElement("br"))}i.append(r)}else cC.render({xfaHtml:n,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",t),s.append(i)}function uC(n){const e=new Path2D;if(!n)return e;for(let t=0,s=n.length;t<s;)switch(n[t++]){case bu.moveTo:e.moveTo(n[t++],n[t++]);break;case bu.lineTo:e.lineTo(n[t++],n[t++]);break;case bu.curveTo:e.bezierCurveTo(n[t++],n[t++],n[t++],n[t++],n[t++],n[t++]);break;case bu.quadraticCurveTo:e.quadraticCurveTo(n[t++],n[t++],n[t++],n[t++]);break;case bu.closePath:e.closePath();break;default:fe(`Unrecognized drawing path operator: ${n[t-1]}`);break}return e}var io,ro,on,an,Eh,oo,Nc,Ic,kh,bg,hC,Kt,fC,pC,Zl,Iu;const Gi=class Gi{constructor(e){C(this,Kt);C(this,io,null);C(this,ro,null);C(this,on);C(this,an,null);C(this,Eh,null);C(this,oo,null);C(this,Nc,null);C(this,Ic,null);_(this,on,e),l(Gi,kh)||_(Gi,kh,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=_(this,io,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=l(this,on)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Sn,{signal:t}),e.addEventListener("pointerdown",E(Gi,bg,hC),{signal:t}));const s=_(this,an,document.createElement("div"));s.className="buttons",e.append(s);const i=l(this,on).toolbarPosition;if(i){const{style:r}=e,o=l(this,on)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return l(this,io)}hide(){var e;l(this,io).classList.add("hidden"),(e=l(this,ro))==null||e.hideDropdown()}show(){var e,t;l(this,io).classList.remove("hidden"),(e=l(this,Eh))==null||e.shown(),(t=l(this,oo))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=l(this,on),s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",l(Gi,kh)[e]),E(this,Kt,Zl).call(this,s)&&s.addEventListener("click",i=>{t.delete()},{signal:t._signal}),l(this,an).append(s)}async addAltText(e){const t=await e.render();E(this,Kt,Zl).call(this,t),l(this,an).append(t,l(this,Kt,Iu)),_(this,Eh,e)}addComment(e,t=null){if(l(this,oo))return;const s=e.renderForToolbar();if(!s)return;E(this,Kt,Zl).call(this,s);const i=_(this,Nc,l(this,Kt,Iu));t?(l(this,an).insertBefore(s,t),l(this,an).insertBefore(i,t)):l(this,an).append(s,i),_(this,oo,e),e.toolbar=this}addColorPicker(e){if(l(this,ro))return;_(this,ro,e);const t=e.renderButton();E(this,Kt,Zl).call(this,t),l(this,an).append(t,l(this,Kt,Iu))}async addEditSignatureButton(e){const t=_(this,Ic,await e.renderEditButton(l(this,on)));E(this,Kt,Zl).call(this,t),l(this,an).append(t,l(this,Kt,Iu))}removeButton(e){var t,s;switch(e){case"comment":(t=l(this,oo))==null||t.removeToolbarCommentButton(),_(this,oo,null),(s=l(this,Nc))==null||s.remove(),_(this,Nc,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,s){if(!t&&e==="comment")return;const i=l(this,an).querySelector(s);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){l(this,Ic)&&(l(this,Ic).title=e)}remove(){var e;l(this,io).remove(),(e=l(this,ro))==null||e.destroy(),_(this,ro,null)}};io=new WeakMap,ro=new WeakMap,on=new WeakMap,an=new WeakMap,Eh=new WeakMap,oo=new WeakMap,Nc=new WeakMap,Ic=new WeakMap,kh=new WeakMap,bg=new WeakSet,hC=function(e){e.stopPropagation()},Kt=new WeakSet,fC=function(e){l(this,on)._focusEventsAllowed=!1,ft(e)},pC=function(e){l(this,on)._focusEventsAllowed=!0,ft(e)},Zl=function(e){const t=l(this,on)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",E(this,Kt,fC).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",E(this,Kt,pC).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Sn,{signal:t}),!0)},Iu=function(){const e=document.createElement("div");return e.className="divider",e},C(Gi,bg),C(Gi,kh,null);let Gy=Gi;var Th,xa,zi,Or,mC,gC,qy;class Vj{constructor(e){C(this,Or);C(this,Th,null);C(this,xa,null);C(this,zi);_(this,zi,e)}show(e,t,s){const[i,r]=E(this,Or,gC).call(this,t,s),{style:o}=l(this,xa)||_(this,xa,E(this,Or,mC).call(this));e.append(l(this,xa)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){l(this,xa).remove()}}Th=new WeakMap,xa=new WeakMap,zi=new WeakMap,Or=new WeakSet,mC=function(){const e=_(this,xa,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=l(this,zi)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Sn,{signal:t});const s=_(this,Th,document.createElement("div"));return s.className="buttons",e.append(s),l(this,zi).hasCommentManager()&&E(this,Or,qy).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{l(this,zi).commentSelection("floating_button")}),E(this,Or,qy).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{l(this,zi).highlightSelection("floating_button")}),e},gC=function(e,t){let s=0,i=0;for(const r of e){const o=r.y+r.height;if(o<s)continue;const a=r.x+(t?r.width:0);if(o>s){i=a,s=o;continue}t?a>i&&(i=a):a<i&&(i=a)}return[t?1-i:i,s]},qy=function(e,t,s,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",s);const a=l(this,zi)._signal;a instanceof AbortSignal&&!a.aborted&&(r.addEventListener("contextmenu",Sn,{signal:a}),r.addEventListener("click",i,{signal:a})),l(this,Th).append(r)};function yC(n,e,t){for(const s of t)e.addEventListener(s,n[s].bind(n))}var ba,va,Pc,wa;const Fe=class Fe{static initializeAndAddPointerId(e){(l(Fe,va)||_(Fe,va,new Set)).add(e)}static setPointer(e,t){l(Fe,ba)||_(Fe,ba,t),l(Fe,wa)??_(Fe,wa,e)}static setTimeStamp(e){_(Fe,Pc,e)}static isSamePointerId(e){return l(Fe,ba)===e}static isSamePointerIdOrRemove(e){var t;return l(Fe,ba)===e?!0:((t=l(Fe,va))==null||t.delete(e),!1)}static isSamePointerType(e){return l(Fe,wa)===e}static isInitializedAndDifferentPointerType(e){return l(Fe,wa)!==null&&!Fe.isSamePointerType(e)}static isSameTimeStamp(e){return l(Fe,Pc)===e}static isUsingMultiplePointers(){var e;return((e=l(Fe,va))==null?void 0:e.size)>=1}static clearPointerType(){_(Fe,wa,null)}static clearPointerIds(){_(Fe,ba,NaN),_(Fe,va,null)}static clearTimeStamp(){_(Fe,Pc,NaN)}};ba=new WeakMap,va=new WeakMap,Pc=new WeakMap,wa=new WeakMap,C(Fe,ba,NaN),C(Fe,va,null),C(Fe,Pc,NaN),C(Fe,wa,null);let Jt=Fe;var vg;class $j{constructor(){C(this,vg,0)}get id(){return`${yh}${ot(this,vg)._++}`}}vg=new WeakMap;var Rc,Nh,Xt,Mc,dm;const zb=class zb{constructor(){C(this,Mc);C(this,Rc,aC());C(this,Nh,0);C(this,Xt,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return pe(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:s,size:i,type:r}=e;return E(this,Mc,dm).call(this,`${t}_${s}_${i}_${r}`,e)}async getFromUrl(e){return E(this,Mc,dm).call(this,e,e)}async getFromBlob(e,t){const s=await t;return E(this,Mc,dm).call(this,e,s)}async getFromId(e){l(this,Xt)||_(this,Xt,new Map);const t=l(this,Xt).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){l(this,Xt)||_(this,Xt,new Map);let s=l(this,Xt).get(e);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${l(this,Rc)}_${ot(this,Nh)._++}`,refCounter:1,isSvg:!1},l(this,Xt).set(e,s),l(this,Xt).set(s.id,s),s}getSvgUrl(e){const t=l(this,Xt).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;l(this,Xt)||_(this,Xt,new Map);const t=l(this,Xt).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(s.width,s.height);r.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=r.convertToBlob()}(i=s.close)==null||i.call(s),t.bitmap=null}isValidId(e){return e.startsWith(`image_${l(this,Rc)}_`)}};Rc=new WeakMap,Nh=new WeakMap,Xt=new WeakMap,Mc=new WeakSet,dm=async function(e,t){l(this,Xt)||_(this,Xt,new Map);let s=l(this,Xt).get(e);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${l(this,Rc)}_${ot(this,Nh)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(s.url=t,i=await vp(t,"blob")):t instanceof File?i=s.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=zb._isSVGFittingCanvas,o=new FileReader,a=new Image,c=new Promise((d,u)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,d()},o.onload=async()=>{const m=s.svgUrl=o.result;a.src=await r?`${m}#svgView(preserveAspectRatio(none))`:m},a.onerror=o.onerror=u});o.readAsDataURL(i),await c}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){fe(i),s=null}return l(this,Xt).set(e,s),s&&l(this,Xt).set(s.id,s),s};let Vy=zb;var mt,ao,Ih,nt;class zj{constructor(e=128){C(this,mt,[]);C(this,ao,!1);C(this,Ih);C(this,nt,-1);_(this,Ih,e)}add({cmd:e,undo:t,post:s,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:a=!1}){if(i&&e(),l(this,ao))return;const c={cmd:e,undo:t,post:s,type:r};if(l(this,nt)===-1){l(this,mt).length>0&&(l(this,mt).length=0),_(this,nt,0),l(this,mt).push(c);return}if(o&&l(this,mt)[l(this,nt)].type===r){a&&(c.undo=l(this,mt)[l(this,nt)].undo),l(this,mt)[l(this,nt)]=c;return}const d=l(this,nt)+1;d===l(this,Ih)?l(this,mt).splice(0,1):(_(this,nt,d),d<l(this,mt).length&&l(this,mt).splice(d)),l(this,mt).push(c)}undo(){if(l(this,nt)===-1)return;_(this,ao,!0);const{undo:e,post:t}=l(this,mt)[l(this,nt)];e(),t==null||t(),_(this,ao,!1),_(this,nt,l(this,nt)-1)}redo(){if(l(this,nt)<l(this,mt).length-1){_(this,nt,l(this,nt)+1),_(this,ao,!0);const{cmd:e,post:t}=l(this,mt)[l(this,nt)];e(),t==null||t(),_(this,ao,!1)}}hasSomethingToUndo(){return l(this,nt)!==-1}hasSomethingToRedo(){return l(this,nt)<l(this,mt).length-1}cleanType(e){if(l(this,nt)!==-1){for(let t=l(this,nt);t>=0;t--)if(l(this,mt)[t].type!==e){l(this,mt).splice(t+1,l(this,nt)-t),_(this,nt,t);return}l(this,mt).length=0,_(this,nt,-1)}}destroy(){_(this,mt,null)}}mt=new WeakMap,ao=new WeakMap,Ih=new WeakMap,nt=new WeakMap;var wg,xC;class Ap{constructor(e){C(this,wg);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Tt.platform;for(const[s,i,r={}]of e)for(const o of s){const a=o.startsWith("mac+");t&&a?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!a&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(E(this,wg,xC).call(this,t));if(!s)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:a=null}}=s;a&&!a(e,t)||(i.bind(e,...o,t)(),r||ft(t))}}wg=new WeakSet,xC=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const _g=class _g{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Uj(e),pe(this,"_colors",e)}convert(e){const t=_p(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,i]of this._colors)if(i.every((r,o)=>r===t[o]))return _g._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?Z.makeHexColor(...t):e}};W(_g,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let $y=_g;var Dc,Ps,Lc,lt,St,Fc,ln,jc,cn,Qt,lo,co,Oc,uo,ii,dn,_a,Ph,Rh,Uc,Mh,ri,ho,Bc,fo,oi,Ag,po,Hc,Dh,mo,Aa,Gc,go,Lh,bt,De,Wi,yo,xo,Fh,qc,jh,bo,ai,Ki,Oh,Uh,un,X,um,zy,bC,vC,Pu,wC,_C,AC,Wy,SC,CC,EC,kC,rs,Bi,TC,NC,Ky,IC,Ru,Yy;const dc=class dc{constructor(e,t,s,i,r,o,a,c,d,u,m,p,y,v,x,b){C(this,X);C(this,Dc,new AbortController);C(this,Ps,null);C(this,Lc,null);C(this,lt,new Map);C(this,St,new Map);C(this,Fc,null);C(this,ln,null);C(this,jc,null);C(this,cn,new zj);C(this,Qt,null);C(this,lo,null);C(this,co,null);C(this,Oc,0);C(this,uo,new Set);C(this,ii,null);C(this,dn,null);C(this,_a,new Set);W(this,"_editorUndoBar",null);C(this,Ph,!1);C(this,Rh,!1);C(this,Uc,!1);C(this,Mh,null);C(this,ri,null);C(this,ho,null);C(this,Bc,null);C(this,fo,!1);C(this,oi,null);C(this,Ag,new $j);C(this,po,!1);C(this,Hc,!1);C(this,Dh,!1);C(this,mo,null);C(this,Aa,null);C(this,Gc,null);C(this,go,null);C(this,Lh,null);C(this,bt,ge.NONE);C(this,De,new Set);C(this,Wi,null);C(this,yo,null);C(this,xo,null);C(this,Fh,null);C(this,qc,null);C(this,jh,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});C(this,bo,[0,0]);C(this,ai,null);C(this,Ki,null);C(this,Oh,null);C(this,Uh,null);C(this,un,null);const w=this._signal=l(this,Dc).signal;_(this,Ki,e),_(this,Oh,t),_(this,Uh,s),_(this,Fc,i),_(this,Qt,r),_(this,yo,o),_(this,qc,c),this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:w}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:w}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:w}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:w}),a._on("setpreference",this.onSetPreference.bind(this),{signal:w}),a._on("switchannotationeditorparams",S=>this.updateParams(S.type,S.value),{signal:w}),window.addEventListener("pointerdown",()=>{_(this,Hc,!0)},{capture:!0,signal:w}),window.addEventListener("pointerup",()=>{_(this,Hc,!1)},{capture:!0,signal:w}),E(this,X,wC).call(this),E(this,X,kC).call(this),E(this,X,Wy).call(this),_(this,ln,c.annotationStorage),_(this,Mh,c.filterFactory),_(this,xo,d),_(this,Bc,u||null),_(this,Ph,m),_(this,Rh,p),_(this,Uc,y),_(this,Lh,v||null),this.viewParameters={realScale:ea.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=x||null,this._supportsPinchToZoom=b!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=dc.prototype,t=o=>l(o,Ki).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),s=(o,{target:a})=>{if(a instanceof HTMLInputElement){const{type:c}=a;return c!=="text"&&c!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return pe(this,"_keyboardManager",new Ap([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&l(o,Ki).contains(a)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:a})=>!(a instanceof HTMLButtonElement)&&l(o,Ki).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,s,i,r,o,a,c,d;(e=l(this,un))==null||e.resolve(),_(this,un,null),(t=l(this,Dc))==null||t.abort(),_(this,Dc,null),this._signal=null;for(const u of l(this,St).values())u.destroy();l(this,St).clear(),l(this,lt).clear(),l(this,_a).clear(),(s=l(this,go))==null||s.clear(),_(this,Ps,null),l(this,De).clear(),l(this,cn).destroy(),(i=l(this,Fc))==null||i.destroy(),(r=l(this,Qt))==null||r.destroy(),(o=l(this,yo))==null||o.destroy(),(a=l(this,oi))==null||a.hide(),_(this,oi,null),(c=l(this,Gc))==null||c.destroy(),_(this,Gc,null),_(this,Lc,null),l(this,ri)&&(clearTimeout(l(this,ri)),_(this,ri,null)),l(this,ai)&&(clearTimeout(l(this,ai)),_(this,ai,null)),(d=this._editorUndoBar)==null||d.destroy(),_(this,qc,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return l(this,Lh)}get useNewAltTextFlow(){return l(this,Rh)}get useNewAltTextWhenAddingImage(){return l(this,Uc)}get hcmFilter(){return pe(this,"hcmFilter",l(this,xo)?l(this,Mh).addHCMFilter(l(this,xo).foreground,l(this,xo).background):"none")}get direction(){return pe(this,"direction",getComputedStyle(l(this,Ki)).direction)}get _highlightColors(){return pe(this,"_highlightColors",l(this,Bc)?new Map(l(this,Bc).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return pe(this,"highlightColors",null);const t=new Map,s=!!l(this,xo);for(const[i,r]of e){const o=i.endsWith("_HCM");if(s&&o){t.set(i.replace("_HCM",""),r);continue}!s&&!o&&t.set(i,r)}return pe(this,"highlightColors",t)}get highlightColorNames(){return pe(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),_(this,co,e)}setMainHighlightColorPicker(e){_(this,Gc,e)}editAltText(e,t=!1){var s;(s=l(this,Fc))==null||s.editAltText(this,e,t)}hasCommentManager(){return!!l(this,Qt)}editComment(e,t,s,i){var r;(r=l(this,Qt))==null||r.showDialog(this,e,t,s,i)}selectComment(e,t){const s=l(this,St).get(e),i=s==null?void 0:s.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=l(this,Qt))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=l(this,Qt))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=l(this,Qt))==null||t.removeComments([e.uid])}toggleComment(e,t,s=void 0){var i;(i=l(this,Qt))==null||i.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){var s;return e&&((s=l(this,Qt))==null?void 0:s.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=l(this,Qt))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(l(this,St).has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await s}getSignature(e){var t;(t=l(this,yo))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return l(this,yo)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":_(this,Uc,t);break}}onPageChanging({pageNumber:e}){_(this,Oc,e-1)}focusMainContainer(){l(this,Ki).focus()}findParent(e,t){for(const s of l(this,St).values()){const{x:i,y:r,width:o,height:a}=s.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+a)return s}return null}disableUserSelect(e=!1){l(this,Oh).classList.toggle("noUserSelect",e)}addShouldRescale(e){l(this,_a).add(e)}removeShouldRescale(e){l(this,_a).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*ea.PDF_TO_CSS_UNITS;for(const s of l(this,_a))s.onScaleChanging();(t=l(this,co))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:a}=s,c=s.toString(),u=E(this,X,um).call(this,s).closest(".textLayer"),m=this.getSelectionBoxes(u);if(!m)return;s.empty();const p=E(this,X,zy).call(this,u),y=l(this,bt)===ge.NONE,v=()=>{const x=p==null?void 0:p.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:m,anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:a,text:c});y&&this.showAllEditors("highlight",!0,!0),t&&(x==null||x.editComment())};if(y){this.switchToMode(ge.HIGHLIGHT,v);return}v()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!l(this,ln))return null;const t=`${yh}${e}`,s=l(this,ln).getRawValue(t);return s&&l(this,ln).remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&l(this,ln)&&!l(this,ln).has(e.id)&&l(this,ln).setValue(e.id,e)}a11yAlert(e,t=null){const s=l(this,Uh);s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,l(this,fo)&&(_(this,fo,!1),E(this,X,Pu).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of l(this,De))if(t.div.contains(e)){_(this,Aa,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!l(this,Aa))return;const[e,t]=l(this,Aa);_(this,Aa,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){E(this,X,Wy).call(this),this.setEditingState(!0)}removeEditListeners(){E(this,X,SC).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of l(this,dn))if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of l(this,dn))if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var s;if(e.preventDefault(),(s=l(this,Ps))==null||s.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of l(this,De)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of l(this,dn))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(r){fe(`paste: "${r.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const c of s){const d=await i.deserialize(c);if(!d)return;r.push(d)}const o=()=>{for(const c of r)E(this,X,Ky).call(this,c);E(this,X,Yy).call(this,r)},a=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:a,mustExec:!0})}catch(r){fe(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),l(this,bt)!==ge.NONE&&!this.isEditorHandlingKeyboard&&dc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,l(this,fo)&&(_(this,fo,!1),E(this,X,Pu).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(E(this,X,_C).call(this),E(this,X,CC).call(this),E(this,X,rs).call(this,{isEditing:l(this,bt)!==ge.NONE,isEmpty:E(this,X,Ru).call(this),hasSomethingToUndo:l(this,cn).hasSomethingToUndo(),hasSomethingToRedo:l(this,cn).hasSomethingToRedo(),hasSelectedEditor:!1})):(E(this,X,AC).call(this),E(this,X,EC).call(this),E(this,X,rs).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!l(this,dn)){_(this,dn,e);for(const t of l(this,dn))E(this,X,Bi).call(this,t.defaultPropertiesToUpdate)}}getId(){return l(this,Ag).id}get currentLayer(){return l(this,St).get(l(this,Oc))}getLayer(e){return l(this,St).get(e)}get currentPageIndex(){return l(this,Oc)}addLayer(e){l(this,St).set(e.pageIndex,e),l(this,po)?e.enable():e.disable()}removeLayer(e){l(this,St).delete(e.pageIndex)}async updateMode(e,t=null,s=!1,i=!1,r=!1,o=!1){var a,c,d,u,m,p;if(l(this,bt)!==e&&!(l(this,un)&&(await l(this,un).promise,!l(this,un)))){if(_(this,un,Promise.withResolvers()),(a=l(this,co))==null||a.commitOrRemove(),l(this,bt)===ge.POPUP&&((c=l(this,Qt))==null||c.hideSidebar()),(d=l(this,Qt))==null||d.destroyPopup(),_(this,bt,e),e===ge.NONE){this.setEditingState(!1),E(this,X,NC).call(this);for(const y of l(this,lt).values())y.hideStandaloneCommentButton();(u=this._editorUndoBar)==null||u.hide(),this.toggleComment(null),l(this,un).resolve();return}for(const y of l(this,lt).values())y.addStandaloneCommentButton();e===ge.SIGNATURE&&await((m=l(this,yo))==null?void 0:m.loadSignatures()),s&&Jt.clearPointerType(),this.setEditingState(!0),await E(this,X,TC).call(this),this.unselectAll();for(const y of l(this,St).values())y.updateMode(e);if(e===ge.POPUP){l(this,Lc)||_(this,Lc,await l(this,qc).getAnnotationsByType(new Set(l(this,dn).map(x=>x._editorType))));const y=new Set,v=[];for(const x of l(this,lt).values()){const{annotationElementId:b,hasComment:w,deleted:S}=x;b&&y.add(b),w&&!S&&v.push(x.getData())}for(const x of l(this,Lc)){const{id:b,popupRef:w,contentsObj:S}=x;w&&(S!=null&&S.str)&&!y.has(b)&&!l(this,uo).has(b)&&v.push(x)}(p=l(this,Qt))==null||p.showSidebar(v)}if(!t){i&&this.addNewEditorFromKeyboard(),l(this,un).resolve();return}for(const y of l(this,lt).values())y.uid===t?(this.setSelected(y),o?y.editComment():r?y.enterInEditMode():y.focus()):y.unselect();l(this,un).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==l(this,bt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(l(this,dn)){switch(e){case Ee.CREATE:this.currentLayer.addNewEditor(t);return;case Ee.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(l(this,Fh)||_(this,Fh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of l(this,De))s.updateParams(e,t);else for(const s of l(this,dn))s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){var r;for(const o of l(this,lt).values())o.editorType===e&&o.show(t);(((r=l(this,Fh))==null?void 0:r.get(Ee.HIGHLIGHT_SHOW_ALL))??!0)!==t&&E(this,X,Bi).call(this,[[Ee.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(l(this,Dh)!==e){_(this,Dh,e);for(const t of l(this,St).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of l(this,lt).values())t.pageIndex===e&&(yield t)}getEditor(e){return l(this,lt).get(e)}addEditor(e){l(this,lt).set(e.id,e)}removeEditor(e){var t,s;e.div.contains(document.activeElement)&&(l(this,ri)&&clearTimeout(l(this,ri)),_(this,ri,setTimeout(()=>{this.focusMainContainer(),_(this,ri,null)},0))),l(this,lt).delete(e.id),e.annotationElementId&&((t=l(this,go))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!l(this,uo).has(e.annotationElementId))&&((s=l(this,ln))==null||s.remove(e.id))}addDeletedAnnotationElement(e){l(this,uo).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return l(this,uo).has(e)}removeDeletedAnnotationElement(e){l(this,uo).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){l(this,Ps)!==e&&(_(this,Ps,e),e&&E(this,X,Bi).call(this,e.propertiesToUpdate))}updateUI(e){l(this,X,IC)===e&&E(this,X,Bi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){E(this,X,Bi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(l(this,De).has(e)){l(this,De).delete(e),e.unselect(),E(this,X,rs).call(this,{hasSelectedEditor:this.hasSelection});return}l(this,De).add(e),e.select(),E(this,X,Bi).call(this,e.propertiesToUpdate),E(this,X,rs).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=l(this,co))==null||t.commitOrRemove();for(const s of l(this,De))s!==e&&s.unselect();l(this,De).clear(),l(this,De).add(e),e.select(),E(this,X,Bi).call(this,e.propertiesToUpdate),E(this,X,rs).call(this,{hasSelectedEditor:!0})}isSelected(e){return l(this,De).has(e)}get firstSelectedEditor(){return l(this,De).values().next().value}unselect(e){e.unselect(),l(this,De).delete(e),E(this,X,rs).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return l(this,De).size!==0}get isEnterHandled(){return l(this,De).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;l(this,cn).undo(),E(this,X,rs).call(this,{hasSomethingToUndo:l(this,cn).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:E(this,X,Ru).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){l(this,cn).redo(),E(this,X,rs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:l(this,cn).hasSomethingToRedo(),isEmpty:E(this,X,Ru).call(this)})}addCommands(e){l(this,cn).add(e),E(this,X,rs).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:E(this,X,Ru).call(this)})}cleanUndoStack(e){l(this,cn).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...l(this,De)],s=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},i=()=>{for(const o of t)E(this,X,Ky).call(this,o)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=l(this,Ps))==null||e.commitOrRemove()}hasSomethingToControl(){return l(this,Ps)||this.hasSelection}selectAll(){for(const e of l(this,De))e.commit();E(this,X,Yy).call(this,l(this,lt).values())}unselectAll(){var e;if(!(l(this,Ps)&&(l(this,Ps).commitOrRemove(),l(this,bt)!==ge.NONE))&&!((e=l(this,co))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of l(this,De))t.unselect();l(this,De).clear(),E(this,X,rs).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;l(this,bo)[0]+=e,l(this,bo)[1]+=t;const[i,r]=l(this,bo),o=[...l(this,De)],a=1e3;l(this,ai)&&clearTimeout(l(this,ai)),_(this,ai,setTimeout(()=>{_(this,ai,null),l(this,bo)[0]=l(this,bo)[1]=0,this.addCommands({cmd:()=>{for(const c of o)l(this,lt).has(c.id)&&(c.translateInPage(i,r),c.translationDone())},undo:()=>{for(const c of o)l(this,lt).has(c.id)&&(c.translateInPage(-i,-r),c.translationDone())},mustExec:!1})},a));for(const c of o)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),_(this,ii,new Map);for(const e of l(this,De))l(this,ii).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!l(this,ii))return!1;this.disableUserSelect(!1);const e=l(this,ii);_(this,ii,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},a]of e)a.newX=i,a.newY=r,a.newPageIndex=o,t||(t=i!==a.savedX||r!==a.savedY||o!==a.savedPageIndex);if(!t)return!1;const s=(i,r,o,a)=>{if(l(this,lt).has(i.id)){const c=l(this,St).get(a);c?i._setParentAndPosition(c,r,o):(i.pageIndex=a,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:a}]of e)s(i,r,o,a)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:a}]of e)s(i,r,o,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(l(this,ii))for(const s of l(this,ii).keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||l(this,De).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return l(this,Ps)===e}getActive(){return l(this,Ps)}getMode(){return l(this,bt)}isEditingMode(){return l(this,bt)!==ge.NONE}get imageManager(){return pe(this,"imageManager",new Vy)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let d=0,u=t.rangeCount;d<u;d++)if(!e.contains(t.getRangeAt(d).commonAncestorContainer))return null;const{x:s,y:i,width:r,height:o}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(d,u,m,p)=>({x:(u-i)/o,y:1-(d+m-s)/r,width:p/o,height:m/r});break;case"180":a=(d,u,m,p)=>({x:1-(d+m-s)/r,y:1-(u+p-i)/o,width:m/r,height:p/o});break;case"270":a=(d,u,m,p)=>({x:1-(u+p-i)/o,y:(d-s)/r,width:p/o,height:m/r});break;default:a=(d,u,m,p)=>({x:(d-s)/r,y:(u-i)/o,width:m/r,height:p/o});break}const c=[];for(let d=0,u=t.rangeCount;d<u;d++){const m=t.getRangeAt(d);if(!m.collapsed)for(const{x:p,y,width:v,height:x}of m.getClientRects())v===0||x===0||c.push(a(p,y,v,x))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(l(this,jc)||_(this,jc,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=l(this,jc))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=l(this,jc))==null?void 0:i.get(e.data.id);if(!t)return;const s=l(this,ln).getRawValue(t);s&&(l(this,bt)===ge.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){var r;const i=(r=l(this,go))==null?void 0:r.get(e);i&&(i.setCanvas(t,s),l(this,go).delete(e))}addMissingCanvas(e,t){(l(this,go)||_(this,go,new Map)).set(e,t)}};Dc=new WeakMap,Ps=new WeakMap,Lc=new WeakMap,lt=new WeakMap,St=new WeakMap,Fc=new WeakMap,ln=new WeakMap,jc=new WeakMap,cn=new WeakMap,Qt=new WeakMap,lo=new WeakMap,co=new WeakMap,Oc=new WeakMap,uo=new WeakMap,ii=new WeakMap,dn=new WeakMap,_a=new WeakMap,Ph=new WeakMap,Rh=new WeakMap,Uc=new WeakMap,Mh=new WeakMap,ri=new WeakMap,ho=new WeakMap,Bc=new WeakMap,fo=new WeakMap,oi=new WeakMap,Ag=new WeakMap,po=new WeakMap,Hc=new WeakMap,Dh=new WeakMap,mo=new WeakMap,Aa=new WeakMap,Gc=new WeakMap,go=new WeakMap,Lh=new WeakMap,bt=new WeakMap,De=new WeakMap,Wi=new WeakMap,yo=new WeakMap,xo=new WeakMap,Fh=new WeakMap,qc=new WeakMap,jh=new WeakMap,bo=new WeakMap,ai=new WeakMap,Ki=new WeakMap,Oh=new WeakMap,Uh=new WeakMap,un=new WeakMap,X=new WeakSet,um=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},zy=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of l(this,St).values())if(s.hasTextLayer(e))return s;return null},bC=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=E(this,X,um).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(l(this,oi)||_(this,oi,new Vj(this)),l(this,oi).show(s,i,this.direction==="ltr"))},vC=function(){var r,o,a;const e=document.getSelection();if(!e||e.isCollapsed){l(this,Wi)&&((r=l(this,oi))==null||r.hide(),_(this,Wi,null),E(this,X,rs).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===l(this,Wi))return;const i=E(this,X,um).call(this,e).closest(".textLayer");if(!i){l(this,Wi)&&((o=l(this,oi))==null||o.hide(),_(this,Wi,null),E(this,X,rs).call(this,{hasSelectedText:!1}));return}if((a=l(this,oi))==null||a.hide(),_(this,Wi,t),E(this,X,rs).call(this,{hasSelectedText:!0}),!(l(this,bt)!==ge.HIGHLIGHT&&l(this,bt)!==ge.NONE)&&(l(this,bt)===ge.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),_(this,fo,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=l(this,bt)===ge.HIGHLIGHT?E(this,X,zy).call(this,i):null;if(c==null||c.toggleDrawing(),l(this,Hc)){const d=new AbortController,u=this.combinedSignal(d),m=p=>{p.type==="pointerup"&&p.button!==0||(d.abort(),c==null||c.toggleDrawing(!0),p.type==="pointerup"&&E(this,X,Pu).call(this,"main_toolbar"))};window.addEventListener("pointerup",m,{signal:u}),window.addEventListener("blur",m,{signal:u})}else c==null||c.toggleDrawing(!0),E(this,X,Pu).call(this,"main_toolbar")}},Pu=function(e=""){l(this,bt)===ge.HIGHLIGHT?this.highlightSelection(e):l(this,Ph)&&E(this,X,bC).call(this)},wC=function(){document.addEventListener("selectionchange",E(this,X,vC).bind(this),{signal:this._signal})},_C=function(){if(l(this,ho))return;_(this,ho,new AbortController);const e=this.combinedSignal(l(this,ho));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},AC=function(){var e;(e=l(this,ho))==null||e.abort(),_(this,ho,null)},Wy=function(){if(l(this,mo))return;_(this,mo,new AbortController);const e=this.combinedSignal(l(this,mo));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},SC=function(){var e;(e=l(this,mo))==null||e.abort(),_(this,mo,null)},CC=function(){if(l(this,lo))return;_(this,lo,new AbortController);const e=this.combinedSignal(l(this,lo));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},EC=function(){var e;(e=l(this,lo))==null||e.abort(),_(this,lo,null)},kC=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},rs=function(e){Object.entries(e).some(([s,i])=>l(this,jh)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(l(this,jh),e)}),l(this,bt)===ge.HIGHLIGHT&&e.hasSelectedEditor===!1&&E(this,X,Bi).call(this,[[Ee.HIGHLIGHT_FREE,!0]]))},Bi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},TC=async function(){if(!l(this,po)){_(this,po,!0);const e=[];for(const t of l(this,St).values())e.push(t.enable());await Promise.all(e);for(const t of l(this,lt).values())t.enable()}},NC=function(){if(this.unselectAll(),l(this,po)){_(this,po,!1);for(const e of l(this,St).values())e.disable();for(const e of l(this,lt).values())e.disable()}},Ky=function(e){const t=l(this,St).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},IC=function(){let e=null;for(e of l(this,De));return e},Ru=function(){if(l(this,lt).size===0)return!0;if(l(this,lt).size===1)for(const e of l(this,lt).values())return e.isEmpty();return!1},Yy=function(e){for(const t of l(this,De))t.unselect();l(this,De).clear();for(const t of e)t.isEmpty()||(l(this,De).add(t),t.select());E(this,X,rs).call(this,{hasSelectedEditor:this.hasSelection})},W(dc,"TRANSLATE_SMALL",1),W(dc,"TRANSLATE_BIG",10);let Bl=dc;var Pt,li,Mn,Vc,ci,Rs,$c,di,_s,Yi,Sa,ui,vo,$n,Mu,hm;const os=class os{constructor(e){C(this,$n);C(this,Pt,null);C(this,li,!1);C(this,Mn,null);C(this,Vc,null);C(this,ci,null);C(this,Rs,null);C(this,$c,!1);C(this,di,null);C(this,_s,null);C(this,Yi,null);C(this,Sa,null);C(this,ui,!1);_(this,_s,e),_(this,ui,e._uiManager.useNewAltTextFlow),l(os,vo)||_(os,vo,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){os._l10n??(os._l10n=e)}async render(){const e=_(this,Mn,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=_(this,Vc,document.createElement("span"));e.append(t),l(this,ui)?(e.classList.add("new"),e.setAttribute("data-l10n-id",l(os,vo).missing),t.setAttribute("data-l10n-id",l(os,vo)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=l(this,_s)._uiManager._signal;e.addEventListener("contextmenu",Sn,{signal:s}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),l(this,_s)._uiManager.editAltText(l(this,_s)),l(this,ui)&&l(this,_s)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:l(this,$n,Mu)}})};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(_(this,$c,!0),i(r))},{signal:s}),await E(this,$n,hm).call(this),e}finish(){l(this,Mn)&&(l(this,Mn).focus({focusVisible:l(this,$c)}),_(this,$c,!1))}isEmpty(){return l(this,ui)?l(this,Pt)===null:!l(this,Pt)&&!l(this,li)}hasData(){return l(this,ui)?l(this,Pt)!==null||!!l(this,Yi):this.isEmpty()}get guessedText(){return l(this,Yi)}async setGuessedText(e){l(this,Pt)===null&&(_(this,Yi,e),_(this,Sa,await os._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),E(this,$n,hm).call(this))}toggleAltTextBadge(e=!1){var t;if(!l(this,ui)||l(this,Pt)){(t=l(this,di))==null||t.remove(),_(this,di,null);return}if(!l(this,di)){const s=_(this,di,document.createElement("div"));s.className="noAltTextBadge",l(this,_s).div.append(s)}l(this,di).classList.toggle("hidden",!e)}serialize(e){let t=l(this,Pt);return!e&&l(this,Yi)===t&&(t=l(this,Sa)),{altText:t,decorative:l(this,li),guessedText:l(this,Yi),textWithDisclaimer:l(this,Sa)}}get data(){return{altText:l(this,Pt),decorative:l(this,li)}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:i,cancel:r=!1}){s&&(_(this,Yi,s),_(this,Sa,i)),!(l(this,Pt)===e&&l(this,li)===t)&&(r||(_(this,Pt,e),_(this,li,t)),E(this,$n,hm).call(this))}toggle(e=!1){l(this,Mn)&&(!e&&l(this,Rs)&&(clearTimeout(l(this,Rs)),_(this,Rs,null)),l(this,Mn).disabled=!e)}shown(){l(this,_s)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:l(this,$n,Mu)}})}destroy(){var e,t;(e=l(this,Mn))==null||e.remove(),_(this,Mn,null),_(this,Vc,null),_(this,ci,null),(t=l(this,di))==null||t.remove(),_(this,di,null)}};Pt=new WeakMap,li=new WeakMap,Mn=new WeakMap,Vc=new WeakMap,ci=new WeakMap,Rs=new WeakMap,$c=new WeakMap,di=new WeakMap,_s=new WeakMap,Yi=new WeakMap,Sa=new WeakMap,ui=new WeakMap,vo=new WeakMap,$n=new WeakSet,Mu=function(){return l(this,Pt)&&"added"||l(this,Pt)===null&&this.guessedText&&"review"||"missing"},hm=async function(){var i,r,o;const e=l(this,Mn);if(!e)return;if(l(this,ui)){if(e.classList.toggle("done",!!l(this,Pt)),e.setAttribute("data-l10n-id",l(os,vo)[l(this,$n,Mu)]),(i=l(this,Vc))==null||i.setAttribute("data-l10n-id",l(os,vo)[`${l(this,$n,Mu)}-label`]),!l(this,Pt)){(r=l(this,ci))==null||r.remove();return}}else{if(!l(this,Pt)&&!l(this,li)){e.classList.remove("done"),(o=l(this,ci))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=l(this,ci);if(!t){_(this,ci,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${l(this,_s).id}`;const a=100,c=l(this,_s)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(l(this,Rs)),_(this,Rs,null)},{once:!0}),e.addEventListener("mouseenter",()=>{_(this,Rs,setTimeout(()=>{_(this,Rs,null),l(this,ci).classList.add("show"),l(this,_s)._reportTelemetry({action:"alt_text_tooltip"})},a))},{signal:c}),e.addEventListener("mouseleave",()=>{var d;l(this,Rs)&&(clearTimeout(l(this,Rs)),_(this,Rs,null)),(d=l(this,ci))==null||d.classList.remove("show")},{signal:c})}l(this,li)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=l(this,Pt)),t.parentNode||e.append(t);const s=l(this,_s).getElementForAltText();s==null||s.setAttribute("aria-describedby",t.id)},C(os,vo,null),W(os,"_l10n",null);let lg=os;var Bt,hn,Ca,Ke,Bh,Ea,Dn,ka,Ta,Na,Hh,Jy;class qp{constructor(e){C(this,Hh);C(this,Bt,null);C(this,hn,null);C(this,Ca,!1);C(this,Ke,null);C(this,Bh,null);C(this,Ea,null);C(this,Dn,null);C(this,ka,null);C(this,Ta,!1);C(this,Na,null);_(this,Ke,e)}renderForToolbar(){const e=_(this,hn,document.createElement("button"));return e.className="comment",E(this,Hh,Jy).call(this,e,!1)}renderForStandalone(){const e=_(this,Bt,document.createElement("button"));e.className="annotationCommentButton";const t=l(this,Ke).commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(l(this,Ke)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=l(this,Ke).commentButtonColor;i&&(s.backgroundColor=i)}return E(this,Hh,Jy).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=l(this,Bt)??l(this,hn))==null||e.focus()},0)}onUpdatedColor(){if(!l(this,Bt))return;const e=l(this,Ke).commentButtonColor;e&&(l(this,Bt).style.backgroundColor=e),l(this,Ke)._uiManager.updatePopupColor(l(this,Ke))}get commentButtonWidth(){var e;return(((e=l(this,Bt))==null?void 0:e.getBoundingClientRect().width)??0)/l(this,Ke).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(l(this,Na))return l(this,Na);if(!l(this,Bt))return null;const{x:e,y:t,height:s}=l(this,Bt).getBoundingClientRect(),{x:i,y:r,width:o,height:a}=l(this,Ke).parent.boundingClientRect;return[(e-i)/o,(t+s-r)/a]}set commentPopupPositionInLayer(e){_(this,Na,e)}hasDefaultPopupPosition(){return l(this,Na)===null}removeStandaloneCommentButton(){var e;(e=l(this,Bt))==null||e.remove(),_(this,Bt,null)}removeToolbarCommentButton(){var e;(e=l(this,hn))==null||e.remove(),_(this,hn,null)}setCommentButtonStates({selected:e,hasPopup:t}){l(this,Bt)&&(l(this,Bt).classList.toggle("selected",e),l(this,Bt).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let s,i;if(t)[s,i]=t;else{[s,i]=l(this,Ke).commentButtonPosition;const{width:u,height:m,x:p,y}=l(this,Ke);s=p+s*u,i=y+i*m}const r=l(this,Ke).parent.boundingClientRect,{x:o,y:a,width:c,height:d}=r;l(this,Ke)._uiManager.editComment(l(this,Ke),o+s*c,a+i*d,{...e,parentDimensions:r})}finish(){l(this,hn)&&(l(this,hn).focus({focusVisible:l(this,Ca)}),_(this,Ca,!1))}isDeleted(){return l(this,Ta)||l(this,Dn)===""}isEmpty(){return l(this,Dn)===null}hasBeenEdited(){return this.isDeleted()||l(this,Dn)!==l(this,Bh)}serialize(){return this.data}get data(){return{text:l(this,Dn),richText:l(this,Ea),date:l(this,ka),deleted:this.isDeleted()}}set data(e){if(e!==l(this,Dn)&&_(this,Ea,null),e===null){_(this,Dn,""),_(this,Ta,!0);return}_(this,Dn,e),_(this,ka,new Date),_(this,Ta,!1)}setInitialText(e,t=null){_(this,Bh,e),this.data=e,_(this,ka,null),_(this,Ea,t)}shown(){}destroy(){var e,t;(e=l(this,hn))==null||e.remove(),_(this,hn,null),(t=l(this,Bt))==null||t.remove(),_(this,Bt,null),_(this,Dn,""),_(this,Ea,null),_(this,ka,null),_(this,Ke,null),_(this,Ca,!1),_(this,Ta,!1)}}Bt=new WeakMap,hn=new WeakMap,Ca=new WeakMap,Ke=new WeakMap,Bh=new WeakMap,Ea=new WeakMap,Dn=new WeakMap,ka=new WeakMap,Ta=new WeakMap,Na=new WeakMap,Hh=new WeakSet,Jy=function(e,t){if(!l(this,Ke)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[l(this,Ke)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=l(this,Ke)._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",Sn,{signal:s}),t&&(e.addEventListener("focusin",r=>{l(this,Ke)._focusEventsAllowed=!1,ft(r)},{capture:!0,signal:s}),e.addEventListener("focusout",r=>{l(this,Ke)._focusEventsAllowed=!0,ft(r)},{capture:!0,signal:s})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:s});const i=r=>{r.preventDefault(),e===l(this,hn)?this.edit():l(this,Ke).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:s}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(_(this,Ca,!0),i(r))},{signal:s}),e.addEventListener("pointerenter",()=>{l(this,Ke).toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{l(this,Ke).toggleComment(!1,!1)},{signal:s}),e};var zc,Ia,Gh,qh,Vh,$h,zh,Ji,Pa,Xi,Ra,Qi,ta,PC,RC,MC;const Wb=class Wb{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:a}){C(this,ta);C(this,zc);C(this,Ia,!1);C(this,Gh,null);C(this,qh);C(this,Vh);C(this,$h);C(this,zh);C(this,Ji,null);C(this,Pa);C(this,Xi,null);C(this,Ra);C(this,Qi,null);_(this,zc,e),_(this,Gh,s),_(this,qh,t),_(this,Vh,i),_(this,$h,r),_(this,zh,o),_(this,Ra,new AbortController),_(this,Pa,AbortSignal.any([a,l(this,Ra).signal])),e.addEventListener("touchstart",E(this,ta,PC).bind(this),{passive:!1,signal:l(this,Pa)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ri.pixelRatio}destroy(){var e,t;(e=l(this,Ra))==null||e.abort(),_(this,Ra,null),(t=l(this,Ji))==null||t.abort(),_(this,Ji,null)}};zc=new WeakMap,Ia=new WeakMap,Gh=new WeakMap,qh=new WeakMap,Vh=new WeakMap,$h=new WeakMap,zh=new WeakMap,Ji=new WeakMap,Pa=new WeakMap,Xi=new WeakMap,Ra=new WeakMap,Qi=new WeakMap,ta=new WeakSet,PC=function(e){var i,r,o;if((i=l(this,qh))!=null&&i.call(this))return;if(e.touches.length===1){if(l(this,Ji))return;const a=_(this,Ji,new AbortController),c=AbortSignal.any([l(this,Pa),a.signal]),d=l(this,zc),u={capture:!0,signal:c,passive:!1},m=p=>{var y;p.pointerType==="touch"&&((y=l(this,Ji))==null||y.abort(),_(this,Ji,null))};d.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(ft(p),m(p))},u),d.addEventListener("pointerup",m,u),d.addEventListener("pointercancel",m,u);return}if(!l(this,Qi)){_(this,Qi,new AbortController);const a=AbortSignal.any([l(this,Pa),l(this,Qi).signal]),c=l(this,zc),d={signal:a,capture:!1,passive:!1};c.addEventListener("touchmove",E(this,ta,RC).bind(this),d);const u=E(this,ta,MC).bind(this);c.addEventListener("touchend",u,d),c.addEventListener("touchcancel",u,d),d.capture=!0,c.addEventListener("pointerdown",ft,d),c.addEventListener("pointermove",ft,d),c.addEventListener("pointercancel",ft,d),c.addEventListener("pointerup",ft,d),(r=l(this,Vh))==null||r.call(this)}if(ft(e),e.touches.length!==2||(o=l(this,Gh))!=null&&o.call(this)){_(this,Xi,null);return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),_(this,Xi,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY})},RC=function(e){var k;if(!l(this,Xi)||e.touches.length!==2)return;ft(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:a}=s,c=l(this,Xi),{touch0X:d,touch0Y:u,touch1X:m,touch1Y:p}=c,y=m-d,v=p-u,x=o-i,b=a-r,w=Math.hypot(x,b)||1,S=Math.hypot(y,v)||1;if(!l(this,Ia)&&Math.abs(S-w)<=Wb.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=r,c.touch1X=o,c.touch1Y=a,!l(this,Ia)){_(this,Ia,!0);return}const A=[(i+o)/2,(r+a)/2];(k=l(this,$h))==null||k.call(this,A,S,w)},MC=function(e){var t;e.touches.length>=2||(l(this,Qi)&&(l(this,Qi).abort(),_(this,Qi,null),(t=l(this,zh))==null||t.call(this)),l(this,Xi)&&(ft(e),_(this,Xi,null),_(this,Ia,!1)))};let cg=Wb;var Ma,Ln,et,Ge,Zi,Wc,wo,Wh,Ht,Da,er,fn,_o,Kh,La,Ms,Yh,Fa,tr,hi,Kc,Yc,pn,ja,Jh,Sg,ce,Xy,Xh,Qy,fm,DC,LC,Zy,pm,ex,FC,jC,OC,tx,UC,sx,BC,HC,GC,nx,Du;const me=class me{constructor(e){C(this,ce);C(this,Ma,null);C(this,Ln,null);C(this,et,null);C(this,Ge,null);C(this,Zi,null);C(this,Wc,!1);C(this,wo,null);C(this,Wh,"");C(this,Ht,null);C(this,Da,null);C(this,er,null);C(this,fn,null);C(this,_o,null);C(this,Kh,"");C(this,La,!1);C(this,Ms,null);C(this,Yh,!1);C(this,Fa,!1);C(this,tr,!1);C(this,hi,null);C(this,Kc,0);C(this,Yc,0);C(this,pn,null);C(this,ja,null);W(this,"isSelected",!1);W(this,"_isCopy",!1);W(this,"_editToolbar",null);W(this,"_initialOptions",Object.create(null));W(this,"_initialData",null);W(this,"_isVisible",!0);W(this,"_uiManager",null);W(this,"_focusEventsAllowed",!0);C(this,Jh,!1);C(this,Sg,me._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[r,o];const[a,c]=this.parentDimensions;this.x=e.x/a,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=me.prototype._resizeWithKeyboard,t=Bl.TRANSLATE_SMALL,s=Bl.TRANSLATE_BIG;return pe(this,"_resizerKeyboardManager",new Ap([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],me.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return pe(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Wj({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(me._l10n??(me._l10n=e),me._l10nResizer||(me._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),me._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);me._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ze("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return l(this,Jh)}set _isDraggable(e){var t;_(this,Jh,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=l(this,Sg)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(E(this,ce,Du).call(this),(t=l(this,fn))==null||t.remove(),_(this,fn,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(l(this,La)?_(this,La,!1):this.parent.setSelected(this))}focusout(e){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,i){const[r,o]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(e+s)/r,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,i]=this.parentDimensions;this.setAt(e*s,t*i,this.width*s,this.height*i),this._onTranslated()}translate(e,t){E(this,ce,Xy).call(this,this.parentDimensions,e,t)}translateInPage(e,t){l(this,Ms)||_(this,Ms,[this.x,this.y,this.width,this.height]),E(this,ce,Xy).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){l(this,Ms)||_(this,Ms,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:m,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,m,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:a}=this;const[c,d]=this.getBaseTranslation();o+=c,a+=d;const{style:u}=s;u.left=`${(100*o).toFixed(2)}%`,u.top=`${(100*a).toFixed(2)}%`,this._onTranslating(o,a),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!l(this,Ms)&&(l(this,Ms)[0]!==this.x||l(this,Ms)[1]!==this.y)}get _hasBeenResized(){return!!l(this,Ms)&&(l(this,Ms)[2]!==this.width||l(this,Ms)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=me,i=s/e,r=s/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,i]}=this;let{x:r,y:o,width:a,height:c}=this;if(a*=s,c*=i,r*=s,o*=i,this._mustFixPosition)switch(e){case 0:r=fs(r,0,s-a),o=fs(o,0,i-c);break;case 90:r=fs(r,0,s-c),o=fs(o,a,i);break;case 180:r=fs(r,a,s),o=fs(o,c,i);break;case 270:r=fs(r,c,s),o=fs(o,0,i-a);break}this.x=r/=s,this.y=o/=i;const[d,u]=this.getBaseTranslation();r+=d,o+=u,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var s;return E(s=me,Xh,Qy).call(s,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var s;return E(s=me,Xh,Qy).call(s,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=l(this,et))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||l(this,Fa))return this._editToolbar;this._editToolbar=new Gy(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=l(this,et))==null||t.destroy()}addContainer(e){var s;const t=(s=this._editToolbar)==null?void 0:s.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return l(this,et)||(lg.initialize(me._l10n),_(this,et,new lg(this)),l(this,Ma)&&(l(this,et).data=l(this,Ma),_(this,Ma,null))),l(this,et)}get altTextData(){var e;return(e=l(this,et))==null?void 0:e.data}set altTextData(e){l(this,et)&&(l(this,et).data=e)}get guessedAltText(){var e;return(e=l(this,et))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=l(this,et))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=l(this,et))==null?void 0:t.serialize(e)}hasAltText(){return!!l(this,et)&&!l(this,et).isEmpty()}hasAltTextData(){var e;return((e=l(this,et))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=l(this,Ge))==null||e.focusButton()}addCommentButton(){return this.canAddComment?l(this,Ge)||_(this,Ge,new qp(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(l(this,Zi)){this._uiManager.isEditingMode()&&l(this,Zi).classList.remove("hidden");return}this.hasComment&&(_(this,Zi,l(this,Ge).renderForStandalone()),this.div.append(l(this,Zi)))}}removeStandaloneCommentButton(){l(this,Ge).removeStandaloneCommentButton(),_(this,Zi,null)}hideStandaloneCommentButton(){var e;(e=l(this,Zi))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:s,deleted:i}}=l(this,Ge);return{text:t,richText:e,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){l(this,Ge)||_(this,Ge,new qp(this)),l(this,Ge).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(l(this,Ge)||_(this,Ge,new qp(this)),l(this,Ge).setInitialText(e,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=l(this,Ge))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=l(this,Ge))==null?void 0:e.isDeleted()}get hasComment(){return!!l(this,Ge)&&!l(this,Ge).isEmpty()&&!l(this,Ge).isDeleted()}async editComment(e){l(this,Ge)||_(this,Ge,new qp(this)),l(this,Ge).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){l(this,Ge).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,a=o+r+1,c=i-100,d=a+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,c,d,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){l(this,Ge).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=l(this,Wc)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),E(this,ce,sx).call(this);const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),yC(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(l(this,ja)||_(this,ja,new cg({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:E(this,ce,FC).bind(this),onPinching:E(this,ce,jC).bind(this),onPinchEnd:E(this,ce,OC).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Tt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(_(this,La,!0),this._isDraggable){E(this,ce,UC).call(this,e);return}E(this,ce,tx).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){l(this,hi)&&clearTimeout(l(this,hi)),_(this,hi,setTimeout(()=>{var e;_(this,hi,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[a,c]=this.pageTranslation,d=e/i,u=t/i,m=this.x*r,p=this.y*o,y=this.width*r,v=this.height*o;switch(s){case 0:return[m+d+a,o-p-u-v+c,m+d+y+a,o-p-u+c];case 90:return[m+u+a,o-p+d+c,m+u+v+a,o-p+d+y+c];case 180:return[m-d-y+a,o-p+u+c,m-d+a,o-p+u+v+c];case 270:return[m-u-v+a,o-p-d-y+c,m-u+a,o-p-d+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,i,r,o]=e,a=r-s,c=o-i;switch(this.rotation){case 0:return[s,t-o,a,c];case 90:return[s,t-i,c,a];case 180:return[r,t-i,a,c];case 270:return[r,t-o,c,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&me._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=l(this,Ge))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:i,deleted:r,richText:o},uid:a,pageIndex:c,creationDate:d,modificationDate:u}=this;return{id:a,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:d,modificationDate:s||u,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),_(this,Fa,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),_(this,Fa,!1),!0):!1}isInEditMode(){return l(this,Fa)}shouldGetKeyboardEvents(){return l(this,tr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&s>0}rebuild(){E(this,ce,sx).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var s;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((s=this._initialData)==null?void 0:s.popupRef)||""}}static async deserialize(e,t,s){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,_(i,Ma,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,o]=i.pageDimensions,[a,c,d,u]=i.getRectInCurrentCoords(e.rect,o);return i.x=a/r,i.y=c/o,i.width=d/r,i.height=u/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,s;if((e=l(this,_o))==null||e.abort(),_(this,_o,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),l(this,hi)&&(clearTimeout(l(this,hi)),_(this,hi,null)),E(this,ce,Du).call(this),this.removeEditToolbar(),l(this,pn)){for(const i of l(this,pn).values())clearTimeout(i);_(this,pn,null)}this.parent=null,(t=l(this,ja))==null||t.destroy(),_(this,ja,null),(s=l(this,fn))==null||s.remove(),_(this,fn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(E(this,ce,DC).call(this),l(this,Ht).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,i,r,o]=this.getPDFRect();return[me._round(s+(r-s)*e),me._round(i+(o-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return l(this,Ge).commentPopupPositionInLayer}set commentPopupPosition(e){l(this,Ge).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return l(this,Ge).hasDefaultPopupPosition()}get commentButtonWidth(){return l(this,Ge).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=l(this,Ge))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),_(this,er,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=l(this,Ht).children;if(!l(this,Ln)){_(this,Ln,Array.from(t));const o=E(this,ce,BC).bind(this),a=E(this,ce,HC).bind(this),c=this._uiManager._signal;for(const d of l(this,Ln)){const u=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",o,{signal:c}),d.addEventListener("blur",a,{signal:c}),d.addEventListener("focus",E(this,ce,GC).bind(this,u),{signal:c}),d.setAttribute("data-l10n-id",me._l10nResizer[u])}}const s=l(this,Ln)[0];let i=0;for(const o of t){if(o===s)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(l(this,Ln).length/4);if(r!==i){if(r<i)for(let a=0;a<i-r;a++)l(this,Ht).append(l(this,Ht).firstElementChild);else if(r>i)for(let a=0;a<r-i;a++)l(this,Ht).firstElementChild.before(l(this,Ht).lastElementChild);let o=0;for(const a of t){const d=l(this,Ln)[o++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",me._l10nResizer[d])}}E(this,ce,nx).call(this,0),_(this,tr,!0),l(this,Ht).firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){l(this,tr)&&E(this,ce,ex).call(this,l(this,Kh),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){E(this,ce,Du).call(this),this.div.focus()}select(){var e,t,s;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(s=l(this,et))==null||s.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,s,i,r;this.isSelected&&(this.isSelected=!1,(e=l(this,Ht))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=l(this,et))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return l(this,Yh)}set isEditing(e){_(this,Yh,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){l(this,pn)||_(this,pn,new Map);const{action:s}=e;let i=l(this,pn).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),l(this,pn).delete(s),l(this,pn).size===0&&_(this,pn,null)},me._telemetryTimeout),l(this,pn).set(s,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),_(this,Wc,!1)}disable(){this.div&&(this.div.tabIndex=-1),_(this,Wc,!0)}updateFakeAnnotationElement(e){if(!l(this,fn)&&!this.deleted){_(this,fn,e.addFakeAnnotation(this));return}if(this.deleted){l(this,fn).remove(),_(this,fn,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&l(this,fn).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Ma=new WeakMap,Ln=new WeakMap,et=new WeakMap,Ge=new WeakMap,Zi=new WeakMap,Wc=new WeakMap,wo=new WeakMap,Wh=new WeakMap,Ht=new WeakMap,Da=new WeakMap,er=new WeakMap,fn=new WeakMap,_o=new WeakMap,Kh=new WeakMap,La=new WeakMap,Ms=new WeakMap,Yh=new WeakMap,Fa=new WeakMap,tr=new WeakMap,hi=new WeakMap,Kc=new WeakMap,Yc=new WeakMap,pn=new WeakMap,ja=new WeakMap,Jh=new WeakMap,Sg=new WeakMap,ce=new WeakSet,Xy=function([e,t],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Xh=new WeakSet,Qy=function(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},fm=function(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}},DC=function(){if(l(this,Ht))return;_(this,Ht,document.createElement("div")),l(this,Ht).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const i=document.createElement("div");l(this,Ht).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",E(this,ce,LC).bind(this,s),{signal:t}),i.addEventListener("contextmenu",Sn,{signal:t}),i.tabIndex=-1}this.div.prepend(l(this,Ht))},LC=function(e,t){var u;t.preventDefault();const{isMac:s}=Tt.platform;if(t.button!==0||t.ctrlKey&&s)return;(u=l(this,et))==null||u.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,_(this,Da,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",E(this,ce,ex).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ft,{passive:!1,signal:o}),window.addEventListener("contextmenu",Sn,{signal:o}),_(this,er,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const a=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const d=()=>{var m;r.abort(),this.parent.togglePointerEvents(!0),(m=l(this,et))==null||m.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=c,E(this,ce,pm).call(this)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})},Zy=function(e,t,s,i){this.width=s,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},pm=function(){if(!l(this,er))return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:i}=l(this,er);_(this,er,null);const r=this.x,o=this.y,a=this.width,c=this.height;r===e&&o===t&&a===s&&c===i||this.addCommands({cmd:E(this,ce,Zy).bind(this,r,o,a,c),undo:E(this,ce,Zy).bind(this,e,t,s,i),mustExec:!0})},ex=function(e,t){const[s,i]=this.parentDimensions,r=this.x,o=this.y,a=this.width,c=this.height,d=me.MIN_SIZE/s,u=me.MIN_SIZE/i,m=E(this,ce,fm).call(this,this.rotation),p=(U,H)=>[m[0]*U+m[2]*H,m[1]*U+m[3]*H],y=E(this,ce,fm).call(this,360-this.rotation),v=(U,H)=>[y[0]*U+y[2]*H,y[1]*U+y[3]*H];let x,b,w=!1,S=!1;switch(e){case"topLeft":w=!0,x=(U,H)=>[0,0],b=(U,H)=>[U,H];break;case"topMiddle":x=(U,H)=>[U/2,0],b=(U,H)=>[U/2,H];break;case"topRight":w=!0,x=(U,H)=>[U,0],b=(U,H)=>[0,H];break;case"middleRight":S=!0,x=(U,H)=>[U,H/2],b=(U,H)=>[0,H/2];break;case"bottomRight":w=!0,x=(U,H)=>[U,H],b=(U,H)=>[0,0];break;case"bottomMiddle":x=(U,H)=>[U/2,H],b=(U,H)=>[U/2,0];break;case"bottomLeft":w=!0,x=(U,H)=>[0,H],b=(U,H)=>[U,0];break;case"middleLeft":S=!0,x=(U,H)=>[0,H/2],b=(U,H)=>[U,H/2];break}const A=x(a,c),k=b(a,c);let T=p(...k);const N=me._round(r+T[0]),I=me._round(o+T[1]);let D=1,P=1,R,j;if(t.fromKeyboard)({deltaX:R,deltaY:j}=t);else{const{screenX:U,screenY:H}=t,[J,Y]=l(this,Da);[R,j]=this.screenToPageTranslation(U-J,H-Y),l(this,Da)[0]=U,l(this,Da)[1]=H}if([R,j]=v(R/s,j/i),w){const U=Math.hypot(a,c);D=P=Math.max(Math.min(Math.hypot(k[0]-A[0]-R,k[1]-A[1]-j)/U,1/a,1/c),d/a,u/c)}else S?D=fs(Math.abs(k[0]-A[0]-R),d,1)/a:P=fs(Math.abs(k[1]-A[1]-j),u,1)/c;const $=me._round(a*D),B=me._round(c*P);T=p(...b($,B));const V=N-T[0],L=I-T[1];l(this,Ms)||_(this,Ms,[this.x,this.y,this.width,this.height]),this.width=$,this.height=B,this.x=V,this.y=L,this.setDims(),this.fixAndSetPosition(),this._onResizing()},FC=function(){var e;_(this,er,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=l(this,et))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},jC=function(e,t,s){let r=.7*(s/t)+1-.7;if(r===1)return;const o=E(this,ce,fm).call(this,this.rotation),a=(N,I)=>[o[0]*N+o[2]*I,o[1]*N+o[3]*I],[c,d]=this.parentDimensions,u=this.x,m=this.y,p=this.width,y=this.height,v=me.MIN_SIZE/c,x=me.MIN_SIZE/d;r=Math.max(Math.min(r,1/p,1/y),v/p,x/y);const b=me._round(p*r),w=me._round(y*r);if(b===p&&w===y)return;l(this,Ms)||_(this,Ms,[u,m,p,y]);const S=a(p/2,y/2),A=me._round(u+S[0]),k=me._round(m+S[1]),T=a(b/2,w/2);this.x=A-T[0],this.y=k-T[1],this.width=b,this.height=w,this.setDims(),this.fixAndSetPosition(),this._onResizing()},OC=function(){var e;(e=l(this,et))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),E(this,ce,pm).call(this)},tx=function(e){const{isMac:t}=Tt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},UC=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},a=d=>{i.abort(),_(this,wo,null),_(this,La,!1),this._uiManager.endDragSession()||E(this,ce,tx).call(this,d),s&&this._onStopDragging()};t&&(_(this,Kc,e.clientX),_(this,Yc,e.clientY),_(this,wo,e.pointerId),_(this,Wh,e.pointerType),window.addEventListener("pointermove",d=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:u,clientY:m,pointerId:p}=d;if(p!==l(this,wo)){ft(d);return}const[y,v]=this.screenToPageTranslation(u-l(this,Kc),m-l(this,Yc));_(this,Kc,u),_(this,Yc,m),this._uiManager.dragSelectedEditors(y,v)},o),window.addEventListener("touchmove",ft,o),window.addEventListener("pointerdown",d=>{d.pointerType===l(this,Wh)&&(l(this,ja)||d.isPrimary)&&a(d),ft(d)},o));const c=d=>{if(!l(this,wo)||l(this,wo)===d.pointerId){a(d);return}ft(d)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},sx=function(){if(l(this,_o)||!this.div)return;_(this,_o,new AbortController);const e=this._uiManager.combinedSignal(l(this,_o));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},BC=function(e){me._resizerKeyboardManager.exec(this,e)},HC=function(e){var t;l(this,tr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==l(this,Ht)&&E(this,ce,Du).call(this)},GC=function(e){_(this,Kh,l(this,tr)?e:"")},nx=function(e){if(l(this,Ln))for(const t of l(this,Ln))t.tabIndex=e},Du=function(){_(this,tr,!1),E(this,ce,nx).call(this,-1),E(this,ce,pm).call(this)},C(me,Xh),W(me,"_l10n",null),W(me,"_l10nResizer",null),W(me,"_borderLineWidth",-1),W(me,"_colorManager",new $y),W(me,"_zIndex",1),W(me,"_telemetryTimeout",1e3);let Ye=me;class Wj extends Ye{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const C_=3285377520,sn=4294901760,Qn=65535;class qC{constructor(e){this.h1=e?e&4294967295:C_,this.h2=e?e&4294967295:C_}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let x=0,b=e.length;x<b;x++){const w=e.charCodeAt(x);w<=255?t[s++]=w:(t[s++]=w>>>8,t[s++]=w&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,r=s-i*4,o=new Uint32Array(t.buffer,0,i);let a=0,c=0,d=this.h1,u=this.h2;const m=3432918353,p=461845907,y=m&Qn,v=p&Qn;for(let x=0;x<i;x++)x&1?(a=o[x],a=a*m&sn|a*y&Qn,a=a<<15|a>>>17,a=a*p&sn|a*v&Qn,d^=a,d=d<<13|d>>>19,d=d*5+3864292196):(c=o[x],c=c*m&sn|c*y&Qn,c=c<<15|c>>>17,c=c*p&sn|c*v&Qn,u^=c,u=u<<13|u>>>19,u=u*5+3864292196);switch(a=0,r){case 3:a^=t[i*4+2]<<16;case 2:a^=t[i*4+1]<<8;case 1:a^=t[i*4],a=a*m&sn|a*y&Qn,a=a<<15|a>>>17,a=a*p&sn|a*v&Qn,i&1?d^=a:u^=a}this.h1=d,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&sn|e*36045&Qn,t=t*4283543511&sn|((t<<16|e>>>16)*2950163797&sn)>>>16,e^=t>>>1,e=e*444984403&sn|e*60499&Qn,t=t*3301882366&sn|((t<<16|e>>>16)*3120437893&sn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const ix=Object.freeze({map:null,hash:"",transfer:void 0});var Oa,Ua,sr,Gt,Cg,VC;class Ub{constructor(){C(this,Cg);C(this,Oa,!1);C(this,Ua,null);C(this,sr,null);C(this,Gt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=l(this,Gt).get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return l(this,Gt).get(e)}remove(e){const t=l(this,Gt).get(e);if(t!==void 0&&(t instanceof Ye&&l(this,sr).delete(t.annotationElementId),l(this,Gt).delete(e),l(this,Gt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of l(this,Gt).values())if(s instanceof Ye)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=l(this,Gt).get(e);let i=!1;if(s!==void 0)for(const[r,o]of Object.entries(t))s[r]!==o&&(i=!0,s[r]=o);else i=!0,l(this,Gt).set(e,t);i&&E(this,Cg,VC).call(this),t instanceof Ye&&((l(this,sr)||_(this,sr,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return l(this,Gt).has(e)}get size(){return l(this,Gt).size}resetModified(){l(this,Oa)&&(_(this,Oa,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new $C(this)}get serializable(){if(l(this,Gt).size===0)return ix;const e=new Map,t=new qC,s=[],i=Object.create(null);let r=!1;for(const[o,a]of l(this,Gt)){const c=a instanceof Ye?a.serialize(!1,i):a;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),r||(r=!!c.bitmap))}if(r)for(const o of e.values())o.bitmap&&s.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:ix}get editorStats(){let e=null;const t=new Map;let s=0,i=0;for(const r of l(this,Gt).values()){if(!(r instanceof Ye)){r.popup&&(r.popup.deleted?i+=1:s+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(s+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:a}=o;t.has(a)||t.set(a,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const c=e[a]||(e[a]=new Map);for(const[d,u]of Object.entries(o)){if(d==="type")continue;let m=c.get(d);m||(m=new Map,c.set(d,m));const p=m.get(u)??0;m.set(u,p+1)}}if((i>0||s>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:s}),!e)return null;for(const[r,o]of t)e[r]=o.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){_(this,Ua,null)}updateEditor(e,t){var i;const s=(i=l(this,sr))==null?void 0:i.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=l(this,sr))==null?void 0:t.get(e))||null}get modifiedIds(){if(l(this,Ua))return l(this,Ua);const e=[];if(l(this,sr))for(const t of l(this,sr).values())t.serialize()&&e.push(t.annotationElementId);return _(this,Ua,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return l(this,Gt).entries()}}Oa=new WeakMap,Ua=new WeakMap,sr=new WeakMap,Gt=new WeakMap,Cg=new WeakSet,VC=function(){l(this,Oa)||(_(this,Oa,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Qh;class $C extends Ub{constructor(t){super();C(this,Qh);const{map:s,hash:i,transfer:r}=t.serializable,o=structuredClone(s,r?{transfer:r}:null);_(this,Qh,{map:o,hash:i,transfer:r})}get print(){ze("Should not call PrintAnnotationStorage.print")}get serializable(){return l(this,Qh)}get modifiedIds(){return pe(this,"modifiedIds",{ids:new Set,hash:""})}}Qh=new WeakMap;var Jc;class Kj{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){C(this,Jc,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),l(this,Jc).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||l(this,Jc).has(e.loadedName))){if(ke(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:o}=e,a=new FontFace(i,r,o);this.addNativeFontFace(a);try{await a.load(),l(this,Jc).add(i),s==null||s(e)}catch{fe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}ze("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw fe(`Failed to load font '${s.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return pe(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return pe(this,"isSyncFontLoadingSupported",hs||Tt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ke(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const r=s.shift();setTimeout(r.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:t,callback:e};return s.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return pe(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(k,T){return k.charCodeAt(T)<<24|k.charCodeAt(T+1)<<16|k.charCodeAt(T+2)<<8|k.charCodeAt(T+3)&255}function i(k,T,N,I){const D=k.substring(0,T),P=k.substring(T+N);return D+I+P}let r,o;const a=this._document.createElement("canvas");a.width=1,a.height=1;const c=a.getContext("2d");let d=0;function u(k,T){if(++d>30){fe("Load test font never loaded."),T();return}if(c.font="30px "+k,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){T();return}setTimeout(u.bind(null,k,T))}const m=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=i(p,976,m.length,m);const v=16,x=1482184792;let b=s(p,v);for(r=0,o=m.length-3;r<o;r+=4)b=b-x+s(m,r)|0;r<m.length&&(b=b-x+s(m+"XXX",r)|0),p=i(p,v,4,Tj(b));const w=`url(data:font/opentype;base64,${btoa(p)});`,S=`@font-face {font-family:"${m}";src:${w}}`;this.insertRule(S);const A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(const k of[e.loadedName,m]){const T=this._document.createElement("span");T.textContent="Hi",T.style.fontFamily=k,A.append(T)}this._document.body.append(A),u(m,()=>{A.remove(),t.complete()})}}Jc=new WeakMap;var je;class Yj{constructor(e,t=null,s,i){C(this,je);this.compiledGlyphs=Object.create(null),_(this,je,e),this._inspectFont=t,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${lC(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(s=this._inspectFont)==null||s.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let i;try{i=e.get(s)}catch(o){fe(`getPathGenerator - ignoring character: "${o}".`)}const r=uC(i==null?void 0:i.path);return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=r}get black(){return l(this,je).black}get bold(){return l(this,je).bold}get disableFontFace(){return l(this,je).disableFontFace??!1}set disableFontFace(e){pe(this,"disableFontFace",!!e)}get fontExtraProperties(){return l(this,je).fontExtraProperties??!1}get isInvalidPDFjsFont(){return l(this,je).isInvalidPDFjsFont}get isType3Font(){return l(this,je).isType3Font}get italic(){return l(this,je).italic}get missingFile(){return l(this,je).missingFile}get remeasure(){return l(this,je).remeasure}get vertical(){return l(this,je).vertical}get ascent(){return l(this,je).ascent}get defaultWidth(){return l(this,je).defaultWidth}get descent(){return l(this,je).descent}get bbox(){return l(this,je).bbox}set bbox(e){pe(this,"bbox",e)}get fontMatrix(){return l(this,je).fontMatrix}get fallbackName(){return l(this,je).fallbackName}get loadedName(){return l(this,je).loadedName}get mimetype(){return l(this,je).mimetype}get name(){return l(this,je).name}get data(){return l(this,je).data}clearData(){l(this,je).clearData()}get cssFontInfo(){return l(this,je).cssFontInfo}get systemFontInfo(){return l(this,je).systemFontInfo}get defaultVMetrics(){return l(this,je).defaultVMetrics}}je=new WeakMap;var Xc,Qc,Zh,Zc,mm;const uc=class uc{constructor(e){C(this,Zc);C(this,Xc);C(this,Qc);C(this,Zh);_(this,Xc,e),_(this,Qc,new DataView(l(this,Xc))),_(this,Zh,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const d of uc.strings){const u=t.encode(e[d]);s[d]=u,i+=4+u.length}const r=new ArrayBuffer(i),o=new Uint8Array(r),a=new DataView(r);let c=0;for(const d of uc.strings){const u=s[d],m=u.length;a.setUint32(c,m),o.set(u,c+4),c+=4+m}return ke(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return E(this,Zc,mm).call(this,0)}get fontWeight(){return E(this,Zc,mm).call(this,1)}get italicAngle(){return E(this,Zc,mm).call(this,2)}};Xc=new WeakMap,Qc=new WeakMap,Zh=new WeakMap,Zc=new WeakSet,mm=function(e){ke(e<uc.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=l(this,Qc).getUint32(t)+4;const s=l(this,Qc).getUint32(t);return l(this,Zh).decode(new Uint8Array(l(this,Xc),t+4,s))},W(uc,"strings",["fontFamily","fontWeight","italicAngle"]);let dg=uc;var Ao,fi,Ba,Ha,Lu;const hc=class hc{constructor(e){C(this,Ha);C(this,Ao);C(this,fi);C(this,Ba);_(this,Ao,e),_(this,fi,new DataView(l(this,Ao))),_(this,Ba,new TextDecoder)}static write(e){const t=new TextEncoder,s={};let i=0;for(const p of hc.strings){const y=t.encode(e[p]);s[p]=y,i+=4+y.length}i+=4;let r,o,a=1+i;e.style&&(r=t.encode(e.style.style),o=t.encode(e.style.weight),a+=4+r.length+4+o.length);const c=new ArrayBuffer(a),d=new Uint8Array(c),u=new DataView(c);let m=0;u.setUint8(m++,e.guessFallback?1:0),u.setUint32(m,0),m+=4,i=0;for(const p of hc.strings){const y=s[p],v=y.length;i+=4+v,u.setUint32(m,v),d.set(y,m+4),m+=4+v}return u.setUint32(m-i-4,i),e.style&&(u.setUint32(m,r.length),d.set(r,m+4),m+=4+r.length,u.setUint32(m,o.length),d.set(o,m+4),m+=4+o.length),ke(m<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(m)}get guessFallback(){return l(this,fi).getUint8(0)!==0}get css(){return E(this,Ha,Lu).call(this,0)}get loadedName(){return E(this,Ha,Lu).call(this,1)}get baseFontName(){return E(this,Ha,Lu).call(this,2)}get src(){return E(this,Ha,Lu).call(this,3)}get style(){let e=1;e+=4+l(this,fi).getUint32(e);const t=l(this,fi).getUint32(e),s=l(this,Ba).decode(new Uint8Array(l(this,Ao),e+4,t));e+=4+t;const i=l(this,fi).getUint32(e),r=l(this,Ba).decode(new Uint8Array(l(this,Ao),e+4,i));return{style:s,weight:r}}};Ao=new WeakMap,fi=new WeakMap,Ba=new WeakMap,Ha=new WeakSet,Lu=function(e){ke(e<hc.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=l(this,fi).getUint32(t)+4;const s=l(this,fi).getUint32(t);return l(this,Ba).decode(new Uint8Array(l(this,Ao),t+4,s))},W(hc,"strings",["css","loadedName","baseFontName","src"]);let ug=hc;var ed,td,sd,nd,Ds,pi,ef,Oe,ht,Tn,gm,Fu;const ye=class ye{constructor({data:e,extra:t}){C(this,ht);C(this,pi);C(this,ef);C(this,Oe);_(this,pi,e),_(this,ef,new TextDecoder),_(this,Oe,new DataView(l(this,pi))),t&&Object.assign(this,t)}get black(){return E(this,ht,Tn).call(this,0)}get bold(){return E(this,ht,Tn).call(this,1)}get disableFontFace(){return E(this,ht,Tn).call(this,2)}get fontExtraProperties(){return E(this,ht,Tn).call(this,3)}get isInvalidPDFjsFont(){return E(this,ht,Tn).call(this,4)}get isType3Font(){return E(this,ht,Tn).call(this,5)}get italic(){return E(this,ht,Tn).call(this,6)}get missingFile(){return E(this,ht,Tn).call(this,7)}get remeasure(){return E(this,ht,Tn).call(this,8)}get vertical(){return E(this,ht,Tn).call(this,9)}get ascent(){return E(this,ht,gm).call(this,0)}get defaultWidth(){return E(this,ht,gm).call(this,1)}get descent(){return E(this,ht,gm).call(this,2)}get bbox(){let e=l(ye,td);if(l(this,Oe).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<4;i++)s.push(l(this,Oe).getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=l(ye,sd);if(l(this,Oe).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<6;i++)s.push(l(this,Oe).getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=l(ye,nd);if(l(this,Oe).getUint8(e)===0)return;e+=1;const s=[];for(let i=0;i<3;i++)s.push(l(this,Oe).getInt16(e,!0)),e+=2;return s}get fallbackName(){return E(this,ht,Fu).call(this,0)}get loadedName(){return E(this,ht,Fu).call(this,1)}get mimetype(){return E(this,ht,Fu).call(this,2)}get name(){return E(this,ht,Fu).call(this,3)}get data(){let e=l(ye,Ds);const t=l(this,Oe).getUint32(e);e+=4+t;const s=l(this,Oe).getUint32(e);e+=4+s;const i=l(this,Oe).getUint32(e);e+=4+i;const r=l(this,Oe).getUint32(e);if(r!==0)return new Uint8Array(l(this,pi),e+4,r)}clearData(){let e=l(ye,Ds);const t=l(this,Oe).getUint32(e);e+=4+t;const s=l(this,Oe).getUint32(e);e+=4+s;const i=l(this,Oe).getUint32(e);e+=4+i;const r=l(this,Oe).getUint32(e);new Uint8Array(l(this,pi),e+4,r).fill(0),l(this,Oe).setUint32(e,0)}get cssFontInfo(){let e=l(ye,Ds);const t=l(this,Oe).getUint32(e);e+=4+t;const s=l(this,Oe).getUint32(e);e+=4+s;const i=l(this,Oe).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(l(this,pi),e+4,i)),new dg(r.buffer)}get systemFontInfo(){let e=l(ye,Ds);const t=l(this,Oe).getUint32(e);e+=4+t;const s=l(this,Oe).getUint32(e);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(l(this,pi),e+4,s)),new ug(i.buffer)}static write(e){const t=e.systemFontInfo?ug.write(e.systemFontInfo):null,s=e.cssFontInfo?dg.write(e.cssFontInfo):null,i=new TextEncoder,r={};let o=0;for(const x of ye.strings)r[x]=i.encode(e[x]),o+=4+r[x].length;const a=l(ye,Ds)+4+o+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),c=new ArrayBuffer(a),d=new Uint8Array(c),u=new DataView(c);let m=0;const p=ye.bools.length;let y=0,v=0;for(let x=0;x<p;x++){const b=e[ye.bools[x]];y|=(b===void 0?0:b?2:1)<<v,v+=2,(v===8||x===p-1)&&(u.setUint8(m++,y),y=0,v=0)}ke(m===l(ye,ed),"FontInfo.write: Boolean properties offset mismatch");for(const x of ye.numbers)u.setFloat64(m,e[x]),m+=8;if(ke(m===l(ye,td),"FontInfo.write: Number properties offset mismatch"),e.bbox){u.setUint8(m++,4);for(const x of e.bbox)u.setInt16(m,x,!0),m+=2}else u.setUint8(m++,0),m+=2*4;if(ke(m===l(ye,sd),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){u.setUint8(m++,6);for(const x of e.fontMatrix)u.setFloat64(m,x,!0),m+=8}else u.setUint8(m++,0),m+=8*6;if(ke(m===l(ye,nd),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){u.setUint8(m++,1);for(const x of e.defaultVMetrics)u.setInt16(m,x,!0),m+=2}else u.setUint8(m++,0),m+=3*2;ke(m===l(ye,Ds),"FontInfo.write: DefaultVMetrics properties offset mismatch"),u.setUint32(l(ye,Ds),0),m+=4;for(const x of ye.strings){const b=r[x],w=b.length;u.setUint32(m,w),d.set(b,m+4),m+=4+w}if(u.setUint32(l(ye,Ds),m-l(ye,Ds)-4),!t)u.setUint32(m,0),m+=4;else{const x=t.byteLength;u.setUint32(m,x),ke(m+4+x<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),d.set(new Uint8Array(t),m+4),m+=4+x}if(!s)u.setUint32(m,0),m+=4;else{const x=s.byteLength;u.setUint32(m,x),ke(m+4+x<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),d.set(new Uint8Array(s),m+4),m+=4+x}return e.data===void 0?(u.setUint32(m,0),m+=4):(u.setUint32(m,e.data.length),d.set(e.data,m+4),m+=4+e.data.length),ke(m<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(m)}};ed=new WeakMap,td=new WeakMap,sd=new WeakMap,nd=new WeakMap,Ds=new WeakMap,pi=new WeakMap,ef=new WeakMap,Oe=new WeakMap,ht=new WeakSet,Tn=function(e){ke(e<ye.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,i=l(this,Oe).getUint8(t)>>s&3;return i===0?void 0:i===2},gm=function(e){return ke(e<ye.numbers.length,"Invalid number index"),l(this,Oe).getFloat64(l(ye,ed)+e*8)},Fu=function(e){ke(e<ye.strings.length,"Invalid string index");let t=l(ye,Ds)+4;for(let r=0;r<e;r++)t+=l(this,Oe).getUint32(t)+4;const s=l(this,Oe).getUint32(t),i=new Uint8Array(s);return i.set(new Uint8Array(l(this,pi),t+4,s)),l(this,ef).decode(i)},W(ye,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),W(ye,"numbers",["ascent","defaultWidth","descent"]),W(ye,"strings",["fallbackName","loadedName","mimetype","name"]),C(ye,ed,Math.ceil(ye.bools.length*2/8)),C(ye,td,l(ye,ed)+ye.numbers.length*8),C(ye,sd,l(ye,td)+1+2*4),C(ye,nd,l(ye,sd)+1+8*6),C(ye,Ds,l(ye,nd)+1+2*3);let rx=ye;var tf,sf,nf,rf,of,af,lf,cf;const We=class We{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,s=null,i=[],r=[],o=[],a=[],c=null,d=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,s=e[2],o=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,c=e[1],i=e[2],r=e[3],a=e[4]||[],s=e[6],d=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const u=Math.floor(i.length/2),m=Math.floor(r.length/3),p=o.length,y=a.length;let v=0;for(const T of a)v+=1,v=Math.ceil(v/4)*4,v+=4+T.coords.length*4,v+=4+T.colors.length*4,T.verticesPerRow!==void 0&&(v+=4);const x=20+u*8+m*3+p*8+(s?16:0)+(d?3:0)+v,b=new ArrayBuffer(x),w=new DataView(b),S=new Uint8Array(b);w.setUint8(l(We,tf),t),w.setUint8(l(We,sf),s?1:0),w.setUint8(l(We,nf),d?1:0),w.setUint8(l(We,rf),c),w.setUint32(l(We,of),u,!0),w.setUint32(l(We,af),m,!0),w.setUint32(l(We,lf),p,!0),w.setUint32(l(We,cf),y,!0);let A=20;new Float32Array(b,A,u*2).set(i),A+=u*8,S.set(r,A),A+=m*3;for(const[T,N]of o)w.setFloat32(A,T,!0),A+=4,w.setUint32(A,parseInt(N.slice(1),16),!0),A+=4;if(s)for(const T of s)w.setFloat32(A,T,!0),A+=4;d&&(S.set(d,A),A+=3);for(let T=0;T<a.length;T++){const N=a[T];w.setUint8(A,N.type),A+=1,A=Math.ceil(A/4)*4,w.setUint32(A,N.coords.length,!0),A+=4,new Int32Array(b,A,N.coords.length).set(N.coords),A+=N.coords.length*4,w.setUint32(A,N.colors.length,!0),A+=4,new Int32Array(b,A,N.colors.length).set(N.colors),A+=N.colors.length*4,N.verticesPerRow!==void 0&&(w.setUint32(A,N.verticesPerRow,!0),A+=4)}return b}getIR(){const e=this.view,t=this.data[l(We,tf)],s=!!this.data[l(We,sf)],i=!!this.data[l(We,nf)],r=e.getUint32(l(We,of),!0),o=e.getUint32(l(We,af),!0),a=e.getUint32(l(We,lf),!0),c=e.getUint32(l(We,cf),!0);let d=20;const u=new Float32Array(this.buffer,d,r*2);d+=r*8;const m=new Uint8Array(this.buffer,d,o*3);d+=o*3;const p=[];for(let b=0;b<a;++b){const w=e.getFloat32(d,!0);d+=4;const S=e.getUint32(d,!0);d+=4,p.push([w,`#${S.toString(16).padStart(6,"0")}`])}let y=null;if(s){y=[];for(let b=0;b<4;++b)y.push(e.getFloat32(d,!0)),d+=4}let v=null;i&&(v=new Uint8Array(this.buffer,d,3),d+=3);const x=[];for(let b=0;b<c;++b){const w=e.getUint8(d);d+=1,d=Math.ceil(d/4)*4;const S=e.getUint32(d,!0);d+=4;const A=new Int32Array(this.buffer,d,S);d+=S*4;const k=e.getUint32(d,!0);d+=4;const T=new Int32Array(this.buffer,d,k);d+=k*4;const N={type:w,coords:A,colors:T};w===jy.LATTICE&&(N.verticesPerRow=e.getUint32(d,!0),d+=4),x.push(N)}if(t===1)return["RadialAxial","axial",y,p,Array.from(u.slice(0,2)),Array.from(u.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",y,p,[u[0],u[1]],[u[3],u[4]],u[2],u[5]];if(t===3){const b=this.data[l(We,rf)];let w=null;if(u.length>0){let S=u[0],A=u[0],k=u[1],T=u[1];for(let N=0;N<u.length;N+=2){const I=u[N],D=u[N+1];S=S>I?I:S,k=k>D?D:k,A=A<I?I:A,T=T<D?D:T}w=[S,k,A,T]}return["Mesh",b,u,m,x,w,y,v]}throw new Error(`Unsupported pattern kind: ${t}`)}};tf=new WeakMap,sf=new WeakMap,nf=new WeakMap,rf=new WeakMap,of=new WeakMap,af=new WeakMap,lf=new WeakMap,cf=new WeakMap,C(We,tf,0),C(We,sf,1),C(We,nf,2),C(We,rf,3),C(We,of,4),C(We,af,8),C(We,lf,12),C(We,cf,16);let ox=We;var id;class Jj{constructor(e){C(this,id);_(this,id,e)}static write(e){let t,s;return Tt.isFloat16ArraySupported?(s=new ArrayBuffer(e.length*2),t=new Float16Array(s)):(s=new ArrayBuffer(e.length*4),t=new Float32Array(s)),t.set(e),s}get path(){return Tt.isFloat16ArraySupported?new Float16Array(l(this,id)):new Float32Array(l(this,id))}}id=new WeakMap;function Xj(n){if(n instanceof URL)return n.href;if(typeof n=="string"){if(hs)return n;const e=URL.parse(n,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Qj(n){if(hs&&typeof Buffer<"u"&&n instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength)return n;if(typeof n=="string")return bp(n);if(n instanceof ArrayBuffer||ArrayBuffer.isView(n)||typeof n=="object"&&!isNaN(n==null?void 0:n.length))return new Uint8Array(n);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Vp(n){if(typeof n!="string")return null;if(n.endsWith("/"))return n;throw new Error(`Invalid factory url: "${n}" must include trailing slash.`)}const ax=n=>typeof n=="object"&&Number.isInteger(n==null?void 0:n.num)&&n.num>=0&&Number.isInteger(n==null?void 0:n.gen)&&n.gen>=0,Zj=n=>typeof n=="object"&&typeof(n==null?void 0:n.name)=="string",e4=Mj.bind(null,ax,Zj);var nr,Eg;class t4{constructor(){C(this,nr,new Map);C(this,Eg,Promise.resolve())}postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};l(this,Eg).then(()=>{for(const[i]of l(this,nr))i.call(this,s)})}addEventListener(e,t,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:r}=s;if(r.aborted){fe("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}l(this,nr).set(t,i)}removeEventListener(e,t){const s=l(this,nr).get(t);s==null||s(),l(this,nr).delete(t)}terminate(){for(const[,e]of l(this,nr))e==null||e();l(this,nr).clear()}}nr=new WeakMap,Eg=new WeakMap;const $p={DATA:1,ERROR:2},yt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function E_(){}function vs(n){if(n instanceof Zo||n instanceof Oy||n instanceof x_||n instanceof og||n instanceof C0)return n;switch(n instanceof Error||typeof n=="object"&&n!==null||ze('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),n.name){case"AbortException":return new Zo(n.message);case"InvalidPDFException":return new Oy(n.message);case"PasswordException":return new x_(n.message,n.code);case"ResponseException":return new og(n.message,n.status,n.missing);case"UnknownErrorException":return new C0(n.message,n.details)}return new C0(n.message,n.toString())}var rd,_n,zC,WC,KC,ym;class ju{constructor(e,t,s){C(this,_n);C(this,rd,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",E(this,_n,zC).bind(this),{signal:l(this,rd).signal})}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},s)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,s,i){const r=this.streamId++,o=this.sourceName,a=this.targetName,c=this.comObj;return new ReadableStream({start:d=>{const u=Promise.withResolvers();return this.streamControllers[r]={controller:d,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:a,action:e,streamId:r,data:t,desiredSize:d.desiredSize},i),u.promise},pull:d=>{const u=Promise.withResolvers();return this.streamControllers[r].pullCall=u,c.postMessage({sourceName:o,targetName:a,stream:yt.PULL,streamId:r,desiredSize:d.desiredSize}),u.promise},cancel:d=>{ke(d instanceof Error,"cancel must have a valid reason");const u=Promise.withResolvers();return this.streamControllers[r].cancelCall=u,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:a,stream:yt.CANCEL,streamId:r,reason:vs(d)}),u.promise}},s)}destroy(){var e;(e=l(this,rd))==null||e.abort(),_(this,rd,null)}}rd=new WeakMap,_n=new WeakSet,zC=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){E(this,_n,KC).call(this,e);return}if(e.callback){const s=e.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===$p.DATA)i.resolve(e.data);else if(e.callback===$p.ERROR)i.reject(vs(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:s,targetName:i,callback:$p.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:s,targetName:i,callback:$p.ERROR,callbackId:e.callbackId,reason:vs(o)})});return}if(e.streamId){E(this,_n,WC).call(this,e);return}t(e.data)},WC=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this,a=this.actionHandler[e.action],c={enqueue(d,u=1,m){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=u,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:s,targetName:i,stream:yt.ENQUEUE,streamId:t,chunk:d},m)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:yt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(d){ke(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:s,targetName:i,stream:yt.ERROR,streamId:t,reason:vs(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(a,e.data,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:yt.START_COMPLETE,streamId:t,success:!0})},function(d){r.postMessage({sourceName:s,targetName:i,stream:yt.START_COMPLETE,streamId:t,reason:vs(d)})})},KC=function(e){const t=e.streamId,s=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case yt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(vs(e.reason));break;case yt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(vs(e.reason));break;case yt.PULL:if(!a){r.postMessage({sourceName:s,targetName:i,stream:yt.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||E_).then(function(){r.postMessage({sourceName:s,targetName:i,stream:yt.PULL_COMPLETE,streamId:t,success:!0})},function(d){r.postMessage({sourceName:s,targetName:i,stream:yt.PULL_COMPLETE,streamId:t,reason:vs(d)})});break;case yt.ENQUEUE:if(ke(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case yt.CLOSE:if(ke(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),E(this,_n,ym).call(this,o,t);break;case yt.ERROR:ke(o,"error should have stream controller"),o.controller.error(vs(e.reason)),E(this,_n,ym).call(this,o,t);break;case yt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(vs(e.reason)),E(this,_n,ym).call(this,o,t);break;case yt.CANCEL:if(!a)break;const c=vs(e.reason);Promise.try(a.onCancel||E_,c).then(function(){r.postMessage({sourceName:s,targetName:i,stream:yt.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){r.postMessage({sourceName:s,targetName:i,stream:yt.CANCEL_COMPLETE,streamId:t,reason:vs(d)})}),a.sinkCapability.reject(c),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},ym=async function(e,t){var s,i,r;await Promise.allSettled([(s=e.startCall)==null?void 0:s.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var df;class YC{constructor({enableHWA:e=!1}){C(this,df,!1);_(this,df,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!l(this,df)})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ze("Abstract method `_createCanvas` called.")}}df=new WeakMap;class s4 extends YC{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class JC{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ze("Abstract method `_fetch` called.")}}class k_ extends JC{async _fetch(e){const t=await vp(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):bp(t)}}class XC{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,i,r){return"none"}destroy(e=!1){}}var Ga,od,ir,rr,Zt,qa,Va,te,Yt,Ou,ec,xm,tc,QC,lx,sc,Uu,Bu,cx,Hu;class n4 extends XC{constructor({docId:t,ownerDocument:s=globalThis.document}){super();C(this,te);C(this,Ga);C(this,od);C(this,ir);C(this,rr);C(this,Zt);C(this,qa);C(this,Va,0);_(this,rr,t),_(this,Zt,s)}addFilter(t){if(!t)return"none";let s=l(this,te,Yt).get(t);if(s)return s;const[i,r,o]=E(this,te,xm).call(this,t),a=t.length===1?i:`${i}${r}${o}`;if(s=l(this,te,Yt).get(a),s)return l(this,te,Yt).set(t,s),s;const c=`g_${l(this,rr)}_transfer_map_${ot(this,Va)._++}`,d=E(this,te,tc).call(this,c);l(this,te,Yt).set(t,d),l(this,te,Yt).set(a,d);const u=E(this,te,sc).call(this,c);return E(this,te,Bu).call(this,i,r,o,u),d}addHCMFilter(t,s){var v;const i=`${t}-${s}`,r="base";let o=l(this,te,Ou).get(r);if((o==null?void 0:o.key)===i||(o?((v=o.filter)==null||v.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},l(this,te,Ou).set(r,o)),!t||!s))return o.url;const a=E(this,te,Hu).call(this,t);t=Z.makeHexColor(...a);const c=E(this,te,Hu).call(this,s);if(s=Z.makeHexColor(...c),l(this,te,ec).style.color="",t==="#000000"&&s==="#ffffff"||t===s)return o.url;const d=new Array(256);for(let x=0;x<=255;x++){const b=x/255;d[x]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const u=d.join(","),m=`g_${l(this,rr)}_hcm_filter`,p=o.filter=E(this,te,sc).call(this,m);E(this,te,Bu).call(this,u,u,u,p),E(this,te,lx).call(this,p);const y=(x,b)=>{const w=a[x]/255,S=c[x]/255,A=new Array(b+1);for(let k=0;k<=b;k++)A[k]=w+k/b*(S-w);return A.join(",")};return E(this,te,Bu).call(this,y(0,5),y(1,5),y(2,5),p),o.url=E(this,te,tc).call(this,m),o.url}addAlphaFilter(t){let s=l(this,te,Yt).get(t);if(s)return s;const[i]=E(this,te,xm).call(this,[t]),r=`alpha_${i}`;if(s=l(this,te,Yt).get(r),s)return l(this,te,Yt).set(t,s),s;const o=`g_${l(this,rr)}_alpha_map_${ot(this,Va)._++}`,a=E(this,te,tc).call(this,o);l(this,te,Yt).set(t,a),l(this,te,Yt).set(r,a);const c=E(this,te,sc).call(this,o);return E(this,te,cx).call(this,i,c),a}addLuminosityFilter(t){let s=l(this,te,Yt).get(t||"luminosity");if(s)return s;let i,r;if(t?([i]=E(this,te,xm).call(this,[t]),r=`luminosity_${i}`):r="luminosity",s=l(this,te,Yt).get(r),s)return l(this,te,Yt).set(t,s),s;const o=`g_${l(this,rr)}_luminosity_map_${ot(this,Va)._++}`,a=E(this,te,tc).call(this,o);l(this,te,Yt).set(t,a),l(this,te,Yt).set(r,a);const c=E(this,te,sc).call(this,o);return E(this,te,QC).call(this,c),t&&E(this,te,cx).call(this,i,c),a}addHighlightHCMFilter(t,s,i,r,o){var S;const a=`${s}-${i}-${r}-${o}`;let c=l(this,te,Ou).get(t);if((c==null?void 0:c.key)===a||(c?((S=c.filter)==null||S.remove(),c.key=a,c.url="none",c.filter=null):(c={key:a,url:"none",filter:null},l(this,te,Ou).set(t,c)),!s||!i))return c.url;const[d,u]=[s,i].map(E(this,te,Hu).bind(this));let m=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),p=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[y,v]=[r,o].map(E(this,te,Hu).bind(this));p<m&&([m,p,y,v]=[p,m,v,y]),l(this,te,ec).style.color="";const x=(A,k,T)=>{const N=new Array(256),I=(p-m)/T,D=A/255,P=(k-A)/(255*T);let R=0;for(let j=0;j<=T;j++){const $=Math.round(m+j*I),B=D+j*P;for(let V=R;V<=$;V++)N[V]=B;R=$+1}for(let j=R;j<256;j++)N[j]=N[R-1];return N.join(",")},b=`g_${l(this,rr)}_hcm_${t}_filter`,w=c.filter=E(this,te,sc).call(this,b);return E(this,te,lx).call(this,w),E(this,te,Bu).call(this,x(y[0],v[0],5),x(y[1],v[1],5),x(y[2],v[2],5),w),c.url=E(this,te,tc).call(this,b),c.url}destroy(t=!1){var s,i,r,o;t&&((s=l(this,qa))!=null&&s.size)||((i=l(this,ir))==null||i.parentNode.parentNode.remove(),_(this,ir,null),(r=l(this,od))==null||r.clear(),_(this,od,null),(o=l(this,qa))==null||o.clear(),_(this,qa,null),_(this,Va,0))}}Ga=new WeakMap,od=new WeakMap,ir=new WeakMap,rr=new WeakMap,Zt=new WeakMap,qa=new WeakMap,Va=new WeakMap,te=new WeakSet,Yt=function(){return l(this,od)||_(this,od,new Map)},Ou=function(){return l(this,qa)||_(this,qa,new Map)},ec=function(){if(!l(this,ir)){const t=l(this,Zt).createElement("div"),{style:s}=t;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=l(this,Zt).createElementNS(Ui,"svg");i.setAttribute("width",0),i.setAttribute("height",0),_(this,ir,l(this,Zt).createElementNS(Ui,"defs")),t.append(i),i.append(l(this,ir)),l(this,Zt).body.append(t)}return l(this,ir)},xm=function(t){if(t.length===1){const d=t[0],u=new Array(256);for(let p=0;p<256;p++)u[p]=d[p]/255;const m=u.join(",");return[m,m,m]}const[s,i,r]=t,o=new Array(256),a=new Array(256),c=new Array(256);for(let d=0;d<256;d++)o[d]=s[d]/255,a[d]=i[d]/255,c[d]=r[d]/255;return[o.join(","),a.join(","),c.join(",")]},tc=function(t){if(l(this,Ga)===void 0){_(this,Ga,"");const s=l(this,Zt).URL;s!==l(this,Zt).baseURI&&(i0(s)?fe('#createUrl: ignore "data:"-URL for performance reasons.'):_(this,Ga,rC(s,"")))}return`url(${l(this,Ga)}#${t})`},QC=function(t){const s=l(this,Zt).createElementNS(Ui,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(s)},lx=function(t){const s=l(this,Zt).createElementNS(Ui,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(s)},sc=function(t){const s=l(this,Zt).createElementNS(Ui,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",t),l(this,te,ec).append(s),s},Uu=function(t,s,i){const r=l(this,Zt).createElementNS(Ui,s);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},Bu=function(t,s,i,r){const o=l(this,Zt).createElementNS(Ui,"feComponentTransfer");r.append(o),E(this,te,Uu).call(this,o,"feFuncR",t),E(this,te,Uu).call(this,o,"feFuncG",s),E(this,te,Uu).call(this,o,"feFuncB",i)},cx=function(t,s){const i=l(this,Zt).createElementNS(Ui,"feComponentTransfer");s.append(i),E(this,te,Uu).call(this,i,"feFuncA",t)},Hu=function(t){return l(this,te,ec).style.color=t,_p(getComputedStyle(l(this,te,ec)).getPropertyValue("color"))};class ZC{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ze("Abstract method `_fetch` called.")}}class T_ extends ZC{async _fetch(e){const t=await vp(e,"arraybuffer");return new Uint8Array(t)}}class eE{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){ze("Abstract method `_fetch` called.")}}class N_ extends eE{async _fetch(e){const t=await vp(e,"arraybuffer");return new Uint8Array(t)}}hs&&fe("Please use the `legacy` build in Node.js environments.");async function Bb(n){const t=await process.getBuiltinModule("fs").promises.readFile(n);return new Uint8Array(t)}class i4 extends XC{}class r4 extends YC{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class o4 extends JC{async _fetch(e){return Bb(e)}}class a4 extends ZC{async _fetch(e){return Bb(e)}}class l4 extends eE{async _fetch(e){return Bb(e)}}const Yl="__forcedDependency",{floor:I_,ceil:P_}=Math;function zp(n,e,t,s,i,r){n[e*4+0]=Math.min(n[e*4+0],t),n[e*4+1]=Math.min(n[e*4+1],s),n[e*4+2]=Math.max(n[e*4+2],i),n[e*4+3]=Math.max(n[e*4+3],r)}const dx=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var ad,So;class c4{constructor(e,t){C(this,ad);C(this,So);_(this,ad,e),_(this,So,t)}get length(){return l(this,ad).length}isEmpty(e){return l(this,ad)[e]===dx}minX(e){return l(this,So)[e*4+0]/256}minY(e){return l(this,So)[e*4+1]/256}maxX(e){return(l(this,So)[e*4+2]+1)/256}maxY(e){return(l(this,So)[e*4+3]+1)/256}}ad=new WeakMap,So=new WeakMap;const Wp=(n,e)=>{if(!n)return;let t=n.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},n.set(e,t)),t};var As,Ss,$a,Fn,za,or,Le,Ue,ar,Cs,uf,ld,Wa,Ka,lr,es,mi,hf,ux;class d4{constructor(e,t,s=!1){C(this,hf);C(this,As,{__proto__:null});C(this,Ss,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Yl]:[]});C(this,$a,new Map);C(this,Fn,[]);C(this,za,[]);C(this,or,[[1,0,0,1,0,0]]);C(this,Le,[-1/0,-1/0,1/0,1/0]);C(this,Ue,new Float64Array([1/0,1/0,-1/0,-1/0]));C(this,ar,-1);C(this,Cs,new Set);C(this,uf,new Map);C(this,ld,new Map);C(this,Wa);C(this,Ka);C(this,lr);C(this,es);C(this,mi);_(this,Wa,e.width),_(this,Ka,e.height),E(this,hf,ux).call(this,t),s&&_(this,mi,new Map)}growOperationsCount(e){e>=l(this,es).length&&E(this,hf,ux).call(this,e,l(this,es))}save(e){return _(this,As,{__proto__:l(this,As)}),_(this,Ss,{__proto__:l(this,Ss),transform:{__proto__:l(this,Ss).transform},moveText:{__proto__:l(this,Ss).moveText},sameLineText:{__proto__:l(this,Ss).sameLineText},[Yl]:{__proto__:l(this,Ss)[Yl]}}),_(this,Le,{__proto__:l(this,Le)}),l(this,Fn).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(l(this,As));if(t===null)return this;_(this,As,t),_(this,Ss,Object.getPrototypeOf(l(this,Ss))),_(this,Le,Object.getPrototypeOf(l(this,Le)));const s=l(this,Fn).pop();return s!==void 0&&((i=Wp(l(this,mi),e))==null||i.dependencies.add(s),l(this,es)[e]=l(this,es)[s]),this}recordOpenMarker(e){return l(this,Fn).push(e),this}getOpenMarker(){return l(this,Fn).length===0?null:l(this,Fn).at(-1)}recordCloseMarker(e){var s;const t=l(this,Fn).pop();return t!==void 0&&((s=Wp(l(this,mi),e))==null||s.dependencies.add(t),l(this,es)[e]=l(this,es)[t]),this}beginMarkedContent(e){return l(this,za).push(e),this}endMarkedContent(e){var s;const t=l(this,za).pop();return t!==void 0&&((s=Wp(l(this,mi),e))==null||s.dependencies.add(t),l(this,es)[e]=l(this,es)[t]),this}pushBaseTransform(e){return l(this,or).push(Z.multiplyByDOMMatrix(l(this,or).at(-1),e.getTransform())),this}popBaseTransform(){return l(this,or).length>1&&l(this,or).pop(),this}recordSimpleData(e,t){return l(this,As)[e]=t,this}recordIncrementalData(e,t){return l(this,Ss)[e].push(t),this}resetIncrementalData(e,t){return l(this,Ss)[e].length=0,this}recordNamedData(e,t){return l(this,$a).set(e,t),this}recordSimpleDataFromNamed(e,t,s){l(this,As)[e]=l(this,$a).get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Yl,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in l(this,As)&&this.recordFutureForcedDependency(t,l(this,As)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of l(this,Cs))this.recordFutureForcedDependency(Yl,e);return this}resetBBox(e){return l(this,ar)!==e&&(_(this,ar,e),l(this,Ue)[0]=1/0,l(this,Ue)[1]=1/0,l(this,Ue)[2]=-1/0,l(this,Ue)[3]=-1/0),this}recordClipBox(e,t,s,i,r,o){const a=Z.multiplyByDOMMatrix(l(this,or).at(-1),t.getTransform()),c=[1/0,1/0,-1/0,-1/0];Z.axialAlignedBoundingBox([s,r,i,o],a,c);const d=Z.intersect(l(this,Le),c);return d?(l(this,Le)[0]=d[0],l(this,Le)[1]=d[1],l(this,Le)[2]=d[2],l(this,Le)[3]=d[3]):(l(this,Le)[0]=l(this,Le)[1]=1/0,l(this,Le)[2]=l(this,Le)[3]=-1/0),this}recordBBox(e,t,s,i,r,o){const a=l(this,Le);if(a[0]===1/0)return this;const c=Z.multiplyByDOMMatrix(l(this,or).at(-1),t.getTransform());if(a[0]===-1/0)return Z.axialAlignedBoundingBox([s,r,i,o],c,l(this,Ue)),this;const d=[1/0,1/0,-1/0,-1/0];return Z.axialAlignedBoundingBox([s,r,i,o],c,d),l(this,Ue)[0]=Math.min(l(this,Ue)[0],Math.max(d[0],a[0])),l(this,Ue)[1]=Math.min(l(this,Ue)[1],Math.max(d[1],a[1])),l(this,Ue)[2]=Math.max(l(this,Ue)[2],Math.min(d[2],a[2])),l(this,Ue)[3]=Math.max(l(this,Ue)[3],Math.min(d[3],a[3])),this}recordCharacterBBox(e,t,s,i=1,r=0,o=0,a){const c=s.bbox;let d,u;if(c&&(d=c[2]!==c[0]&&c[3]!==c[1]&&l(this,ld).get(s),d!==!1&&(u=[0,0,0,0],Z.axialAlignedBoundingBox(c,s.fontMatrix,u),(i!==1||r!==0||o!==0)&&Z.scaleMinMax([i,0,0,-i,r,o],u),d)))return this.recordBBox(e,t,u[0],u[2],u[1],u[3]);if(!a)return this.recordFullPageBBox(e);const m=a();return c&&u&&d===void 0&&(d=u[0]<=r-m.actualBoundingBoxLeft&&u[2]>=r+m.actualBoundingBoxRight&&u[1]<=o-m.actualBoundingBoxAscent&&u[3]>=o+m.actualBoundingBoxDescent,l(this,ld).set(s,d),d)?this.recordBBox(e,t,u[0],u[2],u[1],u[3]):this.recordBBox(e,t,r-m.actualBoundingBoxLeft,r+m.actualBoundingBoxRight,o-m.actualBoundingBoxAscent,o+m.actualBoundingBoxDescent)}recordFullPageBBox(e){return l(this,Ue)[0]=Math.max(0,l(this,Le)[0]),l(this,Ue)[1]=Math.max(0,l(this,Le)[1]),l(this,Ue)[2]=Math.min(l(this,Wa),l(this,Le)[2]),l(this,Ue)[3]=Math.min(l(this,Ka),l(this,Le)[3]),this}getSimpleIndex(e){return l(this,As)[e]}recordDependencies(e,t){const s=l(this,Cs),i=l(this,As),r=l(this,Ss);for(const o of t)o in l(this,As)?s.add(i[o]):o in r&&r[o].forEach(s.add,s);return this}recordNamedDependency(e,t){return l(this,$a).has(t)&&l(this,Cs).add(l(this,$a).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Yl]),l(this,mi)){const s=Wp(l(this,mi),e),{dependencies:i}=s;l(this,Cs).forEach(i.add,i),l(this,Fn).forEach(i.add,i),l(this,za).forEach(i.add,i),i.delete(e),s.isRenderingOperation=!0}if(l(this,ar)===e){const s=I_(l(this,Ue)[0]*256/l(this,Wa)),i=I_(l(this,Ue)[1]*256/l(this,Ka)),r=P_(l(this,Ue)[2]*256/l(this,Wa)),o=P_(l(this,Ue)[3]*256/l(this,Ka));zp(l(this,lr),e,s,i,r,o);for(const a of l(this,Cs))a!==e&&zp(l(this,lr),a,s,i,r,o);for(const a of l(this,Fn))a!==e&&zp(l(this,lr),a,s,i,r,o);for(const a of l(this,za))a!==e&&zp(l(this,lr),a,s,i,r,o);t||(l(this,Cs).clear(),_(this,ar,-1))}return this}recordShowTextOperation(e,t=!1){const s=Array.from(l(this,Cs));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return l(this,ar)===e&&(_(this,ar,-1),l(this,Le)[0]=Math.max(l(this,Le)[0],l(this,Ue)[0]),l(this,Le)[1]=Math.max(l(this,Le)[1],l(this,Ue)[1]),l(this,Le)[2]=Math.min(l(this,Le)[2],l(this,Ue)[2]),l(this,Le)[3]=Math.min(l(this,Le)[3],l(this,Ue)[3]),t||l(this,Cs).clear()),this}_takePendingDependencies(){const e=l(this,Cs);return _(this,Cs,new Set),e}_extractOperation(e){const t=l(this,uf).get(e);return l(this,uf).delete(e),t}_pushPendingDependencies(e){for(const t of e)l(this,Cs).add(t)}take(){return l(this,ld).clear(),new c4(l(this,es),l(this,lr))}takeDebugMetadata(){return l(this,mi)}}As=new WeakMap,Ss=new WeakMap,$a=new WeakMap,Fn=new WeakMap,za=new WeakMap,or=new WeakMap,Le=new WeakMap,Ue=new WeakMap,ar=new WeakMap,Cs=new WeakMap,uf=new WeakMap,ld=new WeakMap,Wa=new WeakMap,Ka=new WeakMap,lr=new WeakMap,es=new WeakMap,mi=new WeakMap,hf=new WeakSet,ux=function(e,t){const s=new ArrayBuffer(e*4);_(this,lr,new Uint8ClampedArray(s)),_(this,es,new Uint32Array(s)),t&&t.length>0?(l(this,es).set(t),l(this,es).fill(dx,t.length)):l(this,es).fill(dx)};var qe,ct,jn,cd,dd;const Kb=class Kb{constructor(e,t,s){C(this,qe);C(this,ct);C(this,jn);C(this,cd,0);C(this,dd,0);if(e instanceof Kb&&l(e,jn)===!!s)return e;_(this,qe,e),_(this,ct,t),_(this,jn,!!s)}growOperationsCount(){throw new Error("Unreachable")}save(e){return ot(this,dd)._++,l(this,qe).save(l(this,ct)),this}restore(e){return l(this,dd)>0&&(l(this,qe).restore(l(this,ct)),ot(this,dd)._--),this}recordOpenMarker(e){return ot(this,cd)._++,this}getOpenMarker(){return l(this,cd)>0?l(this,ct):l(this,qe).getOpenMarker()}recordCloseMarker(e){return ot(this,cd)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return l(this,qe).pushBaseTransform(e),this}popBaseTransform(){return l(this,qe).popBaseTransform(),this}recordSimpleData(e,t){return l(this,qe).recordSimpleData(e,l(this,ct)),this}recordIncrementalData(e,t){return l(this,qe).recordIncrementalData(e,l(this,ct)),this}resetIncrementalData(e,t){return l(this,qe).resetIncrementalData(e,l(this,ct)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return l(this,qe).recordSimpleDataFromNamed(e,t,l(this,ct)),this}recordFutureForcedDependency(e,t){return l(this,qe).recordFutureForcedDependency(e,l(this,ct)),this}inheritSimpleDataAsFutureForcedDependencies(e){return l(this,qe).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return l(this,qe).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return l(this,jn)||l(this,qe).resetBBox(l(this,ct)),this}recordClipBox(e,t,s,i,r,o){return l(this,jn)||l(this,qe).recordClipBox(l(this,ct),t,s,i,r,o),this}recordBBox(e,t,s,i,r,o){return l(this,jn)||l(this,qe).recordBBox(l(this,ct),t,s,i,r,o),this}recordCharacterBBox(e,t,s,i,r,o,a){return l(this,jn)||l(this,qe).recordCharacterBBox(l(this,ct),t,s,i,r,o,a),this}recordFullPageBBox(e){return l(this,jn)||l(this,qe).recordFullPageBBox(l(this,ct)),this}getSimpleIndex(e){return l(this,qe).getSimpleIndex(e)}recordDependencies(e,t){return l(this,qe).recordDependencies(l(this,ct),t),this}recordNamedDependency(e,t){return l(this,qe).recordNamedDependency(l(this,ct),t),this}recordOperation(e){return l(this,qe).recordOperation(l(this,ct),!0),this}recordShowTextOperation(e){return l(this,qe).recordShowTextOperation(l(this,ct),!0),this}bboxToClipBoxDropOperation(e){return l(this,jn)||l(this,qe).bboxToClipBoxDropOperation(l(this,ct),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};qe=new WeakMap,ct=new WeakMap,jn=new WeakMap,cd=new WeakMap,dd=new WeakMap;let hg=Kb;const nn={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},$t={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function hx(n,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,s),n.clip(i)}class Hb{isModifyingCurrentTransform(){return!1}getPattern(){ze("Abstract method `getPattern` called.")}}class u4 extends Hb{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(e,t=null){let s,i=this._p0,r=this._p1;if(t&&(i=i.slice(),r=r.slice(),Z.applyTransform(i,t),Z.applyTransform(r,t)),this._type==="axial")s=e.createLinearGradient(i[0],i[1],r[0],r[1]);else if(this._type==="radial"){let o=this._r0,a=this._r1;if(t){const c=new Float32Array(2);Z.singularValueDecompose2dScale(t,c),o*=c[0],a*=c[0]}s=e.createRadialGradient(i[0],i[1],o,r[0],r[1],a)}for(const o of this._colorStops)s.addColorStop(o[0],o[1]);return s}getPattern(e,t,s,i){let r;if(i===$t.STROKE||i===$t.FILL){if(this.isOriginBased()){let p=Z.transform(s,t.baseTransform);this.matrix&&(p=Z.transform(p,this.matrix));const y=.001,v=Math.hypot(p[0],p[1]),x=Math.hypot(p[2],p[3]),b=(p[0]*p[2]+p[1]*p[3])/(v*x);if(Math.abs(b)<y)if(this.isRadial()){if(Math.abs(v-x)<y)return this._createGradient(e,p)}else return this._createGradient(e,p)}const o=t.current.getClippedPathBoundingBox(i,it(e))||[0,0,0,0],a=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,d=t.cachedCanvases.getCanvas("pattern",a,c),u=d.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-o[0],-o[1]),s=Z.transform(s,[1,0,0,1,o[0],o[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),hx(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),r=e.createPattern(d.canvas,"no-repeat");const m=new DOMMatrix(s);r.setTransform(m)}else hx(e,this._bbox),r=this._createGradient(e);return r}}function T0(n,e,t,s,i,r,o,a){const c=e.coords,d=e.colors,u=n.data,m=n.width*4;let p;c[t+1]>c[s+1]&&(p=t,t=s,s=p,p=r,r=o,o=p),c[s+1]>c[i+1]&&(p=s,s=i,i=p,p=o,o=a,a=p),c[t+1]>c[s+1]&&(p=t,t=s,s=p,p=r,r=o,o=p);const y=(c[t]+e.offsetX)*e.scaleX,v=(c[t+1]+e.offsetY)*e.scaleY,x=(c[s]+e.offsetX)*e.scaleX,b=(c[s+1]+e.offsetY)*e.scaleY,w=(c[i]+e.offsetX)*e.scaleX,S=(c[i+1]+e.offsetY)*e.scaleY;if(v>=S)return;const A=d[r],k=d[r+1],T=d[r+2],N=d[o],I=d[o+1],D=d[o+2],P=d[a],R=d[a+1],j=d[a+2],$=Math.round(v),B=Math.round(S);let V,L,U,H,J,Y,re,xe;for(let _e=$;_e<=B;_e++){if(_e<b){const Se=_e<v?0:(v-_e)/(v-b);V=y-(y-x)*Se,L=A-(A-N)*Se,U=k-(k-I)*Se,H=T-(T-D)*Se}else{let Se;_e>S?Se=1:b===S?Se=0:Se=(b-_e)/(b-S),V=x-(x-w)*Se,L=N-(N-P)*Se,U=I-(I-R)*Se,H=D-(D-j)*Se}let M;_e<v?M=0:_e>S?M=1:M=(v-_e)/(v-S),J=y-(y-w)*M,Y=A-(A-P)*M,re=k-(k-R)*M,xe=T-(T-j)*M;const O=Math.round(Math.min(V,J)),q=Math.round(Math.max(V,J));let le=m*_e+O*4;for(let Se=O;Se<=q;Se++)M=(V-Se)/(V-J),M<0?M=0:M>1&&(M=1),u[le++]=L-(L-Y)*M|0,u[le++]=U-(U-re)*M|0,u[le++]=H-(H-xe)*M|0,u[le++]=255}}function h4(n,e,t){const s=e.coords,i=e.colors;let r,o;switch(e.type){case jy.LATTICE:const a=e.verticesPerRow,c=Math.floor(s.length/a)-1,d=a-1;for(r=0;r<c;r++){let u=r*a;for(let m=0;m<d;m++,u++)T0(n,t,s[u],s[u+1],s[u+a],i[u],i[u+1],i[u+a]),T0(n,t,s[u+a+1],s[u+1],s[u+a],i[u+a+1],i[u+1],i[u+a])}break;case jy.TRIANGLES:for(r=0,o=s.length;r<o;r+=3)T0(n,t,s[r],s[r+1],s[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class f4 extends Hb{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const a=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-a,u=Math.ceil(this._bounds[3])-c,m=Math.min(Math.ceil(Math.abs(d*e[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(u*e[1]*1.1)),3e3),y=d/m,v=u/p,x={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-c,scaleX:1/y,scaleY:1/v},b=m+2*2,w=p+2*2,S=s.getCanvas("mesh",b,w),A=S.context,k=A.createImageData(m,p);if(t){const N=k.data;for(let I=0,D=N.length;I<D;I+=4)N[I]=t[0],N[I+1]=t[1],N[I+2]=t[2],N[I+3]=255}for(const N of this._figures)h4(k,N,x);return A.putImageData(k,2,2),{canvas:S.canvas,offsetX:a-2*y,offsetY:c-2*v,scaleX:y,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,i){hx(e,this._bbox);const r=new Float32Array(2);if(i===$t.SHADING)Z.singularValueDecompose2dScale(it(e),r);else if(this.matrix){Z.singularValueDecompose2dScale(this.matrix,r);const[a,c]=r;Z.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=a,r[1]*=c}else Z.singularValueDecompose2dScale(t.baseTransform,r);const o=this._createMeshCanvas(r,i===$t.SHADING?null:this._background,t.cachedCanvases);return i!==$t.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class p4 extends Hb{getPattern(){return"hotpink"}}function m4(n){switch(n[0]){case"RadialAxial":return new u4(n);case"Mesh":return new f4(n);case"Dummy":return new p4}throw new Error(`Unknown IR type: ${n[0]}`)}const R_={COLORED:1,UNCOLORED:2},kg=class kg{constructor(e,t,s,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(e,t){var Y,re;const{bbox:s,operatorList:i,paintType:r,tilingType:o,color:a,canvasGraphicsFactory:c}=this;let{xstep:d,ystep:u}=this;d=Math.abs(d),u=Math.abs(u),n0("TilingType: "+o);const m=s[0],p=s[1],y=s[2],v=s[3],x=y-m,b=v-p,w=new Float32Array(2);Z.singularValueDecompose2dScale(this.matrix,w);const[S,A]=w;Z.singularValueDecompose2dScale(this.baseTransform,w);const k=S*w[0],T=A*w[1];let N=x,I=b,D=!1,P=!1;const R=Math.ceil(d*k),j=Math.ceil(u*T),$=Math.ceil(x*k),B=Math.ceil(b*T);R>=$?N=d:D=!0,j>=B?I=u:P=!0;const V=this.getSizeAndScale(N,this.ctx.canvas.width,k),L=this.getSizeAndScale(I,this.ctx.canvas.height,T),U=e.cachedCanvases.getCanvas("pattern",V.size,L.size),H=U.context,J=c.createCanvasGraphics(H,t);if(J.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(J,r,a),H.translate(-V.scale*m,-L.scale*p),J.transform(0,V.scale,0,0,L.scale,0,0),H.save(),(Y=J.dependencyTracker)==null||Y.save(),this.clipBbox(J,m,p,y,v),J.baseTransform=it(J.ctx),J.executeOperatorList(i),J.endDrawing(),(re=J.dependencyTracker)==null||re.restore(),H.restore(),D||P){const xe=U.canvas;D&&(N=d),P&&(I=u);const _e=this.getSizeAndScale(N,this.ctx.canvas.width,k),M=this.getSizeAndScale(I,this.ctx.canvas.height,T),O=_e.size,q=M.size,le=e.cachedCanvases.getCanvas("pattern-workaround",O,q),Se=le.context,En=D?Math.floor(x/d):0,K=P?Math.floor(b/u):0;for(let ue=0;ue<=En;ue++)for(let Te=0;Te<=K;Te++)Se.drawImage(xe,O*ue,q*Te,O,q,0,0,O,q);return{canvas:le.canvas,scaleX:_e.scale,scaleY:M.scale,offsetX:m,offsetY:p}}return{canvas:U.canvas,scaleX:V.scale,scaleY:L.scale,offsetX:m,offsetY:p}}getSizeAndScale(e,t,s){const i=Math.max(kg.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*s);return r>=i?r=i:s=r/e,{scale:s,size:r}}clipBbox(e,t,s,i,r){const o=i-t,a=r-s;e.ctx.rect(t,s,o,a),Z.axialAlignedBoundingBox([t,s,i,r],it(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const i=e.ctx,r=e.current;switch(t){case R_.COLORED:const{fillStyle:o,strokeStyle:a}=this.ctx;i.fillStyle=r.fillColor=o,i.strokeStyle=r.strokeColor=a;break;case R_.UNCOLORED:i.fillStyle=i.strokeStyle=s,r.fillColor=r.strokeColor=s;break;default:throw new kj(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,i,r){let o=s;i!==$t.SHADING&&(o=Z.transform(o,t.baseTransform),this.matrix&&(o=Z.transform(o,this.matrix)));const a=this.createPatternCanvas(t,r);let c=new DOMMatrix(o);c=c.translate(a.offsetX,a.offsetY),c=c.scale(1/a.scaleX,1/a.scaleY);const d=e.createPattern(a.canvas,"repeat");return d.setTransform(c),d}};W(kg,"MAX_PATTERN_SIZE",3e3);let fx=kg;function g4({src:n,srcPos:e=0,dest:t,width:s,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const a=Tt.isLittleEndian?4278190080:255,[c,d]=o?[r,a]:[a,r],u=s>>3,m=s&7,p=n.length;t=new Uint32Array(t.buffer);let y=0;for(let v=0;v<i;v++){for(const b=e+u;e<b;e++){const w=e<p?n[e]:255;t[y++]=w&128?d:c,t[y++]=w&64?d:c,t[y++]=w&32?d:c,t[y++]=w&16?d:c,t[y++]=w&8?d:c,t[y++]=w&4?d:c,t[y++]=w&2?d:c,t[y++]=w&1?d:c}if(m===0)continue;const x=e<p?n[e++]:255;for(let b=0;b<m;b++)t[y++]=x&1<<7-b?d:c}return{srcPos:e,destPos:y}}const M_=16,D_=100,y4=15,L_=10,Ts=16,N0=new DOMMatrix,Xs=new Float32Array(2),cc=new Float32Array([1/0,1/0,-1/0,-1/0]);function x4(n,e){if(n._removeMirroring)throw new Error("Context is already forwarding operations.");n.__originalSave=n.save,n.__originalRestore=n.restore,n.__originalRotate=n.rotate,n.__originalScale=n.scale,n.__originalTranslate=n.translate,n.__originalTransform=n.transform,n.__originalSetTransform=n.setTransform,n.__originalResetTransform=n.resetTransform,n.__originalClip=n.clip,n.__originalMoveTo=n.moveTo,n.__originalLineTo=n.lineTo,n.__originalBezierCurveTo=n.bezierCurveTo,n.__originalRect=n.rect,n.__originalClosePath=n.closePath,n.__originalBeginPath=n.beginPath,n._removeMirroring=()=>{n.save=n.__originalSave,n.restore=n.__originalRestore,n.rotate=n.__originalRotate,n.scale=n.__originalScale,n.translate=n.__originalTranslate,n.transform=n.__originalTransform,n.setTransform=n.__originalSetTransform,n.resetTransform=n.__originalResetTransform,n.clip=n.__originalClip,n.moveTo=n.__originalMoveTo,n.lineTo=n.__originalLineTo,n.bezierCurveTo=n.__originalBezierCurveTo,n.rect=n.__originalRect,n.closePath=n.__originalClosePath,n.beginPath=n.__originalBeginPath,delete n._removeMirroring},n.save=function(){e.save(),this.__originalSave()},n.restore=function(){e.restore(),this.__originalRestore()},n.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},n.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},n.transform=function(t,s,i,r,o,a){e.transform(t,s,i,r,o,a),this.__originalTransform(t,s,i,r,o,a)},n.setTransform=function(t,s,i,r,o,a){e.setTransform(t,s,i,r,o,a),this.__originalSetTransform(t,s,i,r,o,a)},n.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},n.rotate=function(t){e.rotate(t),this.__originalRotate(t)},n.clip=function(t){e.clip(t),this.__originalClip(t)},n.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},n.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},n.bezierCurveTo=function(t,s,i,r,o,a){e.bezierCurveTo(t,s,i,r,o,a),this.__originalBezierCurveTo(t,s,i,r,o,a)},n.rect=function(t,s,i,r){e.rect(t,s,i,r),this.__originalRect(t,s,i,r)},n.closePath=function(){e.closePath(),this.__originalClosePath()},n.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class b4{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,s)):(i=this.canvasFactory.create(t,s),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Kp(n,e,t,s,i,r,o,a,c,d){const[u,m,p,y,v,x]=it(n);if(m===0&&p===0){const S=o*u+v,A=Math.round(S),k=a*y+x,T=Math.round(k),N=(o+c)*u+v,I=Math.abs(Math.round(N)-A)||1,D=(a+d)*y+x,P=Math.abs(Math.round(D)-T)||1;return n.setTransform(Math.sign(u),0,0,Math.sign(y),A,T),n.drawImage(e,t,s,i,r,0,0,I,P),n.setTransform(u,m,p,y,v,x),[I,P]}if(u===0&&y===0){const S=a*p+v,A=Math.round(S),k=o*m+x,T=Math.round(k),N=(a+d)*p+v,I=Math.abs(Math.round(N)-A)||1,D=(o+c)*m+x,P=Math.abs(Math.round(D)-T)||1;return n.setTransform(0,Math.sign(m),Math.sign(p),0,A,T),n.drawImage(e,t,s,i,r,0,0,P,I),n.setTransform(u,m,p,y,v,x),[P,I]}n.drawImage(e,t,s,i,r,o,a,c,d);const b=Math.hypot(u,m),w=Math.hypot(p,y);return[b*c,w*d]}class F_{constructor(e,t,s){W(this,"alphaIsShape",!1);W(this,"fontSize",0);W(this,"fontSizeScale",1);W(this,"textMatrix",null);W(this,"textMatrixScale",1);W(this,"fontMatrix",Fy);W(this,"leading",0);W(this,"x",0);W(this,"y",0);W(this,"lineX",0);W(this,"lineY",0);W(this,"charSpacing",0);W(this,"wordSpacing",0);W(this,"textHScale",1);W(this,"textRenderingMode",_t.FILL);W(this,"textRise",0);W(this,"fillColor","#000000");W(this,"strokeColor","#000000");W(this,"patternFill",!1);W(this,"patternStroke",!1);W(this,"fillAlpha",1);W(this,"strokeAlpha",1);W(this,"lineWidth",1);W(this,"activeSMask",null);W(this,"transferMaps","none");s==null||s(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=cc.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=$t.FILL,t=null){const s=this.minMax.slice();if(e===$t.STROKE){t||ze("Stroke bounding box must include transform."),Z.singularValueDecompose2dScale(t,Xs);const i=Xs[0]*this.lineWidth/2,r=Xs[1]*this.lineWidth/2;s[0]-=i,s[1]-=r,s[2]+=i,s[3]+=r}return s}updateClipFromPath(){const e=Z.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(cc,0)}getClippedPathBoundingBox(e=$t.FILL,t=null){return Z.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function j_(n,e){if(e instanceof ImageData){n.putImageData(e,0,0);return}const t=e.height,s=e.width,i=t%Ts,r=(t-i)/Ts,o=i===0?r:r+1,a=n.createImageData(s,Ts);let c=0,d;const u=e.data,m=a.data;let p,y,v,x;if(e.kind===lm.GRAYSCALE_1BPP){const b=u.byteLength,w=new Uint32Array(m.buffer,0,m.byteLength>>2),S=w.length,A=s+7>>3,k=4294967295,T=Tt.isLittleEndian?4278190080:255;for(p=0;p<o;p++){for(v=p<r?Ts:i,d=0,y=0;y<v;y++){const N=b-c;let I=0;const D=N>A?s:N*8-7,P=D&-8;let R=0,j=0;for(;I<P;I+=8)j=u[c++],w[d++]=j&128?k:T,w[d++]=j&64?k:T,w[d++]=j&32?k:T,w[d++]=j&16?k:T,w[d++]=j&8?k:T,w[d++]=j&4?k:T,w[d++]=j&2?k:T,w[d++]=j&1?k:T;for(;I<D;I++)R===0&&(j=u[c++],R=128),w[d++]=j&R?k:T,R>>=1}for(;d<S;)w[d++]=0;n.putImageData(a,0,p*Ts)}}else if(e.kind===lm.RGBA_32BPP){for(y=0,x=s*Ts*4,p=0;p<r;p++)m.set(u.subarray(c,c+x)),c+=x,n.putImageData(a,0,y),y+=Ts;p<o&&(x=s*i*4,m.set(u.subarray(c,c+x)),n.putImageData(a,0,y))}else if(e.kind===lm.RGB_24BPP)for(v=Ts,x=s*v,p=0;p<o;p++){for(p>=r&&(v=i,x=s*v),d=0,y=x;y--;)m[d++]=u[c++],m[d++]=u[c++],m[d++]=u[c++],m[d++]=255;n.putImageData(a,0,p*Ts)}else throw new Error(`bad image kind: ${e.kind}`)}function O_(n,e){if(e.bitmap){n.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,i=t%Ts,r=(t-i)/Ts,o=i===0?r:r+1,a=n.createImageData(s,Ts);let c=0;const d=e.data,u=a.data;for(let m=0;m<o;m++){const p=m<r?Ts:i;({srcPos:c}=g4({src:d,srcPos:c,dest:u,width:s,height:p,nonBlackColor:0})),n.putImageData(a,0,m*Ts)}}function vu(n,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)n[s]!==void 0&&(e[s]=n[s]);n.setLineDash!==void 0&&(e.setLineDash(n.getLineDash()),e.lineDashOffset=n.lineDashOffset)}function Yp(n){n.strokeStyle=n.fillStyle="#000000",n.fillRule="nonzero",n.globalAlpha=1,n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.miterLimit=10,n.globalCompositeOperation="source-over",n.font="10px sans-serif",n.setLineDash!==void 0&&(n.setLineDash([]),n.lineDashOffset=0);const{filter:e}=n;e!=="none"&&e!==""&&(n.filter="none")}function U_(n,e){if(e)return!0;Z.singularValueDecompose2dScale(n,Xs);const t=Math.fround(Ri.pixelRatio*ea.PDF_TO_CSS_UNITS);return Xs[0]<=t&&Xs[1]<=t}const v4=["butt","round","square"],w4=["miter","round","bevel"],_4={},B_={};var Yn,px,mx,gx;const Yb=class Yb{constructor(e,t,s,i,r,{optionalContentConfig:o,markedContentStack:a=null},c,d,u){C(this,Yn);this.ctx=e,this.current=new F_(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=o,this.cachedCanvases=new b4(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=u??null}getObject(e,t,s=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=a,s){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...it(this.compositeCtx))}this.ctx.save(),Yp(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=it(this.ctx)}executeOperatorList(e,t,s,i,r){var w;const o=e.argsArray,a=e.fnArray;let c=t||0;const d=o.length;if(d===c)return c;const u=d-c>L_&&typeof s=="function",m=u?Date.now()+y4:0;let p=0;const y=this.commonObjs,v=this.objs;let x,b;for(;;){if(i!==void 0&&c===i.nextBreakPoint)return i.breakIt(c,s),c;if(!r||r(c))if(x=a[c],b=o[c]??null,x!==xh.dependency)b===null?this[x](c):this[x](c,...b);else for(const S of b){(w=this.dependencyTracker)==null||w.recordNamedData(S,c);const A=S.startsWith("g_")?y:v;if(!A.has(S))return A.get(S,s),c}if(c++,c===d)return c;if(u&&++p>L_){if(Date.now()>m)return s(),c;p=0}}}endDrawing(){E(this,Yn,px).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),E(this,Yn,mx).call(this)}_scaleImage(e,t){const s=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),a=s,c=i,d="prescale1",u,m;for(;r>2&&a>1||o>2&&c>1;){let p=a,y=c;r>2&&a>1&&(p=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),r/=a/p),o>2&&c>1&&(y=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/y),u=this.cachedCanvases.getCanvas(d,p,y),m=u.context,m.clearRect(0,0,p,y),m.drawImage(e,0,0,a,c,0,0,p,y),e=u.canvas,a=p,c=y,d=d==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:c}}_createMaskCanvas(e,t){var R,j;const s=this.ctx,{width:i,height:r}=t,o=this.current.fillColor,a=this.current.patternFill,c=it(s);let d,u,m,p;if((t.bitmap||t.data)&&t.count>1){const $=t.bitmap||t.data.buffer;u=JSON.stringify(a?c:[c.slice(0,4),o]),d=this._cachedBitmapsMap.get($),d||(d=new Map,this._cachedBitmapsMap.set($,d));const B=d.get(u);if(B&&!a){const V=Math.round(Math.min(c[0],c[2])+c[4]),L=Math.round(Math.min(c[1],c[3])+c[5]);return(R=this.dependencyTracker)==null||R.recordDependencies(e,nn.transformAndFill),{canvas:B,offsetX:V,offsetY:L}}m=B}m||(p=this.cachedCanvases.getCanvas("maskCanvas",i,r),O_(p.context,t));let y=Z.transform(c,[1/i,0,0,-1/r,0,0]);y=Z.transform(y,[1,0,0,1,0,-r]);const v=cc.slice();Z.axialAlignedBoundingBox([0,0,i,r],y,v);const[x,b,w,S]=v,A=Math.round(w-x)||1,k=Math.round(S-b)||1,T=this.cachedCanvases.getCanvas("fillCanvas",A,k),N=T.context,I=x,D=b;N.translate(-I,-D),N.transform(...y),m||(m=this._scaleImage(p.canvas,Xn(N)),m=m.img,d&&a&&d.set(u,m)),N.imageSmoothingEnabled=U_(it(N),t.interpolate),Kp(N,m,0,0,m.width,m.height,0,0,i,r),N.globalCompositeOperation="source-in";const P=Z.transform(Xn(N),[1,0,0,1,-I,-D]);return N.fillStyle=a?o.getPattern(s,this,P,$t.FILL,e):o,N.fillRect(0,0,i,r),d&&!a&&(this.cachedCanvases.delete("fillCanvas"),d.set(u,T.canvas)),(j=this.dependencyTracker)==null||j.recordDependencies(e,nn.transformAndFill),{canvas:T.canvas,offsetX:Math.round(I),offsetY:Math.round(D)}}setLineWidth(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineCap",e),this.ctx.lineCap=v4[t]}setLineJoin(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("lineJoin",e),this.ctx.lineJoin=w4[t]}setMiterLimit(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var s,i,r,o,a;for(const[c,d]of t)switch(c){case"LW":this.setLineWidth(e,d);break;case"LC":this.setLineCap(e,d);break;case"LJ":this.setLineJoin(e,d);break;case"ML":this.setMiterLimit(e,d);break;case"D":this.setDash(e,d[0],d[1]);break;case"RI":this.setRenderingIntent(e,d);break;case"FL":this.setFlatness(e,d);break;case"Font":this.setFont(e,d[0],d[1]);break;case"CA":(s=this.dependencyTracker)==null||s.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=d;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=d;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=d;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=d?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(a=this.dependencyTracker)==null||a.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(d);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,s);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),vu(this.suspendedCtx,o),x4(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),vu(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,i){const r=i[0],o=i[1],a=i[2]-r,c=i[3]-o;a===0||c===0||(this.genericComposeSMask(t.context,s,a,c,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,i,r,o,a,c,d,u,m){let p=e.canvas,y=c-u,v=d-m;if(o)if(y<0||v<0||y+s>p.width||v+i>p.height){const b=this.cachedCanvases.getCanvas("maskExtension",s,i),w=b.context;w.drawImage(p,-y,-v),w.globalCompositeOperation="destination-atop",w.fillStyle=o,w.fillRect(0,0,s,i),w.globalCompositeOperation="source-over",p=b.canvas,y=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(y,v,s,i),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(y,v,s,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const x=new Path2D;x.rect(c,d,s,i),t.clip(x),t.globalCompositeOperation="destination-in",t.drawImage(p,y,v,s,i,c,d,s,i),t.restore()}save(e){var s;this.inSMaskMode&&vu(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(s=this.dependencyTracker)==null||s.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&vu(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,i,r,o,a){var c;(c=this.dependencyTracker)==null||c.recordIncrementalData("transform",e),this.ctx.transform(t,s,i,r,o,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,i){let[r]=s;if(!i){r||(r=s[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const o=t===xh.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(e,["transform"])}r instanceof Path2D||(r=s[0]=uC(r)),Z.axialAlignedBoundingBox(i,it(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){var o;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const a=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,Xn(i),$t.STROKE,e),a){const c=new Path2D;c.addPath(t,i.getTransform().invertSelf().multiplySelf(a)),t=c}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,nn.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox($t.STROKE,it(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){var d,u,m;const i=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let a=!1;if(o){const p=r.isModifyingCurrentTransform()?i.getTransform():null;if((d=this.dependencyTracker)==null||d.save(e),i.save(),i.fillStyle=r.getPattern(i,this,Xn(i),$t.FILL,e),p){const y=new Path2D;y.addPath(t,i.getTransform().invertSelf().multiplySelf(p)),t=y}a=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(u=this.dependencyTracker)==null||u.recordDependencies(e,nn.fill),a&&(i.restore(),(m=this.dependencyTracker)==null||m.restore(e)),s&&this.consumePath(e,t,c)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var s;this.ctx.fill(t),(s=this.dependencyTracker)==null||s.recordDependencies(e,nn.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=_4}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=B_}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=s.getTransform().invertSelf();for(const{transform:o,x:a,y:c,fontSize:d,path:u}of t)u&&i.addPath(u,new DOMMatrix(o).preMultiplySelf(r).translate(a,c).scale(d,-d));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){var m,p;(m=this.dependencyTracker)==null||m.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||Fy,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&fe("Invalid font matrix for font "+t),s<0?(s=-s,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const o=i.loadedName||"sans-serif",a=((p=i.systemFontInfo)==null?void 0:p.css)||`"${o}", ${i.fallbackName}`;let c="normal";i.black?c="900":i.bold&&(c="bold");const d=i.italic?"italic":"normal";let u=s;s<M_?u=M_:s>D_&&(u=D_),this.current.fontSizeScale=s/u,this.ctx.font=`${d} ${c} ${u}px ${a}`}setTextRenderingMode(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,s,i,r,o){var w,S,A,k;const a=this.ctx,c=this.current,d=c.font,u=c.textRenderingMode,m=c.fontSize/c.fontSizeScale,p=u&_t.FILL_STROKE_MASK,y=!!(u&_t.ADD_TO_PATH_FLAG),v=c.patternFill&&!d.missingFile,x=c.patternStroke&&!d.missingFile;let b;if((d.disableFontFace||y||v||x)&&!d.missingFile&&(b=d.getPathGenerator(this.commonObjs,t)),b&&(d.disableFontFace||v||x)){a.save(),a.translate(s,i),a.scale(m,-m),(w=this.dependencyTracker)==null||w.recordCharacterBBox(e,a,d);let T;if(p===_t.FILL||p===_t.FILL_STROKE)if(r){T=a.getTransform(),a.setTransform(...r);const N=E(this,Yn,gx).call(this,b,T,r);a.fill(N)}else a.fill(b);if(p===_t.STROKE||p===_t.FILL_STROKE)if(o){T||(T=a.getTransform()),a.setTransform(...o);const{a:N,b:I,c:D,d:P}=T,R=Z.inverseTransform(o),j=Z.transform([N,I,D,P,0,0],R);Z.singularValueDecompose2dScale(j,Xs),a.lineWidth*=Math.max(Xs[0],Xs[1])/m,a.stroke(E(this,Yn,gx).call(this,b,T,o))}else a.lineWidth/=m,a.stroke(b);a.restore()}else(p===_t.FILL||p===_t.FILL_STROKE)&&(a.fillText(t,s,i),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,a,d,m,s,i,()=>a.measureText(t))),(p===_t.STROKE||p===_t.FILL_STROKE)&&(this.dependencyTracker&&((A=this.dependencyTracker)==null||A.recordCharacterBBox(e,a,d,m,s,i,()=>a.measureText(t)).recordDependencies(e,nn.stroke)),a.strokeText(t,s,i));y&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:it(a),x:s,y:i,fontSize:m,path:b}),(k=this.dependencyTracker)==null||k.recordCharacterBBox(e,a,d,m,s,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){s=!0;break}return pe(this,"isFontSubpixelAAEnabled",s)}showText(e,t){var j,$,B,V;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,nn.showText).resetBBox(e),this.current.textRenderingMode&_t.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(e,t),(j=this.dependencyTracker)==null||j.recordShowTextOperation(e);return}const r=s.fontSize;if(r===0){($=this.dependencyTracker)==null||$.recordOperation(e);return}const o=this.ctx,a=s.fontSizeScale,c=s.charSpacing,d=s.wordSpacing,u=s.fontDirection,m=s.textHScale*u,p=t.length,y=i.vertical,v=y?1:-1,x=i.defaultVMetrics,b=r*s.fontMatrix[0],w=s.textRenderingMode===_t.FILL&&!i.disableFontFace&&!s.patternFill;o.save(),s.textMatrix&&o.transform(...s.textMatrix),o.translate(s.x,s.y+s.textRise),u>0?o.scale(m,-1):o.scale(m,1);let S,A;const k=s.textRenderingMode&_t.FILL_STROKE_MASK,T=k===_t.FILL||k===_t.FILL_STROKE,N=k===_t.STROKE||k===_t.FILL_STROKE;if(T&&s.patternFill){o.save();const L=s.fillColor.getPattern(o,this,Xn(o),$t.FILL,e);S=it(o),o.restore(),o.fillStyle=L}if(N&&s.patternStroke){o.save();const L=s.strokeColor.getPattern(o,this,Xn(o),$t.STROKE,e);A=it(o),o.restore(),o.strokeStyle=L}let I=s.lineWidth;const D=s.textMatrixScale;if(D===0||I===0?N&&(I=this.getSinglePixelWidth()):I/=D,a!==1&&(o.scale(a,a),I/=a),o.lineWidth=I,i.isInvalidPDFjsFont){const L=[];let U=0;for(const J of t)L.push(J.unicode),U+=J.width;const H=L.join("");if(o.fillText(H,0,0),this.dependencyTracker!==null){const J=o.measureText(H);this.dependencyTracker.recordBBox(e,this.ctx,-J.actualBoundingBoxLeft,J.actualBoundingBoxRight,-J.actualBoundingBoxAscent,J.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=U*b*m,o.restore(),this.compose();return}let P=0,R;for(R=0;R<p;++R){const L=t[R];if(typeof L=="number"){P+=v*L*r/1e3;continue}let U=!1;const H=(L.isSpace?d:0)+c,J=L.fontChar,Y=L.accent;let re,xe,_e=L.width;if(y){const q=L.vmetric||x,le=-(L.vmetric?q[1]:_e*.5)*b,Se=q[2]*b;_e=q?-q[0]:_e,re=le/a,xe=(P+Se)/a}else re=P/a,xe=0;let M;if(i.remeasure&&_e>0){M=o.measureText(J);const q=M.width*1e3/r*a;if(_e<q&&this.isFontSubpixelAAEnabled){const le=_e/q;U=!0,o.save(),o.scale(le,1),re/=le}else _e!==q&&(re+=(_e-q)/2e3*r/a)}if(this.contentVisible&&(L.isInFont||i.missingFile)){if(w&&!Y)o.fillText(J,re,xe),(B=this.dependencyTracker)==null||B.recordCharacterBBox(e,o,M?{bbox:null}:i,r/a,re,xe,()=>M??o.measureText(J));else if(this.paintChar(e,J,re,xe,S,A),Y){const q=re+r*Y.offset.x/a,le=xe-r*Y.offset.y/a;this.paintChar(e,Y.fontChar,q,le,S,A)}}const O=y?_e*b-H*u:_e*b+H*u;P+=O,U&&o.restore()}y?s.y-=P:s.x+=P*m,o.restore(),this.compose(),(V=this.dependencyTracker)==null||V.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,i=this.current,r=i.font,o=i.fontSize,a=i.fontDirection,c=r.vertical?1:-1,d=i.charSpacing,u=i.wordSpacing,m=i.textHScale*a,p=i.fontMatrix||Fy,y=t.length,v=i.textRenderingMode===_t.INVISIBLE;let x,b,w,S;if(v||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(m,a);const A=this.dependencyTracker;for(this.dependencyTracker=A?new hg(A,e):null,x=0;x<y;++x){if(b=t[x],typeof b=="number"){S=c*b*o/1e3,this.ctx.translate(S,0),i.x+=S*m;continue}const k=(b.isSpace?u:0)+d,T=r.charProcOperatorList[b.operatorListId];T?this.contentVisible&&(this.save(),s.scale(o,o),s.transform(...p),this.executeOperatorList(T),this.restore()):fe(`Type3 character "${b.operatorListId}" is not available.`);const N=[b.width,0];Z.applyTransform(N,p),w=N[0]*o+k,s.translate(w,0),i.x+=w*m}s.restore(),A&&(this.dependencyTracker=A)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,i,r,o,a){var d;const c=new Path2D;c.rect(i,r,o-i,a-r),this.ctx.clip(c),(d=this.dependencyTracker)==null||d.recordBBox(e,this.ctx,i,o,r,a).recordClipBox(e,this.ctx,i,o,r,a),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const i=this.baseTransform||it(this.ctx),r={createCanvasGraphics:(o,a)=>new Yb(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new hg(this.dependencyTracker,a,!0):null)};s=new fx(t,this.ctx,r,i)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var s;(s=this.dependencyTracker)==null||s.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=m4(this.getObject(e,t)),this.cachedPatterns.set(t,i)),s&&(i.matrix=s),i}shadingFill(e,t){var o;if(!this.contentVisible)return;const s=this.ctx;this.save(e);const i=this._getPattern(e,t);s.fillStyle=i.getPattern(s,this,Xn(s),$t.SHADING,e);const r=Xn(s);if(r){const{width:a,height:c}=s.canvas,d=cc.slice();Z.axialAlignedBoundingBox([0,0,a,c],r,d);const[u,m,p,y]=d;this.ctx.fillRect(u,m,p-u,y-m)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,nn.transform).recordDependencies(e,nn.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){ze("Should not call beginInlineImage")}beginImageData(){ze("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=it(this.ctx),s)){Z.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[r,o,a,c]=s,d=new Path2D;d.rect(r,o,a-r,c-o),this.ctx.clip(d),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,a,o,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var A;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||n0("TODO: Support non-isolated groups."),t.knockout&&fe("Knockout groups not supported.");const i=it(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=cc.slice();Z.axialAlignedBoundingBox(t.bbox,it(s),r);const o=[0,0,s.canvas.width,s.canvas.height];r=Z.intersect(r,o)||[0,0,0,0];const a=Math.floor(r[0]),c=Math.floor(r[1]),d=Math.max(Math.ceil(r[2])-a,1),u=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,d,u]);let m="groupAt"+this.groupLevel;t.smask&&(m+="_smask_"+this.smaskCounter++%2);const p=this.cachedCanvases.getCanvas(m,d,u),y=p.context;y.translate(-a,-c),y.transform(...i);let v=new Path2D;const[x,b,w,S]=t.bbox;if(v.rect(x,b,w-x,S-b),t.matrix){const k=new Path2D;k.addPath(v,new DOMMatrix(t.matrix)),v=k}y.clip(v),t.smask&&this.smaskStack.push({canvas:p.canvas,context:y,offsetX:a,offsetY:c,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,c),s.save()),vu(s,y),this.ctx=y,(A=this.dependencyTracker)==null||A.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=it(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const a=cc.slice();Z.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],o,a),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(a)}}beginAnnotation(e,t,s,i,r,o){if(E(this,Yn,px).call(this),Yp(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],c=s[3]-s[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=c,Z.singularValueDecompose2dScale(it(this.ctx),Xs);const{viewportScale:d}=this,u=Math.ceil(a*this.outputScaleX*d),m=Math.ceil(c*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(u,m);const{canvas:p,context:y}=this.annotationCanvas;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=y,this.ctx.save(),this.ctx.setTransform(Xs[0],0,0,-Xs[1],0,c*Xs[1]),Yp(this.ctx)}else{Yp(this.ctx),this.endPath(e);const d=new Path2D;d.rect(s[0],s[1],a,c),this.ctx.clip(d)}}this.current=new F_(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),E(this,Yn,mx).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var a;if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const i=this.ctx,r=this._createMaskCanvas(e,t),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),(a=this.dependencyTracker)==null||a.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,i=0,r=0,o,a){var m,p,y;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const c=this.ctx;c.save();const d=it(c);c.transform(s,i,r,o,0,0);const u=this._createMaskCanvas(e,t);c.setTransform(1,0,0,1,u.offsetX-d[4],u.offsetY-d[5]),(m=this.dependencyTracker)==null||m.resetBBox(e);for(let v=0,x=a.length;v<x;v+=2){const b=Z.transform(d,[s,i,r,o,a[v],a[v+1]]);c.drawImage(u.canvas,b[4],b[5]),(p=this.dependencyTracker)==null||p.recordBBox(e,this.ctx,b[4],b[4]+u.canvas.width,b[5],b[5]+u.canvas.height)}c.restore(),this.compose(),(y=this.dependencyTracker)==null||y.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,a,c;if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,nn.transformAndFill);for(const d of t){const{data:u,width:m,height:p,transform:y}=d,v=this.cachedCanvases.getCanvas("maskCanvas",m,p),x=v.context;x.save();const b=this.getObject(e,u,d);O_(x,b),x.globalCompositeOperation="source-in",x.fillStyle=r?i.getPattern(x,this,Xn(s),$t.FILL,e):i,x.fillRect(0,0,m,p),x.restore(),s.save(),s.transform(...y),s.scale(1,-1),Kp(s,v.canvas,0,0,m,p,0,-1,1,1),(a=this.dependencyTracker)==null||a.recordBBox(e,s,0,m,0,p),s.restore()}this.compose(),(c=this.dependencyTracker)==null||c.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){fe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,i,r){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){fe("Dependent image isn't ready yet");return}const a=o.width,c=o.height,d=[];for(let u=0,m=r.length;u<m;u+=2)d.push({transform:[s,0,0,i,r[u],r[u+1]],x:0,y:0,w:a,h:c});this.paintInlineImageXObjectGroup(e,o,d)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",s,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e,t){var d;if(!this.contentVisible)return;const s=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/s,-1/i);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const m=this.cachedCanvases.getCanvas("inlineImage",s,i).context;j_(m,t),a=this.applyTransferMapsToCanvas(m)}const c=this._scaleImage(a,Xn(r));r.imageSmoothingEnabled=U_(it(r),t.interpolate),(d=this.dependencyTracker)==null||d.resetBBox(e).recordBBox(e,r,0,s,-i,0).recordDependencies(e,nn.imageXObject).recordOperation(e),Kp(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-i,s,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){var o,a,c;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const d=t.width,u=t.height,p=this.cachedCanvases.getCanvas("inlineImage",d,u).context;j_(p,t),r=this.applyTransferMapsToCanvas(p)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const d of s)i.save(),i.transform(...d.transform),i.scale(1,-1),Kp(i,r,d.x,d.y,d.w,d.h,0,-1,1,1),(a=this.dependencyTracker)==null||a.recordBBox(e,i,0,1,-1,0),i.restore();(c=this.dependencyTracker)==null||c.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,nn.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){var o,a;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===B_?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(a=this.dependencyTracker)==null||a.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=it(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:i,d:r}=this.ctx.getTransform();let o,a;if(s===0&&i===0){const c=Math.abs(t),d=Math.abs(r);if(c===d)if(e===0)o=a=1/c;else{const u=c*e;o=a=u<1?1/u:1}else if(e===0)o=1/c,a=1/d;else{const u=c*e,m=d*e;o=u<1?1/u:1,a=m<1?1/m:1}}else{const c=Math.abs(t*r-s*i),d=Math.hypot(t,s),u=Math.hypot(i,r);if(e===0)o=u/c,a=d/c;else{const m=e*c;o=u>m?u/m:1,a=d>m?d/m:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:i}}=this,[r,o]=this.getScaleForStroking();if(r===o){s.lineWidth=(i||1)*r,s.stroke(e);return}const a=s.getLineDash();t&&s.save(),s.scale(r,o),N0.a=1/r,N0.d=1/o;const c=new Path2D;if(c.addPath(e,N0),a.length>0){const d=Math.max(r,o);s.setLineDash(a.map(u=>u/d)),s.lineDashOffset/=d}s.lineWidth=i||1,s.stroke(c),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Yn=new WeakSet,px=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},mx=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},gx=function(e,t,s){const i=new Path2D;return i.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),i};let vc=Yb;for(const n in xh)vc.prototype[n]!==void 0&&(vc.prototype[xh[n]]=vc.prototype[n]);var ff,pf;class ki{static get workerPort(){return l(this,ff)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");_(this,ff,e)}static get workerSrc(){return l(this,pf)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");_(this,pf,e)}}ff=new WeakMap,pf=new WeakMap,C(ki,ff,null),C(ki,pf,"");var ud,mf;class A4{constructor({parsedData:e,rawData:t}){C(this,ud);C(this,mf);_(this,ud,e),_(this,mf,t)}getRaw(){return l(this,mf)}get(e){return l(this,ud).get(e)??null}[Symbol.iterator](){return l(this,ud).entries()}}ud=new WeakMap,mf=new WeakMap;const nc=Symbol("INTERNAL");var gf,yf,xf,hd;class S4{constructor(e,{name:t,intent:s,usage:i,rbGroups:r}){C(this,gf,!1);C(this,yf,!1);C(this,xf,!1);C(this,hd,!0);_(this,gf,!!(e&Js.DISPLAY)),_(this,yf,!!(e&Js.PRINT)),this.name=t,this.intent=s,this.usage=i,this.rbGroups=r}get visible(){if(l(this,xf))return l(this,hd);if(!l(this,hd))return!1;const{print:e,view:t}=this.usage;return l(this,gf)?(t==null?void 0:t.viewState)!=="OFF":l(this,yf)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,s=!1){e!==nc&&ze("Internal method `_setVisible` called."),_(this,xf,s),_(this,hd,t)}}gf=new WeakMap,yf=new WeakMap,xf=new WeakMap,hd=new WeakMap;var Co,Be,fd,pd,bf,yx;class C4{constructor(e,t=Js.DISPLAY){C(this,bf);C(this,Co,null);C(this,Be,new Map);C(this,fd,null);C(this,pd,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,_(this,pd,e.order);for(const s of e.groups)l(this,Be).set(s.id,new S4(t,s));if(e.baseState==="OFF")for(const s of l(this,Be).values())s._setVisible(nc,!1);for(const s of e.on)l(this,Be).get(s)._setVisible(nc,!0);for(const s of e.off)l(this,Be).get(s)._setVisible(nc,!1);_(this,fd,this.getHash())}}isVisible(e){if(l(this,Be).size===0)return!0;if(!e)return n0("Optional content group not defined."),!0;if(e.type==="OCG")return l(this,Be).has(e.id)?l(this,Be).get(e.id).visible:(fe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return E(this,bf,yx).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!l(this,Be).has(t))return fe(`Optional content group not found: ${t}`),!0;if(l(this,Be).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!l(this,Be).has(t))return fe(`Optional content group not found: ${t}`),!0;if(!l(this,Be).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!l(this,Be).has(t))return fe(`Optional content group not found: ${t}`),!0;if(!l(this,Be).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!l(this,Be).has(t))return fe(`Optional content group not found: ${t}`),!0;if(l(this,Be).get(t).visible)return!1}return!0}return fe(`Unknown optional content policy ${e.policy}.`),!0}return fe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){var r;const i=l(this,Be).get(e);if(!i){fe(`Optional content group not found: ${e}`);return}if(s&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const a of o)a!==e&&((r=l(this,Be).get(a))==null||r._setVisible(nc,!1,!0));i._setVisible(nc,!!t,!0),_(this,Co,null)}setOCGState({state:e,preserveRB:t}){let s;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const r=l(this,Be).get(i);if(r)switch(s){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}_(this,Co,null)}get hasInitialVisibility(){return l(this,fd)===null||this.getHash()===l(this,fd)}getOrder(){return l(this,Be).size?l(this,pd)?l(this,pd).slice():[...l(this,Be).keys()]:null}getGroup(e){return l(this,Be).get(e)||null}getHash(){if(l(this,Co)!==null)return l(this,Co);const e=new qC;for(const[t,s]of l(this,Be))e.update(`${t}:${s.visible}`);return _(this,Co,e.hexdigest())}[Symbol.iterator](){return l(this,Be).entries()}}Co=new WeakMap,Be=new WeakMap,fd=new WeakMap,pd=new WeakMap,bf=new WeakSet,yx=function(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=E(this,bf,yx).call(this,r);else if(l(this,Be).has(r))o=l(this,Be).get(r).visible;else return fe(`Optional content group not found: ${r}`),!0;switch(s){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return s==="And"};class E4{constructor(e,{disableRange:t=!1,disableStream:s=!1}){ke(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:a}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=a,(r==null?void 0:r.length)>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!s,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,d)=>{this._onReceiveData({begin:c,chunk:d})}),e.addProgressListener((c,d)=>{this._onProgress({loaded:c,total:d})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const s=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(s),!0)});ke(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,s,i,r;e.total===void 0?(s=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||s.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ke(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new k4(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new T4(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeReaders.slice(0))s.cancel(e);this._pdfDataRangeTransport.abort()}}class k4{constructor(e,t,s=!1,i=null){this._stream=e,this._done=s||!1,this._filename=Ob(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class T4{constructor(e,t,s){this._stream=e,this._begin=t,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function N4(n){let e=!0,t=s("filename\\*","i").exec(n);if(t){t=t[1];let u=a(t);return u=unescape(u),u=c(u),u=d(u),r(u)}if(t=o(n),t){const u=d(t);return r(u)}if(t=s("filename","i").exec(n),t){t=t[1];let u=a(t);return u=d(u),r(u)}function s(u,m){return new RegExp("(?:^|;)\\s*"+u+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',m)}function i(u,m){if(u){if(!/^[\x00-\xFF]+$/.test(m))return m;try{const p=new TextDecoder(u,{fatal:!0}),y=bp(m);m=p.decode(y),e=!1}catch{}}return m}function r(u){return e&&/[\x80-\xff]/.test(u)&&(u=i("utf-8",u),e&&(u=i("iso-8859-1",u))),u}function o(u){const m=[];let p;const y=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=y.exec(u))!==null;){let[,x,b,w]=p;if(x=parseInt(x,10),x in m){if(x===0)break;continue}m[x]=[b,w]}const v=[];for(let x=0;x<m.length&&x in m;++x){let[b,w]=m[x];w=a(w),b&&(w=unescape(w),x===0&&(w=c(w))),v.push(w)}return v.join("")}function a(u){if(u.startsWith('"')){const m=u.slice(1).split('\\"');for(let p=0;p<m.length;++p){const y=m[p].indexOf('"');y!==-1&&(m[p]=m[p].slice(0,y),m.length=p+1),m[p]=m[p].replaceAll(/\\(.)/g,"$1")}u=m.join('"')}return u}function c(u){const m=u.indexOf("'");if(m===-1)return u;const p=u.slice(0,m),v=u.slice(m+1).replace(/^[^']*'/,"");return i(p,v)}function d(u){return!u.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(u)?u:u.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(m,p,y,v){if(y==="q"||y==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(x,b){return String.fromCharCode(parseInt(b,16))}),i(p,v);try{v=atob(v)}catch{}return i(p,v)})}return""}function tE(n,e){const t=new Headers;if(!n||!e||typeof e!="object")return t;for(const s in e){const i=e[s];i!==void 0&&t.append(s,i)}return t}function r0(n){var e;return((e=URL.parse(n))==null?void 0:e.origin)??null}function sE({responseHeaders:n,isHttp:e,rangeChunkSize:t,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(n.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||s||!e||n.get("Accept-Ranges")!=="bytes"||(n.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function nE(n){const e=n.get("Content-Disposition");if(e){let t=N4(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Ob(t))return t}return null}function Sp(n,e){return new og(`Unexpected server response (${n}) while retrieving PDF "${e}".`,n,n===404||n===0&&e.startsWith("file:"))}function iE(n){return n===200||n===206}function rE(n,e,t){return{method:"GET",headers:n,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function oE(n){return n instanceof Uint8Array?n.buffer:n instanceof ArrayBuffer?n:(fe(`getArrayBuffer - unexpected data format: ${n}`),new Uint8Array(n).buffer)}class I4{constructor(e){W(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=tE(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ke(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new P4(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new R4(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class P4{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const s=new Headers(e.headers),i=t.url;fetch(i,rE(s,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=r0(r.url),!iE(r.status))throw Sp(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:a,suggestedLength:c}=sE({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=c||this._contentLength,this._filename=nE(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Zo("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:oE(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class R4{constructor(e,t,s){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`);const o=i.url;fetch(o,rE(r,this._withCredentials,this._abortController)).then(a=>{const c=r0(a.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!iE(a.status))throw Sp(a.status,o);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:oE(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const I0=200,P0=206;function M4(n){const e=n.response;return typeof e!="string"?e:bp(e).buffer}class D4{constructor({url:e,httpHeaders:t,withCredentials:s}){W(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=tE(this.isHttp,t),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=P0):i.expectedStatus=I0,t.responseType="arraybuffer",ke(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,s),t.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),s}onProgress(e,t){var i;const s=this.pendingRequests[e];s&&((i=s.onProgress)==null||i.call(s,t))}onStateChange(e,t){const s=this.pendingRequests[e];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){s.onError(i.status);return}const r=i.status||I0;if(!(r===I0&&s.expectedStatus===P0)&&r!==s.expectedStatus){s.onError(i.status);return}const a=M4(i);if(r===P0){const c=i.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);d?s.onDone({begin:parseInt(d[1],10),chunk:a}):(fe('Missing or invalid "Content-Range" header.'),s.onError(0))}else a?s.onDone({begin:0,chunk:a}):s.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class L4{constructor(e){this._source=e,this._manager=new D4(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ke(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new F4(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const s=new j4(this._manager,e,t);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class F4{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=r0(t.responseURL);const s=t.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(a=>{const[c,...d]=a.split(": ");return[c,d.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=sE({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=nE(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Sp(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class j4{constructor(e,t,s){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=r0((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=Sp(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const O4=/^[a-z][a-z0-9\-+.]+:/i;function U4(n){if(O4.test(n))return new URL(n);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(n))}class B4{constructor(e){this.source=e,this.url=U4(e.url),ke(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ke(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new H4(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new G4(this,e,t);return this._rangeRequestReaders.push(s),s}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const s of this._rangeRequestReaders.slice(0))s.cancel(e)}}class H4{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=Sp(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Zo("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class G4{constructor(e,t,s){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const wu=Symbol("INITIAL_DATA");var Ls,vf,xx;class aE{constructor(){C(this,vf);C(this,Ls,Object.create(null))}get(e,t=null){if(t){const i=E(this,vf,xx).call(this,e);return i.promise.then(()=>t(i.data)),null}const s=l(this,Ls)[e];if(!s||s.data===wu)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=l(this,Ls)[e];return!!t&&t.data!==wu}delete(e){const t=l(this,Ls)[e];return!t||t.data===wu?!1:(delete l(this,Ls)[e],!0)}resolve(e,t=null){const s=E(this,vf,xx).call(this,e);s.data=t,s.resolve()}clear(){var e;for(const t in l(this,Ls)){const{data:s}=l(this,Ls)[t];(e=s==null?void 0:s.bitmap)==null||e.close()}_(this,Ls,Object.create(null))}*[Symbol.iterator](){for(const e in l(this,Ls)){const{data:t}=l(this,Ls)[e];t!==wu&&(yield[e,t])}}}Ls=new WeakMap,vf=new WeakSet,xx=function(e){var t;return(t=l(this,Ls))[e]||(t[e]={...Promise.withResolvers(),data:wu})};const q4=1e5,H_=30;var eA,Eo,Fs,wf,_f,Ya,cr,Af,Sf,Ja,Cf,md,ko,gd,Ef,yd,Xa,kf,Tf,xd,Qa,Nf,bd,vd,Ur,lE,cE,bx,Zs,bm,vx,dE,uE;const Ut=class Ut{constructor({textContentSource:e,container:t,viewport:s}){C(this,Ur);C(this,Eo,Promise.withResolvers());C(this,Fs,null);C(this,wf,!1);C(this,_f,!!((eA=globalThis.FontInspector)!=null&&eA.enabled));C(this,Ya,null);C(this,cr,null);C(this,Af,0);C(this,Sf,0);C(this,Ja,null);C(this,Cf,null);C(this,md,0);C(this,ko,0);C(this,gd,Object.create(null));C(this,Ef,[]);C(this,yd,null);C(this,Xa,[]);C(this,kf,new WeakMap);C(this,Tf,null);var c;if(e instanceof ReadableStream)_(this,yd,e);else if(typeof e=="object")_(this,yd,new ReadableStream({start(d){d.enqueue(e),d.close()}}));else throw new Error('No "textContentSource" parameter specified.');_(this,Fs,_(this,Cf,t)),_(this,ko,s.scale*Ri.pixelRatio),_(this,md,s.rotation),_(this,cr,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:a}=s.rawDims;_(this,Tf,[1,0,0,-1,-o,a+r]),_(this,Sf,i),_(this,Af,r),E(c=Ut,Zs,dE).call(c),t.style.setProperty("--min-font-size",l(Ut,bd)),Ul(t,s),l(this,Eo).promise.finally(()=>{l(Ut,vd).delete(this),_(this,cr,null),_(this,gd,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Tt.platform;return pe(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{l(this,Ja).read().then(({value:t,done:s})=>{if(s){l(this,Eo).resolve();return}l(this,Ya)??_(this,Ya,t.lang),Object.assign(l(this,gd),t.styles),E(this,Ur,lE).call(this,t.items),e()},l(this,Eo).reject)};return _(this,Ja,l(this,yd).getReader()),l(Ut,vd).add(this),e(),l(this,Eo).promise}update({viewport:e,onBefore:t=null}){var r;const s=e.scale*Ri.pixelRatio,i=e.rotation;if(i!==l(this,md)&&(t==null||t(),_(this,md,i),Ul(l(this,Cf),{rotation:i})),s!==l(this,ko)){t==null||t(),_(this,ko,s);const o={div:null,properties:null,ctx:E(r=Ut,Zs,bm).call(r,l(this,Ya))};for(const a of l(this,Xa))o.properties=l(this,kf).get(a),o.div=a,E(this,Ur,bx).call(this,o)}}cancel(){var t;const e=new Zo("TextLayer task cancelled.");(t=l(this,Ja))==null||t.cancel(e).catch(()=>{}),_(this,Ja,null),l(this,Eo).reject(e)}get textDivs(){return l(this,Xa)}get textContentItemsStr(){return l(this,Ef)}static cleanup(){if(!(l(this,vd).size>0)){l(this,xd).clear();for(const{canvas:e}of l(this,Qa).values())e.remove();l(this,Qa).clear()}}};Eo=new WeakMap,Fs=new WeakMap,wf=new WeakMap,_f=new WeakMap,Ya=new WeakMap,cr=new WeakMap,Af=new WeakMap,Sf=new WeakMap,Ja=new WeakMap,Cf=new WeakMap,md=new WeakMap,ko=new WeakMap,gd=new WeakMap,Ef=new WeakMap,yd=new WeakMap,Xa=new WeakMap,kf=new WeakMap,Tf=new WeakMap,xd=new WeakMap,Qa=new WeakMap,Nf=new WeakMap,bd=new WeakMap,vd=new WeakMap,Ur=new WeakSet,lE=function(e){var i,r;if(l(this,wf))return;(r=l(this,cr)).ctx??(r.ctx=E(i=Ut,Zs,bm).call(i,l(this,Ya)));const t=l(this,Xa),s=l(this,Ef);for(const o of e){if(t.length>q4){fe("Ignoring additional textDivs for performance reasons."),_(this,wf,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const a=l(this,Fs);_(this,Fs,document.createElement("span")),l(this,Fs).classList.add("markedContent"),o.id&&l(this,Fs).setAttribute("id",`${o.id}`),a.append(l(this,Fs))}else o.type==="endMarkedContent"&&_(this,Fs,l(this,Fs).parentNode);continue}s.push(o.str),E(this,Ur,cE).call(this,o)}},cE=function(e){var v;const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};l(this,Xa).push(t);const i=Z.transform(l(this,Tf),e.transform);let r=Math.atan2(i[1],i[0]);const o=l(this,gd)[e.fontName];o.vertical&&(r+=Math.PI/2);let a=l(this,_f)&&o.fontSubstitution||o.fontFamily;a=Ut.fontFamilyMap.get(a)||a;const c=Math.hypot(i[2],i[3]),d=c*E(v=Ut,Zs,uE).call(v,a,o,l(this,Ya));let u,m;r===0?(u=i[4],m=i[5]-d):(u=i[4]+d*Math.sin(r),m=i[5]-d*Math.cos(r));const p=t.style;p.left=`${(100*u/l(this,Sf)).toFixed(2)}%`,p.top=`${(100*m/l(this,Af)).toFixed(2)}%`,p.setProperty("--font-height",`${c.toFixed(2)}px`),p.fontFamily=a,s.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,l(this,_f)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(s.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const x=Math.abs(e.transform[0]),b=Math.abs(e.transform[3]);x!==b&&Math.max(x,b)/Math.min(x,b)>1.5&&(y=!0)}if(y&&(s.canvasWidth=o.vertical?e.height:e.width),l(this,kf).set(t,s),l(this,cr).div=t,l(this,cr).properties=s,E(this,Ur,bx).call(this,l(this,cr)),s.hasText&&l(this,Fs).append(t),s.hasEOL){const x=document.createElement("br");x.setAttribute("role","presentation"),l(this,Fs).append(x)}},bx=function(e){var o;const{div:t,properties:s,ctx:i}=e,{style:r}=t;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:a}=r,{canvasWidth:c,fontSize:d}=s;E(o=Ut,Zs,vx).call(o,i,d*l(this,ko),a);const{width:u}=i.measureText(t.textContent);u>0&&r.setProperty("--scale-x",c*l(this,ko)/u)}s.angle!==0&&r.setProperty("--rotate",`${s.angle}deg`)},Zs=new WeakSet,bm=function(e=null){let t=l(this,Qa).get(e||(e=""));if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),l(this,Qa).set(e,t),l(this,Nf).set(t,{size:0,family:""})}return t},vx=function(e,t,s){const i=l(this,Nf).get(e);t===i.size&&s===i.family||(e.font=`${t}px ${s}`,i.size=t,i.family=s)},dE=function(){if(l(this,bd)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),_(this,bd,e.getBoundingClientRect().height),e.remove()},uE=function(e,t,s){const i=l(this,xd).get(e);if(i)return i;const r=E(this,Zs,bm).call(this,s);r.canvas.width=r.canvas.height=H_,E(this,Zs,vx).call(this,r,H_,e);const o=r.measureText(""),a=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let d=.8;return a?d=a/(a+c):(Tt.platform.isFirefox&&fe("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?d=t.ascent:t.descent&&(d=1+t.descent)),l(this,xd).set(e,d),d},C(Ut,Zs),C(Ut,xd,new Map),C(Ut,Qa,new Map),C(Ut,Nf,new WeakMap),C(Ut,bd,null),C(Ut,vd,new Set);let vh=Ut;const V4=100;function hE(n={}){typeof n=="string"||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});const e=new wx,{docId:t}=e,s=n.url?Xj(n.url):null,i=n.data?Qj(n.data):null,r=n.httpHeaders||null,o=n.withCredentials===!0,a=n.password??null,c=n.range instanceof fE?n.range:null,d=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:2**16;let u=n.worker instanceof wh?n.worker:null;const m=n.verbosity,p=typeof n.docBaseUrl=="string"&&!i0(n.docBaseUrl)?n.docBaseUrl:null,y=Vp(n.cMapUrl),v=n.cMapPacked!==!1,x=n.CMapReaderFactory||(hs?o4:k_),b=Vp(n.iccUrl),w=Vp(n.standardFontDataUrl),S=n.StandardFontDataFactory||(hs?a4:T_),A=Vp(n.wasmUrl),k=n.WasmFactory||(hs?l4:N_),T=n.stopAtErrors!==!0,N=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,I=n.isEvalSupported!==!1,D=typeof n.isOffscreenCanvasSupported=="boolean"?n.isOffscreenCanvasSupported:!hs,P=typeof n.isImageDecoderSupported=="boolean"?n.isImageDecoderSupported:!hs&&(Tt.platform.isFirefox||!globalThis.chrome),R=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,j=typeof n.disableFontFace=="boolean"?n.disableFontFace:hs,$=n.fontExtraProperties===!0,B=n.enableXfa===!0,V=n.ownerDocument||globalThis.document,L=n.disableRange===!0,U=n.disableStream===!0,H=n.disableAutoFetch===!0,J=n.pdfBug===!0,Y=n.CanvasFactory||(hs?r4:s4),re=n.FilterFactory||(hs?i4:n4),xe=n.enableHWA===!0,_e=n.useWasm!==!1,M=c?c.length:n.length??NaN,O=typeof n.useSystemFonts=="boolean"?n.useSystemFonts:!hs&&!j,q=typeof n.useWorkerFetch=="boolean"?n.useWorkerFetch:!!(x===k_&&S===T_&&k===N_&&y&&w&&A&&Nu(y,document.baseURI)&&Nu(w,document.baseURI)&&Nu(A,document.baseURI)),le=null;Sj(m);const Se={canvasFactory:new Y({ownerDocument:V,enableHWA:xe}),filterFactory:new re({docId:t,ownerDocument:V}),cMapReaderFactory:q?null:new x({baseUrl:y,isCompressed:v}),standardFontDataFactory:q?null:new S({baseUrl:w}),wasmFactory:q?null:new k({baseUrl:A})};u||(u=wh.create({verbosity:m,port:ki.workerPort}),e._worker=u);const En={docId:t,apiVersion:"5.4.530",data:i,password:a,disableAutoFetch:H,rangeChunkSize:d,length:M,docBaseUrl:p,enableXfa:B,evaluatorOptions:{maxImageSize:N,disableFontFace:j,ignoreErrors:T,isEvalSupported:I,isOffscreenCanvasSupported:D,isImageDecoderSupported:P,canvasMaxAreaInBytes:R,fontExtraProperties:$,useSystemFonts:O,useWasm:_e,useWorkerFetch:q,cMapUrl:y,iccUrl:b,standardFontDataUrl:w,wasmUrl:A}},K={ownerDocument:V,pdfBug:J,styleElement:le,loadingParams:{disableAutoFetch:H,enableXfa:B}};return u.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const ue=u.messageHandler.sendWithPromise("GetDocRequest",En,i?[i.buffer]:null);let Te;if(c)Te=new E4(c,{disableRange:L,disableStream:U});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const tn=Nu(s)?I4:hs?B4:L4;Te=new tn({url:s,length:M,httpHeaders:r,withCredentials:o,rangeChunkSize:d,disableRange:L,disableStream:U})}return ue.then(tn=>{if(e.destroyed)throw new Error("Loading aborted");if(u.destroyed)throw new Error("Worker was destroyed");const Nt=new ju(t,tn,u.port),zl=new W4(Nt,e,Te,K,Se,xe);e._transport=zl,Nt.send("Ready",null)})}).catch(e._capability.reject),e}var Tg;const Ng=class Ng{constructor(){W(this,"_capability",Promise.withResolvers());W(this,"_transport",null);W(this,"_worker",null);W(this,"docId",`d${ot(Ng,Tg)._++}`);W(this,"destroyed",!1);W(this,"onPassword",null);W(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,s,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Tg=new WeakMap,C(Ng,Tg,0);let wx=Ng;var Za,If,Pf,Rf,Mf;class fE{constructor(e,t,s=!1,i=null){C(this,Za,Promise.withResolvers());C(this,If,[]);C(this,Pf,[]);C(this,Rf,[]);C(this,Mf,[]);this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(e){l(this,Mf).push(e)}addProgressListener(e){l(this,Rf).push(e)}addProgressiveReadListener(e){l(this,Pf).push(e)}addProgressiveDoneListener(e){l(this,If).push(e)}onDataRange(e,t){for(const s of l(this,Mf))s(e,t)}onDataProgress(e,t){l(this,Za).promise.then(()=>{for(const s of l(this,Rf))s(e,t)})}onDataProgressiveRead(e){l(this,Za).promise.then(()=>{for(const t of l(this,Pf))t(e)})}onDataProgressiveDone(){l(this,Za).promise.then(()=>{for(const e of l(this,If))e()})}transportReady(){l(this,Za).resolve()}requestDataRange(e,t){ze("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}Za=new WeakMap,If=new WeakMap,Pf=new WeakMap,Rf=new WeakMap,Mf=new WeakMap;class $4{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return pe(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var dr,el,Gu;class z4{constructor(e,t,s,i=!1){C(this,el);C(this,dr,!1);this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=i?new v_:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new aE,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:r=!1}={}){return new wp({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return pe(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:i="display",annotationMode:r=Xr.ENABLE,transform:o=null,background:a=null,optionalContentConfigPromise:c=null,annotationCanvasMap:d=null,pageColors:u=null,printAnnotationStorage:m=null,isEditing:p=!1,recordOperations:y=!1,operationsFilter:v=null}){var P,R,j;(P=this._stats)==null||P.time("Overall");const x=this._transport.getRenderingIntent(i,r,m,p),{renderingIntent:b,cacheKey:w}=x;_(this,dr,!1),c||(c=this._transport.getOptionalContentConfig(b));let S=this._intentStates.get(w);S||(S=Object.create(null),this._intentStates.set(w,S)),S.streamReaderCancelTimeout&&(clearTimeout(S.streamReaderCancelTimeout),S.streamReaderCancelTimeout=null);const A=!!(b&Js.PRINT);S.displayReadyCapability||(S.displayReadyCapability=Promise.withResolvers(),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(R=this._stats)==null||R.time("Page Request"),this._pumpOperatorList(x));const k=!!(this._pdfBug&&((j=globalThis.StepperManager)!=null&&j.enabled)),T=!this.recordedBBoxes&&(y||k),N=$=>{var B,V;if(S.renderTasks.delete(I),T){const L=(B=I.gfx)==null?void 0:B.dependencyTracker.take();L&&(I.stepper&&I.stepper.setOperatorBBoxes(L,I.gfx.dependencyTracker.takeDebugMetadata()),y&&(this.recordedBBoxes=L))}A&&_(this,dr,!0),E(this,el,Gu).call(this),$?(I.capability.reject($),this._abortOperatorList({intentState:S,reason:$ instanceof Error?$:new Error($)})):I.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(V=globalThis.Stats)!=null&&V.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},I=new _x({callback:N,params:{canvas:t,canvasContext:e,dependencyTracker:T?new d4(t,S.operatorList.length,k):null,viewport:s,transform:o,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:S.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!A,pdfBug:this._pdfBug,pageColors:u,enableHWA:this._transport.enableHWA,operationsFilter:v});(S.renderTasks||(S.renderTasks=new Set)).add(I);const D=I.task;return Promise.all([S.displayReadyCapability.promise,c]).then(([$,B])=>{var V;if(this.destroyed){N();return}if((V=this._stats)==null||V.time("Rendering"),!(B.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");I.initializeGraphics({transparency:$,optionalContentConfig:B}),I.operatorListChanged()}).catch(N),D}getOperatorList({intent:e="display",annotationMode:t=Xr.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var d;function r(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,s,i,!0);let a=this._intentStates.get(o.cacheKey);a||(a=Object.create(null),this._intentStates.set(o.cacheKey,a));let c;return a.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||(a.renderTasks=new Set)).add(c),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(d=this._stats)==null||d.time("Page Request"),this._pumpOperatorList(o)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>bh.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,i){function r(){o.read().then(function({value:c,done:d}){if(d){s(a);return}a.lang??(a.lang=c.lang),Object.assign(a.styles,c.styles),a.items.push(...c.items),r()},i)}const o=t.getReader(),a={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),_(this,dr,!1),Promise.all(e)}cleanup(e=!1){_(this,dr,!0);const t=E(this,el,Gu).call(this);return e&&t&&this._stats&&(this._stats=new v_),t}_startRenderPage(e,t){var i,r;const s=this._intentStates.get(t);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=s.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let s=0,i=e.length;s<i;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&E(this,el,Gu).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:i}){const{map:r,transfer:o}=s,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),d=this._intentStates.get(t);d.streamReader=c;const u=()=>{c.read().then(({value:m,done:p})=>{if(p){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(m,d),u())},m=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const p of d.renderTasks)p.operatorListChanged();E(this,el,Gu).call(this)}if(d.displayReadyCapability)d.displayReadyCapability.reject(m);else if(d.opListReadCapability)d.opListReadCapability.reject(m);else throw m}})};u()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof jb){let i=V4;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new Zo(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}dr=new WeakMap,el=new WeakSet,Gu=function(){if(!l(this,dr)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),_(this,dr,!1),!0};var To,On,ur,tl,Ig,sl,nl,gs,vm,pE,mE,qu,wd,wm;const Ze=class Ze{constructor({name:e=null,port:t=null,verbosity:s=Cj()}={}){C(this,gs);C(this,To,Promise.withResolvers());C(this,On,null);C(this,ur,null);C(this,tl,null);if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if(l(Ze,nl).has(t))throw new Error("Cannot use more than one PDFWorker per port.");l(Ze,nl).set(t,this),E(this,gs,pE).call(this,t)}else E(this,gs,mE).call(this)}get promise(){return l(this,To).promise}get port(){return l(this,ur)}get messageHandler(){return l(this,On)}destroy(){var e,t;this.destroyed=!0,(e=l(this,tl))==null||e.terminate(),_(this,tl,null),l(Ze,nl).delete(l(this,ur)),_(this,ur,null),(t=l(this,On))==null||t.destroy(),_(this,On,null)}static create(e){const t=l(this,nl).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ze(e)}static get workerSrc(){if(ki.workerSrc)return ki.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return pe(this,"_setupFakeWorkerGlobal",(async()=>l(this,wd,wm)?l(this,wd,wm):(await import(this.workerSrc)).WorkerMessageHandler)())}};To=new WeakMap,On=new WeakMap,ur=new WeakMap,tl=new WeakMap,Ig=new WeakMap,sl=new WeakMap,nl=new WeakMap,gs=new WeakSet,vm=function(){l(this,To).resolve(),l(this,On).send("configure",{verbosity:this.verbosity})},pE=function(e){_(this,ur,e),_(this,On,new ju("main","worker",e)),l(this,On).on("ready",()=>{}),E(this,gs,vm).call(this)},mE=function(){if(l(Ze,sl)||l(Ze,wd,wm)){E(this,gs,qu).call(this);return}let{workerSrc:e}=Ze;try{Ze._isSameOrigin(window.location,e)||(e=Ze._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new ju("main","worker",t),i=()=>{r.abort(),s.destroy(),t.terminate(),this.destroyed?l(this,To).reject(new Error("Worker was destroyed")):E(this,gs,qu).call(this)},r=new AbortController;t.addEventListener("error",()=>{l(this,tl)||i()},{signal:r.signal}),s.on("test",a=>{if(r.abort(),this.destroyed||!a){i();return}_(this,On,s),_(this,ur,t),_(this,tl,t),E(this,gs,vm).call(this)}),s.on("ready",a=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{E(this,gs,qu).call(this)}});const o=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};o();return}catch{n0("The worker has been disabled.")}E(this,gs,qu).call(this)},qu=function(){l(Ze,sl)||(fe("Setting up fake worker."),_(Ze,sl,!0)),Ze._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){l(this,To).reject(new Error("Worker was destroyed"));return}const t=new t4;_(this,ur,t);const s=`fake${ot(Ze,Ig)._++}`,i=new ju(s+"_worker",s,t);e.setup(i,t),_(this,On,new ju(s,s+"_worker",t)),E(this,gs,vm).call(this)}).catch(e=>{l(this,To).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},wd=new WeakSet,wm=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},C(Ze,wd),C(Ze,Ig,0),C(Ze,sl,!1),C(Ze,nl,new WeakMap),hs&&(_(Ze,sl,!0),ki.workerSrc||(ki.workerSrc="./pdf.worker.mjs")),Ze._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(t,s);return s.origin===i.origin},Ze._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Ze.fromPort=e=>{if(jj("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Ze.create(e)};let wh=Ze;var hr,gi,_d,Ad,fr,il,Vu;class W4{constructor(e,t,s,i,r,o){C(this,il);C(this,hr,new Map);C(this,gi,new Map);C(this,_d,new Map);C(this,Ad,new Map);C(this,fr,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new aE,this.fontLoader=new Kj({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return pe(this,"annotationStorage",new Ub)}getRenderingIntent(e,t=Xr.ENABLE,s=null,i=!1,r=!1){let o=Js.DISPLAY,a=ix;switch(e){case"any":o=Js.ANY;break;case"display":break;case"print":o=Js.PRINT;break;default:fe(`getRenderingIntent - invalid intent: ${e}`)}const c=o&Js.PRINT&&s instanceof $C?s:this.annotationStorage;switch(t){case Xr.DISABLE:o+=Js.ANNOTATIONS_DISABLE;break;case Xr.ENABLE:break;case Xr.ENABLE_FORMS:o+=Js.ANNOTATIONS_FORMS;break;case Xr.ENABLE_STORAGE:o+=Js.ANNOTATIONS_STORAGE,a=c.serializable;break;default:fe(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=Js.IS_EDITING),r&&(o+=Js.OPLIST);const{ids:d,hash:u}=c.modifiedIds,m=[o,a.hash,u];return{renderingIntent:o,cacheKey:m.join("_"),annotationStorageSerializable:a,modifiedIds:d}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=l(this,fr))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of l(this,gi).values())e.push(i._destroy());l(this,gi).clear(),l(this,_d).clear(),l(this,Ad).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),l(this,hr).clear(),this.filterFactory.destroy(),vh.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new Zo("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,i)=>{ke(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}ke(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async s=>{var a;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((a=t.onProgress)==null||a.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var d;(d=t.onProgress)==null||d.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(s,i)=>{ke(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(s.begin,s.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){i.close();return}ke(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new $4(s,this))}),e.on("DocException",s=>{t._capability.reject(vs(s))}),e.on("PasswordRequest",s=>{_(this,fr,Promise.withResolvers());try{if(!t.onPassword)throw vs(s);const i=r=>{r instanceof Error?l(this,fr).reject(r):l(this,fr).resolve({password:r})};t.onPassword(i,s.code)}catch(i){l(this,fr).reject(i)}return l(this,fr).promise}),e.on("DataLoaded",s=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;l(this,gi).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in r){const p=r.error;fe(`Error during font loading: ${p}`),this.commonObjs.resolve(s,p);break}const a=new rx(r),c=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(p,y)=>globalThis.FontInspector.fontAdded(p,y):null,d=new Yj(a,c,r.extra,r.charProcOperatorList);this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(s,d)});break;case"CopyLocalImage":const{imageRef:u}=r;ke(u,"The imageRef must be defined.");for(const p of l(this,gi).values())for(const[,y]of p.objs)if((y==null?void 0:y.ref)===u)return y.dataLen?(this.commonObjs.resolve(s,structuredClone(y)),y.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new Jj(r));break;case"Image":this.commonObjs.resolve(s,r);break;case"Pattern":const m=new ox(r);this.commonObjs.resolve(s,m.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([s,i,r,o])=>{var c;if(this.destroyed)return;const a=l(this,gi).get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){(c=o==null?void 0:o.bitmap)==null||c.close();return}switch(r){case"Image":case"Pattern":a.objs.resolve(s,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",s=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:s.loaded,total:s.total})}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&fe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((s=this._fullReader)==null?void 0:s.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=l(this,_d).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&l(this,Ad).set(r.refStr,e);const o=new z4(t,r,this,this._params.pdfBug);return l(this,gi).set(t,o),o});return l(this,_d).set(t,i),i}getPageIndex(e){return ax(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return E(this,il,Vu).call(this,"GetFieldObjects")}hasJSActions(){return E(this,il,Vu).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return E(this,il,Vu).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return E(this,il,Vu).call(this,"GetOptionalContentConfig").then(t=>new C4(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=l(this,hr).get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new A4(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null,hasStructTree:i[2]}});return l(this,hr).set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of l(this,gi).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),l(this,hr).clear(),this.filterFactory.destroy(!0),vh.cleanup()}}cachedPageNumber(e){if(!ax(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return l(this,Ad).get(t)??null}}hr=new WeakMap,gi=new WeakMap,_d=new WeakMap,Ad=new WeakMap,fr=new WeakMap,il=new WeakSet,Vu=function(e,t=null){const s=l(this,hr).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise(e,t);return l(this,hr).set(e,i),i};var No;class K4{constructor(e){C(this,No,null);W(this,"onContinue",null);W(this,"onError",null);_(this,No,e)}get promise(){return l(this,No).capability.promise}cancel(e=0){l(this,No).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=l(this,No).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=l(this,No);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}No=new WeakMap;var Io,rl;const ca=class ca{constructor({callback:e,params:t,objs:s,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:c,filterFactory:d,useRequestAnimationFrame:u=!1,pdfBug:m=!1,pageColors:p=null,enableHWA:y=!1,operationsFilter:v=null}){C(this,Io,null);this.callback=e,this.params=t,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=c,this.filterFactory=d,this._pdfBug=m,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=u===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new K4(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=y,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=v}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var c,d;if(this.cancelled)return;if(this._canvas){if(l(ca,rl).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");l(ca,rl).add(this._canvas)}this._pdfBug&&((c=globalThis.StepperManager)!=null&&c.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:r,dependencyTracker:o}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new vc(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:s,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(d=this.graphicsReadyCallback)==null||d.call(this)}cancel(e=null,t=0){var s,i,r;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),l(this,Io)&&(window.cancelAnimationFrame(l(this,Io)),_(this,Io,null)),l(ca,rl).delete(this._canvas),e||(e=new jb(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?_(this,Io,window.requestAnimationFrame(()=>{_(this,Io,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),l(ca,rl).delete(this._canvas),this.callback())))}};Io=new WeakMap,rl=new WeakMap,C(ca,rl,new WeakSet);let _x=ca;const Y4="5.4.530",J4="50cc4adac";var js,ol,Sd,Ct,Df,Cd,pr,Lf,Po,Un,Ff,He,Ax,Sx,Cx,ra,gE,Kr;const ws=class ws{constructor({editor:e=null,uiManager:t=null}){C(this,He);C(this,js,null);C(this,ol,null);C(this,Sd);C(this,Ct,null);C(this,Df,!1);C(this,Cd,!1);C(this,pr,null);C(this,Lf);C(this,Po,null);C(this,Un,null);var s,i;e?(_(this,Cd,!1),_(this,pr,e)):_(this,Cd,!0),_(this,Un,(e==null?void 0:e._uiManager)||t),_(this,Lf,l(this,Un)._eventBus),_(this,Sd,((s=e==null?void 0:e.color)==null?void 0:s.toUpperCase())||((i=l(this,Un))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),l(ws,Ff)||_(ws,Ff,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return pe(this,"_keyboardManager",new Ap([[["Escape","mac+Escape"],ws.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ws.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ws.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ws.prototype._moveToPrevious],[["Home","mac+Home"],ws.prototype._moveToBeginning],[["End","mac+End"],ws.prototype._moveToEnd]]))}renderButton(){const e=_(this,js,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",l(this,pr)&&(e.ariaControls=`${l(this,pr).id}_colorpicker_dropdown`);const t=l(this,Un)._signal;e.addEventListener("click",E(this,He,ra).bind(this),{signal:t}),e.addEventListener("keydown",E(this,He,Cx).bind(this),{signal:t});const s=_(this,ol,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=l(this,Sd),e.append(s),e}renderMainDropdown(){const e=_(this,Ct,E(this,He,Ax).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===l(this,js)){E(this,He,ra).call(this,e);return}const t=e.target.getAttribute("data-color");t&&E(this,He,Sx).call(this,t,e)}_moveToNext(e){var t,s;if(!l(this,He,Kr)){E(this,He,ra).call(this,e);return}if(e.target===l(this,js)){(t=l(this,Ct).firstElementChild)==null||t.focus();return}(s=e.target.nextSibling)==null||s.focus()}_moveToPrevious(e){var t,s;if(e.target===((t=l(this,Ct))==null?void 0:t.firstElementChild)||e.target===l(this,js)){l(this,He,Kr)&&this._hideDropdownFromKeyboard();return}l(this,He,Kr)||E(this,He,ra).call(this,e),(s=e.target.previousSibling)==null||s.focus()}_moveToBeginning(e){var t;if(!l(this,He,Kr)){E(this,He,ra).call(this,e);return}(t=l(this,Ct).firstElementChild)==null||t.focus()}_moveToEnd(e){var t;if(!l(this,He,Kr)){E(this,He,ra).call(this,e);return}(t=l(this,Ct).lastElementChild)==null||t.focus()}hideDropdown(){var e,t;(e=l(this,Ct))==null||e.classList.add("hidden"),l(this,js).ariaExpanded="false",(t=l(this,Po))==null||t.abort(),_(this,Po,null)}_hideDropdownFromKeyboard(){var e;if(!l(this,Cd)){if(!l(this,He,Kr)){(e=l(this,pr))==null||e.unselect();return}this.hideDropdown(),l(this,js).focus({preventScroll:!0,focusVisible:l(this,Df)})}}updateColor(e){if(l(this,ol)&&(l(this,ol).style.backgroundColor=e),!l(this,Ct))return;const t=l(this,Un).highlightColors.values();for(const s of l(this,Ct).children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=l(this,js))==null||e.remove(),_(this,js,null),_(this,ol,null),(t=l(this,Ct))==null||t.remove(),_(this,Ct,null)}};js=new WeakMap,ol=new WeakMap,Sd=new WeakMap,Ct=new WeakMap,Df=new WeakMap,Cd=new WeakMap,pr=new WeakMap,Lf=new WeakMap,Po=new WeakMap,Un=new WeakMap,Ff=new WeakMap,He=new WeakSet,Ax=function(){const e=document.createElement("div"),t=l(this,Un)._signal;e.addEventListener("contextmenu",Sn,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),l(this,pr)&&(e.id=`${l(this,pr).id}_colorpicker_dropdown`);for(const[s,i]of l(this,Un).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=s,r.setAttribute("data-l10n-id",l(ws,Ff)[s]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.ariaSelected=i===l(this,Sd),r.addEventListener("click",E(this,He,Sx).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",E(this,He,Cx).bind(this),{signal:t}),e},Sx=function(e,t){t.stopPropagation(),l(this,Lf).dispatch("switchannotationeditorparams",{source:this,type:Ee.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},Cx=function(e){ws._keyboardManager.exec(this,e)},ra=function(e){if(l(this,He,Kr)){this.hideDropdown();return}if(_(this,Df,e.detail===0),l(this,Po)||(_(this,Po,new AbortController),window.addEventListener("pointerdown",E(this,He,gE).bind(this),{signal:l(this,Un).combinedSignal(l(this,Po))})),l(this,js).ariaExpanded="true",l(this,Ct)){l(this,Ct).classList.remove("hidden");return}const t=_(this,Ct,E(this,He,Ax).call(this));l(this,js).append(t)},gE=function(e){var t;(t=l(this,Ct))!=null&&t.contains(e.target)||this.hideDropdown()},Kr=function(){return l(this,Ct)&&!l(this,Ct).classList.contains("hidden")},C(ws,Ff,null);let fg=ws;var yi,jf,Ed,Of;const da=class da{constructor(e){C(this,yi,null);C(this,jf,null);C(this,Ed,null);_(this,jf,e),_(this,Ed,e._uiManager),l(da,Of)||_(da,Of,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(l(this,yi))return l(this,yi);const{editorType:e,colorType:t,color:s}=l(this,jf),i=_(this,yi,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",l(da,Of)[e]),i.addEventListener("input",()=>{l(this,Ed).updateParams(t,i.value)},{signal:l(this,Ed)._signal}),i}update(e){l(this,yi)&&(l(this,yi).value=e)}destroy(){var e;(e=l(this,yi))==null||e.remove(),_(this,yi,null)}hideDropdown(){}};yi=new WeakMap,jf=new WeakMap,Ed=new WeakMap,Of=new WeakMap,C(da,Of,null);let pg=da;function G_(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}function _u(n){return Math.max(0,Math.min(255,255*n))}class q_{static CMYK_G([e,t,s,i]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=_u(e),[e,e,e]}static G_HTML([e]){const t=G_(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(_u)}static RGB_HTML(e){return`#${e.map(G_).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,s+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,s,i]){return[_u(1-Math.min(1,e+i)),_u(1-Math.min(1,s+i)),_u(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const i=1-e,r=1-t,o=1-s,a=Math.min(i,r,o);return["CMYK",i,r,o,a]}}class X4{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ze("Abstract method `_createSVG` called.")}}class mg extends X4{_createSVG(e){return document.createElementNS(Ui,e)}}const Q4=9,Hl=new WeakSet,Z4=new Date().getTimezoneOffset()*60*1e3;class R0{static create(e){switch(e.data.annotationType){case xt.LINK:return new Gb(e);case xt.TEXT:return new tO(e);case xt.WIDGET:switch(e.data.fieldType){case"Tx":return new sO(e);case"Btn":return e.data.radioButton?new bE(e):e.data.checkBox?new iO(e):new rO(e);case"Ch":return new oO(e);case"Sig":return new nO(e)}return new $l(e);case xt.POPUP:return new kx(e);case xt.FREETEXT:return new SE(e);case xt.LINE:return new lO(e);case xt.SQUARE:return new cO(e);case xt.CIRCLE:return new dO(e);case xt.POLYLINE:return new CE(e);case xt.CARET:return new hO(e);case xt.INK:return new qb(e);case xt.POLYGON:return new uO(e);case xt.HIGHLIGHT:return new EE(e);case xt.UNDERLINE:return new fO(e);case xt.SQUIGGLY:return new pO(e);case xt.STRIKEOUT:return new mO(e);case xt.STAMP:return new kE(e);case xt.FILEATTACHMENT:return new gO(e);default:return new rt(e)}}}var al,kd,mn,Uf,Ex;const Jb=class Jb{constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){C(this,Uf);C(this,al,null);C(this,kd,!1);C(this,mn,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Jb._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var s;const{data:e}=this,t=(s=this.annotationStorage)==null?void 0:s.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var a;const e=(a=this.annotationStorage)==null?void 0:a.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:i}=this.data;let r=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let c=0;c<t.length;c+=8)t[c+1]>o?(o=t[c+1],r=t[c+2]):t[c+1]===o&&(r=Math.max(r,t[c+2]));return[r,o]}if((s==null?void 0:s.length)>=1){for(const c of s)for(let d=0,u=c.length;d<u;d+=2)c[d+1]>o?(o=c[d+1],r=c[d]):c[d+1]===o&&(r=Math.max(r,c[d]));if(r!==1/0)return[r,o]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:r,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/s,e[1]=100*(e[1]-o)/i,e}get commentText(){var t,s,i;const{data:e}=this;return((s=(t=this.annotationStorage.getRawValue(`${yh}${e.id}`))==null?void 0:t.popup)==null?void 0:s.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${yh}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=l(this,mn))==null?void 0:e.popup)||this.popup)==null||t.remove(),_(this,mn,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(l(this,al)||_(this,al,{rect:this.data.rect.slice(0)}));const{rect:t,popup:s}=e;t&&E(this,Uf,Ex).call(this,t);let i=((r=l(this,mn))==null?void 0:r.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=l(this,mn).popup),i&&(i.updateEdited(e),s!=null&&s.deleted&&(i.remove(),_(this,mn,null),this.popup=null))}resetEdited(){var e;l(this,al)&&(E(this,Uf,Ex).call(this,l(this,al).rect),(e=l(this,mn))==null||e.popup.resetEdited(),_(this,al,null))}_createContainer(e){const{data:t,parent:{page:s,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof $l)&&!(this instanceof Gb)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof kx){const{rotation:x}=t;return!t.hasOwnCanvas&&x!==0&&this.setRotation(x,r),r}const{width:a,height:c}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const x=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(x>0||b>0){const S=`calc(${x}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;o.borderRadius=S}else if(this instanceof bE){const S=`calc(${a}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=S}switch(t.borderStyle.style){case Ql.SOLID:o.borderStyle="solid";break;case Ql.DASHED:o.borderStyle="dashed";break;case Ql.BEVELED:fe("Unimplemented border style: beveled");break;case Ql.INSET:fe("Unimplemented border style: inset");break;case Ql.UNDERLINE:o.borderBottomStyle="solid";break}const w=t.borderColor||null;w?(_(this,kd,!0),o.borderColor=Z.makeHexColor(w[0]|0,w[1]|0,w[2]|0)):o.borderWidth=0}const d=Z.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:u,pageHeight:m,pageX:p,pageY:y}=i.rawDims;o.left=`${100*(d[0]-p)/u}%`,o.top=`${100*(d[1]-y)/m}%`;const{rotation:v}=t;return t.hasOwnCanvas||v===0?(o.width=`${100*a/u}%`,o.height=`${100*c/m}%`):this.setRotation(v,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:o}=this;e%180!==0&&([r,o]=[o,r]),t.style.width=`${100*r/s}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,i)=>{const r=i.detail[t],o=r[0],a=r.slice(1);i.target.style[s]=q_[`${o}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:q_[`${o}_rgb`](a)})};return pe(this,"_commonActions",{display:t=>{const{display:s}=t.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||s[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[i,r]of Object.entries(t)){const o=s[i];if(o){const a={detail:{[i]:r},target:e};o(a),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,i,r]=this.data.rect.map(x=>Math.fround(x));if(e.length===8){const[x,b,w,S]=e.subarray(2,6);if(i===x&&r===b&&t===w&&s===S)return}const{style:o}=this.container;let a;if(l(this,kd)){const{borderColor:x,borderWidth:b}=o;o.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${x}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const c=i-t,d=r-s,{svgFactory:u}=this,m=u.createElement("svg");m.classList.add("quadrilateralsContainer"),m.setAttribute("width",0),m.setAttribute("height",0),m.role="none";const p=u.createElement("defs");m.append(p);const y=u.createElement("clipPath"),v=`clippath_${this.data.id}`;y.setAttribute("id",v),y.setAttribute("clipPathUnits","objectBoundingBox"),p.append(y);for(let x=2,b=e.length;x<b;x+=8){const w=e[x],S=e[x+1],A=e[x+2],k=e[x+3],T=u.createElement("rect"),N=(A-t)/c,I=(r-S)/d,D=(w-A)/c,P=(S-k)/d;T.setAttribute("x",N),T.setAttribute("y",I),T.setAttribute("width",D),T.setAttribute("height",P),y.append(T),a==null||a.push(`<rect vector-effect="non-scaling-stroke" x="${N}" y="${I}" width="${D}" height="${P}"/>`)}l(this,kd)&&(a.push("</g></svg>')"),o.backgroundImage=a.join("")),this.container.append(m),this.container.style.clipPath=`url(#${v})`}_createPopup(e=null){const{data:t}=this;let s,i;e?(s={str:e.text},i=e.date):(s=t.contentsObj,i=t.modificationDate),_(this,mn,new kx({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(l(this,mn)||this.popup||this.data.popupRef)}get extraPopupElement(){return l(this,mn)}render(){ze("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:a}of i){if(r===-1||o===t)continue;const c=typeof a=="string"?a:null,d=document.querySelector(`[data-element-id="${o}"]`);if(d&&!Hl.has(d)){fe(`_getElementsByName - element not allowed: ${o}`);continue}s.push({id:o,exportValue:c,domElement:d})}return s}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&Hl.has(i)&&s.push({id:o,exportValue:r,domElement:i})}return s}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};al=new WeakMap,kd=new WeakMap,mn=new WeakMap,Uf=new WeakSet,Ex=function(e){const{container:{style:t},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:c}}}}=this;s==null||s.splice(0,4,...e),t.left=`${100*(e[0]-a)/r}%`,t.top=`${100*(o-e[3]+c)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)};let rt=Jb;class eO extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var Qs,oa,yE,xE;class Gb extends rt{constructor(t,s=null){super(t,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});C(this,Qs);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(s.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(E(this,Qs,yE).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(E(this,Qs,xE).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=i,this.container.append(i)),this.container}_bindLink(t,s,i=""){t.href=this.linkService.getDestinationHash(s),t.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&E(this,Qs,oa).call(this),i&&(t.title=i)}_bindNamedAction(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(t.title=i),E(this,Qs,oa).call(this)}_bindJSAction(t,s){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(s.actions)){const o=i.get(r);o&&(t[o]=()=>{var a;return(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:r}}),!1})}s.overlaidText&&(t.title=s.overlaidText),t.onclick||(t.onclick=()=>!1),E(this,Qs,oa).call(this)}_bindResetFormAction(t,s){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),E(this,Qs,oa).call(this),!this._fieldObjects){fe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var m;i==null||i();const{fields:r,refs:o,include:a}=s,c=[];if(r.length!==0||o.length!==0){const p=new Set(o);for(const y of r){const v=this._fieldObjects[y]||[];for(const{id:x}of v)p.add(x)}for(const y of Object.values(this._fieldObjects))for(const v of y)p.has(v.id)===a&&c.push(v)}else for(const p of Object.values(this._fieldObjects))c.push(...p);const d=this.annotationStorage,u=[];for(const p of c){const{id:y}=p;switch(u.push(y),p.type){case"text":{const x=p.defaultValue||"";d.setValue(y,{value:x});break}case"checkbox":case"radiobutton":{const x=p.defaultValue===p.exportValues;d.setValue(y,{value:x});break}case"combobox":case"listbox":{const x=p.defaultValue||"";d.setValue(y,{value:x});break}default:continue}const v=document.querySelector(`[data-element-id="${y}"]`);if(v){if(!Hl.has(v)){fe(`_bindResetFormAction - element not allowed: ${y}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((m=this.linkService.eventBus)==null||m.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}})),!1}}}Qs=new WeakSet,oa=function(){this.container.setAttribute("data-internal-link","")},yE=function(t,s,i="",r=null){t.href=this.linkService.getAnchorUrl(""),s.description?t.title=s.description:i&&(t.title=i),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(s.content,s.filename,r),!1},E(this,Qs,oa).call(this)},xE=function(t,s,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(t.title=i),E(this,Qs,oa).call(this)};class tO extends rt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class $l extends rt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Tt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,i,r){s.includes("mouse")?e.addEventListener(s,o=>{var a;(a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(s,o=>{var a;if(s==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}r&&((a=this.linkService.eventBus)==null||a.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,s,i){var r,o,a;for(const[c,d]of s)(d==="Action"||(r=this.data.actions)!=null&&r[d])&&((d==="Focus"||d==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,d,i),d==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):d==="Blur"&&!((a=this.data.actions)!=null&&a.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Z.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Q4,r=e.style;let o;const a=2,c=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-a),u=Math.round(d/(S0*i))||1,m=d/u;o=Math.min(i,c(m/S0))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-a);o=Math.min(i,c(d/S0))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=Z.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class sO extends $l{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=s),r.setValue(o.id,{[i]:s})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let a=o.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&a.length>c&&(a=a.slice(0,c));let d=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;d&&this.data.comb&&(d=d.replaceAll(/\s+/g,""));const u={userValue:a,formattedValue:d,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=d??a,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",d??a),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Hl.add(s),this.contentElement=s,s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:m,datetimeType:p,timeStep:y}=this.data,v=!!p&&this.enableScripting;m&&(s.title=m),this._setRequired(s,this.data.required),c&&(s.maxLength=c),s.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(s,"value",b.target.value,"value"),u.formattedValue=null}),s.addEventListener("resetform",b=>{const w=this.data.defaultFieldValue??"";s.value=u.userValue=w,u.formattedValue=null});let x=b=>{const{formattedValue:w}=u;w!=null&&(b.target.value=w),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",w=>{var A;if(u.focused)return;const{target:S}=w;if(v&&(S.type=p,y&&(S.step=y)),u.userValue){const k=u.userValue;if(v)if(p==="time"){const T=new Date(k),N=[T.getHours(),T.getMinutes(),T.getSeconds()];S.value=N.map(I=>I.toString().padStart(2,"0")).join(":")}else S.value=new Date(k-Z4).toISOString().split(p==="date"?"T":".",1)[0];else S.value=k}u.lastCommittedValue=S.value,u.commitKey=1,(A=this.data.actions)!=null&&A.Focus||(u.focused=!0)}),s.addEventListener("updatefromsandbox",w=>{this.showElementAndHideCanvas(w.target);const S={value(A){u.userValue=A.detail.value??"",v||e.setValue(t,{value:u.userValue.toString()}),A.target.value=u.userValue},formattedValue(A){const{formattedValue:k}=A.detail;u.formattedValue=k,k!=null&&A.target!==document.activeElement&&(A.target.value=k);const T={formattedValue:k};v&&(T.value=k),e.setValue(t,T)},selRange(A){A.target.setSelectionRange(...A.detail.selRange)},charLimit:A=>{var I;const{charLimit:k}=A.detail,{target:T}=A;if(k===0){T.removeAttribute("maxLength");return}T.setAttribute("maxLength",k);let N=u.userValue;!N||N.length<=k||(N=N.slice(0,k),T.value=u.userValue=N,e.setValue(t,{value:N}),(I=this.linkService.eventBus)==null||I.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:N,willCommit:!0,commitKey:1,selStart:T.selectionStart,selEnd:T.selectionEnd}}))}};this._dispatchEventFromSandbox(S,w)}),s.addEventListener("keydown",w=>{var k;u.commitKey=1;let S=-1;if(w.key==="Escape"?S=0:w.key==="Enter"&&!this.data.multiLine?S=2:w.key==="Tab"&&(u.commitKey=3),S===-1)return;const{value:A}=w.target;u.lastCommittedValue!==A&&(u.lastCommittedValue=A,u.userValue=A,(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:S,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}}))});const b=x;x=null,s.addEventListener("blur",w=>{var k,T;if(!u.focused||!w.relatedTarget)return;(k=this.data.actions)!=null&&k.Blur||(u.focused=!1);const{target:S}=w;let{value:A}=S;if(v){if(A&&p==="time"){const N=A.split(":").map(I=>parseInt(I,10));A=new Date(2e3,0,1,N[0],N[1],N[2]||0).valueOf(),S.step=""}else A.includes("T")||(A=`${A}T00:00`),A=new Date(A).valueOf();S.type="text"}u.userValue=A,u.lastCommittedValue!==A&&((T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:u.commitKey,selStart:w.target.selectionStart,selEnd:w.target.selectionEnd}})),b(w)}),(r=this.data.actions)!=null&&r.Keystroke&&s.addEventListener("beforeinput",w=>{var P;u.lastCommittedValue=null;const{data:S,target:A}=w,{value:k,selectionStart:T,selectionEnd:N}=A;let I=T,D=N;switch(w.inputType){case"deleteWordBackward":{const R=k.substring(0,T).match(/\w*[^\w]*$/);R&&(I-=R[0].length);break}case"deleteWordForward":{const R=k.substring(T).match(/^[^\w]*\w*/);R&&(D+=R[0].length);break}case"deleteContentBackward":T===N&&(I-=1);break;case"deleteContentForward":T===N&&(D+=1);break}w.preventDefault(),(P=this.linkService.eventBus)==null||P.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:k,change:S||"",willCommit:!1,selStart:I,selEnd:D}})}),this._setEventListeners(s,u,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],w=>w.target.value)}if(x&&s.addEventListener("blur",x),this.data.comb){const w=(this.data.rect[2]-this.data.rect[0])/c;s.classList.add("comb"),s.style.letterSpacing=`calc(${w}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class nO extends $l{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class iO extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return Hl.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const d of this._getElementsByName(a,s)){const u=c&&d.exportValue===t.exportValue;d.domElement&&(d.domElement.checked=u),e.setValue(d.id,{value:u})}e.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue||"Off";o.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const a={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(s,{value:c.target.checked})}};this._dispatchEventFromSandbox(a,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class bE extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let i=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(s,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,s))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(Hl.add(r),r.setAttribute("data-element-id",s),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:a,checked:c}=o.target;for(const d of this._getElementsByName(a,s))e.setValue(d.id,{value:!1});e.setValue(s,{value:c})}),r.addEventListener("resetform",o=>{const a=t.defaultFieldValue;o.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",a=>{const c={value:d=>{const u=o===d.detail.value;for(const m of this._getElementsByName(d.target.name)){const p=u&&m.id===s;m.domElement&&(m.domElement.checked=p),e.setValue(m.id,{value:p})}}};this._dispatchEventFromSandbox(c,a)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class rO extends Gb{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class oO extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");Hl.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",u=>{const m=this.data.defaultFieldValue;for(const p of i.options)p.selected=p.value===m});for(const u of this.data.options){const m=document.createElement("option");m.textContent=u.displayValue,m.value=u.exportValue,s.value.includes(u.exportValue)&&(m.setAttribute("selected",!0),r=!1),i.append(m)}let o=null;if(r){const u=document.createElement("option");u.value=" ",u.setAttribute("hidden",!0),u.setAttribute("selected",!0),i.prepend(u),o=()=>{u.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const a=u=>{const m=u?"value":"textContent",{options:p,multiple:y}=i;return y?Array.prototype.filter.call(p,v=>v.selected).map(v=>v[m]):p.selectedIndex===-1?null:p[p.selectedIndex][m]};let c=a(!1);const d=u=>{const m=u.target.options;return Array.prototype.map.call(m,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",u=>{const m={value(p){o==null||o();const y=p.detail.value,v=new Set(Array.isArray(y)?y:[y]);for(const x of i.options)x.selected=v.has(x.value);e.setValue(t,{value:a(!0)}),c=a(!1)},multipleSelection(p){i.multiple=!0},remove(p){const y=i.options,v=p.detail.remove;y[v].selected=!1,i.remove(v),y.length>0&&Array.prototype.findIndex.call(y,b=>b.selected)===-1&&(y[0].selected=!0),e.setValue(t,{value:a(!0),items:d(p)}),c=a(!1)},clear(p){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),c=a(!1)},insert(p){const{index:y,displayValue:v,exportValue:x}=p.detail.insert,b=i.children[y],w=document.createElement("option");w.textContent=v,w.value=x,b?b.before(w):i.append(w),e.setValue(t,{value:a(!0),items:d(p)}),c=a(!1)},items(p){const{items:y}=p.detail;for(;i.length!==0;)i.remove(0);for(const v of y){const{displayValue:x,exportValue:b}=v,w=document.createElement("option");w.textContent=x,w.value=b,i.append(w)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:a(!0),items:d(p)}),c=a(!1)},indices(p){const y=new Set(p.detail.indices);for(const v of p.target.options)v.selected=y.has(v.index);e.setValue(t,{value:a(!0)}),c=a(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(m,u)}),i.addEventListener("input",u=>{var y;const m=a(!0),p=a(!1);e.setValue(t,{value:m}),u.preventDefault(),(y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:p,changeEx:m,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],u=>u.target.value)):i.addEventListener("input",function(u){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var Bf,Tx;class kx extends rt{constructor(t){const{data:s,elements:i,parent:r}=t,o=!!r._commentManager;super(t,{isRenderable:!o&&rt._hasPopupData(s)});C(this,Bf);if(this.elements=i,o&&rt._hasPopupData(s)){const a=this.popup=E(this,Bf,Tx).call(this);for(const c of i)c.popup=a}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const s=this.popup=E(this,Bf,Tx).call(this),i=[];for(const r of this.elements)r.popup=s,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${lc}${r}`).join(",")),this.container}}Bf=new WeakSet,Tx=function(){return new aO({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var Os,Ro,Pg,Rg,Td,Nd,dt,xi,Mo,ll,Id,Pd,bi,Us,mr,gr,ut,yr,Do,Hf,xr,Rd,cl,Lo,Rt,Fo,we,_m,Nx,Ix,Px,Am,Rx,vE,wE,_E,AE,Sm,Cm,Mx;class aO{constructor({container:e,color:t,elements:s,titleObj:i,modificationDate:r,contentsObj:o,richText:a,parent:c,rect:d,parentRect:u,open:m,commentManager:p=null}){C(this,we);C(this,Os,null);C(this,Ro,E(this,we,_E).bind(this));C(this,Pg,E(this,we,Mx).bind(this));C(this,Rg,E(this,we,Cm).bind(this));C(this,Td,E(this,we,Sm).bind(this));C(this,Nd,null);C(this,dt,null);C(this,xi,null);C(this,Mo,null);C(this,ll,null);C(this,Id,null);C(this,Pd,null);C(this,bi,!1);C(this,Us,null);C(this,mr,null);C(this,gr,null);C(this,ut,null);C(this,yr,null);C(this,Do,null);C(this,Hf,null);C(this,xr,null);C(this,Rd,null);C(this,cl,null);C(this,Lo,!1);C(this,Rt,null);C(this,Fo,null);_(this,dt,e),_(this,Rd,i),_(this,xi,o),_(this,xr,a),_(this,Id,c),_(this,Nd,t),_(this,Hf,d),_(this,Pd,u),_(this,ll,s),_(this,Os,p),_(this,Rt,s[0]),_(this,Mo,ag.toDateObject(r)),this.trigger=s.flatMap(y=>y.getElementsToTriggerPopup()),p||(E(this,we,_m).call(this),l(this,dt).hidden=!0,m&&E(this,we,Sm).call(this))}renderCommentButton(){if(l(this,ut)){l(this,ut).parentNode||l(this,Rt).container.after(l(this,ut));return}if(l(this,yr)||E(this,we,Nx).call(this),!l(this,yr))return;const{signal:e}=_(this,mr,new AbortController),t=l(this,Rt).hasOwnCommentButton,s=()=>{l(this,Os).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{l(this,Os).toggleCommentPopup(this,!1,!0,!t)},r=()=>{l(this,Os).toggleCommentPopup(this,!1,!1)};if(t){_(this,ut,l(this,Rt).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",l(this,Ro),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=_(this,ut,document.createElement("button"));o.className="annotationCommentButton";const a=l(this,Rt).container;o.style.zIndex=a.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),E(this,we,Px).call(this),E(this,we,Ix).call(this),o.addEventListener("keydown",l(this,Ro),{signal:e}),o.addEventListener("click",s,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),a.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=l(this,Rt).commentData;return e?l(this,Id)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=l(this,ut))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}=l(this,Rt).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:i,modificationDate:r}}get elementBeforePopup(){return l(this,ut)}get comment(){return l(this,Fo)||_(this,Fo,l(this,Rt).commentText),l(this,Fo)}set comment(e){e!==this.comment&&(l(this,Rt).commentText=_(this,Fo,e))}focus(){var e;(e=l(this,Rt).container)==null||e.focus()}get parentBoundingClientRect(){return l(this,Rt).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){l(this,ut)&&(l(this,ut).classList.toggle("selected",e),l(this,ut).ariaExpanded=t)}setSelectedCommentButton(e){l(this,ut).classList.toggle("selected",e)}get commentPopupPosition(){if(l(this,Do))return l(this,Do);const{x:e,y:t,height:s}=l(this,ut).getBoundingClientRect(),{x:i,y:r,width:o,height:a}=l(this,Rt).layer.getBoundingClientRect();return[(e-i)/o,(t+s-r)/a]}set commentPopupPosition(e){_(this,Do,e)}hasDefaultPopupPosition(){return l(this,Do)===null}get commentButtonPosition(){return l(this,yr)}get commentButtonWidth(){return l(this,ut).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=l(this,Do)||this.commentButtonPosition.map(d=>d/100),i=this.parentBoundingClientRect,{x:r,y:o,width:a,height:c}=i;l(this,Os).showDialog(null,this,r+t*a,o+s*c,{...e,parentDimensions:i})}render(){var s,i;if(l(this,Us))return;const e=_(this,Us,document.createElement("div"));if(e.className="popup",l(this,Nd)){const r=e.style.outlineColor=Z.makeHexColor(...l(this,Nd));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(s=l(this,Rd))!=null&&s.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=l(this,Rd)}if(e.append(t),l(this,Mo)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:l(this,Mo).valueOf()})),r.dateTime=l(this,Mo).toISOString(),t.append(r)}dC({html:l(this,we,Am)||l(this,xi).str,dir:(i=l(this,xi))==null?void 0:i.dir,className:"popupContent"},e),l(this,dt).append(e)}updateEdited({rect:e,popup:t,deleted:s}){var i;if(l(this,Os)){s?(this.remove(),_(this,Fo,null)):t&&(t.deleted?this.remove():(E(this,we,Px).call(this),_(this,Fo,t.text))),e&&(_(this,yr,null),E(this,we,Nx).call(this),E(this,we,Ix).call(this));return}if(s||t!=null&&t.deleted){this.remove();return}E(this,we,_m).call(this),l(this,cl)||_(this,cl,{contentsObj:l(this,xi),richText:l(this,xr)}),e&&_(this,gr,null),t&&t.text&&(_(this,xr,E(this,we,wE).call(this,t.text)),_(this,Mo,ag.toDateObject(t.date)),_(this,xi,null)),(i=l(this,Us))==null||i.remove(),_(this,Us,null)}resetEdited(){var e;l(this,cl)&&({contentsObj:ot(this,xi)._,richText:ot(this,xr)._}=l(this,cl),_(this,cl,null),(e=l(this,Us))==null||e.remove(),_(this,Us,null),_(this,gr,null))}remove(){var e,t,s;if((e=l(this,mr))==null||e.abort(),_(this,mr,null),(t=l(this,Us))==null||t.remove(),_(this,Us,null),_(this,Lo,!1),_(this,bi,!1),(s=l(this,ut))==null||s.remove(),_(this,ut,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){_(this,Lo,this.isVisible),l(this,Lo)&&(l(this,dt).hidden=!0)}maybeShow(){l(this,Os)||(E(this,we,_m).call(this),l(this,Lo)&&(l(this,Us)||E(this,we,Cm).call(this),_(this,Lo,!1),l(this,dt).hidden=!1))}get isVisible(){return l(this,Os)?!1:l(this,dt).hidden===!1}}Os=new WeakMap,Ro=new WeakMap,Pg=new WeakMap,Rg=new WeakMap,Td=new WeakMap,Nd=new WeakMap,dt=new WeakMap,xi=new WeakMap,Mo=new WeakMap,ll=new WeakMap,Id=new WeakMap,Pd=new WeakMap,bi=new WeakMap,Us=new WeakMap,mr=new WeakMap,gr=new WeakMap,ut=new WeakMap,yr=new WeakMap,Do=new WeakMap,Hf=new WeakMap,xr=new WeakMap,Rd=new WeakMap,cl=new WeakMap,Lo=new WeakMap,Rt=new WeakMap,Fo=new WeakMap,we=new WeakSet,_m=function(){var t;if(l(this,mr))return;_(this,mr,new AbortController);const{signal:e}=l(this,mr);for(const s of this.trigger)s.addEventListener("click",l(this,Td),{signal:e}),s.addEventListener("pointerenter",l(this,Rg),{signal:e}),s.addEventListener("pointerleave",l(this,Pg),{signal:e}),s.classList.add("popupTriggerArea");for(const s of l(this,ll))(t=s.container)==null||t.addEventListener("keydown",l(this,Ro),{signal:e})},Nx=function(){const e=l(this,ll).find(t=>t.hasCommentButton);e&&_(this,yr,e._normalizePoint(e.commentButtonPosition))},Ix=function(){if(l(this,Rt).extraPopupElement&&!l(this,Rt).editor)return;l(this,ut)||this.renderCommentButton();const[e,t]=l(this,yr),{style:s}=l(this,ut);s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`},Px=function(){l(this,Rt).extraPopupElement||(l(this,ut)||this.renderCommentButton(),l(this,ut).style.backgroundColor=this.commentButtonColor||"")},Am=function(){const e=l(this,xr),t=l(this,xi);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&l(this,xr).html||null},Rx=function(){var e,t,s;return((s=(t=(e=l(this,we,Am))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.fontSize)||0},vE=function(){var e,t,s;return((s=(t=(e=l(this,we,Am))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:s.color)||null},wE=function(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:l(this,we,vE),fontSize:l(this,we,Rx)?`calc(${l(this,we,Rx)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return s},_E=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&l(this,bi))&&E(this,we,Sm).call(this)},AE=function(){if(l(this,gr)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:i,pageY:r}}}=l(this,Id);let o=!!l(this,Pd),a=o?l(this,Pd):l(this,Hf);for(const v of l(this,ll))if(!a||Z.intersect(v.data.rect,a)!==null){a=v.data.rect,o=!0;break}const c=Z.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),u=o?a[2]-a[0]+5:0,m=c[0]+u,p=c[1];_(this,gr,[100*(m-i)/t,100*(p-r)/s]);const{style:y}=l(this,dt);y.left=`${l(this,gr)[0]}%`,y.top=`${l(this,gr)[1]}%`},Sm=function(){if(l(this,Os)){l(this,Os).toggleCommentPopup(this,!1);return}_(this,bi,!l(this,bi)),l(this,bi)?(E(this,we,Cm).call(this),l(this,dt).addEventListener("click",l(this,Td)),l(this,dt).addEventListener("keydown",l(this,Ro))):(E(this,we,Mx).call(this),l(this,dt).removeEventListener("click",l(this,Td)),l(this,dt).removeEventListener("keydown",l(this,Ro)))},Cm=function(){l(this,Us)||this.render(),this.isVisible?l(this,bi)&&l(this,dt).classList.add("focused"):(E(this,we,AE).call(this),l(this,dt).hidden=!1,l(this,dt).style.zIndex=parseInt(l(this,dt).style.zIndex)+1e3)},Mx=function(){l(this,dt).classList.remove("focused"),!(l(this,bi)||!this.isVisible)&&(l(this,dt).hidden=!0,l(this,dt).style.zIndex=parseInt(l(this,dt).style.zIndex)-1e3)};class SE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=ge.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Gf;class lO extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});C(this,Gf,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=_(this,Gf,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,Gf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gf=new WeakMap;var qf;class cO extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});C(this,qf,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,a=_(this,qf,this.svgFactory.createElement("svg:rect"));return a.setAttribute("x",o/2),a.setAttribute("y",o/2),a.setAttribute("width",s-o),a.setAttribute("height",i-o),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,qf)}addHighlightArea(){this.container.classList.add("highlightArea")}}qf=new WeakMap;var Vf;class dO extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});C(this,Vf,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:s,height:i}=this,r=this.svgFactory.create(s,i,!0),o=t.borderStyle.width,a=_(this,Vf,this.svgFactory.createElement("svg:ellipse"));return a.setAttribute("cx",s/2),a.setAttribute("cy",i/2),a.setAttribute("rx",s/2-o/2),a.setAttribute("ry",i/2-o/2),a.setAttribute("stroke-width",o||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,Vf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vf=new WeakMap;var $f;class CE extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});C(this,$f,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:s,borderStyle:i,popupRef:r},width:o,height:a}=this;if(!s)return this.container;const c=this.svgFactory.create(o,a,!0);let d=[];for(let m=0,p=s.length;m<p;m+=2){const y=s[m]-t[0],v=t[3]-s[m+1];d.push(`${y},${v}`)}d=d.join(" ");const u=_(this,$f,this.svgFactory.createElement(this.svgElementName));return u.setAttribute("points",d),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),c.append(u),this.container.append(c),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return l(this,$f)}addHighlightArea(){this.container.classList.add("highlightArea")}}$f=new WeakMap;class uO extends CE{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class hO extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var zf,dl,Wf,Dx;class qb extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});C(this,Wf);C(this,zf,null);C(this,dl,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ge.HIGHLIGHT:ge.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:s,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:a,width:c,height:d}=E(this,Wf,Dx).call(this,s,t),u=this.svgFactory.create(c,d,!0),m=_(this,zf,this.svgFactory.createElement("svg:g"));u.append(m),m.setAttribute("stroke-width",r.width||1),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-miterlimit",10),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),m.setAttribute("transform",a);for(let p=0,y=i.length;p<y;p++){const v=this.svgFactory.createElement(this.svgElementName);l(this,dl).push(v),v.setAttribute("points",i[p].join(",")),m.append(v)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:s,points:i,rect:r}=t,o=l(this,zf);if(s>=0&&o.setAttribute("stroke-width",s||1),i)for(let a=0,c=l(this,dl).length;a<c;a++)l(this,dl)[a].setAttribute("points",i[a].join(","));if(r){const{transform:a,width:c,height:d}=E(this,Wf,Dx).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${d}`),o.setAttribute("transform",a)}}getElementsToTriggerPopup(){return l(this,dl)}addHighlightArea(){this.container.classList.add("highlightArea")}}zf=new WeakMap,dl=new WeakMap,Wf=new WeakSet,Dx=function(t,s){switch(t){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class EE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ge.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class fO extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class pO extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class mO extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class kE extends rt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ge.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Kf,Yf,Lx;class gO extends rt{constructor(t){var i;super(t,{isRenderable:!0});C(this,Yf);C(this,Kf,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",E(this,Yf,Lx).bind(this)),_(this,Kf,i);const{isMac:r}=Tt.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&E(this,Yf,Lx).call(this)}),!s.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return l(this,Kf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Kf=new WeakMap,Yf=new WeakSet,Lx=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var ul,hl,Md,jo,Jf,fl,Bs,Xf,Dr,Em,jx;const Xb=class Xb{constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:a,commentManager:c,linkService:d,annotationStorage:u}){C(this,Dr);C(this,ul,null);C(this,hl,null);C(this,Md,null);C(this,jo,new Map);C(this,Jf,null);C(this,fl,null);C(this,Bs,[]);C(this,Xf,!1);this.div=e,_(this,ul,t),_(this,hl,s),_(this,Jf,a||null),_(this,fl,d||null),_(this,Md,u||new Ub),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=c||null}hasEditableAnnotations(){return l(this,jo).size>0}async render(e){var a;const{annotations:t}=e,s=this.div;Ul(s,this.viewport);const i=new Map,r=[],o={data:null,layer:s,linkService:l(this,fl),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new mg,annotationStorage:l(this,Md),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const d=c.annotationType===xt.POPUP;if(d){const p=i.get(c.id);if(!p)continue;if(!this._commentManager){r.push(c);continue}o.elements=p}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const u=R0.create(o);if(!u.isRenderable)continue;if(!d&&(l(this,Bs).push(u),c.popupRef)){const p=i.get(c.popupRef);p?p.push(u):i.set(c.popupRef,[u])}const m=u.render();c.hidden&&(m.style.visibility="hidden"),u._isEditable&&(l(this,jo).set(u.data.id,u),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(u))}await E(this,Dr,Em).call(this);for(const c of r){const d=o.elements=i.get(c.id);o.data=c;const u=R0.create(o);if(!u.isRenderable)continue;const m=u.render();u.contentElement.id=`${lc}${c.id}`,c.hidden&&(m.style.visibility="hidden"),d.at(-1).container.after(m)}E(this,Dr,jx).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:l(this,fl),svgFactory:new mg,parent:this};for(const s of e){s.borderStyle||(s.borderStyle=Xb._defaultBorderStyle),t.data=s;const i=R0.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${lc}${s.id}`,l(this,Bs).push(i))}await E(this,Dr,Em).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Ul(t,{rotation:e.rotation}),E(this,Dr,jx).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(l(this,jo).values())}getEditableAnnotation(e){return l(this,jo).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:s,rotation:i}=e,r=new eO({data:{id:s,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:l(this,fl),annotationStorage:l(this,Md)});return r.render(),r.contentElement.id=`${lc}${s}`,r.createOrUpdatePopup(),l(this,Bs).push(r),r}removeAnnotation(e){var i;const t=l(this,Bs).findIndex(r=>r.data.id===e);if(t<0)return;const[s]=l(this,Bs).splice(t,1);(i=l(this,ul))==null||i.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);E(this,Dr,Em).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return pe(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ql.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};ul=new WeakMap,hl=new WeakMap,Md=new WeakMap,jo=new WeakMap,Jf=new WeakMap,fl=new WeakMap,Bs=new WeakMap,Xf=new WeakMap,Dr=new WeakSet,Em=async function(){var s,i,r;if(l(this,Bs).length===0)return;this.div.replaceChildren();const e=[];if(!l(this,Xf)){_(this,Xf,!0);for(const{contentElement:o,data:{id:a}}of l(this,Bs)){const c=o.id=`${lc}${a}`;e.push((s=l(this,Jf))==null?void 0:s.getAriaAttributes(c).then(d=>{if(d)for(const[u,m]of d)o.setAttribute(u,m)}))}}l(this,Bs).sort(({data:{rect:[o,a,c,d]}},{data:{rect:[u,m,p,y]}})=>{if(o===c&&a===d)return 1;if(u===p&&m===y)return-1;const v=d,x=a,b=(a+d)/2,w=y,S=m,A=(m+y)/2;if(b>=w&&A<=x)return-1;if(A>=v&&b<=S)return 1;const k=(o+c)/2,T=(u+p)/2;return k-T});const t=document.createDocumentFragment();for(const o of l(this,Bs))t.append(o.container),this._commentManager?(r=((i=o.extraPopupElement)==null?void 0:i.popup)||o.popup)==null||r.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),l(this,ul))for(const o of l(this,Bs))l(this,ul).addPointerInTextLayer(o.contentElement,!1)},jx=function(){var t;if(!l(this,hl))return;const e=this.div;for(const[s,i]of l(this,hl)){const r=e.querySelector(`[data-annotation-id="${s}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(i):o.classList.contains("annotationContent")?o.after(i):o.before(i):r.append(i);const a=l(this,jo).get(s);a&&(a._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(s,r.id,i),a._hasNoCanvas=!1):a.canvas=i)}l(this,hl).clear()};let Fx=Xb;const Jp=/\r\n?|\n/g;var Hs,Qf,pl,Gs,wt,TE,NE,IE,km,Lr,Tm,Nm,PE,Ux,RE;const Je=class Je extends Ye{constructor(t){super({...t,name:"freeTextEditor"});C(this,wt);C(this,Hs,"");C(this,Qf,`${this.id}-editor`);C(this,pl,null);C(this,Gs);W(this,"_colorPicker",null);this.color=t.color||Je._defaultColor||Ye._defaultLineColor,_(this,Gs,t.fontSize||Je._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=Je.prototype,s=o=>o.isEmpty(),i=Bl.TRANSLATE_SMALL,r=Bl.TRANSLATE_BIG;return pe(this,"_keyboardManager",new Ap([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:s}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:s}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:s}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:s}]]))}static initialize(t,s){Ye.initialize(t,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,s){switch(t){case Ee.FREETEXT_SIZE:Je._defaultFontSize=s;break;case Ee.FREETEXT_COLOR:Je._defaultColor=s;break}}updateParams(t,s){switch(t){case Ee.FREETEXT_SIZE:E(this,wt,TE).call(this,s);break;case Ee.FREETEXT_COLOR:E(this,wt,NE).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Ee.FREETEXT_SIZE,Je._defaultFontSize],[Ee.FREETEXT_COLOR,Je._defaultColor||Ye._defaultLineColor]]}get propertiesToUpdate(){return[[Ee.FREETEXT_SIZE,l(this,Gs)],[Ee.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new pg(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Ee.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,s){this._uiManager.translateSelectedEditors(t,s,!0)}getInitialTranslation(){const t=this.parentScale;return[-Je._internalPadding*t,-(Je._internalPadding+l(this,Gs))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),_(this,pl,new AbortController);const t=this._uiManager.combinedSignal(l(this,pl));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",l(this,Qf)),this._isDraggable=!0,(t=l(this,pl))==null||t.abort(),_(this,pl,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var s;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=l(this,Hs),s=_(this,Hs,E(this,wt,IE).call(this).trimEnd());if(t===s)return;const i=r=>{if(_(this,Hs,r),!r){this.remove();return}E(this,wt,Nm).call(this),this._uiManager.rebuild(this),E(this,wt,km).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(t)},mustExec:!1}),E(this,wt,km).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Je._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,s;(this._isCopy||this.annotationElementId)&&(t=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",l(this,Qf)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${l(this,Gs)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[c,d]=this.getInitialTranslation();[c,d]=this.pageTranslationToScreen(c,d);const[u,m]=this.pageDimensions,[p,y]=this.pageTranslation;let v,x;switch(this.rotation){case 0:v=t+(a[0]-p)/u,x=s+this.height-(a[1]-y)/m;break;case 90:v=t+(a[0]-p)/u,x=s-(a[1]-y)/m,[c,d]=[d,-c];break;case 180:v=t-this.width+(a[0]-p)/u,x=s-(a[1]-y)/m,[c,d]=[-c,-d];break;case 270:v=t+(a[0]-p-this.height*m)/u,x=s+(a[1]-y-this.width*u)/m,[c,d]=[-d,c];break}this.setAt(v*r,x*o,c,d)}else this._moveAfterPaste(t,s);E(this,wt,Nm).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var v,x,b;const s=t.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=E(v=Je,Lr,Ux).call(v,s.getData("text")||"").replaceAll(Jp,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const a=o.getRangeAt(0);if(!r.includes(`
`)){a.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:d}=a,u=[],m=[];if(c.nodeType===Node.TEXT_NODE){const w=c.parentElement;if(m.push(c.nodeValue.slice(d).replaceAll(Jp,"")),w!==this.editorDiv){let S=u;for(const A of this.editorDiv.childNodes){if(A===w){S=m;continue}S.push(E(x=Je,Lr,Tm).call(x,A))}}u.push(c.nodeValue.slice(0,d).replaceAll(Jp,""))}else if(c===this.editorDiv){let w=u,S=0;for(const A of this.editorDiv.childNodes)S++===d&&(w=m),w.push(E(b=Je,Lr,Tm).call(b,A))}_(this,Hs,`${u.join(`
`)}${r}${m.join(`
`)}`),E(this,wt,Nm).call(this);const p=new Range;let y=Math.sumPrecise(u.map(w=>w.length));for(const{firstChild:w}of this.editorDiv.childNodes)if(w.nodeType===Node.TEXT_NODE){const S=w.nodeValue.length;if(y<=S){p.setStart(w,y),p.setEnd(w,y);break}y-=S}o.removeAllRanges(),o.addRange(p)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=Je._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,s,i){var a;let r=null;if(t instanceof SE){const{data:{defaultAppearanceData:{fontSize:c,fontColor:d},rect:u,rotation:m,id:p,popupRef:y,richText:v,contentsObj:x,creationDate:b,modificationDate:w},textContent:S,textPosition:A,parent:{page:{pageNumber:k}}}=t;if(!S||S.length===0)return null;r=t={annotationType:ge.FREETEXT,color:Array.from(d),fontSize:c,value:S.join(`
`),position:A,pageIndex:k-1,rect:u.slice(0),rotation:m,annotationElementId:p,id:p,deleted:!1,popupRef:y,comment:(x==null?void 0:x.str)||null,richText:v,creationDate:b,modificationDate:w}}const o=await super.deserialize(t,s,i);return _(o,Gs,t.fontSize),o.color=Z.makeHexColor(...t.color),_(o,Hs,E(a=Je,Lr,Ux).call(a,t.value)),o._initialData=r,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Ye._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:s,fontSize:l(this,Gs),value:E(this,wt,PE).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!E(this,wt,RE).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const s=super.renderAnnotationElement(t);if(!s)return null;const{style:i}=s;i.fontSize=`calc(${l(this,Gs)}px * var(--total-scale-factor))`,i.color=this.color,s.replaceChildren();for(const r of l(this,Hs).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),s.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:l(this,Hs)}}),s}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Hs=new WeakMap,Qf=new WeakMap,pl=new WeakMap,Gs=new WeakMap,wt=new WeakSet,TE=function(t){const s=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-l(this,Gs))*this.parentScale),_(this,Gs,r),E(this,wt,km).call(this)},i=l(this,Gs);this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ee.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},NE=function(t){const s=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ee.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},IE=function(){var i;const t=[];this.editorDiv.normalize();let s=null;for(const r of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(E(i=Je,Lr,Tm).call(i,r)),s=r);return t.join(`
`)},km=function(){const[t,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,a=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=a,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/s):(this.width=i.height/t,this.height=i.width/s),this.fixAndSetPosition()},Lr=new WeakSet,Tm=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Jp,"")},Nm=function(){if(this.editorDiv.replaceChildren(),!!l(this,Hs))for(const t of l(this,Hs).split(`
`)){const s=document.createElement("div");s.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(s)}},PE=function(){return l(this,Hs).replaceAll("Â "," ")},Ux=function(t){return t.replaceAll(" ","Â ")},RE=function(t){const{value:s,fontSize:i,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==s||t.fontSize!==i||t.color.some((a,c)=>a!==r[c])||t.pageIndex!==o},C(Je,Lr),W(Je,"_freeTextDefaultContent",""),W(Je,"_internalPadding",0),W(Je,"_defaultColor",null),W(Je,"_defaultFontSize",10),W(Je,"_type","freetext"),W(Je,"_editorType",ge.FREETEXT);let Ox=Je;class se{toSVGPath(){ze("Abstract method `toSVGPath` must be implemented.")}get box(){ze("Abstract getter `box` must be implemented.")}serialize(e,t){ze("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let a=0,c=e.length;a<c;a+=2)o[a]=t+e[a]*i,o[a+1]=s+e[a+1]*r;return o}static _rescaleAndSwap(e,t,s,i,r,o){o||(o=new Float32Array(e.length));for(let a=0,c=e.length;a<c;a+=2)o[a]=t+e[a+1]*i,o[a+1]=s+e[a]*r;return o}static _translate(e,t,s,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=s+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,i,r){switch(r){case 90:return[1-t/s,e/i];case 180:return[1-e/s,1-t/i];case 270:return[t/s,1-e/i];default:return[e/s,t/i]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,i,r,o){return[(e+5*s)/6,(t+5*i)/6,(5*s+r)/6,(5*i+o)/6,(s+r)/2,(i+o)/2]}}W(se,"PRECISION",1e-4);var qs,Bn,Dd,Ld,vi,Ae,ml,gl,Zf,ep,Fd,jd,Oo,tp,Mg,Dg,Et,$u,ME,DE,LE,FE,jE,OE;const qi=class qi{constructor({x:e,y:t},s,i,r,o,a=0){C(this,Et);C(this,qs);C(this,Bn,[]);C(this,Dd);C(this,Ld);C(this,vi,[]);C(this,Ae,new Float32Array(18));C(this,ml);C(this,gl);C(this,Zf);C(this,ep);C(this,Fd);C(this,jd);C(this,Oo,[]);_(this,qs,s),_(this,jd,r*i),_(this,Ld,o),l(this,Ae).set([NaN,NaN,NaN,NaN,e,t],6),_(this,Dd,a),_(this,ep,l(qi,tp)*i),_(this,Zf,l(qi,Dg)*i),_(this,Fd,i),l(this,Oo).push(e,t)}isEmpty(){return isNaN(l(this,Ae)[8])}add({x:e,y:t}){var P;_(this,ml,e),_(this,gl,t);const[s,i,r,o]=l(this,qs);let[a,c,d,u]=l(this,Ae).subarray(8,12);const m=e-d,p=t-u,y=Math.hypot(m,p);if(y<l(this,Zf))return!1;const v=y-l(this,ep),x=v/y,b=x*m,w=x*p;let S=a,A=c;a=d,c=u,d+=b,u+=w,(P=l(this,Oo))==null||P.push(e,t);const k=-w/v,T=b/v,N=k*l(this,jd),I=T*l(this,jd);return l(this,Ae).set(l(this,Ae).subarray(2,8),0),l(this,Ae).set([d+N,u+I],4),l(this,Ae).set(l(this,Ae).subarray(14,18),12),l(this,Ae).set([d-N,u-I],16),isNaN(l(this,Ae)[6])?(l(this,vi).length===0&&(l(this,Ae).set([a+N,c+I],2),l(this,vi).push(NaN,NaN,NaN,NaN,(a+N-s)/r,(c+I-i)/o),l(this,Ae).set([a-N,c-I],14),l(this,Bn).push(NaN,NaN,NaN,NaN,(a-N-s)/r,(c-I-i)/o)),l(this,Ae).set([S,A,a,c,d,u],6),!this.isEmpty()):(l(this,Ae).set([S,A,a,c,d,u],6),Math.abs(Math.atan2(A-c,S-a)-Math.atan2(w,b))<Math.PI/2?([a,c,d,u]=l(this,Ae).subarray(2,6),l(this,vi).push(NaN,NaN,NaN,NaN,((a+d)/2-s)/r,((c+u)/2-i)/o),[a,c,S,A]=l(this,Ae).subarray(14,18),l(this,Bn).push(NaN,NaN,NaN,NaN,((S+a)/2-s)/r,((A+c)/2-i)/o),!0):([S,A,a,c,d,u]=l(this,Ae).subarray(0,6),l(this,vi).push(((S+5*a)/6-s)/r,((A+5*c)/6-i)/o,((5*a+d)/6-s)/r,((5*c+u)/6-i)/o,((a+d)/2-s)/r,((c+u)/2-i)/o),[d,u,a,c,S,A]=l(this,Ae).subarray(12,18),l(this,Bn).push(((S+5*a)/6-s)/r,((A+5*c)/6-i)/o,((5*a+d)/6-s)/r,((5*c+u)/6-i)/o,((a+d)/2-s)/r,((c+u)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=l(this,vi),t=l(this,Bn);if(isNaN(l(this,Ae)[6])&&!this.isEmpty())return E(this,Et,ME).call(this);const s=[];s.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);E(this,Et,LE).call(this,s);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return E(this,Et,DE).call(this,s),s.join(" ")}newFreeDrawOutline(e,t,s,i,r,o){return new UE(e,t,s,i,r,o)}getOutlines(){var m;const e=l(this,vi),t=l(this,Bn),s=l(this,Ae),[i,r,o,a]=l(this,qs),c=new Float32Array((((m=l(this,Oo))==null?void 0:m.length)??0)+2);for(let p=0,y=c.length-2;p<y;p+=2)c[p]=(l(this,Oo)[p]-i)/o,c[p+1]=(l(this,Oo)[p+1]-r)/a;if(c[c.length-2]=(l(this,ml)-i)/o,c[c.length-1]=(l(this,gl)-r)/a,isNaN(s[6])&&!this.isEmpty())return E(this,Et,FE).call(this,c);const d=new Float32Array(l(this,vi).length+24+l(this,Bn).length);let u=e.length;for(let p=0;p<u;p+=2){if(isNaN(e[p])){d[p]=d[p+1]=NaN;continue}d[p]=e[p],d[p+1]=e[p+1]}u=E(this,Et,OE).call(this,d,u);for(let p=t.length-6;p>=6;p-=6)for(let y=0;y<6;y+=2){if(isNaN(t[p+y])){d[u]=d[u+1]=NaN,u+=2;continue}d[u]=t[p+y],d[u+1]=t[p+y+1],u+=2}return E(this,Et,jE).call(this,d,u),this.newFreeDrawOutline(d,c,l(this,qs),l(this,Fd),l(this,Dd),l(this,Ld))}};qs=new WeakMap,Bn=new WeakMap,Dd=new WeakMap,Ld=new WeakMap,vi=new WeakMap,Ae=new WeakMap,ml=new WeakMap,gl=new WeakMap,Zf=new WeakMap,ep=new WeakMap,Fd=new WeakMap,jd=new WeakMap,Oo=new WeakMap,tp=new WeakMap,Mg=new WeakMap,Dg=new WeakMap,Et=new WeakSet,$u=function(){const e=l(this,Ae).subarray(4,6),t=l(this,Ae).subarray(16,18),[s,i,r,o]=l(this,qs);return[(l(this,ml)+(e[0]-t[0])/2-s)/r,(l(this,gl)+(e[1]-t[1])/2-i)/o,(l(this,ml)+(t[0]-e[0])/2-s)/r,(l(this,gl)+(t[1]-e[1])/2-i)/o]},ME=function(){const[e,t,s,i]=l(this,qs),[r,o,a,c]=E(this,Et,$u).call(this);return`M${(l(this,Ae)[2]-e)/s} ${(l(this,Ae)[3]-t)/i} L${(l(this,Ae)[4]-e)/s} ${(l(this,Ae)[5]-t)/i} L${r} ${o} L${a} ${c} L${(l(this,Ae)[16]-e)/s} ${(l(this,Ae)[17]-t)/i} L${(l(this,Ae)[14]-e)/s} ${(l(this,Ae)[15]-t)/i} Z`},DE=function(e){const t=l(this,Bn);e.push(`L${t[4]} ${t[5]} Z`)},LE=function(e){const[t,s,i,r]=l(this,qs),o=l(this,Ae).subarray(4,6),a=l(this,Ae).subarray(16,18),[c,d,u,m]=E(this,Et,$u).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-s)/r} L${c} ${d} L${u} ${m} L${(a[0]-t)/i} ${(a[1]-s)/r}`)},FE=function(e){const t=l(this,Ae),[s,i,r,o]=l(this,qs),[a,c,d,u]=E(this,Et,$u).call(this),m=new Float32Array(36);return m.set([NaN,NaN,NaN,NaN,(t[2]-s)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-s)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,a,c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,(t[16]-s)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-s)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(m,e,l(this,qs),l(this,Fd),l(this,Dd),l(this,Ld))},jE=function(e,t){const s=l(this,Bn);return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6},OE=function(e,t){const s=l(this,Ae).subarray(4,6),i=l(this,Ae).subarray(16,18),[r,o,a,c]=l(this,qs),[d,u,m,p]=E(this,Et,$u).call(this);return e.set([NaN,NaN,NaN,NaN,(s[0]-r)/a,(s[1]-o)/c,NaN,NaN,NaN,NaN,d,u,NaN,NaN,NaN,NaN,m,p,NaN,NaN,NaN,NaN,(i[0]-r)/a,(i[1]-o)/c],t),t+=24},C(qi,tp,8),C(qi,Mg,2),C(qi,Dg,l(qi,tp)+l(qi,Mg));let gg=qi;var Od,yl,br,sp,Vs,np,gt,Lg,BE;class UE extends se{constructor(t,s,i,r,o,a){super();C(this,Lg);C(this,Od);C(this,yl,new Float32Array(4));C(this,br);C(this,sp);C(this,Vs);C(this,np);C(this,gt);_(this,gt,t),_(this,Vs,s),_(this,Od,i),_(this,np,r),_(this,br,o),_(this,sp,a),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],E(this,Lg,BE).call(this,a);const[c,d,u,m]=l(this,yl);for(let p=0,y=t.length;p<y;p+=2)t[p]=(t[p]-c)/u,t[p+1]=(t[p+1]-d)/m;for(let p=0,y=s.length;p<y;p+=2)s[p]=(s[p]-c)/u,s[p+1]=(s[p+1]-d)/m}toSVGPath(){const t=[`M${l(this,gt)[4]} ${l(this,gt)[5]}`];for(let s=6,i=l(this,gt).length;s<i;s+=6){if(isNaN(l(this,gt)[s])){t.push(`L${l(this,gt)[s+4]} ${l(this,gt)[s+5]}`);continue}t.push(`C${l(this,gt)[s]} ${l(this,gt)[s+1]} ${l(this,gt)[s+2]} ${l(this,gt)[s+3]} ${l(this,gt)[s+4]} ${l(this,gt)[s+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,s,i,r],o){const a=i-t,c=r-s;let d,u;switch(o){case 0:d=se._rescale(l(this,gt),t,r,a,-c),u=se._rescale(l(this,Vs),t,r,a,-c);break;case 90:d=se._rescaleAndSwap(l(this,gt),t,s,a,c),u=se._rescaleAndSwap(l(this,Vs),t,s,a,c);break;case 180:d=se._rescale(l(this,gt),i,s,-a,c),u=se._rescale(l(this,Vs),i,s,-a,c);break;case 270:d=se._rescaleAndSwap(l(this,gt),i,r,-a,-c),u=se._rescaleAndSwap(l(this,Vs),i,r,-a,-c);break}return{outline:Array.from(d),points:[Array.from(u)]}}get box(){return l(this,yl)}newOutliner(t,s,i,r,o,a=0){return new gg(t,s,i,r,o,a)}getNewOutline(t,s){const[i,r,o,a]=l(this,yl),[c,d,u,m]=l(this,Od),p=o*u,y=a*m,v=i*u+c,x=r*m+d,b=this.newOutliner({x:l(this,Vs)[0]*p+v,y:l(this,Vs)[1]*y+x},l(this,Od),l(this,np),t,l(this,sp),s??l(this,br));for(let w=2;w<l(this,Vs).length;w+=2)b.add({x:l(this,Vs)[w]*p+v,y:l(this,Vs)[w+1]*y+x});return b.getOutlines()}}Od=new WeakMap,yl=new WeakMap,br=new WeakMap,sp=new WeakMap,Vs=new WeakMap,np=new WeakMap,gt=new WeakMap,Lg=new WeakSet,BE=function(t){const s=l(this,gt);let i=s[4],r=s[5];const o=[i,r,i,r];let a=i,c=r,d=i,u=r;const m=t?Math.max:Math.min,p=new Float32Array(4);for(let v=6,x=s.length;v<x;v+=6){const b=s[v+4],w=s[v+5];isNaN(s[v])?(Z.pointBoundingBox(b,w,o),c>w?(a=b,c=w):c===w&&(a=m(a,b)),u<w?(d=b,u=w):u===w&&(d=m(d,b))):(p[0]=p[1]=1/0,p[2]=p[3]=-1/0,Z.bezierBoundingBox(i,r,...s.slice(v,v+6),p),Z.rectBoundingBox(p[0],p[1],p[2],p[3],o),c>p[1]?(a=p[0],c=p[1]):c===p[1]&&(a=m(a,p[0])),u<p[3]?(d=p[2],u=p[3]):u===p[3]&&(d=m(d,p[2]))),i=b,r=w}const y=l(this,yl);y[0]=o[0]-l(this,br),y[1]=o[1]-l(this,br),y[2]=o[2]-o[0]+2*l(this,br),y[3]=o[3]-o[1]+2*l(this,br),this.firstPoint=[a,c],this.lastPoint=[d,u]};var ip,rp,op,Uo,Hn,ys,HE,Im,GE,qE,Hx;class Bx{constructor(e,t=0,s=0,i=!0){C(this,ys);C(this,ip);C(this,rp);C(this,op);C(this,Uo,[]);C(this,Hn,[]);const r=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x,y:b,width:w,height:S}of e){const A=Math.floor((x-t)/o)*o,k=Math.ceil((x+w+t)/o)*o,T=Math.floor((b-t)/o)*o,N=Math.ceil((b+S+t)/o)*o,I=[A,T,N,!0],D=[k,T,N,!1];l(this,Uo).push(I,D),Z.rectBoundingBox(A,T,k,N,r)}const a=r[2]-r[0]+2*s,c=r[3]-r[1]+2*s,d=r[0]-s,u=r[1]-s;let m=i?-1/0:1/0,p=1/0;const y=l(this,Uo).at(i?-1:-2),v=[y[0],y[2]];for(const x of l(this,Uo)){const[b,w,S,A]=x;!A&&i?w<p?(p=w,m=b):w===p&&(m=Math.max(m,b)):A&&!i&&(w<p?(p=w,m=b):w===p&&(m=Math.min(m,b))),x[0]=(b-d)/a,x[1]=(w-u)/c,x[2]=(S-u)/c}_(this,ip,new Float32Array([d,u,a,c])),_(this,rp,[m,p]),_(this,op,v)}getOutlines(){l(this,Uo).sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of l(this,Uo))t[3]?(e.push(...E(this,ys,Hx).call(this,t)),E(this,ys,GE).call(this,t)):(E(this,ys,qE).call(this,t),e.push(...E(this,ys,Hx).call(this,t)));return E(this,ys,HE).call(this,e)}}ip=new WeakMap,rp=new WeakMap,op=new WeakMap,Uo=new WeakMap,Hn=new WeakMap,ys=new WeakSet,HE=function(e){const t=[],s=new Set;for(const o of e){const[a,c,d]=o;t.push([a,c,o],[a,d,o])}t.sort((o,a)=>o[1]-a[1]||o[0]-a[0]);for(let o=0,a=t.length;o<a;o+=2){const c=t[o][2],d=t[o+1][2];c.push(d),d.push(c),s.add(c),s.add(d)}const i=[];let r;for(;s.size>0;){const o=s.values().next().value;let[a,c,d,u,m]=o;s.delete(o);let p=a,y=c;for(r=[a,d],i.push(r);;){let v;if(s.has(u))v=u;else if(s.has(m))v=m;else break;s.delete(v),[a,c,d,u,m]=v,p!==a&&(r.push(p,y,a,y===c?c:d),p=a),y=y===c?d:c}r.push(p,y)}return new yO(i,l(this,ip),l(this,rp),l(this,op))},Im=function(e){const t=l(this,Hn);let s=0,i=t.length-1;for(;s<=i;){const r=s+i>>1,o=t[r][0];if(o===e)return r;o<e?s=r+1:i=r-1}return i+1},GE=function([,e,t]){const s=E(this,ys,Im).call(this,e);l(this,Hn).splice(s,0,[e,t])},qE=function([,e,t]){const s=E(this,ys,Im).call(this,e);for(let i=s;i<l(this,Hn).length;i++){const[r,o]=l(this,Hn)[i];if(r!==e)break;if(r===e&&o===t){l(this,Hn).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[r,o]=l(this,Hn)[i];if(r!==e)break;if(r===e&&o===t){l(this,Hn).splice(i,1);return}}},Hx=function(e){const[t,s,i]=e,r=[[t,s,i]],o=E(this,ys,Im).call(this,i);for(let a=0;a<o;a++){const[c,d]=l(this,Hn)[a];for(let u=0,m=r.length;u<m;u++){const[,p,y]=r[u];if(!(d<=p||y<=c)){if(p>=c){if(y>d)r[u][1]=d;else{if(m===1)return[];r.splice(u,1),u--,m--}continue}r[u][2]=c,y>d&&r.push([t,d,y])}}}return r};var ap,Ud;class yO extends se{constructor(t,s,i,r){super();C(this,ap);C(this,Ud);_(this,Ud,t),_(this,ap,s),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const s of l(this,Ud)){let[i,r]=s;t.push(`M${i} ${r}`);for(let o=2;o<s.length;o+=2){const a=s[o],c=s[o+1];a===i?(t.push(`V${c}`),r=c):c===r&&(t.push(`H${a}`),i=a)}t.push("Z")}return t.join(" ")}serialize([t,s,i,r],o){const a=[],c=i-t,d=r-s;for(const u of l(this,Ud)){const m=new Array(u.length);for(let p=0;p<u.length;p+=2)m[p]=t+u[p]*c,m[p+1]=r-u[p+1]*d;a.push(m)}return a}get box(){return l(this,ap)}get classNamesForOutlining(){return["highlightOutline"]}}ap=new WeakMap,Ud=new WeakMap;class Gx extends gg{newFreeDrawOutline(e,t,s,i,r,o){return new xO(e,t,s,i,r,o)}}class xO extends UE{newOutliner(e,t,s,i,r,o=0){return new Gx(e,t,s,i,r,o)}}var Bd,lp,vr,xl,cp,Es,dp,up,bl,$s,zs,qt,Hd,Gd,ts,qd,gn,hp,ve,qx,Pm,VE,$E,zE,Vx,aa,vn,ic,WE,Rm,Mm,KE,YE,JE,XE,QE;const Re=class Re extends Ye{constructor(t){super({...t,name:"highlightEditor"});C(this,ve);C(this,Bd,null);C(this,lp,0);C(this,vr);C(this,xl,null);C(this,cp,null);C(this,Es,null);C(this,dp,null);C(this,up,0);C(this,bl,null);C(this,$s,null);C(this,zs,null);C(this,qt,!1);C(this,Hd,null);C(this,Gd,null);C(this,ts,null);C(this,qd,"");C(this,gn);C(this,hp,"");this.color=t.color||Re._defaultColor,_(this,gn,t.thickness||Re._defaultThickness),this.opacity=t.opacity||Re._defaultOpacity,_(this,vr,t.boxes||null),_(this,hp,t.methodOfCreation||""),_(this,qd,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(_(this,qt,!0),E(this,ve,Pm).call(this,t),E(this,ve,aa).call(this)):l(this,vr)&&(_(this,Bd,t.anchorNode),_(this,lp,t.anchorOffset),_(this,dp,t.focusNode),_(this,up,t.focusOffset),E(this,ve,qx).call(this),E(this,ve,aa).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=Re.prototype;return pe(this,"_keyboardManager",new Ap([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:l(this,qt)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:l(this,gn),methodOfCreation:l(this,hp)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,s){var i;Ye.initialize(t,s),Re._defaultColor||(Re._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,s){switch(t){case Ee.HIGHLIGHT_COLOR:Re._defaultColor=s;break;case Ee.HIGHLIGHT_THICKNESS:Re._defaultThickness=s;break}}translateInPage(t,s){}get toolbarPosition(){return l(this,Gd)}get commentButtonPosition(){return l(this,Hd)}updateParams(t,s){switch(t){case Ee.HIGHLIGHT_COLOR:E(this,ve,VE).call(this,s);break;case Ee.HIGHLIGHT_THICKNESS:E(this,ve,$E).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Ee.HIGHLIGHT_COLOR,Re._defaultColor],[Ee.HIGHLIGHT_THICKNESS,Re._defaultThickness]]}get propertiesToUpdate(){return[[Ee.HIGHLIGHT_COLOR,this.color||Re._defaultColor],[Ee.HIGHLIGHT_THICKNESS,l(this,gn)||Re._defaultThickness],[Ee.HIGHLIGHT_FREE,l(this,qt)]]}onUpdatedColor(){var t,s;(t=this.parent)==null||t.drawLayer.updateProperties(l(this,zs),{root:{fill:this.color,"fill-opacity":this.opacity}}),(s=l(this,cp))==null||s.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",_(this,cp,new fg({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(E(this,ve,Mm).call(this))}getBaseTranslation(){return[0,0]}getRect(t,s){return super.getRect(t,s,E(this,ve,Mm).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){E(this,ve,Vx).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,ve,aa).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?E(this,ve,Vx).call(this):t&&(E(this,ve,aa).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),s&&this.select()}rotate(t){var r,o,a;const{drawLayer:s}=this.parent;let i;l(this,qt)?(t=(t-this.rotation+360)%360,i=E(r=Re,vn,ic).call(r,l(this,$s).box,t)):i=E(o=Re,vn,ic).call(o,[this.x,this.y,this.width,this.height],t),s.updateProperties(l(this,zs),{bbox:i,root:{"data-main-rotation":t}}),s.updateProperties(l(this,ts),{bbox:E(a=Re,vn,ic).call(a,l(this,Es).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();l(this,qd)&&(t.setAttribute("aria-label",l(this,qd)),t.setAttribute("role","mark")),l(this,qt)?t.classList.add("free"):this.div.addEventListener("keydown",E(this,ve,WE).bind(this),{signal:this._uiManager._signal});const s=_(this,bl,document.createElement("div"));return t.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=l(this,xl),this.setDims(),yC(this,l(this,bl),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,ts),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(l(this,ts),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:E(this,ve,Rm).call(this,!0);break;case 1:case 3:E(this,ve,Rm).call(this,!1);break}}select(){var t;super.select(),l(this,ts)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,ts),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),l(this,ts)&&((t=this.parent)==null||t.drawLayer.updateProperties(l(this,ts),{rootClass:{selected:!1}}),l(this,qt)||E(this,ve,Rm).call(this,!1))}get _mustFixPosition(){return!l(this,qt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(l(this,zs),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(l(this,ts),{rootClass:{hidden:!t}}))}static startHighlighting(t,s,{target:i,x:r,y:o}){const{x:a,y:c,width:d,height:u}=i.getBoundingClientRect(),m=new AbortController,p=t.combinedSignal(m),y=v=>{m.abort(),E(this,vn,XE).call(this,t,v)};window.addEventListener("blur",y,{signal:p}),window.addEventListener("pointerup",y,{signal:p}),window.addEventListener("pointerdown",ft,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Sn,{signal:p}),i.addEventListener("pointermove",E(this,vn,JE).bind(this,t),{signal:p}),this._freeHighlight=new Gx({x:r,y:o},[a,c,d,u],t.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,s,i){var x,b,w,S;let r=null;if(t instanceof EE){const{data:{quadPoints:A,rect:k,rotation:T,id:N,color:I,opacity:D,popupRef:P,richText:R,contentsObj:j,creationDate:$,modificationDate:B},parent:{page:{pageNumber:V}}}=t;r=t={annotationType:ge.HIGHLIGHT,color:Array.from(I),opacity:D,quadPoints:A,boxes:null,pageIndex:V-1,rect:k.slice(0),rotation:T,annotationElementId:N,id:N,deleted:!1,popupRef:P,richText:R,comment:(j==null?void 0:j.str)||null,creationDate:$,modificationDate:B}}else if(t instanceof qb){const{data:{inkLists:A,rect:k,rotation:T,id:N,color:I,borderStyle:{rawWidth:D},popupRef:P,richText:R,contentsObj:j,creationDate:$,modificationDate:B},parent:{page:{pageNumber:V}}}=t;r=t={annotationType:ge.HIGHLIGHT,color:Array.from(I),thickness:D,inkLists:A,boxes:null,pageIndex:V-1,rect:k.slice(0),rotation:T,annotationElementId:N,id:N,deleted:!1,popupRef:P,richText:R,comment:(j==null?void 0:j.str)||null,creationDate:$,modificationDate:B}}const{color:o,quadPoints:a,inkLists:c,opacity:d}=t,u=await super.deserialize(t,s,i);u.color=Z.makeHexColor(...o),u.opacity=d||1,c&&_(u,gn,t.thickness),u._initialData=r,t.comment&&u.setCommentData(t);const[m,p]=u.pageDimensions,[y,v]=u.pageTranslation;if(a){const A=_(u,vr,[]);for(let k=0;k<a.length;k+=8)A.push({x:(a[k]-y)/m,y:1-(a[k+1]-v)/p,width:(a[k+2]-a[k])/m,height:(a[k+1]-a[k+5])/p});E(x=u,ve,qx).call(x),E(b=u,ve,aa).call(b),u.rotate(u.rotation)}else if(c){_(u,qt,!0);const A=c[0],k={x:A[0]-y,y:p-(A[1]-v)},T=new Gx(k,[0,0,m,p],1,l(u,gn)/2,!0,.001);for(let D=0,P=A.length;D<P;D+=2)k.x=A[D]-y,k.y=p-(A[D+1]-v),T.add(k);const{id:N,clipPathId:I}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:T.toSVGPath()}},!0,!0);E(w=u,ve,Pm).call(w,{highlightOutlines:T.getOutlines(),highlightId:N,clipPathId:I}),E(S=u,ve,aa).call(S),u.rotate(u.parentRotation)}return u}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const s=Ye._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:s,opacity:this.opacity,thickness:l(this,gn),quadPoints:E(this,ve,KE).call(this),outlines:E(this,ve,YE).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!E(this,ve,QE).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Bd=new WeakMap,lp=new WeakMap,vr=new WeakMap,xl=new WeakMap,cp=new WeakMap,Es=new WeakMap,dp=new WeakMap,up=new WeakMap,bl=new WeakMap,$s=new WeakMap,zs=new WeakMap,qt=new WeakMap,Hd=new WeakMap,Gd=new WeakMap,ts=new WeakMap,qd=new WeakMap,gn=new WeakMap,hp=new WeakMap,ve=new WeakSet,qx=function(){const t=new Bx(l(this,vr),.001);_(this,$s,t.getOutlines()),[this.x,this.y,this.width,this.height]=l(this,$s).box;const s=new Bx(l(this,vr),.0025,.001,this._uiManager.direction==="ltr");_(this,Es,s.getOutlines());const{firstPoint:i}=l(this,$s);_(this,Hd,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=l(this,Es);_(this,Gd,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},Pm=function({highlightOutlines:t,highlightId:s,clipPathId:i}){var p,y;if(_(this,$s,t),_(this,Es,t.getNewOutline(l(this,gn)/2+1.5,.0025)),s>=0)_(this,zs,s),_(this,xl,i),this.parent.drawLayer.finalizeDraw(s,{bbox:t.box,path:{d:t.toSVGPath()}}),_(this,ts,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:l(this,Es).box,path:{d:l(this,Es).toSVGPath()}},!0));else if(this.parent){const v=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(l(this,zs),{bbox:E(p=Re,vn,ic).call(p,l(this,$s).box,(v-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(l(this,ts),{bbox:E(y=Re,vn,ic).call(y,l(this,Es).box,v),path:{d:l(this,Es).toSVGPath()}})}const[o,a,c,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=a,this.width=c,this.height=d;break;case 90:{const[v,x]=this.parentDimensions;this.x=a,this.y=1-o,this.width=c*x/v,this.height=d*v/x;break}case 180:this.x=1-o,this.y=1-a,this.width=c,this.height=d;break;case 270:{const[v,x]=this.parentDimensions;this.x=1-a,this.y=o,this.width=c*x/v,this.height=d*v/x;break}}const{firstPoint:u}=t;_(this,Hd,[(u[0]-o)/c,(u[1]-a)/d]);const{lastPoint:m}=l(this,Es);_(this,Gd,[(m[0]-o)/c,(m[1]-a)/d])},VE=function(t){const s=(o,a)=>{this.color=o,this.opacity=a,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:s.bind(this,t,Re._defaultOpacity),undo:s.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ee.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},$E=function(t){const s=l(this,gn),i=r=>{_(this,gn,r),E(this,ve,zE).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Ee.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},zE=function(t){l(this,qt)&&(E(this,ve,Pm).call(this,{highlightOutlines:l(this,$s).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},Vx=function(){l(this,zs)===null||!this.parent||(this.parent.drawLayer.remove(l(this,zs)),_(this,zs,null),this.parent.drawLayer.remove(l(this,ts)),_(this,ts,null))},aa=function(t=this.parent){l(this,zs)===null&&({id:ot(this,zs)._,clipPathId:ot(this,xl)._}=t.drawLayer.draw({bbox:l(this,$s).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:l(this,qt)},path:{d:l(this,$s).toSVGPath()}},!1,!0),_(this,ts,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:l(this,qt)},bbox:l(this,Es).box,path:{d:l(this,Es).toSVGPath()}},l(this,qt))),l(this,bl)&&(l(this,bl).style.clipPath=l(this,xl)))},vn=new WeakSet,ic=function([t,s,i,r],o){switch(o){case 90:return[1-s-r,t,r,i];case 180:return[1-t-i,1-s-r,i,r];case 270:return[s,1-t-i,r,i]}return[t,s,i,r]},WE=function(t){Re._keyboardManager.exec(this,t)},Rm=function(t){if(!l(this,Bd))return;const s=window.getSelection();t?s.setPosition(l(this,Bd),l(this,lp)):s.setPosition(l(this,dp),l(this,up))},Mm=function(){return l(this,qt)?this.rotation:0},KE=function(){if(l(this,qt))return null;const[t,s]=this.pageDimensions,[i,r]=this.pageTranslation,o=l(this,vr),a=new Float32Array(o.length*8);let c=0;for(const{x:d,y:u,width:m,height:p}of o){const y=d*t+i,v=(1-u)*s+r;a[c]=a[c+4]=y,a[c+1]=a[c+3]=v,a[c+2]=a[c+6]=y+m*t,a[c+5]=a[c+7]=v-p*s,c+=8}return a},YE=function(t){return l(this,$s).serialize(t,E(this,ve,Mm).call(this))},JE=function(t,s){this._freeHighlight.add(s)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},XE=function(t,s){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},QE=function(t){const{color:s}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==s[r])},C(Re,vn),W(Re,"_defaultColor",null),W(Re,"_defaultOpacity",1),W(Re,"_defaultThickness",12),W(Re,"_type","highlight"),W(Re,"_editorType",ge.HIGHLIGHT),W(Re,"_freeHighlightId",-1),W(Re,"_freeHighlight",null),W(Re,"_freeHighlightClipId","");let yg=Re;var vl;class ZE{constructor(){C(this,vl,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){l(this,vl)[e]=t}toSVGProperties(){const e=l(this,vl);return _(this,vl,Object.create(null)),{root:e}}reset(){_(this,vl,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ze("Not implemented")}}vl=new WeakMap;var Ws,Vd,Mt,wl,_l,Ne,$x,zx,Wx,zu,ek,Dm,Wu,rc;const Ce=class Ce extends Ye{constructor(t){super(t);C(this,Ne);C(this,Ws,null);C(this,Vd);W(this,"_colorPicker",null);W(this,"_drawId",null);_(this,Vd,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(E(this,Ne,$x).call(this,t),E(this,Ne,zu).call(this))}static _mergeSVGProperties(t,s){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(s))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){ze("Not implemented")}static get typesMap(){ze("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,s){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(l(Ce,Mt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,s){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,s)}static get defaultPropertiesToUpdate(){const t=[],s=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,s[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:s}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,s[r]]);return t}_updateProperty(t,s,i){const r=this._drawingOptions,o=r[s],a=c=>{var u;r.updateProperty(s,c);const d=l(this,Ws).updateProperty(s,c);d&&E(this,Ne,Wu).call(this,d),(u=this.parent)==null||u.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ce._mergeSVGProperties(l(this,Ws).getPathResizingSVGProperties(E(this,Ne,Dm).call(this)),{bbox:E(this,Ne,rc).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ce._mergeSVGProperties(l(this,Ws).getPathResizedSVGProperties(E(this,Ne,Dm).call(this)),{bbox:E(this,Ne,rc).call(this)}))}_onTranslating(t,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:E(this,Ne,rc).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Ce._mergeSVGProperties(l(this,Ws).getPathTranslatedSVGProperties(E(this,Ne,Dm).call(this),this.parentDimensions),{bbox:E(this,Ne,rc).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,l(this,Vd)&&(_(this,Vd,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){E(this,Ne,Wx).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(E(this,Ne,zu).call(this),E(this,Ne,Wu).call(this,l(this,Ws).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let s=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),E(this,Ne,Wx).call(this)):t&&(this._uiManager.addShouldRescale(this),E(this,Ne,zu).call(this,t),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ce._mergeSVGProperties({bbox:E(this,Ne,rc).call(this)},l(this,Ws).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&E(this,Ne,Wu).call(this,l(this,Ws).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,s;this._isCopy&&(t=this.x,s=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,s),i}static createDrawerInstance(t,s,i,r,o){ze("Not implemented")}static startDrawing(t,s,i,r){var b;const{target:o,offsetX:a,offsetY:c,pointerId:d,pointerType:u}=r;if(Jt.isInitializedAndDifferentPointerType(u))return;const{viewport:{rotation:m}}=t,{width:p,height:y}=o.getBoundingClientRect(),v=_(Ce,wl,new AbortController),x=t.combinedSignal(v);if(Jt.setPointer(u,d),window.addEventListener("pointerup",w=>{Jt.isSamePointerIdOrRemove(w.pointerId)&&this._endDraw(w)},{signal:x}),window.addEventListener("pointercancel",w=>{Jt.isSamePointerIdOrRemove(w.pointerId)&&this._currentParent.endDrawingSession()},{signal:x}),window.addEventListener("pointerdown",w=>{Jt.isSamePointerType(w.pointerType)&&(Jt.initializeAndAddPointerId(w.pointerId),l(Ce,Mt).isCancellable()&&(l(Ce,Mt).removeLastElement(),l(Ce,Mt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:x}),window.addEventListener("contextmenu",Sn,{signal:x}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:x}),o.addEventListener("touchmove",w=>{Jt.isSameTimeStamp(w.timeStamp)&&ft(w)},{signal:x}),t.toggleDrawing(),(b=s._editorUndoBar)==null||b.hide(),l(Ce,Mt)){t.drawLayer.updateProperties(this._currentDrawId,l(Ce,Mt).startNew(a,c,p,y,m));return}s.updateUIForDefaultProperties(this),_(Ce,Mt,this.createDrawerInstance(a,c,p,y,m)),_(Ce,_l,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(l(Ce,_l).toSVGProperties(),l(Ce,Mt).defaultSVGProperties),!0,!1)}static _drawMove(t){if(Jt.isSameTimeStamp(t.timeStamp),!l(Ce,Mt))return;const{offsetX:s,offsetY:i,pointerId:r}=t;if(Jt.isSamePointerId(r)){if(Jt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,l(Ce,Mt).add(s,i)),Jt.setTimeStamp(t.timeStamp),ft(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,_(Ce,Mt,null),_(Ce,_l,null),Jt.clearTimeStamp()),l(Ce,wl)&&(l(Ce,wl).abort(),_(Ce,wl,null),Jt.clearPointerIds())}static _endDraw(t){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,l(Ce,Mt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=l(Ce,Mt),r=this._currentDrawId,o=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{s.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:Ee.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Ee.DRAW_STEP),!l(Ce,Mt).isEmpty()){const{pageDimensions:[i,r],scale:o}=s,a=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:l(Ce,Mt).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:l(Ce,_l),mustBeCommitted:!t});return this._cleanup(!0),a}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,s,i,r,o,a){ze("Not implemented")}static async deserialize(t,s,i){var m,p;const{rawDims:{pageWidth:r,pageHeight:o,pageX:a,pageY:c}}=s.viewport,d=this.deserializeDraw(a,c,r,o,this._INNER_MARGIN,t),u=await super.deserialize(t,s,i);return u.createDrawingOptions(t),E(m=u,Ne,$x).call(m,{drawOutlines:d}),E(p=u,Ne,zu).call(p),u.onScaleChanging(),u.rotate(),u}serializeDraw(t){const[s,i]=this.pageTranslation,[r,o]=this.pageDimensions;return l(this,Ws).serialize([s,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};Ws=new WeakMap,Vd=new WeakMap,Mt=new WeakMap,wl=new WeakMap,_l=new WeakMap,Ne=new WeakSet,$x=function({drawOutlines:t,drawId:s,drawingOptions:i}){_(this,Ws,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,t.defaultProperties)):this._drawId=E(this,Ne,zx).call(this,t,this.parent),E(this,Ne,Wu).call(this,t.box)},zx=function(t,s){const{id:i}=s.drawLayer.draw(Ce._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},Wx=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},zu=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=E(this,Ne,zx).call(this,l(this,Ws),t)}},ek=function([t,s,i,r]){const{parentDimensions:[o,a],rotation:c}=this;switch(c){case 90:return[s,1-t,i*(a/o),r*(o/a)];case 180:return[1-t,1-s,i,r];case 270:return[1-s,t,i*(a/o),r*(o/a)];default:return[t,s,i,r]}},Dm=function(){const{x:t,y:s,width:i,height:r,parentDimensions:[o,a],rotation:c}=this;switch(c){case 90:return[1-s,t,i*(o/a),r*(a/o)];case 180:return[1-t,1-s,i,r];case 270:return[s,1-t,i*(o/a),r*(a/o)];default:return[t,s,i,r]}},Wu=function(t){[this.x,this.y,this.width,this.height]=E(this,Ne,ek).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},rc=function(){const{x:t,y:s,width:i,height:r,rotation:o,parentRotation:a,parentDimensions:[c,d]}=this;switch((o*4+a)/90){case 1:return[1-s-r,t,r,i];case 2:return[1-t-i,1-s-r,i,r];case 3:return[s,1-t-i,r,i];case 4:return[t,s-i*(c/d),r*(d/c),i*(c/d)];case 5:return[1-s,t,i*(c/d),r*(d/c)];case 6:return[1-t-r*(d/c),1-s,r*(d/c),i*(c/d)];case 7:return[s-i*(c/d),1-t-r*(d/c),i*(c/d),r*(d/c)];case 8:return[t-i,s-r,i,r];case 9:return[1-s,t-i,r,i];case 10:return[1-t,1-s,i,r];case 11:return[s-r,1-t,r,i];case 12:return[t-r*(d/c),s,r*(d/c),i*(c/d)];case 13:return[1-s-i*(c/d),t-r*(d/c),i*(c/d),r*(d/c)];case 14:return[1-t,1-s-i*(c/d),r*(d/c),i*(c/d)];case 15:return[s,1-t,i*(c/d),r*(d/c)];default:return[t,s,i,r]}},W(Ce,"_currentDrawId",-1),W(Ce,"_currentParent",null),C(Ce,Mt,null),C(Ce,wl,null),C(Ce,_l,null),W(Ce,"_INNER_MARGIN",3);let xg=Ce;var wi,Dt,Lt,Al,$d,ls,Vt,yn,Sl,Cl,El,zd,Lm;class bO{constructor(e,t,s,i,r,o){C(this,zd);C(this,wi,new Float64Array(6));C(this,Dt);C(this,Lt);C(this,Al);C(this,$d);C(this,ls);C(this,Vt,"");C(this,yn,0);C(this,Sl,new Cp);C(this,Cl);C(this,El);_(this,Cl,s),_(this,El,i),_(this,Al,r),_(this,$d,o),[e,t]=E(this,zd,Lm).call(this,e,t);const a=_(this,Dt,[NaN,NaN,NaN,NaN,e,t]);_(this,ls,[e,t]),_(this,Lt,[{line:a,points:l(this,ls)}]),l(this,wi).set(a,0)}updateProperty(e,t){e==="stroke-width"&&_(this,$d,t)}isEmpty(){return!l(this,Lt)||l(this,Lt).length===0}isCancellable(){return l(this,ls).length<=10}add(e,t){[e,t]=E(this,zd,Lm).call(this,e,t);const[s,i,r,o]=l(this,wi).subarray(2,6),a=e-r,c=t-o;return Math.hypot(l(this,Cl)*a,l(this,El)*c)<=2?null:(l(this,ls).push(e,t),isNaN(s)?(l(this,wi).set([r,o,e,t],2),l(this,Dt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(l(this,wi)[0])&&l(this,Dt).splice(6,6),l(this,wi).set([s,i,r,o,e,t],0),l(this,Dt).push(...se.createBezierPoints(s,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(l(this,ls).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,i,r){_(this,Cl,s),_(this,El,i),_(this,Al,r),[e,t]=E(this,zd,Lm).call(this,e,t);const o=_(this,Dt,[NaN,NaN,NaN,NaN,e,t]);_(this,ls,[e,t]);const a=l(this,Lt).at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),l(this,Lt).push({line:o,points:l(this,ls)}),l(this,wi).set(o,0),_(this,yn,0),this.toSVGPath(),null}getLastElement(){return l(this,Lt).at(-1)}setLastElement(e){return l(this,Lt)?(l(this,Lt).push(e),_(this,Dt,e.line),_(this,ls,e.points),_(this,yn,0),{path:{d:this.toSVGPath()}}):l(this,Sl).setLastElement(e)}removeLastElement(){if(!l(this,Lt))return l(this,Sl).removeLastElement();l(this,Lt).pop(),_(this,Vt,"");for(let e=0,t=l(this,Lt).length;e<t;e++){const{line:s,points:i}=l(this,Lt)[e];_(this,Dt,s),_(this,ls,i),_(this,yn,0),this.toSVGPath()}return{path:{d:l(this,Vt)}}}toSVGPath(){const e=se.svgRound(l(this,Dt)[4]),t=se.svgRound(l(this,Dt)[5]);if(l(this,ls).length===2)return _(this,Vt,`${l(this,Vt)} M ${e} ${t} Z`),l(this,Vt);if(l(this,ls).length<=6){const i=l(this,Vt).lastIndexOf("M");_(this,Vt,`${l(this,Vt).slice(0,i)} M ${e} ${t}`),_(this,yn,6)}if(l(this,ls).length===4){const i=se.svgRound(l(this,Dt)[10]),r=se.svgRound(l(this,Dt)[11]);return _(this,Vt,`${l(this,Vt)} L ${i} ${r}`),_(this,yn,12),l(this,Vt)}const s=[];l(this,yn)===0&&(s.push(`M ${e} ${t}`),_(this,yn,6));for(let i=l(this,yn),r=l(this,Dt).length;i<r;i+=6){const[o,a,c,d,u,m]=l(this,Dt).slice(i,i+6).map(se.svgRound);s.push(`C${o} ${a} ${c} ${d} ${u} ${m}`)}return _(this,Vt,l(this,Vt)+s.join(" ")),_(this,yn,l(this,Dt).length),l(this,Vt)}getOutlines(e,t,s,i){const r=l(this,Lt).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),l(this,Sl).build(l(this,Lt),e,t,s,l(this,Al),l(this,$d),i),_(this,wi,null),_(this,Dt,null),_(this,Lt,null),_(this,Vt,null),l(this,Sl)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}wi=new WeakMap,Dt=new WeakMap,Lt=new WeakMap,Al=new WeakMap,$d=new WeakMap,ls=new WeakMap,Vt=new WeakMap,yn=new WeakMap,Sl=new WeakMap,Cl=new WeakMap,El=new WeakMap,zd=new WeakSet,Lm=function(e,t){return se._normalizePoint(e,t,l(this,Cl),l(this,El),l(this,Al))};var cs,fp,pp,Ks,_i,Ai,Wd,Kd,kl,zt,Hi,tk,sk,nk;class Cp extends se{constructor(){super(...arguments);C(this,zt);C(this,cs);C(this,fp,0);C(this,pp);C(this,Ks);C(this,_i);C(this,Ai);C(this,Wd);C(this,Kd);C(this,kl)}build(t,s,i,r,o,a,c){_(this,_i,s),_(this,Ai,i),_(this,Wd,r),_(this,Kd,o),_(this,kl,a),_(this,pp,c??0),_(this,Ks,t),E(this,zt,sk).call(this)}get thickness(){return l(this,kl)}setLastElement(t){return l(this,Ks).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return l(this,Ks).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:s}of l(this,Ks)){if(t.push(`M${se.svgRound(s[4])} ${se.svgRound(s[5])}`),s.length===6){t.push("Z");continue}if(s.length===12&&isNaN(s[6])){t.push(`L${se.svgRound(s[10])} ${se.svgRound(s[11])}`);continue}for(let i=6,r=s.length;i<r;i+=6){const[o,a,c,d,u,m]=s.subarray(i,i+6).map(se.svgRound);t.push(`C${o} ${a} ${c} ${d} ${u} ${m}`)}}return t.join("")}serialize([t,s,i,r],o){const a=[],c=[],[d,u,m,p]=E(this,zt,tk).call(this);let y,v,x,b,w,S,A,k,T;switch(l(this,Kd)){case 0:T=se._rescale,y=t,v=s+r,x=i,b=-r,w=t+d*i,S=s+(1-u-p)*r,A=t+(d+m)*i,k=s+(1-u)*r;break;case 90:T=se._rescaleAndSwap,y=t,v=s,x=i,b=r,w=t+u*i,S=s+d*r,A=t+(u+p)*i,k=s+(d+m)*r;break;case 180:T=se._rescale,y=t+i,v=s,x=-i,b=r,w=t+(1-d-m)*i,S=s+u*r,A=t+(1-d)*i,k=s+(u+p)*r;break;case 270:T=se._rescaleAndSwap,y=t+i,v=s+r,x=-i,b=-r,w=t+(1-u-p)*i,S=s+(1-d-m)*r,A=t+(1-u)*i,k=s+(1-d)*r;break}for(const{line:N,points:I}of l(this,Ks))a.push(T(N,y,v,x,b,o?new Array(N.length):null)),c.push(T(I,y,v,x,b,o?new Array(I.length):null));return{lines:a,points:c,rect:[w,S,A,k]}}static deserialize(t,s,i,r,o,{paths:{lines:a,points:c},rotation:d,thickness:u}){const m=[];let p,y,v,x,b;switch(d){case 0:b=se._rescale,p=-t/i,y=s/r+1,v=1/i,x=-1/r;break;case 90:b=se._rescaleAndSwap,p=-s/r,y=-t/i,v=1/r,x=1/i;break;case 180:b=se._rescale,p=t/i+1,y=-s/r,v=-1/i,x=1/r;break;case 270:b=se._rescaleAndSwap,p=s/r+1,y=t/i+1,v=-1/r,x=-1/i;break}if(!a){a=[];for(const S of c){const A=S.length;if(A===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(A===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const k=new Float32Array(3*(A-2));a.push(k);let[T,N,I,D]=S.subarray(0,4);k.set([NaN,NaN,NaN,NaN,T,N],0);for(let P=4;P<A;P+=2){const R=S[P],j=S[P+1];k.set(se.createBezierPoints(T,N,I,D,R,j),(P-2)*3),[T,N,I,D]=[I,D,R,j]}}}for(let S=0,A=a.length;S<A;S++)m.push({line:b(a[S].map(k=>k??NaN),p,y,v,x),points:b(c[S].map(k=>k??NaN),p,y,v,x)});const w=new this.prototype.constructor;return w.build(m,i,r,1,d,u,o),w}get box(){return l(this,cs)}updateProperty(t,s){return t==="stroke-width"?E(this,zt,nk).call(this,s):null}updateParentDimensions([t,s],i){const[r,o]=E(this,zt,Hi).call(this);_(this,_i,t),_(this,Ai,s),_(this,Wd,i);const[a,c]=E(this,zt,Hi).call(this),d=a-r,u=c-o,m=l(this,cs);return m[0]-=d,m[1]-=u,m[2]+=2*d,m[3]+=2*u,m}updateRotation(t){return _(this,fp,t),{path:{transform:this.rotationTransform}}}get viewBox(){return l(this,cs).map(se.svgRound).join(" ")}get defaultProperties(){const[t,s]=l(this,cs);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${se.svgRound(t)} ${se.svgRound(s)}`}}}get rotationTransform(){const[,,t,s]=l(this,cs);let i=0,r=0,o=0,a=0,c=0,d=0;switch(l(this,fp)){case 90:r=s/t,o=-t/s,c=t;break;case 180:i=-1,a=-1,c=t,d=s;break;case 270:r=-s/t,o=t/s,d=s;break;default:return""}return`matrix(${i} ${r} ${o} ${a} ${se.svgRound(c)} ${se.svgRound(d)})`}getPathResizingSVGProperties([t,s,i,r]){const[o,a]=E(this,zt,Hi).call(this),[c,d,u,m]=l(this,cs);if(Math.abs(u-o)<=se.PRECISION||Math.abs(m-a)<=se.PRECISION){const b=t+i/2-(c+u/2),w=s+r/2-(d+m/2);return{path:{"transform-origin":`${se.svgRound(t)} ${se.svgRound(s)}`,transform:`${this.rotationTransform} translate(${b} ${w})`}}}const p=(i-2*o)/(u-2*o),y=(r-2*a)/(m-2*a),v=u/i,x=m/r;return{path:{"transform-origin":`${se.svgRound(c)} ${se.svgRound(d)}`,transform:`${this.rotationTransform} scale(${v} ${x}) translate(${se.svgRound(o)} ${se.svgRound(a)}) scale(${p} ${y}) translate(${se.svgRound(-o)} ${se.svgRound(-a)})`}}}getPathResizedSVGProperties([t,s,i,r]){const[o,a]=E(this,zt,Hi).call(this),c=l(this,cs),[d,u,m,p]=c;if(c[0]=t,c[1]=s,c[2]=i,c[3]=r,Math.abs(m-o)<=se.PRECISION||Math.abs(p-a)<=se.PRECISION){const w=t+i/2-(d+m/2),S=s+r/2-(u+p/2);for(const{line:A,points:k}of l(this,Ks))se._translate(A,w,S,A),se._translate(k,w,S,k);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${se.svgRound(t)} ${se.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(i-2*o)/(m-2*o),v=(r-2*a)/(p-2*a),x=-y*(d+o)+t+o,b=-v*(u+a)+s+a;if(y!==1||v!==1||x!==0||b!==0)for(const{line:w,points:S}of l(this,Ks))se._rescale(w,x,b,y,v,w),se._rescale(S,x,b,y,v,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${se.svgRound(t)} ${se.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,s],i){const[r,o]=i,a=l(this,cs),c=t-a[0],d=s-a[1];if(l(this,_i)===r&&l(this,Ai)===o)for(const{line:u,points:m}of l(this,Ks))se._translate(u,c,d,u),se._translate(m,c,d,m);else{const u=l(this,_i)/r,m=l(this,Ai)/o;_(this,_i,r),_(this,Ai,o);for(const{line:p,points:y}of l(this,Ks))se._rescale(p,c,d,u,m,p),se._rescale(y,c,d,u,m,y);a[2]*=u,a[3]*=m}return a[0]=t,a[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${se.svgRound(t)} ${se.svgRound(s)}`}}}get defaultSVGProperties(){const t=l(this,cs);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${se.svgRound(t[0])} ${se.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}cs=new WeakMap,fp=new WeakMap,pp=new WeakMap,Ks=new WeakMap,_i=new WeakMap,Ai=new WeakMap,Wd=new WeakMap,Kd=new WeakMap,kl=new WeakMap,zt=new WeakSet,Hi=function(t=l(this,kl)){const s=l(this,pp)+t/2*l(this,Wd);return l(this,Kd)%180===0?[s/l(this,_i),s/l(this,Ai)]:[s/l(this,Ai),s/l(this,_i)]},tk=function(){const[t,s,i,r]=l(this,cs),[o,a]=E(this,zt,Hi).call(this,0);return[t+o,s+a,i-2*o,r-2*a]},sk=function(){const t=_(this,cs,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of l(this,Ks)){if(r.length<=12){for(let c=4,d=r.length;c<d;c+=6)Z.pointBoundingBox(r[c],r[c+1],t);continue}let o=r[4],a=r[5];for(let c=6,d=r.length;c<d;c+=6){const[u,m,p,y,v,x]=r.subarray(c,c+6);Z.bezierBoundingBox(o,a,u,m,p,y,v,x,t),o=v,a=x}}const[s,i]=E(this,zt,Hi).call(this);t[0]=fs(t[0]-s,0,1),t[1]=fs(t[1]-i,0,1),t[2]=fs(t[2]+s,0,1),t[3]=fs(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},nk=function(t){const[s,i]=E(this,zt,Hi).call(this);_(this,kl,t);const[r,o]=E(this,zt,Hi).call(this),[a,c]=[r-s,o-i],d=l(this,cs);return d[0]-=a,d[1]-=c,d[2]+=2*a,d[3]+=2*c,d};class o0 extends ZE{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ye._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new o0(this._viewParameters);return e.updateAll(this),e}}var Fg,ik;const fc=class fc extends xg{constructor(t){super({...t,name:"inkEditor"});C(this,Fg);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,s){Ye.initialize(t,s),this._defaultDrawingOptions=new o0(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return pe(this,"typesMap",new Map([[Ee.INK_THICKNESS,"stroke-width"],[Ee.INK_COLOR,"stroke"],[Ee.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,s,i,r,o){return new bO(t,s,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,s,i,r,o,a){return Cp.deserialize(t,s,i,r,o,a)}static async deserialize(t,s,i){let r=null;if(t instanceof qb){const{data:{inkLists:a,rect:c,rotation:d,id:u,color:m,opacity:p,borderStyle:{rawWidth:y},popupRef:v,richText:x,contentsObj:b,creationDate:w,modificationDate:S},parent:{page:{pageNumber:A}}}=t;r=t={annotationType:ge.INK,color:Array.from(m),thickness:y,opacity:p,paths:{points:a},boxes:null,pageIndex:A-1,rect:c.slice(0),rotation:d,annotationElementId:u,id:u,deleted:!1,popupRef:v,richText:x,comment:(b==null?void 0:b.str)||null,creationDate:w,modificationDate:S}}const o=await super.deserialize(t,s,i);return o._initialData=r,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new pg(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Ee.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:s,opacity:i}){this._drawingOptions=fc.getDefaultDrawingOptions({stroke:Z.makeHexColor(...t),"stroke-width":s,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":a}}=this,c=Object.assign(super.serialize(t),{color:Ye._colorManager.convert(r),opacity:o,thickness:a,paths:{lines:s,points:i}});return this.addComment(c),t?(c.isCopy=!0,c):this.annotationElementId&&!E(this,Fg,ik).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:s,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:s,popup:this.comment}),null}};Fg=new WeakSet,ik=function(t){const{color:s,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((a,c)=>a!==s[c])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},W(fc,"_type","ink"),W(fc,"_editorType",ge.INK),W(fc,"_defaultDrawingOptions",null);let Kx=fc;class Yx extends Cp{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Xp=8,Au=3;var Tl,Me,Jx,Gn,rk,ok,Xx,Fm,ak,lk,ck,Qx,Zx,dk;class kr{static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:i},r,o,a,c){let d=new OffscreenCanvas(1,1),u=d.getContext("2d",{alpha:!1});const m=200,p=u.font=`${s} ${i} ${m}px ${t}`,{actualBoundingBoxLeft:y,actualBoundingBoxRight:v,actualBoundingBoxAscent:x,actualBoundingBoxDescent:b,fontBoundingBoxAscent:w,fontBoundingBoxDescent:S,width:A}=u.measureText(e),k=1.5,T=Math.ceil(Math.max(Math.abs(y)+Math.abs(v)||0,A)*k),N=Math.ceil(Math.max(Math.abs(x)+Math.abs(b)||m,Math.abs(w)+Math.abs(S)||m)*k);d=new OffscreenCanvas(T,N),u=d.getContext("2d",{alpha:!0,willReadFrequently:!0}),u.font=p,u.filter="grayscale(1)",u.fillStyle="white",u.fillRect(0,0,T,N),u.fillStyle="black",u.fillText(e,T*(k-1)/2,N*(3-k)/2);const I=E(this,Me,Qx).call(this,u.getImageData(0,0,T,N).data),D=E(this,Me,ck).call(this,I),P=E(this,Me,Zx).call(this,D),R=E(this,Me,Xx).call(this,I,T,N,P);return this.processDrawnLines({lines:{curves:R,width:T,height:N},pageWidth:r,pageHeight:o,rotation:a,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,s,i,r){const[o,a,c]=E(this,Me,dk).call(this,e),[d,u]=E(this,Me,lk).call(this,o,a,c,Math.hypot(a,c)*l(this,Tl).sigmaSFactor,l(this,Tl).sigmaR,l(this,Tl).kernelSize),m=E(this,Me,Zx).call(this,u),p=E(this,Me,Xx).call(this,d,a,c,m);return this.processDrawnLines({lines:{curves:p,width:a,height:c},pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:i,innerMargin:r,mustSmooth:o,areContours:a}){i%180!==0&&([t,s]=[s,t]);const{curves:c,width:d,height:u}=e,m=e.thickness??0,p=[],y=Math.min(t/d,s/u),v=y/t,x=y/s,b=[];for(const{points:S}of c){const A=o?E(this,Me,ak).call(this,S):S;if(!A)continue;b.push(A);const k=A.length,T=new Float32Array(k),N=new Float32Array(3*(k===2?2:k-2));if(p.push({line:N,points:T}),k===2){T[0]=A[0]*v,T[1]=A[1]*x,N.set([NaN,NaN,NaN,NaN,T[0],T[1]],0);continue}let[I,D,P,R]=A;I*=v,D*=x,P*=v,R*=x,T.set([I,D,P,R],0),N.set([NaN,NaN,NaN,NaN,I,D],0);for(let j=4;j<k;j+=2){const $=T[j]=A[j]*v,B=T[j+1]=A[j+1]*x;N.set(se.createBezierPoints(I,D,P,R,$,B),(j-2)*3),[I,D,P,R]=[P,R,$,B]}}if(p.length===0)return null;const w=a?new Yx:new Cp;return w.build(p,t,s,1,i,a?0:m,r),{outline:w,newCurves:b,areContours:a,thickness:m,width:d,height:u}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:i,height:r}){let o=1/0,a=-1/0,c=0;for(const A of e){c+=A.length;for(let k=2,T=A.length;k<T;k++){const N=A[k]-A[k-2];o=Math.min(o,N),a=Math.max(a,N)}}let d;o>=-128&&a<=127?d=Int8Array:o>=-32768&&a<=32767?d=Int16Array:d=Int32Array;const u=e.length,m=Xp+Au*u,p=new Uint32Array(m);let y=0;p[y++]=m*Uint32Array.BYTES_PER_ELEMENT+(c-2*u)*d.BYTES_PER_ELEMENT,p[y++]=0,p[y++]=i,p[y++]=r,p[y++]=t?0:1,p[y++]=Math.max(0,Math.floor(s??0)),p[y++]=u,p[y++]=d.BYTES_PER_ELEMENT;for(const A of e)p[y++]=A.length-2,p[y++]=A[0],p[y++]=A[1];const v=new CompressionStream("deflate-raw"),x=v.writable.getWriter();await x.ready,x.write(p);const b=d.prototype.constructor;for(const A of e){const k=new b(A.length-2);for(let T=2,N=A.length;T<N;T++)k[T-2]=A[T]-A[T-2];x.write(k)}x.close();const w=await new Response(v.readable).arrayBuffer(),S=new Uint8Array(w);return lC(S)}static async decompressSignature(e){try{const t=Dj(e),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,a=0;for await(const A of s)o||(o=new Uint8Array(new Uint32Array(A.buffer,0,4)[0])),o.set(A,a),a+=A.length;const c=new Uint32Array(o.buffer,0,o.length>>2),d=c[1];if(d!==0)throw new Error(`Invalid version: ${d}`);const u=c[2],m=c[3],p=c[4]===0,y=c[5],v=c[6],x=c[7],b=[],w=(Xp+Au*v)*Uint32Array.BYTES_PER_ELEMENT;let S;switch(x){case Int8Array.BYTES_PER_ELEMENT:S=new Int8Array(o.buffer,w);break;case Int16Array.BYTES_PER_ELEMENT:S=new Int16Array(o.buffer,w);break;case Int32Array.BYTES_PER_ELEMENT:S=new Int32Array(o.buffer,w);break}a=0;for(let A=0;A<v;A++){const k=c[Au*A+Xp],T=new Float32Array(k+2);b.push(T);for(let N=0;N<Au-1;N++)T[N]=c[Au*A+Xp+N+1];for(let N=0;N<k;N++)T[N+2]=T[N]+S[a++]}return{areContours:p,thickness:y,outlines:b,width:u,height:m}}catch(t){return fe(`decompressSignature: ${t}`),null}}}Tl=new WeakMap,Me=new WeakSet,Jx=function(e,t,s,i){return s-=e,i-=t,s===0?i>0?0:4:s===1?i+6:2-i},Gn=new WeakMap,rk=function(e,t,s,i,r,o,a){const c=E(this,Me,Jx).call(this,s,i,r,o);for(let d=0;d<8;d++){const u=(-d+c-a+16)%8,m=l(this,Gn)[2*u],p=l(this,Gn)[2*u+1];if(e[(s+m)*t+(i+p)]!==0)return u}return-1},ok=function(e,t,s,i,r,o,a){const c=E(this,Me,Jx).call(this,s,i,r,o);for(let d=0;d<8;d++){const u=(d+c+a+16)%8,m=l(this,Gn)[2*u],p=l(this,Gn)[2*u+1];if(e[(s+m)*t+(i+p)]!==0)return u}return-1},Xx=function(e,t,s,i){const r=e.length,o=new Int32Array(r);for(let u=0;u<r;u++)o[u]=e[u]<=i?1:0;for(let u=1;u<s-1;u++)o[u*t]=o[u*t+t-1]=0;for(let u=0;u<t;u++)o[u]=o[t*s-1-u]=0;let a=1,c;const d=[];for(let u=1;u<s-1;u++){c=1;for(let m=1;m<t-1;m++){const p=u*t+m,y=o[p];if(y===0)continue;let v=u,x=m;if(y===1&&o[p-1]===0)a+=1,x-=1;else if(y>=1&&o[p+1]===0)a+=1,x+=1,y>1&&(c=y);else{y!==1&&(c=Math.abs(y));continue}const b=[m,u],w=x===m+1,S={isHole:w,points:b,id:a,parent:0};d.push(S);let A;for(const j of d)if(j.id===c){A=j;break}A?A.isHole?S.parent=w?A.parent:c:S.parent=w?c:A.parent:S.parent=w?c:0;const k=E(this,Me,rk).call(this,o,t,u,m,v,x,0);if(k===-1){o[p]=-a,o[p]!==1&&(c=Math.abs(o[p]));continue}let T=l(this,Gn)[2*k],N=l(this,Gn)[2*k+1];const I=u+T,D=m+N;v=I,x=D;let P=u,R=m;for(;;){const j=E(this,Me,ok).call(this,o,t,P,R,v,x,1);T=l(this,Gn)[2*j],N=l(this,Gn)[2*j+1];const $=P+T,B=R+N;b.push(B,$);const V=P*t+R;if(o[V+1]===0?o[V]=-a:o[V]===1&&(o[V]=a),$===u&&B===m&&P===I&&R===D){o[p]!==1&&(c=Math.abs(o[p]));break}else v=P,x=R,P=$,R=B}}}return d},Fm=function(e,t,s,i){if(s-t<=4){for(let I=t;I<s-2;I+=2)i.push(e[I],e[I+1]);return}const r=e[t],o=e[t+1],a=e[s-4]-r,c=e[s-3]-o,d=Math.hypot(a,c),u=a/d,m=c/d,p=u*o-m*r,y=c/a,v=1/d,x=Math.atan(y),b=Math.cos(x),w=Math.sin(x),S=v*(Math.abs(b)+Math.abs(w)),A=v*(1-S+S**2),k=Math.max(Math.atan(Math.abs(w+b)*A),Math.atan(Math.abs(w-b)*A));let T=0,N=t;for(let I=t+2;I<s-2;I+=2){const D=Math.abs(p-u*e[I+1]+m*e[I]);D>T&&(N=I,T=D)}T>(d*k)**2?(E(this,Me,Fm).call(this,e,t,N+2,i),E(this,Me,Fm).call(this,e,N,s,i)):i.push(r,o)},ak=function(e){const t=[],s=e.length;return E(this,Me,Fm).call(this,e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t},lk=function(e,t,s,i,r,o){const a=new Float32Array(o**2),c=-2*i**2,d=o>>1;for(let x=0;x<o;x++){const b=(x-d)**2;for(let w=0;w<o;w++)a[x*o+w]=Math.exp((b+(w-d)**2)/c)}const u=new Float32Array(256),m=-2*r**2;for(let x=0;x<256;x++)u[x]=Math.exp(x**2/m);const p=e.length,y=new Uint8Array(p),v=new Uint32Array(256);for(let x=0;x<s;x++)for(let b=0;b<t;b++){const w=x*t+b,S=e[w];let A=0,k=0;for(let N=0;N<o;N++){const I=x+N-d;if(!(I<0||I>=s))for(let D=0;D<o;D++){const P=b+D-d;if(P<0||P>=t)continue;const R=e[I*t+P],j=a[N*o+D]*u[Math.abs(R-S)];A+=R*j,k+=j}}const T=y[w]=Math.round(A/k);v[T]++}return[y,v]},ck=function(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t},Qx=function(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let a=0,c=s.length;a<c;a++){const d=s[a]=e[a<<2];i=Math.max(i,d),r=Math.min(r,d)}const o=255/(i-r);for(let a=0,c=s.length;a<c;a++)s[a]=(s[a]-r)*o;return s},Zx=function(e){let t,s=-1/0,i=-1/0;const r=e.findIndex(c=>c!==0);let o=r,a=r;for(t=r;t<256;t++){const c=e[t];c>s&&(t-o>i&&(i=t-o,a=t-1),s=c,o=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t},dk=function(e){const t=e,{width:s,height:i}=e,{maxDim:r}=l(this,Tl);let o=s,a=i;if(s>r||i>r){let p=s,y=i,v=Math.log2(Math.max(s,i)/r);const x=Math.floor(v);v=v===x?x-1:x;for(let w=0;w<v;w++){o=Math.ceil(p/2),a=Math.ceil(y/2);const S=new OffscreenCanvas(o,a);S.getContext("2d").drawImage(e,0,0,p,y,0,0,o,a),p=o,y=a,e!==t&&e.close(),e=S.transferToImageBitmap()}const b=Math.min(r/o,r/a);o=Math.round(o*b),a=Math.round(a*b)}const d=new OffscreenCanvas(o,a).getContext("2d",{willReadFrequently:!0});d.fillStyle="white",d.fillRect(0,0,o,a),d.filter="grayscale(1)",d.drawImage(e,0,0,e.width,e.height,0,0,o,a);const u=d.getImageData(0,0,o,a).data;return[E(this,Me,Qx).call(this,u),o,a]},C(kr,Me),C(kr,Tl,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),C(kr,Gn,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Vb extends ZE{constructor(){super(),super.updateProperties({fill:Ye._defaultLineColor,"stroke-width":0})}clone(){const e=new Vb;return e.updateAll(this),e}}class $b extends o0{constructor(e){super(e),super.updateProperties({stroke:Ye._defaultLineColor,"stroke-width":1})}clone(){const e=new $b(this._viewParameters);return e.updateAll(this),e}}var Bo,Si,Ho,Nl;const Is=class Is extends xg{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});C(this,Bo,!1);C(this,Si,null);C(this,Ho,null);C(this,Nl,null);this._willKeepAspectRatio=!0,_(this,Ho,t.signatureData||null),_(this,Si,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,s){Ye.initialize(t,s),this._defaultDrawingOptions=new Vb,this._defaultDrawnSignatureOptions=new $b(s.viewParameters)}static getDefaultDrawingOptions(t){const s=this._defaultDrawingOptions.clone();return s.updateProperties(t),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return pe(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!l(this,Si)}}static computeTelemetryFinalData(t){const s=t.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,s=this.y),super.render(),this._drawId===null)if(l(this,Ho)){const{lines:r,mustSmooth:o,areContours:a,description:c,uuid:d,heightInPage:u}=l(this,Ho),{rawDims:{pageWidth:m,pageHeight:p},rotation:y}=this.parent.viewport,v=kr.processDrawnLines({lines:r,pageWidth:m,pageHeight:p,rotation:y,innerMargin:Is._INNER_MARGIN,mustSmooth:o,areContours:a});this.addSignature(v,u,c,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:l(this,Si)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,s)),this.div}setUuid(t){_(this,Nl,t),this.addEditToolbar()}getUuid(){return l(this,Nl)}get description(){return l(this,Si)}set description(t){_(this,Si,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:s,thickness:i,width:r,height:o}=l(this,Ho),a=Math.max(r,o),c=kr.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:i,width:r,height:o},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,s,i,r){const{x:o,y:a}=this,{outline:c}=_(this,Ho,t);_(this,Bo,c instanceof Yx),this.description=i;let d;l(this,Bo)?d=Is.getDefaultDrawingOptions():(d=Is._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:d});const[,u]=this.pageDimensions;let m=s/u;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(),this.x=o,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return kr.process(t,s,i,r,Is._INNER_MARGIN)}getFromText(t,s){const{rawDims:{pageWidth:i,pageHeight:r},rotation:o}=this.parent.viewport;return kr.extractContoursFromText(t,s,i,r,o,Is._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:s,pageHeight:i},rotation:r}=this.parent.viewport;return kr.processDrawnLines({lines:t,pageWidth:s,pageHeight:i,rotation:r,innerMargin:Is._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:s}){t?this._drawingOptions=Is.getDefaultDrawingOptions():(this._drawingOptions=Is._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:s,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:l(this,Bo),color:[0,0,0],thickness:l(this,Bo)?0:r});return this.addComment(o),t?(o.paths={lines:s,points:i},o.uuid=l(this,Nl),o.isCopy=!0):o.lines=s,l(this,Si)&&(o.accessibilityData={type:"Figure",alt:l(this,Si)}),o}static deserializeDraw(t,s,i,r,o,a){return a.areContours?Yx.deserialize(t,s,i,r,o,a):Cp.deserialize(t,s,i,r,o,a)}static async deserialize(t,s,i){var o;const r=await super.deserialize(t,s,i);return _(r,Bo,t.areContours),r.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",_(r,Nl,t.uuid),r}};Bo=new WeakMap,Si=new WeakMap,Ho=new WeakMap,Nl=new WeakMap,W(Is,"_type","signature"),W(Is,"_editorType",ge.SIGNATURE),W(Is,"_defaultDrawingOptions",null);let eb=Is;var tt,Ft,Go,wr,qo,Yd,_r,Il,Ci,Ys,Jd,Ie,Ku,Yu,jm,Om,Um,sb,Bm,uk;class tb extends Ye{constructor(t){super({...t,name:"stampEditor"});C(this,Ie);C(this,tt,null);C(this,Ft,null);C(this,Go,null);C(this,wr,null);C(this,qo,null);C(this,Yd,"");C(this,_r,null);C(this,Il,!1);C(this,Ci,null);C(this,Ys,!1);C(this,Jd,!1);_(this,wr,t.bitmapUrl),_(this,qo,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,s){Ye.initialize(t,s)}static isHandlingMimeForPasting(t){return By.includes(t)}static paste(t,s){s.pasteEditor({mode:ge.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const s=t.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(t=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:a}=t||this.copyCanvas(null,null,!0).imageData,c=await i.guess({name:"altText",request:{data:r,width:o,height:a,channels:r.length/(o*a)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const d=c.output;return await this.setGuessedAltText(d),s&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}remove(){var t;l(this,Ft)&&(_(this,tt,null),this._uiManager.imageManager.deleteId(l(this,Ft)),(t=l(this,_r))==null||t.remove(),_(this,_r,null),l(this,Ci)&&(clearTimeout(l(this,Ci)),_(this,Ci,null))),super.remove()}rebuild(){if(!this.parent){l(this,Ft)&&E(this,Ie,jm).call(this);return}super.rebuild(),this.div!==null&&(l(this,Ft)&&l(this,_r)===null&&E(this,Ie,jm).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(l(this,Go)||l(this,tt)||l(this,wr)||l(this,qo)||l(this,Ft)||l(this,Il))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,s;return this._isCopy&&(t=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),l(this,Il)||(l(this,tt)?E(this,Ie,Om).call(this):E(this,Ie,jm).call(this)),this._isCopy&&this._moveAfterPaste(t,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,s){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(_(this,Ft,i),r&&_(this,tt,r),_(this,Il,!1),E(this,Ie,Om).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;l(this,Ci)!==null&&clearTimeout(l(this,Ci)),_(this,Ci,setTimeout(()=>{_(this,Ci,null),E(this,Ie,sb).call(this)},200))}copyCanvas(t,s,i=!1){t||(t=224);const{width:r,height:o}=l(this,tt),a=new Ri;let c=l(this,tt),d=r,u=o,m=null;if(s){if(r>s||o>s){const I=Math.min(s/r,s/o);d=Math.floor(r*I),u=Math.floor(o*I)}m=document.createElement("canvas");const y=m.width=Math.ceil(d*a.sx),v=m.height=Math.ceil(u*a.sy);l(this,Ys)||(c=E(this,Ie,Um).call(this,y,v));const x=m.getContext("2d");x.filter=this._uiManager.hcmFilter;let b="white",w="#cfcfd8";this._uiManager.hcmFilter!=="none"?w="black":Bj.isDarkMode&&(b="#8f8f9d",w="#42414d");const S=15,A=S*a.sx,k=S*a.sy,T=new OffscreenCanvas(A*2,k*2),N=T.getContext("2d");N.fillStyle=b,N.fillRect(0,0,A*2,k*2),N.fillStyle=w,N.fillRect(0,0,A,k),N.fillRect(A,k,A,k),x.fillStyle=x.createPattern(T,"repeat"),x.fillRect(0,0,y,v),x.drawImage(c,0,0,c.width,c.height,0,0,y,v)}let p=null;if(i){let y,v;if(a.symmetric&&c.width<t&&c.height<t)y=c.width,v=c.height;else if(c=l(this,tt),r>t||o>t){const w=Math.min(t/r,t/o);y=Math.floor(r*w),v=Math.floor(o*w),l(this,Ys)||(c=E(this,Ie,Um).call(this,y,v))}const b=new OffscreenCanvas(y,v).getContext("2d",{willReadFrequently:!0});b.drawImage(c,0,0,c.width,c.height,0,0,y,v),p={width:y,height:v,data:b.getImageData(0,0,y,v).data}}return{canvas:m,width:d,height:u,imageData:p}}static async deserialize(t,s,i){var b;let r=null,o=!1;if(t instanceof kE){const{data:{rect:w,rotation:S,id:A,structParent:k,popupRef:T,richText:N,contentsObj:I,creationDate:D,modificationDate:P},container:R,parent:{page:{pageNumber:j}},canvas:$}=t;let B,V;$?(delete t.canvas,{id:B,bitmap:V}=i.imageManager.getFromCanvas(R.id,$),$.remove()):(o=!0,t._hasNoCanvas=!0);const L=((b=await s._structTree.getAriaAttributes(`${lc}${A}`))==null?void 0:b.get("aria-label"))||"";r=t={annotationType:ge.STAMP,bitmapId:B,bitmap:V,pageIndex:j-1,rect:w.slice(0),rotation:S,annotationElementId:A,id:A,deleted:!1,accessibilityData:{decorative:!1,altText:L},isSvg:!1,structParent:k,popupRef:T,richText:N,comment:(I==null?void 0:I.str)||null,creationDate:D,modificationDate:P}}const a=await super.deserialize(t,s,i),{rect:c,bitmap:d,bitmapUrl:u,bitmapId:m,isSvg:p,accessibilityData:y}=t;o?(i.addMissingCanvas(t.id,a),_(a,Il,!0)):m&&i.imageManager.isValidId(m)?(_(a,Ft,m),d&&_(a,tt,d)):_(a,wr,u),_(a,Ys,p);const[v,x]=a.pageDimensions;return a.width=(c[2]-c[0])/v,a.height=(c[3]-c[1])/x,y&&(a.altTextData=y),a._initialData=r,t.comment&&a.setCommentData(t),_(a,Jd,!!r),a}serialize(t=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:l(this,Ft),isSvg:l(this,Ys)});if(this.addComment(i),t)return i.bitmapUrl=E(this,Ie,Bm).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=E(this,Ie,uk).call(this,i);return c.isSame?null:(c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(s===null)return i;s.stamps||(s.stamps=new Map);const a=l(this,Ys)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(l(this,Ft)))s.stamps.set(l(this,Ft),{area:a,serialized:i}),i.bitmap=E(this,Ie,Bm).call(this,!1);else if(l(this,Ys)){const c=s.stamps.get(l(this,Ft));a>c.area&&(c.area=a,c.serialized.bitmap.close(),c.serialized.bitmap=E(this,Ie,Bm).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}tt=new WeakMap,Ft=new WeakMap,Go=new WeakMap,wr=new WeakMap,qo=new WeakMap,Yd=new WeakMap,_r=new WeakMap,Il=new WeakMap,Ci=new WeakMap,Ys=new WeakMap,Jd=new WeakMap,Ie=new WeakSet,Ku=function(t,s=!1){if(!t){this.remove();return}_(this,tt,t.bitmap),s||(_(this,Ft,t.id),_(this,Ys,t.isSvg)),t.file&&_(this,Yd,t.file.name),E(this,Ie,Om).call(this)},Yu=function(){if(_(this,Go,null),this._uiManager.enableWaiting(!1),!!l(this,_r)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,tt)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&l(this,tt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},jm=function(){if(l(this,Ft)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(l(this,Ft)).then(i=>E(this,Ie,Ku).call(this,i,!0)).finally(()=>E(this,Ie,Yu).call(this));return}if(l(this,wr)){const i=l(this,wr);_(this,wr,null),this._uiManager.enableWaiting(!0),_(this,Go,this._uiManager.imageManager.getFromUrl(i).then(r=>E(this,Ie,Ku).call(this,r)).finally(()=>E(this,Ie,Yu).call(this)));return}if(l(this,qo)){const i=l(this,qo);_(this,qo,null),this._uiManager.enableWaiting(!0),_(this,Go,this._uiManager.imageManager.getFromFile(i).then(r=>E(this,Ie,Ku).call(this,r)).finally(()=>E(this,Ie,Yu).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=By.join(",");const s=this._uiManager._signal;_(this,Go,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),E(this,Ie,Ku).call(this,r)}i()},{signal:s}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>E(this,Ie,Yu).call(this))),t.click()},Om=function(){var d;const{div:t}=this;let{width:s,height:i}=l(this,tt);const[r,o]=this.pageDimensions,a=.75;if(this.width)s=this.width*r,i=this.height*o;else if(s>a*r||i>a*o){const u=Math.min(a*r/s,a*o/i);s*=u,i*=u}this._uiManager.enableWaiting(!1);const c=_(this,_r,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=s/r,this.height=i/o,this.setDims(),(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),E(this,Ie,sb).call(this),l(this,Jd)||(this.parent.addUndoableEditor(this),_(this,Jd,!0)),this._reportTelemetry({action:"inserted_image"}),l(this,Yd)&&this.div.setAttribute("aria-description",l(this,Yd)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Um=function(t,s){const{width:i,height:r}=l(this,tt);let o=i,a=r,c=l(this,tt);for(;o>2*t||a>2*s;){const d=o,u=a;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),a>2*s&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const m=new OffscreenCanvas(o,a);m.getContext("2d").drawImage(c,0,0,d,u,0,0,o,a),c=m.transferToImageBitmap()}return c},sb=function(){const[t,s]=this.parentDimensions,{width:i,height:r}=this,o=new Ri,a=Math.ceil(i*t*o.sx),c=Math.ceil(r*s*o.sy),d=l(this,_r);if(!d||d.width===a&&d.height===c)return;d.width=a,d.height=c;const u=l(this,Ys)?l(this,tt):E(this,Ie,Um).call(this,a,c),m=d.getContext("2d");m.filter=this._uiManager.hcmFilter,m.drawImage(u,0,0,u.width,u.height,0,0,a,c)},Bm=function(t){if(t){if(l(this,Ys)){const r=this._uiManager.imageManager.getSvgUrl(l(this,Ft));if(r)return r}const s=document.createElement("canvas");return{width:s.width,height:s.height}=l(this,tt),s.getContext("2d").drawImage(l(this,tt),0,0),s.toDataURL()}if(l(this,Ys)){const[s,i]=this.pageDimensions,r=Math.round(this.width*s*ea.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*ea.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(r,o);return a.getContext("2d").drawImage(l(this,tt),0,0,l(this,tt).width,l(this,tt).height,0,0,r,o),a.transferToImageBitmap()}return structuredClone(l(this,tt))},uk=function(t){var a;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===s,o=(((a=t.accessibilityData)==null?void 0:a.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},W(tb,"_type","stamp"),W(tb,"_editorType",ge.STAMP);var Pl,Xd,Vo,$o,Ar,ks,zo,Qd,Zd,qn,Sr,jt,Cr,Wo,eu,ie,Ko,Ve,ib,hk,Zn,rb,ob,Hm;const Nn=class Nn{constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:a,textLayer:c,viewport:d,l10n:u}){C(this,Ve);C(this,Pl);C(this,Xd,!1);C(this,Vo,null);C(this,$o,null);C(this,Ar,null);C(this,ks,new Map);C(this,zo,!1);C(this,Qd,!1);C(this,Zd,!1);C(this,qn,null);C(this,Sr,null);C(this,jt,null);C(this,Cr,null);C(this,Wo,null);C(this,eu,-1);C(this,ie);const m=[...l(Nn,Ko).values()];if(!Nn._initialized){Nn._initialized=!0;for(const p of m)p.initialize(u,e)}e.registerEditorTypes(m),_(this,ie,e),this.pageIndex=t,this.div=s,_(this,Pl,r),_(this,Vo,o),this.viewport=d,_(this,jt,c),this.drawLayer=a,this._structTree=i,l(this,ie).addLayer(this)}get isEmpty(){return l(this,ks).size===0}get isInvisible(){return this.isEmpty&&l(this,ie).getMode()===ge.NONE}updateToolbar(e){l(this,ie).updateToolbar(e)}updateMode(e=l(this,ie).getMode()){switch(E(this,Ve,Hm).call(this),e){case ge.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ge.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ge.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===ge.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of l(Nn,Ko).values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=l(this,jt))==null?void 0:t.div)}setEditingState(e){l(this,ie).setEditingState(e)}addCommands(e){l(this,ie).addCommands(e)}cleanUndoStack(e){l(this,ie).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=l(this,Vo))==null||t.togglePointerEvents(e)}async enable(){var s;_(this,Zd,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(s=l(this,Wo))==null||s.abort(),_(this,Wo,null);const e=new Set;for(const i of l(this,Ve,ib))i.enableEditing(),i.show(!0),i.annotationElementId&&(l(this,ie).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=l(this,Vo);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),l(this,ie).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}_(this,Zd,!1),l(this,ie)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var i;if(_(this,Qd,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),l(this,jt)&&!l(this,Wo)){_(this,Wo,new AbortController);const r=l(this,ie).combinedSignal(l(this,Wo));l(this,jt).div.addEventListener("pointerdown",o=>{const{clientX:c,clientY:d,timeStamp:u}=o,m=l(this,eu);if(u-m>500){_(this,eu,u);return}_(this,eu,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const y=document.elementsFromPoint(c,d);if(p.toggle("getElements",!1),!this.div.contains(y[0]))return;let v;const x=new RegExp(`^${yh}[0-9]+$`);for(const w of y)if(x.test(w.id)){v=w.id;break}if(!v)return;const b=l(this,ks).get(v);(b==null?void 0:b.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),b.dblclick(o))},{signal:r,capture:!0})}const e=l(this,Vo),t=[];if(e){const r=new Map,o=new Map;for(const c of l(this,Ve,ib)){if(c.disableEditing(),!c.annotationElementId){t.push(c);continue}if(c.serialize()!==null){r.set(c.annotationElementId,c);continue}else o.set(c.annotationElementId,c);(i=this.getEditableAnnotation(c.annotationElementId))==null||i.show(),c.remove()}const a=e.getEditableAnnotations();for(const c of a){const{id:d}=c.data;if(l(this,ie).isDeletedAnnotationElement(d)){c.updateEdited({deleted:!0});continue}let u=o.get(d);if(u){u.resetAnnotationElement(c),u.show(!1),c.show();continue}u=r.get(d),u&&(l(this,ie).addChangedExistingAnnotation(u),u.renderAnnotationElement(c)&&u.show(!1)),c.show()}}E(this,Ve,Hm).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const r of l(Nn,Ko).values())s.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),_(this,Qd,!1)}getEditableAnnotation(e){var t;return((t=l(this,Vo))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){l(this,ie).getActive()!==e&&l(this,ie).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=l(this,jt))!=null&&e.div&&!l(this,Cr)){_(this,Cr,new AbortController);const t=l(this,ie).combinedSignal(l(this,Cr));l(this,jt).div.addEventListener("pointerdown",E(this,Ve,hk).bind(this),{signal:t}),l(this,jt).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=l(this,jt))!=null&&e.div&&l(this,Cr)&&(l(this,Cr).abort(),_(this,Cr,null),l(this,jt).div.classList.remove("highlighting"))}enableClick(){if(l(this,$o))return;_(this,$o,new AbortController);const e=l(this,ie).combinedSignal(l(this,$o));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=l(this,$o))==null||e.abort(),_(this,$o,null)}attach(e){l(this,ks).set(e.id,e);const{annotationElementId:t}=e;t&&l(this,ie).isDeletedAnnotationElement(t)&&l(this,ie).removeDeletedAnnotationElement(e)}detach(e){var t;l(this,ks).delete(e.id),(t=l(this,Pl))==null||t.removePointerInTextLayer(e.contentDiv),!l(this,Qd)&&e.annotationElementId&&l(this,ie).addDeletedAnnotationElement(e)}remove(e){this.detach(e),l(this,ie).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(l(this,ie).addDeletedAnnotationElement(e),Ye.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),l(this,ie).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!l(this,Zd)),l(this,ie).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var s;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!l(this,Ar)&&(e._focusEventsAllowed=!1,_(this,Ar,setTimeout(()=>{_(this,Ar,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:l(this,ie)._signal}),t.focus())},0))),e._structTreeParentId=(s=l(this,Pl))==null?void 0:s.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of l(this,ks).values())if(t.uid===e)return t;return null}getNextId(){return l(this,ie).getId()}combinedSignal(e){return l(this,ie).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=l(this,Ve,Zn))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await l(this,ie).updateMode(e.mode);const{offsetX:s,offsetY:i}=E(this,Ve,ob).call(this),r=this.getNextId(),o=E(this,Ve,rb).call(this,{parent:this,id:r,x:s,y:i,uiManager:l(this,ie),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=l(Nn,Ko).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,l(this,ie)))||null}createAndAddNewEditor(e,t,s={}){const i=this.getNextId(),r=E(this,Ve,rb).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:l(this,ie),isCentered:t,...s});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(E(this,Ve,ob).call(this),!0,e)}setSelected(e){l(this,ie).setSelected(e)}toggleSelected(e){l(this,ie).toggleSelected(e)}unselect(e){l(this,ie).unselect(e)}pointerup(e){var i;const{isMac:t}=Tt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!l(this,zo)||(_(this,zo,!1),(i=l(this,Ve,Zn))!=null&&i.isDrawer&&l(this,Ve,Zn).supportMultipleDrawings))return;if(!l(this,Xd)){_(this,Xd,!0);return}const s=l(this,ie).getMode();if(s===ge.STAMP||s===ge.SIGNATURE){l(this,ie).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(l(this,ie).getMode()===ge.HIGHLIGHT&&this.enableTextSelection(),l(this,zo)){_(this,zo,!1);return}const{isMac:t}=Tt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(_(this,zo,!0),(i=l(this,Ve,Zn))!=null&&i.isDrawer){this.startDrawingSession(e);return}const s=l(this,ie).getActive();_(this,Xd,!s||s.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),l(this,qn)){l(this,Ve,Zn).startDrawing(this,l(this,ie),!1,e);return}l(this,ie).setCurrentDrawingSession(this),_(this,qn,new AbortController);const t=l(this,ie).combinedSignal(l(this,qn));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(_(this,Sr,null),this.commitOrRemove())},{signal:t}),l(this,Ve,Zn).startDrawing(this,l(this,ie),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&_(this,Sr,t);return}l(this,Sr)&&setTimeout(()=>{var t;(t=l(this,Sr))==null||t.focus(),_(this,Sr,null)},0)}endDrawingSession(e=!1){return l(this,qn)?(l(this,ie).setCurrentDrawingSession(null),l(this,qn).abort(),_(this,qn,null),_(this,Sr,null),l(this,Ve,Zn).endDrawing(e)):null}findNewParent(e,t,s){const i=l(this,ie).findParent(t,s);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return l(this,qn)?(this.endDrawingSession(),!0):!1}onScaleChanging(){l(this,qn)&&l(this,Ve,Zn).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=l(this,ie).getActive())==null?void 0:e.parent)===this&&(l(this,ie).commitOrRemove(),l(this,ie).setActiveEditor(null)),l(this,Ar)&&(clearTimeout(l(this,Ar)),_(this,Ar,null));for(const s of l(this,ks).values())(t=l(this,Pl))==null||t.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,l(this,ks).clear(),l(this,ie).removeLayer(this)}render({viewport:e}){this.viewport=e,Ul(this.div,e);for(const t of l(this,ie).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){l(this,ie).commitOrRemove(),E(this,Ve,Hm).call(this);const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Ul(this.div,{rotation:s}),t!==s)for(const i of l(this,ks).values())i.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return l(this,ie).viewParameters.realScale}};Pl=new WeakMap,Xd=new WeakMap,Vo=new WeakMap,$o=new WeakMap,Ar=new WeakMap,ks=new WeakMap,zo=new WeakMap,Qd=new WeakMap,Zd=new WeakMap,qn=new WeakMap,Sr=new WeakMap,jt=new WeakMap,Cr=new WeakMap,Wo=new WeakMap,eu=new WeakMap,ie=new WeakMap,Ko=new WeakMap,Ve=new WeakSet,ib=function(){return l(this,ks).size!==0?l(this,ks).values():l(this,ie).getEditors(this.pageIndex)},hk=function(e){l(this,ie).unselectAll();const{target:t}=e;if(t===l(this,jt).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&l(this,jt).div.contains(t)){const{isMac:s}=Tt.platform;if(e.button!==0||e.ctrlKey&&s)return;l(this,ie).showAllEditors("highlight",!0,!0),l(this,jt).div.classList.add("free"),this.toggleDrawing(),yg.startHighlighting(this,l(this,ie).direction==="ltr",{target:l(this,jt).div,x:e.x,y:e.y}),l(this,jt).div.addEventListener("pointerup",()=>{l(this,jt).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:l(this,ie)._signal}),e.preventDefault()}},Zn=function(){return l(Nn,Ko).get(l(this,ie).getMode())},rb=function(e){const t=l(this,Ve,Zn);return t?new t.prototype.constructor(e):null},ob=function(){const{x:e,y:t,width:s,height:i}=this.boundingClientRect,r=Math.max(0,e),o=Math.max(0,t),a=Math.min(window.innerWidth,e+s),c=Math.min(window.innerHeight,t+i),d=(r+a)/2-e,u=(o+c)/2-t,[m,p]=this.viewport.rotation%180===0?[d,u]:[u,d];return{offsetX:m,offsetY:p}},Hm=function(){for(const e of l(this,ks).values())e.isEmpty()&&e.remove()},W(Nn,"_initialized",!1),C(Nn,Ko,new Map([Ox,Kx,tb,yg,eb].map(e=>[e._editorType,e])));let nb=Nn;var Vn,ds,Rl,mp,jg,fk,Mi,lb,pk,cb;const At=class At{constructor({pageIndex:e}){C(this,Mi);C(this,Vn,null);C(this,ds,new Map);C(this,Rl,new Map);this.pageIndex=e}setParent(e){if(!l(this,Vn)){_(this,Vn,e);return}if(l(this,Vn)!==e){if(l(this,ds).size>0)for(const t of l(this,ds).values())t.remove(),e.append(t);_(this,Vn,e)}}static get _svgFactory(){return pe(this,"_svgFactory",new mg)}draw(e,t=!1,s=!1){const i=ot(At,mp)._++,r=E(this,Mi,lb).call(this),o=At._svgFactory.createElement("defs");r.append(o);const a=At._svgFactory.createElement("path");o.append(a);const c=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",c),a.setAttribute("vector-effect","non-scaling-stroke"),t&&l(this,Rl).set(i,a);const d=s?E(this,Mi,pk).call(this,o,c):null,u=At._svgFactory.createElement("use");return r.append(u),u.setAttribute("href",`#${c}`),this.updateProperties(r,e),l(this,ds).set(i,r),{id:i,clipPathId:`url(#${d})`}}drawOutline(e,t){const s=ot(At,mp)._++,i=E(this,Mi,lb).call(this),r=At._svgFactory.createElement("defs");i.append(r);const o=At._svgFactory.createElement("path");r.append(o);const a=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",a),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const m=At._svgFactory.createElement("mask");r.append(m),c=`mask_p${this.pageIndex}_${s}`,m.setAttribute("id",c),m.setAttribute("maskUnits","objectBoundingBox");const p=At._svgFactory.createElement("rect");m.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const y=At._svgFactory.createElement("use");m.append(y),y.setAttribute("href",`#${a}`),y.setAttribute("stroke","none"),y.setAttribute("fill","black"),y.setAttribute("fill-rule","nonzero"),y.classList.add("mask")}const d=At._svgFactory.createElement("use");i.append(d),d.setAttribute("href",`#${a}`),c&&d.setAttribute("mask",`url(#${c})`);const u=d.cloneNode();return i.append(u),d.classList.add("mainOutline"),u.classList.add("secondaryOutline"),this.updateProperties(i,e),l(this,ds).set(s,i),s}finalizeDraw(e,t){l(this,Rl).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:s,bbox:i,rootClass:r,path:o}=t,a=typeof e=="number"?l(this,ds).get(e):e;if(a){if(s&&E(this,Mi,cb).call(this,a,s),i&&E(c=At,jg,fk).call(c,a,i),r){const{classList:d}=a;for(const[u,m]of Object.entries(r))d.toggle(u,m)}if(o){const u=a.firstElementChild.firstElementChild;E(this,Mi,cb).call(this,u,o)}}}updateParent(e,t){if(t===this)return;const s=l(this,ds).get(e);s&&(l(t,Vn).append(s),l(this,ds).delete(e),l(t,ds).set(e,s))}remove(e){l(this,Rl).delete(e),l(this,Vn)!==null&&(l(this,ds).get(e).remove(),l(this,ds).delete(e))}destroy(){_(this,Vn,null);for(const e of l(this,ds).values())e.remove();l(this,ds).clear(),l(this,Rl).clear()}};Vn=new WeakMap,ds=new WeakMap,Rl=new WeakMap,mp=new WeakMap,jg=new WeakSet,fk=function(e,[t,s,i,r]){const{style:o}=e;o.top=`${100*s}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},Mi=new WeakSet,lb=function(){const e=At._svgFactory.create(1,1,!0);return l(this,Vn).append(e),e.setAttribute("aria-hidden",!0),e},pk=function(e,t){const s=At._svgFactory.createElement("clipPath");e.append(s);const i=`clip_${t}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const r=At._svgFactory.createElement("use");return s.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},cb=function(e,t){for(const[s,i]of Object.entries(t))i===null?e.removeAttribute(s):e.setAttribute(s,i)},C(At,jg),C(At,mp,0);let ab=At;globalThis._pdfjsTestingUtils={HighlightOutliner:Bx};globalThis.pdfjsLib={AbortException:Zo,AnnotationEditorLayer:nb,AnnotationEditorParamsType:Ee,AnnotationEditorType:ge,AnnotationEditorUIManager:Bl,AnnotationLayer:Fx,AnnotationMode:Xr,AnnotationType:xt,applyOpacity:Gj,build:J4,ColorPicker:fg,createValidAbsoluteUrl:iC,CSSConstants:Hj,DOMSVGFactory:mg,DrawLayer:ab,FeatureTest:Tt,fetchData:vp,findContrastColor:qj,getDocument:hE,getFilenameFromUrl:Lj,getPdfFilenameFromUrl:Fj,getRGB:_p,getUuid:aC,getXfaPageViewport:Oj,GlobalWorkerOptions:ki,ImageKind:lm,InvalidPDFException:Oy,isDataScheme:i0,isPdfFile:Ob,isValidExplicitDest:e4,MathClamp:fs,noContextMenu:Sn,normalizeUnicode:Rj,OPS:xh,OutputScale:Ri,PasswordResponses:Aj,PDFDataRangeTransport:fE,PDFDateString:ag,PDFWorker:wh,PermissionFlag:_j,PixelsPerInch:ea,RenderingCancelledException:jb,renderRichText:dC,ResponseException:og,setLayerDimensions:Ul,shadow:pe,SignatureExtractor:kr,stopEvent:ft,SupportedImageMimeTypes:By,TextLayer:vh,TouchManager:cg,updateUrlHash:rC,Util:Z,VerbosityLevel:t0,version:Y4,XfaLayer:cC};ki.workerSrc="https://unpkg.com/pdfjs-dist@5.4.530/build/pdf.worker.min.mjs";const V_=({tasks:n,view:e})=>{const t=Xe(M=>M.geminiApiKey),s=Xe(M=>M.portfolioHistory),i=Xe(M=>M.currentSeasonId),r=Xe(M=>M.addPortfolioEntry),o=Xe(M=>M.deletePortfolioEntry),a=s.filter(M=>!M.seasonId||M.seasonId===i),{isOnline:c}=ZA(),[d,u]=F.useState(""),[m,p]=F.useState([]),[y,v]=F.useState(!1),[x,b]=F.useState(null),[w,S]=F.useState("done"),[A,k]=F.useState(null),[T,N]=F.useState(""),[I,D]=F.useState([]),[P,R]=F.useState(!1),[j,$]=F.useState(null),B=async()=>{v(!0),k(null);const M=w==="done"?n.filter(O=>O.status==="Done"):n;try{const O=await vj(M,t||void 0);u(O),r(O,M.length)}catch{alert("Error generating portfolio. Please check your API Key configuration in Coaches Portal.")}finally{v(!1)}},V=M=>{u(M.content),k(M.id)},L=(M,O)=>{M.stopPropagation(),$(O)},U=()=>{j&&(o(j),A===j&&(u(""),k(null)),$(null))},H=M=>new Date(M).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),J=()=>{const M=I.map(O=>`--- ${O.name} ---
${O.content}`).join(`

`);return[T,M].filter(Boolean).join(`

`)},Y=async()=>{v(!0);try{const M=d||"We built a great robot that has a high scoring autonomous and durable drivetrain.",O=J(),q=await wj(M,O,t||void 0);q&&q.length>0?p(q):p([{question:"Describe your robot's drivetrain.",answer:"We use a mecanum drivetrain for omnidirectional movement."},{question:"What was your biggest challenge?",answer:"Our biggest challenge was consistent intake, which we solved with a compliant wheel system."},{question:"How did you use sensors?",answer:"We use odometry pods for precise localization during autonomous."}])}catch{alert("Error generating questions. Showing demo questions instead."),p([{question:"Describe your robot's drivetrain.",answer:"We use a mecanum drivetrain for omnidirectional movement."},{question:"What was your biggest challenge?",answer:"Our biggest challenge was consistent intake, which we solved with a compliant wheel system."}])}finally{v(!1)}},re=async M=>{try{const O=await M.arrayBuffer(),q=await hE({data:O}).promise;let le="";for(let Se=1;Se<=q.numPages;Se++){const ue=(await(await q.getPage(Se)).getTextContent()).items.map(Te=>Te.str).join(" ");le+=ue+`
`}return le.trim()}catch(O){throw console.error("PDF extraction error:",O),new Error("Failed to extract text from PDF")}},xe=async M=>{var q;const O=(q=M.target.files)==null?void 0:q[0];if(O){if(I.some(le=>le.name===O.name)){alert("This file has already been uploaded."),M.target.value="";return}R(!0);try{let le="";if(O.name.endsWith(".pdf"))le=await re(O);else if(O.name.endsWith(".txt"))le=await O.text();else{alert("Please upload a PDF or TXT file.");return}D(Se=>[...Se,{name:O.name,content:le}])}catch(le){console.error("Error reading file:",le),alert("Error reading file. Please try again.")}finally{R(!1),M.target.value=""}}},_e=M=>{D(O=>O.filter(q=>q.name!==M))};return h.jsxs("div",{className:"h-full flex flex-col p-2 md:p-6 max-w-5xl mx-auto w-full overflow-y-auto",children:[h.jsxs("div",{className:"flex-1",children:[e==="portfolio"&&h.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 md:gap-6 h-full",children:[h.jsxs("div",{className:"md:col-span-1 space-y-4",children:[h.jsxs("div",{className:"bg-orange-50 dark:bg-slate-800 p-3 md:p-4 rounded-xl border border-orange-100 dark:border-slate-700",children:[h.jsx("h3",{className:"font-bold text-orange-900 dark:text-orange-400 mb-2",children:"Portfolio Helper"}),h.jsx("p",{className:"text-sm text-orange-800/80 dark:text-slate-300 mb-4",children:"The AI analyzes your tasks to create a summary of your season's technical achievements."}),h.jsxs("div",{className:"mb-4",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-2",children:"Include Tasks"}),h.jsxs("div",{className:"flex bg-white dark:bg-slate-900 rounded-lg p-1 border border-orange-100 dark:border-slate-600",children:[h.jsx("button",{onClick:()=>S("done"),className:`flex-1 py-1 text-xs font-medium rounded transition ${w==="done"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,children:"Completed Only"}),h.jsx("button",{onClick:()=>S("all"),className:`flex-1 py-1 text-xs font-medium rounded transition ${w==="all"?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"text-slate-500 dark:text-slate-400"}`,children:"All Tasks"})]})]}),h.jsxs("div",{className:"text-xs text-orange-800/60 dark:text-slate-400 font-mono bg-white/50 dark:bg-slate-900/50 p-2 rounded mb-4",children:["Tasks Analyzed: ",w==="done"?n.filter(M=>M.status==="Done").length:n.length]}),h.jsxs("button",{onClick:B,disabled:y||!c,className:"w-full bg-orange-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-orange-700 transition flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[y?h.jsx(Wt,{className:"animate-spin",size:18}):c?h.jsx(Zm,{size:18}):h.jsx(Xm,{size:18}),c?"Generate Summary":"Offline - AI Disabled"]}),!c&&h.jsx("p",{className:"text-[10px] text-center text-slate-500 mt-2",children:"Connecting to internet will enable AI features."})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 md:p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:[h.jsxs("h3",{className:"font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2 text-sm",children:[h.jsx(ru,{size:16})," History"]}),a.length===0?h.jsx("p",{className:"text-xs text-slate-400 italic",children:"No saved summaries yet."}):h.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:a.map(M=>h.jsx("div",{onClick:()=>V(M),className:`p-2 rounded-lg cursor-pointer transition text-sm border ${A===M.id?"bg-orange-100 dark:bg-orange-900/30 border-orange-300 dark:border-orange-700":"bg-slate-50 dark:bg-slate-900 border-slate-100 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800"}`,children:h.jsxs("div",{className:"flex justify-between items-start gap-2",children:[h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:H(M.createdAt)}),h.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 truncate",children:[M.taskCount," tasks"]})]}),h.jsx("button",{onClick:O=>L(O,M.id),className:"text-slate-400 hover:text-red-500 transition p-1 shrink-0",children:h.jsx(Ni,{size:14})})]})},M.id))})]})]}),h.jsxs("div",{className:"md:col-span-3 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 md:p-6 h-full flex flex-col",children:[h.jsxs("div",{className:"flex justify-between items-center mb-4",children:[h.jsx("h3",{className:"font-bold text-slate-800 dark:text-white",children:"Generated Content"}),d&&h.jsxs("button",{className:"text-xs flex items-center gap-1 text-slate-500 dark:text-slate-400 hover:text-slate-900",children:[h.jsx(U1,{size:14})," Copy MD"]})]}),h.jsx("div",{className:"flex-1 bg-slate-50 dark:bg-slate-900 rounded-lg p-4 font-mono text-sm text-slate-700 dark:text-slate-300 overflow-y-auto whitespace-pre-wrap leading-relaxed border border-slate-100 dark:border-slate-700",children:d||h.jsx("span",{className:"text-slate-400 italic",children:"Content will appear here..."})})]})]}),e==="judging"&&h.jsxs("div",{className:"flex flex-col",children:[h.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-6",children:"Judging Prep"}),h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 md:p-6 rounded-xl border border-slate-200 dark:border-slate-700",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"Study Guide & Context"}),h.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-4",children:"Upload PDF or TXT files, or add manual notes to help the AI generate better practice questions."}),h.jsxs("div",{className:"mb-4",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-2",children:"Additional Notes"}),h.jsx("textarea",{className:"w-full h-24 p-3 text-sm border rounded-lg bg-slate-50 dark:bg-slate-900 border-slate-300 dark:border-slate-600 text-slate-900 dark:text-white resize-none",placeholder:"Add any extra context, robot specs, or outreach details here...",value:T,onChange:M=>N(M.target.value)})]}),h.jsxs("div",{className:"mb-4",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase block mb-2",children:"Included Files"}),I.length===0?h.jsx("p",{className:"text-xs text-slate-400 italic mb-2",children:"No files uploaded yet."}):h.jsx("div",{className:"space-y-2 mb-3",children:I.map(M=>h.jsxs("div",{className:"flex items-center justify-between bg-slate-100 dark:bg-slate-700 rounded-lg px-3 py-2",children:[h.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[h.jsx(G1,{size:16,className:"text-orange-500 shrink-0"}),h.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-200 truncate",children:M.name}),h.jsxs("span",{className:"text-xs text-slate-400",children:["(",(M.content.length/1e3).toFixed(1),"k chars)"]})]}),h.jsx("button",{onClick:()=>_e(M.name),className:"text-slate-400 hover:text-red-500 transition p-1 shrink-0",children:h.jsx(Pi,{size:16})})]},M.name))}),h.jsx("div",{className:"flex items-center gap-3",children:h.jsxs("label",{className:"flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg cursor-pointer transition",children:[h.jsx("input",{type:"file",onChange:xe,className:"hidden",accept:".pdf,.txt",disabled:P}),P?h.jsx(Wt,{size:16,className:"animate-spin text-slate-500"}):h.jsx(R1,{size:16,className:"text-slate-500"}),h.jsx("span",{className:"text-sm font-medium text-slate-600 dark:text-slate-300",children:P?"Processing...":"Upload PDF or TXT"})]})})]}),h.jsxs("div",{className:"flex justify-center flex-col items-center gap-2 pt-4 mt-2 border-t border-slate-200 dark:border-slate-700",children:[h.jsxs("button",{onClick:Y,disabled:y||!c,className:"bg-orange-600 text-white py-2 px-6 rounded-lg text-sm font-medium hover:bg-orange-700 transition flex items-center gap-2 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[y?h.jsx(Wt,{className:"animate-spin",size:16}):c?h.jsx(Zm,{size:16}):h.jsx(Xm,{size:16}),c?"Generate Questions":"Offline - AI Disabled"]}),!c&&h.jsx("p",{className:"text-[10px] text-slate-500",children:"AI generation requires an internet connection."})]})]}),h.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 md:gap-6 pb-4 md:pb-6",children:[m.length===0&&!y&&h.jsx("div",{className:"col-span-full text-center py-10 text-slate-400 italic",children:"No flashcards yet. Add context and click Generate."}),m.map((M,O)=>h.jsx("div",{className:"h-64 perspective-1000 cursor-pointer group",onClick:()=>b(x===O?null:O),children:h.jsxs("div",{className:`relative w-full h-full transition-all duration-500 transform-style-3d ${x===O?"rotate-y-180":""}`,children:[h.jsxs("div",{className:"absolute w-full h-full bg-white dark:bg-slate-800 rounded-xl border-2 border-slate-200 dark:border-slate-700 p-6 flex flex-col items-center justify-center text-center backface-hidden shadow-sm group-hover:border-orange-200 dark:group-hover:border-slate-500",children:[h.jsxs("span",{className:"text-xs uppercase font-bold text-orange-600 dark:text-orange-400 mb-2",children:["Question ",O+1]}),h.jsx("div",{className:"max-h-full overflow-y-auto custom-scrollbar pr-1",children:h.jsx("p",{className:"font-medium text-slate-800 dark:text-slate-100 select-none break-words",children:M.question})}),h.jsxs("div",{className:"mt-4 text-xs text-slate-400 flex items-center gap-1 shrink-0",children:["Click to reveal answer ",h.jsx(Nr,{size:12})]})]}),h.jsxs("div",{className:"absolute w-full h-full bg-slate-800 dark:bg-slate-900 rounded-xl p-6 flex flex-col items-center justify-center text-center backface-hidden rotate-y-180 shadow-xl border border-slate-700",children:[h.jsx("span",{className:"text-xs uppercase font-bold text-slate-400 mb-2",children:"Suggested Answer"}),h.jsx("div",{className:"max-h-full overflow-y-auto custom-scrollbar pr-1",children:h.jsx("p",{className:"text-slate-200 dark:text-slate-300 text-sm leading-relaxed select-none break-words",children:M.answer})})]})]})},O))]})]})]})]}),j&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-sm w-full shadow-2xl",children:[h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white mb-2",children:"Delete History Entry?"}),h.jsx("p",{className:"text-slate-600 dark:text-slate-300 mb-6",children:"This portfolio summary will be permanently deleted. This action cannot be undone."}),h.jsxs("div",{className:"flex justify-end gap-3",children:[h.jsx("button",{onClick:()=>$(null),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition",children:"Cancel"}),h.jsx("button",{onClick:U,className:"px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition",children:"Delete"})]})]})})]})},M0={owner:"Owner",coach:"Coach",mentor:"Mentor",student:"Student"},D0={owner:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",coach:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",mentor:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300",student:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300"};function vO(){const{currentOrganization:n,isAdmin:e,isOwner:t,refreshOrganizations:s}=Br(),{user:i}=Cn(),[r,o]=F.useState([]),[a,c]=F.useState([]),[d,u]=F.useState(!0),[m,p]=F.useState(null),[y,v]=F.useState(null),[x,b]=F.useState(!1),[w,S]=F.useState("student"),[A,k]=F.useState(null),[T,N]=F.useState(7),[I,D]=F.useState(!1),[P,R]=F.useState(null),[j,$]=F.useState(!1),[B,V]=F.useState(""),[L,U]=F.useState(""),[H,J]=F.useState(!1),[Y,re]=F.useState(!1),[xe,_e]=F.useState(""),[M,O]=F.useState(!1),[q,le]=F.useState([]),[Se,En]=F.useState([]),[K,ue]=F.useState(!1),[Te,tn]=F.useState(!1);F.useEffect(()=>{!n||!z||Nt()},[n]);const Nt=async()=>{if(!(!n||!z)){u(!0),p(null);try{const G=z,{data:oe,error:be}=await G.from("organization_members").select("*").eq("organization_id",n.id).in("status",["pending","approved","suspended"]);if(be)throw be;const pt=[...new Set((oe||[]).map(kn=>kn.user_id))];let qr={};if(pt.length>0){const{data:kn,error:Ep}=await G.from("users").select("id, email, full_name").in("id",pt);!Ep&&kn&&(qr=Object.fromEntries(kn.map(kp=>[kp.id,kp])))}const Ek=(oe||[]).map(kn=>({...kn,user:qr[kn.user_id]||null}));if(o(Ek),e){const{data:kn,error:Ep}=await G.from("organization_invites").select("*").eq("organization_id",n.id).eq("active",!0);if(Ep)throw Ep;c(kn||[]);const{data:kp}=await G.from("ownership_transfer_requests").select("*").eq("organization_id",n.id).eq("from_user_id",i==null?void 0:i.id).eq("status","pending");le(kp||[])}if(i){const{data:kn}=await G.from("ownership_transfer_requests").select("*, organization:organizations(id, name, team_number)").eq("to_user_id",i.id).eq("status","pending");En(kn||[])}}catch(G){console.error("Error loading team data:",G),p(G.message||"Failed to load team data")}finally{u(!1)}}},zl=async G=>{if(!(!z||!i||!n))try{const oe=z,{error:be}=await oe.from("organization_members").update({status:"approved",approved_at:new Date().toISOString(),approved_by:i.id}).eq("id",G).eq("organization_id",n.id);if(be)throw be;await Nt()}catch(oe){console.error("Error approving member:",oe),p(oe.message)}},Qb=async(G,oe)=>{if(!(!z||!i||!n))try{const be=z,{error:pt}=await be.from("organization_members").update({status:"removed",removed_at:new Date().toISOString(),removed_by:i.id,removal_reason:oe||null}).eq("id",G).eq("organization_id",n.id);if(pt)throw pt;await Nt()}catch(be){console.error("Error removing member:",be),p(be.message)}},yk=async(G,oe)=>{if(!(!z||!n))try{const be=z,{error:pt}=await be.from("organization_members").update({role:oe}).eq("id",G).eq("organization_id",n.id);if(pt)throw pt;await Nt()}catch(be){console.error("Error updating role:",be),p(be.message)}},xk=async()=>{if(!(!z||!i||!n)){D(!0),p(null);try{const G=z,oe=Math.random().toString(36).substring(2,8).toUpperCase();let be=null;if(T){const qr=new Date;qr.setDate(qr.getDate()+T),be=qr.toISOString()}const{error:pt}=await G.from("organization_invites").insert({organization_id:n.id,invite_code:oe,created_by:i.id,default_role:w,max_uses:A,expires_at:be,active:!0});if(pt)throw pt;await Nt(),b(!1)}catch(G){console.error("Error creating invite:",G),p(G.message)}finally{D(!1)}}},bk=async G=>{if(!(!z||!n))try{const oe=z,{error:be}=await oe.from("organization_invites").update({active:!1}).eq("id",G).eq("organization_id",n.id);if(be)throw be;await Nt()}catch(oe){console.error("Error deactivating invite:",oe),p(oe.message)}},vk=(G,oe)=>{const be=`${window.location.origin}/#/join/${G}`;navigator.clipboard.writeText(be),R(oe),setTimeout(()=>R(null),2e3)},wk=async()=>{if(!(!z||!n)){J(!0),p(null);try{const G=z,{error:oe}=await G.from("organizations").update({name:B,team_number:L||null}).eq("id",n.id);if(oe)throw oe;v("Organization updated successfully"),$(!1),await s(),setTimeout(()=>v(null),3e3)}catch(G){console.error("Error updating organization:",G),p(G.message)}finally{J(!1)}}},_k=async()=>{if(!(!z||!i||!n||!xe)){O(!0),p(null);try{const G=z,{error:oe}=await G.from("ownership_transfer_requests").insert({organization_id:n.id,from_user_id:i.id,to_user_id:xe,status:"pending"});if(oe)throw oe;v("Transfer request sent"),re(!1),_e(""),await Nt(),setTimeout(()=>v(null),3e3)}catch(G){console.error("Error creating transfer:",G),p(G.message)}finally{O(!1)}}},Ak=async G=>{if(!(!z||!K)){tn(!0),p(null);try{const oe=z,{error:be}=await oe.rpc("accept_ownership_transfer",{transfer_id:G,acknowledge_billing:!0});if(be)throw be;v("Ownership transferred successfully!"),ue(!1),await s(),await Nt(),setTimeout(()=>v(null),3e3)}catch(oe){console.error("Error accepting transfer:",oe),p(oe.message)}finally{tn(!1)}}},Sk=async G=>{if(z)try{await z.from("ownership_transfer_requests").update({status:"declined"}).eq("id",G),await Nt()}catch(oe){console.error("Error declining transfer:",oe),p(oe.message)}},Ck=async G=>{if(z)try{await z.from("ownership_transfer_requests").update({status:"cancelled"}).eq("id",G),await Nt()}catch(oe){console.error("Error canceling transfer:",oe),p(oe.message)}};if(!n)return h.jsx("div",{className:"p-6 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:h.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No organization selected"})});const a0=r.filter(G=>G.status==="pending"),fu=r.filter(G=>G.status==="approved");return h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center",children:h.jsx(yc,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),h.jsxs("div",{children:[h.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:n.name}),n.team_number&&h.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:["Team #",n.team_number]})]})]}),h.jsx("button",{onClick:Nt,disabled:d,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:h.jsx(zg,{className:`w-5 h-5 ${d?"animate-spin":""}`})})]}),m&&h.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 flex items-start gap-3",children:[h.jsx(Wg,{className:"w-5 h-5 text-red-500 flex-shrink-0 mt-0.5"}),h.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:m})]}),y&&h.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4 flex items-start gap-3",children:[h.jsx(Ei,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),h.jsx("p",{className:"text-green-700 dark:text-green-300 text-sm",children:y})]}),Se.length>0&&h.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-xl p-4",children:[h.jsxs("h3",{className:"text-purple-800 dark:text-purple-200 font-semibold mb-3 flex items-center gap-2",children:[h.jsx(rm,{className:"w-5 h-5"}),"Incoming Ownership Transfer"]}),Se.map(G=>{var oe,be;return h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 space-y-3",children:[h.jsxs("p",{className:"text-slate-700 dark:text-slate-300",children:["You've been invited to become the owner of"," ",h.jsx("strong",{children:(oe=G.organization)==null?void 0:oe.name}),((be=G.organization)==null?void 0:be.team_number)&&` (Team #${G.organization.team_number})`]}),h.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg p-3",children:h.jsxs("div",{className:"flex items-start gap-2",children:[h.jsx($g,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"text-amber-800 dark:text-amber-200 text-sm font-medium",children:"Billing Responsibility"}),h.jsx("p",{className:"text-amber-700 dark:text-amber-300 text-sm mt-1",children:"By accepting ownership, you will be responsible for all future billing charges for this team's subscription."})]})]})}),h.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[h.jsx("input",{type:"checkbox",checked:K,onChange:pt=>ue(pt.target.checked),className:"w-4 h-4 rounded border-slate-300 text-orange-500 focus:ring-orange-500"}),h.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"I acknowledge I will be responsible for future billing"})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs("button",{onClick:()=>Ak(G.id),disabled:!K||Te,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg disabled:opacity-50",children:[Te?h.jsx(Wt,{className:"w-4 h-4 animate-spin"}):h.jsx(Ei,{className:"w-4 h-4"}),"Accept Ownership"]}),h.jsx("button",{onClick:()=>Sk(G.id),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600",children:"Decline"})]})]},G.id)})]}),e&&h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden",children:[h.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[h.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(pI,{className:"w-5 h-5 text-slate-500"}),"Organization Settings"]}),!j&&h.jsx("button",{onClick:()=>{V(n.name),U(n.team_number||""),$(!0)},className:"text-sm text-orange-500 hover:text-orange-600 font-medium",children:"Edit"})]}),j?h.jsxs("div",{className:"p-4 space-y-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Team Name"}),h.jsx("input",{type:"text",value:B,onChange:G=>V(G.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Team Number"}),h.jsx("input",{type:"text",value:L,onChange:G=>U(G.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg",placeholder:"Optional"})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("button",{onClick:()=>$(!1),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg",children:"Cancel"}),h.jsxs("button",{onClick:wk,disabled:H||!B.trim(),className:"flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg disabled:opacity-50",children:[H?h.jsx(Wt,{className:"w-4 h-4 animate-spin"}):h.jsx(Ei,{className:"w-4 h-4"}),"Save"]})]})]}):h.jsxs("div",{className:"p-4 text-sm text-slate-600 dark:text-slate-400",children:[h.jsxs("p",{children:[h.jsx("strong",{children:"Name:"})," ",n.name]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Team Number:"})," ",n.team_number||"Not set"]})]})]}),t&&h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden",children:[h.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:h.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(rm,{className:"w-5 h-5 text-slate-500"}),"Transfer Ownership"]})}),q.length>0?h.jsxs("div",{className:"p-4",children:[h.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm mb-3",children:"You have a pending transfer request. Waiting for the new owner to accept."}),q.map(G=>{var oe,be;return h.jsxs("div",{className:"flex items-center justify-between bg-slate-50 dark:bg-slate-700 rounded-lg p-3",children:[h.jsxs("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:["Transfer to: ",((be=(oe=r.find(pt=>pt.user_id===G.to_user_id))==null?void 0:oe.user)==null?void 0:be.full_name)||G.to_user_id]}),h.jsx("button",{onClick:()=>Ck(G.id),className:"text-sm text-red-500 hover:text-red-600",children:"Cancel"})]},G.id)})]}):Y?h.jsxs("div",{className:"p-4 space-y-4",children:[h.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg p-3",children:h.jsxs("p",{className:"text-amber-800 dark:text-amber-200 text-sm",children:[h.jsx("strong",{children:"Warning:"})," Transferring ownership will make the selected coach responsible for all billing."]})}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Select New Owner"}),h.jsxs("select",{value:xe,onChange:G=>_e(G.target.value),className:"w-full px-3 py-2 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg",children:[h.jsx("option",{value:"",children:"Select a coach..."}),fu.filter(G=>G.role==="coach"&&G.user_id!==(i==null?void 0:i.id)).map(G=>{var oe,be;return h.jsx("option",{value:G.user_id,children:((oe=G.user)==null?void 0:oe.full_name)||((be=G.user)==null?void 0:be.email)||G.user_id},G.user_id)})]}),fu.filter(G=>G.role==="coach"&&G.user_id!==(i==null?void 0:i.id)).length===0&&h.jsx("p",{className:"text-slate-500 text-xs mt-1",children:"No other coaches available. Promote a member to coach first."})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsx("button",{onClick:()=>re(!1),className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg",children:"Cancel"}),h.jsxs("button",{onClick:_k,disabled:M||!xe,className:"flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg disabled:opacity-50",children:[M?h.jsx(Wt,{className:"w-4 h-4 animate-spin"}):h.jsx(rm,{className:"w-4 h-4"}),"Send Transfer Request"]})]})]}):h.jsxs("div",{className:"p-4",children:[h.jsx("p",{className:"text-slate-600 dark:text-slate-400 text-sm mb-3",children:"Transfer ownership of this team to another coach."}),h.jsx("button",{onClick:()=>re(!0),className:"text-sm text-orange-500 hover:text-orange-600 font-medium",children:"Initiate Transfer"})]})]}),e&&a0.length>0&&h.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4",children:[h.jsxs("h3",{className:"text-amber-800 dark:text-amber-200 font-semibold mb-3 flex items-center gap-2",children:[h.jsx(ru,{className:"w-5 h-5"}),"Pending Approvals (",a0.length,")"]}),h.jsx("div",{className:"space-y-2",children:a0.map(G=>{var oe,be,pt;return h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-3 flex items-center justify-between",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center",children:h.jsx(Rr,{className:"w-5 h-5 text-slate-500"})}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-slate-900 dark:text-white",children:((oe=G.user)==null?void 0:oe.full_name)||((be=G.user)==null?void 0:be.email)||"Unknown"}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:(pt=G.user)==null?void 0:pt.email})]}),h.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${D0[G.role]}`,children:M0[G.role]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:()=>zl(G.id),className:"p-2 bg-green-100 hover:bg-green-200 dark:bg-green-900/30 dark:hover:bg-green-900/50 text-green-600 dark:text-green-400 rounded-lg",title:"Approve",children:h.jsx(Ei,{className:"w-4 h-4"})}),h.jsx("button",{onClick:()=>Qb(G.id,"Request denied"),className:"p-2 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 rounded-lg",title:"Deny",children:h.jsx(Pi,{className:"w-4 h-4"})})]})]},G.id)})})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden",children:[h.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:h.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(Ii,{className:"w-5 h-5 text-slate-500"}),"Team Members (",fu.length,")"]})}),d?h.jsx("div",{className:"p-8 flex items-center justify-center",children:h.jsx(Wt,{className:"w-6 h-6 animate-spin text-slate-400"})}):fu.length===0?h.jsx("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:"No team members yet"}):h.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:fu.map(G=>{var oe,be,pt;return h.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700/50",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx("div",{className:"w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-full flex items-center justify-center",children:G.role==="owner"||G.role==="coach"?h.jsx(ou,{className:"w-5 h-5 text-orange-500"}):G.role==="mentor"?h.jsx(yy,{className:"w-5 h-5 text-blue-500"}):h.jsx(Rr,{className:"w-5 h-5 text-slate-500"})}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-medium text-slate-900 dark:text-white",children:[((oe=G.user)==null?void 0:oe.full_name)||((be=G.user)==null?void 0:be.email)||"Unknown",G.user_id===(i==null?void 0:i.id)&&h.jsx("span",{className:"ml-2 text-xs text-slate-500",children:"(you)"})]}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:(pt=G.user)==null?void 0:pt.email})]})]}),h.jsx("div",{className:"flex items-center gap-3",children:e&&G.role!=="owner"&&G.user_id!==(i==null?void 0:i.id)?h.jsxs(h.Fragment,{children:[h.jsxs("select",{value:G.role,onChange:qr=>yk(G.id,qr.target.value),className:"text-sm bg-slate-100 dark:bg-slate-700 border-none rounded-lg px-2 py-1",children:[h.jsx("option",{value:"coach",children:"Coach"}),h.jsx("option",{value:"mentor",children:"Mentor"}),h.jsx("option",{value:"student",children:"Student"})]}),h.jsx("button",{onClick:()=>Qb(G.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Remove member",children:h.jsx(BI,{className:"w-4 h-4"})})]}):h.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${D0[G.role]}`,children:M0[G.role]})})]},G.id)})})]}),e&&h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl overflow-hidden",children:[h.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[h.jsxs("h3",{className:"font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(X1,{className:"w-5 h-5 text-slate-500"}),"Invite Links"]}),h.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-1 text-sm bg-orange-500 hover:bg-orange-600 text-white px-3 py-1.5 rounded-lg",children:[h.jsx(wy,{className:"w-4 h-4"}),"Create Invite"]})]}),x&&h.jsxs("div",{className:"p-4 bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700",children:[h.jsxs("div",{className:"grid sm:grid-cols-3 gap-4",children:[h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Default Role"}),h.jsxs("select",{value:w,onChange:G=>S(G.target.value),className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-2",children:[h.jsx("option",{value:"student",children:"Student"}),h.jsx("option",{value:"mentor",children:"Mentor"})]})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Max Uses"}),h.jsx("input",{type:"number",value:A||"",onChange:G=>k(G.target.value?parseInt(G.target.value):null),placeholder:"Unlimited",className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-2"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Expires In (days)"}),h.jsx("input",{type:"number",value:T||"",onChange:G=>N(G.target.value?parseInt(G.target.value):null),placeholder:"Never",className:"w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-2"})]})]}),h.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[h.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:"Cancel"}),h.jsxs("button",{onClick:xk,disabled:I,className:"flex items-center gap-2 px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded-lg disabled:opacity-50",children:[I?h.jsx(Wt,{className:"w-4 h-4 animate-spin"}):h.jsx(Ei,{className:"w-4 h-4"}),"Create"]})]})]}),a.length===0?h.jsx("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:"No active invite links"}):h.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:a.map(G=>h.jsxs("div",{className:"p-4 flex items-center justify-between",children:[h.jsxs("div",{children:[h.jsx("code",{className:"text-lg font-mono font-bold text-orange-600 dark:text-orange-400",children:G.invite_code}),h.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-slate-500 dark:text-slate-400",children:[h.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${D0[G.default_role]}`,children:M0[G.default_role]}),h.jsxs("span",{children:[G.use_count," / ",G.max_uses||"â"," uses"]}),G.expires_at&&h.jsxs("span",{children:["Expires: ",new Date(G.expires_at).toLocaleDateString()]})]})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("button",{onClick:()=>vk(G.invite_code,G.id),className:"flex items-center gap-1 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg text-sm",children:P===G.id?h.jsxs(h.Fragment,{children:[h.jsx(Ei,{className:"w-4 h-4 text-green-500"}),"Copied!"]}):h.jsxs(h.Fragment,{children:[h.jsx(F1,{className:"w-4 h-4"}),"Copy Link"]})}),h.jsx("button",{onClick:()=>bk(G.id),className:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",title:"Deactivate",children:h.jsx(Pi,{className:"w-4 h-4"})})]})]},G.id))})]})]})}function wO(){const{currentOrganization:n,isOwner:e}=Br();if(!n)return null;const t={status:n.billing_status||"trialing",trialEndsAt:n.trial_ends_at?new Date(n.trial_ends_at):new Date(Date.now()+14*24*60*60*1e3),memberCount:5,pricePerMember:2.99},s=Math.max(0,Math.ceil((t.trialEndsAt.getTime()-Date.now())/(1e3*60*60*24)));return h.jsxs("div",{className:"space-y-6",children:[h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-xl flex items-center justify-center",children:h.jsx(Iv,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"font-bold text-slate-900 dark:text-white",children:"Billing & Subscription"}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Manage your team's subscription"})]})]}),t.status==="trialing"&&h.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx($g,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-medium text-blue-700 dark:text-blue-300",children:["Free Trial - ",s," days remaining"]}),h.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:"Your trial includes full access to all features. Add a payment method to continue after your trial ends."})]})]})}),t.status==="active"&&h.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4 mb-4",children:h.jsxs("div",{className:"flex items-start gap-3",children:[h.jsx(S1,{className:"w-5 h-5 text-green-500 flex-shrink-0 mt-0.5"}),h.jsxs("div",{children:[h.jsx("p",{className:"font-medium text-green-700 dark:text-green-300",children:"Subscription Active"}),h.jsx("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:"Your team has full access to all features."})]})]})}),h.jsxs("div",{className:"grid sm:grid-cols-2 gap-4 mb-6",children:[h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4",children:[h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Team Members"}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx(Ii,{className:"w-5 h-5 text-slate-400"}),h.jsx("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:t.memberCount})]})]}),h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4",children:[h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mb-1",children:"Monthly Cost"}),h.jsxs("div",{className:"flex items-baseline gap-1",children:[h.jsxs("span",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:["$",(t.memberCount*t.pricePerMember).toFixed(2)]}),h.jsx("span",{className:"text-sm text-slate-500",children:"/month"})]}),h.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["$",t.pricePerMember,"/member"]})]})]}),e&&h.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[h.jsx("button",{disabled:!0,className:"w-full sm:w-auto px-6 py-3 bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 rounded-xl cursor-not-allowed",children:h.jsxs("span",{className:"flex items-center gap-2",children:[h.jsx(Iv,{className:"w-4 h-4"}),"Manage Payment Method"]})}),h.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"Stripe integration coming soon. Contact support for billing inquiries."})]})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl p-6",children:[h.jsx("h3",{className:"font-bold text-slate-900 dark:text-white mb-4",children:"Invoice History"}),h.jsxs("div",{className:"text-center py-8 text-slate-500 dark:text-slate-400",children:[h.jsx("p",{children:"No invoices yet"}),h.jsx("p",{className:"text-sm mt-1",children:"Invoices will appear here after your trial ends"})]})]})]})}const _O=({members:n,setMembers:e,teams:t,setTeams:s})=>{var En;const[i,r]=F.useState(""),[o,a]=F.useState(""),[c,d]=F.useState(""),[u,m]=F.useState(null),[p,y]=F.useState(""),[v,x]=F.useState([]),[b,w]=F.useState(!1),[S,A]=F.useState(!1),{isOffline:k}=nS(),T=Xe(K=>K.seasons),N=Xe(K=>K.currentSeasonId),I=Xe(K=>K.addSeason),D=Xe(K=>K.updateSeason),P=Xe(K=>K.deleteSeason),[R,j]=F.useState(""),[$,B]=F.useState(null),[V,L]=F.useState(""),[U,H]=F.useState(""),[J,Y]=F.useState(null),{isConfigured:re}=Cn(),xe=async K=>{if(!K.trim()||!z||!bn()||k){x([]);return}w(!0);try{const{data:ue,error:Te}=await z.from("users").select("id, email, full_name").or(`full_name.ilike.%${K}%,email.ilike.%${K}%`).limit(10);if(Te)throw Te;x(ue||[])}catch(ue){console.error("Error searching users:",ue),x([])}finally{w(!1)}};F.useEffect(()=>{if(!S||!p.trim()){x([]);return}const K=setTimeout(()=>{xe(p)},300);return()=>clearTimeout(K)},[p,S,k]);const _e=K=>{var zl;const ue=((zl=K.full_name)==null?void 0:zl.trim().split(/\s+/))||[K.email.split("@")[0]],Te=ue[0]||"User",tn=ue.length>1?ue[ue.length-1][0]:Te[0],Nt={id:K.id,firstName:Te,lastNameInitial:tn.toUpperCase()};e([...n,Nt]),y(""),x([]),A(!1)},M=()=>{if(i.trim()&&o.trim().length===1){const K={id:Date.now().toString(),firstName:i.trim(),lastNameInitial:o.trim().toUpperCase()};e([...n,K]),r(""),a("")}else alert("Please provide a First Name and a single letter Last Initial.")},O=K=>{e(n.filter(ue=>ue.id!==K)),s(t.map(ue=>({...ue,memberIds:ue.memberIds.filter(Te=>Te!==K)})))},q=()=>{if(c.trim()){const K={id:Date.now().toString(),name:c.trim(),memberIds:[]};s([...t,K]),d("")}},le=K=>{s(t.filter(ue=>ue.id!==K))},Se=(K,ue)=>{s(t.map(Te=>{if(Te.id!==K)return Te;const tn=Te.memberIds.includes(ue);return{...Te,memberIds:tn?Te.memberIds.filter(Nt=>Nt!==ue):[...Te.memberIds,ue]}}))};return h.jsxs("div",{className:"p-3 md:p-6 max-w-6xl mx-auto w-full h-full overflow-y-auto",children:[h.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-6",children:"Coaches Portal"}),re&&h.jsx("div",{className:"mb-6",children:h.jsx(vO,{})}),re&&h.jsx("div",{className:"mb-6",children:h.jsx(wO,{})}),h.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-8",children:[h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 md:p-6",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:[h.jsx(Ii,{className:"text-orange-600",size:24}),h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Team Roster"})]}),bn()&&!k&&h.jsxs("div",{className:"flex gap-2 mb-4",children:[h.jsxs("button",{onClick:()=>A(!1),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${S?"bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-400":"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400"}`,children:[h.jsx(wy,{size:16,className:"inline mr-2"}),"Manual Entry"]}),h.jsxs("button",{onClick:()=>A(!0),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${S?"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400":"bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-400"}`,children:[h.jsx(Qm,{size:16,className:"inline mr-2"}),"Find User"]})]}),bn()&&k&&h.jsxs("div",{className:"flex items-center gap-2 mb-4 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-amber-700 dark:text-amber-400 text-sm",children:[h.jsx($I,{size:16}),h.jsx("span",{children:"Search unavailable offline. Use manual entry below."})]}),S&&!k&&bn()?h.jsxs("div",{className:"mb-4",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 mb-1 block",children:"Search by name or email"}),h.jsxs("div",{className:"relative",children:[h.jsx("input",{type:"text",value:p,onChange:K=>y(K.target.value),placeholder:"Type a name or email...",className:"w-full p-2 pl-9 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white"}),h.jsx(Qm,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"}),p&&h.jsx("button",{onClick:()=>y(""),className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:h.jsx(Pi,{size:16})})]}),b&&h.jsx("div",{className:"mt-2 p-3 text-center text-slate-500 dark:text-slate-400 text-sm",children:"Searching..."}),!b&&v.length>0&&h.jsx("ul",{className:"mt-2 space-y-1 max-h-48 overflow-y-auto",children:v.map(K=>{var ue,Te;return h.jsxs("li",{onClick:()=>_e(K),className:"flex items-center gap-3 p-2 rounded-lg cursor-pointer hover:bg-orange-50 dark:hover:bg-orange-900/20 transition",children:[h.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center text-orange-600 dark:text-orange-400 font-bold text-xs",children:((Te=(ue=K.full_name)==null?void 0:ue[0])==null?void 0:Te.toUpperCase())||K.email[0].toUpperCase()}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-200 truncate",children:K.full_name||"No name"}),h.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 truncate",children:[h.jsx(f1,{size:10}),K.email]})]}),h.jsx(Ti,{size:18,className:"text-orange-600 dark:text-orange-400 flex-shrink-0"})]},K.id)})}),!b&&p&&v.length===0&&h.jsx("div",{className:"mt-2 p-3 text-center text-slate-500 dark:text-slate-400 text-sm",children:"No users found. Try a different search or use manual entry."})]}):h.jsxs("div",{className:"flex gap-2 mb-4 items-end",children:[h.jsxs("div",{className:"flex-1",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"First Name"}),h.jsx("input",{type:"text",value:i,onChange:K=>r(K.target.value),placeholder:"e.g. Abby",className:"w-full p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white"})]}),h.jsxs("div",{className:"w-20",children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400",children:"Last Init."}),h.jsx("input",{type:"text",value:o,maxLength:1,onChange:K=>a(K.target.value),placeholder:"B",className:"w-full p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white text-center",onKeyDown:K=>K.key==="Enter"&&M()})]}),h.jsx("button",{onClick:M,className:"bg-orange-600 text-white p-2.5 rounded-lg hover:bg-orange-700 transition mb-[1px]",children:h.jsx(wy,{size:20})})]}),n.length===0?h.jsxs("div",{className:"text-center py-8 px-4",children:[h.jsx(Ii,{size:40,className:"mx-auto mb-3 text-slate-300 dark:text-slate-600"}),h.jsx("h4",{className:"font-semibold text-slate-600 dark:text-slate-400 mb-2",children:"No team members yet"}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500",children:bn()&&!k?'Use "Find User" to search for existing accounts, or "Manual Entry" to add members by name.':"Add team members by entering their first name and last initial above."})]}):h.jsx("ul",{className:"space-y-2 max-h-96 overflow-y-auto pr-1 custom-scrollbar",children:n.map(K=>h.jsxs("li",{className:"flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg group hover:bg-slate-100 dark:hover:bg-slate-700 transition",children:[h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsxs("div",{className:"w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-600 flex items-center justify-center font-bold text-slate-600 dark:text-slate-300 text-xs",children:[K.firstName[0],K.lastNameInitial]}),h.jsxs("span",{className:"font-medium text-slate-700 dark:text-slate-200",children:[K.firstName," ",K.lastNameInitial,"."]})]}),h.jsx("button",{onClick:()=>O(K.id),className:"text-slate-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition",children:h.jsx(Ni,{size:18})})]},K.id))})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 md:p-6",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:[h.jsx(Rv,{className:"text-orange-600",size:24}),h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Sub-Teams & Assignments"})]}),h.jsxs("div",{className:"flex gap-2 mb-4",children:[h.jsx("input",{type:"text",value:c,onChange:K=>d(K.target.value),placeholder:"New Team Name (e.g. Pit Crew)",className:"flex-1 p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white",onKeyDown:K=>K.key==="Enter"&&q()}),h.jsx("button",{onClick:q,className:"bg-orange-600 text-white p-2 rounded-lg hover:bg-orange-700 transition",children:h.jsx(Ti,{size:20})})]}),t.length===0?h.jsxs("div",{className:"text-center py-8 px-4",children:[h.jsx(Rv,{size:40,className:"mx-auto mb-3 text-slate-300 dark:text-slate-600"}),h.jsx("h4",{className:"font-semibold text-slate-600 dark:text-slate-400 mb-2",children:"No sub-teams yet"}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-500",children:"Create sub-teams to organize your members by role (e.g., Pit Crew, Drivers, Build Team). Add a team using the form above, then assign members to it."})]}):h.jsx("div",{className:"space-y-4 max-h-[600px] overflow-y-auto pr-2",children:t.map(K=>h.jsxs("div",{className:"border border-slate-200 dark:border-slate-600 rounded-lg overflow-hidden",children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50",children:[h.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-200",children:K.name}),h.jsxs("div",{className:"flex gap-2 self-end sm:self-auto",children:[h.jsx("button",{onClick:()=>m(u===K.id?null:K.id),className:`text-xs px-3 py-1 rounded-full transition ${u===K.id?"bg-orange-100 text-orange-700":"bg-white dark:bg-slate-600 text-slate-600 dark:text-slate-300"}`,children:u===K.id?"Done":"Manage Members"}),h.jsx("button",{onClick:()=>le(K.id),className:"text-slate-400 hover:text-red-500",children:h.jsx(Ni,{size:18})})]})]}),h.jsx("div",{className:"p-3 bg-white dark:bg-slate-800",children:u===K.id?n.length===0?h.jsx("p",{className:"text-xs text-slate-400 italic",children:"Add members to your Team Roster first before assigning them to sub-teams."}):h.jsx("div",{className:"grid grid-cols-2 gap-2",children:n.map(ue=>h.jsxs("div",{onClick:()=>Se(K.id,ue.id),className:`cursor-pointer p-2 rounded border flex items-center justify-between text-sm ${K.memberIds.includes(ue.id)?"border-orange-500 bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300":"border-slate-200 dark:border-slate-600 text-slate-600 dark:text-slate-400"}`,children:[h.jsxs("span",{children:[ue.firstName," ",ue.lastNameInitial,"."]}),K.memberIds.includes(ue.id)&&h.jsx(Ei,{size:14})]},ue.id))}):h.jsxs("div",{className:"flex flex-wrap gap-2",children:[K.memberIds.length===0&&h.jsx("span",{className:"text-xs text-slate-400 italic",children:"No members assigned."}),K.memberIds.map(ue=>{const Te=n.find(tn=>tn.id===ue);return Te?h.jsxs("span",{className:"text-xs bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 px-2 py-1 rounded-full border border-slate-200 dark:border-slate-600",children:[Te.firstName," ",Te.lastNameInitial,"."]},ue):null})]})})]},K.id))})]})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-4 md:p-6 mt-6",children:[h.jsxs("div",{className:"flex items-center gap-2 mb-4 border-b border-slate-100 dark:border-slate-700 pb-2",children:[h.jsx(oS,{className:"text-orange-600",size:24}),h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Season Manager"})]}),h.jsxs("div",{className:"flex gap-2 mb-4",children:[h.jsx("input",{type:"text",value:R,onChange:K=>j(K.target.value),placeholder:"New Season Name (e.g. 2025-2026 Decode)",className:"flex-1 p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white",onKeyDown:K=>K.key==="Enter"&&R.trim()&&(I(R.trim()),j(""))}),h.jsx("button",{onClick:()=>{R.trim()&&(I(R.trim()),j(""))},className:"bg-orange-600 text-white p-2 rounded-lg hover:bg-orange-700 transition",children:h.jsx(Ti,{size:20})})]}),h.jsx("div",{className:"space-y-3",children:T.map(K=>h.jsxs("div",{className:`border rounded-lg overflow-hidden ${N===K.id?"border-orange-400 ring-2 ring-orange-200 dark:ring-orange-900/50":"border-slate-200 dark:border-slate-600"}`,children:[h.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[N===K.id&&h.jsx("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 px-2 py-0.5 rounded-full font-bold",children:"Active"}),h.jsx("h4",{className:"font-bold text-slate-700 dark:text-slate-200",children:K.name})]}),h.jsxs("div",{className:"flex gap-2 self-end sm:self-auto",children:[h.jsx("button",{onClick:()=>{$===K.id?B(null):(B(K.id),L(K.name),H(K.fieldImageUrl||""))},className:`text-xs px-3 py-1 rounded-full transition ${$===K.id?"bg-orange-100 text-orange-700":"bg-white dark:bg-slate-600 text-slate-600 dark:text-slate-300"}`,children:$===K.id?"Done":"Edit"}),T.length>1&&h.jsx("button",{onClick:()=>Y(K.id),className:"text-slate-400 hover:text-red-500",children:h.jsx(Ni,{size:18})})]})]}),$===K.id&&h.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 space-y-3",children:[h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 block mb-1",children:"Season Name"}),h.jsx("input",{type:"text",value:V,onChange:ue=>L(ue.target.value),onBlur:()=>V.trim()&&D(K.id,{name:V.trim()}),className:"w-full p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white"})]}),h.jsxs("div",{children:[h.jsx("label",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 block mb-1",children:"Field Image URL (for Match Planner)"}),h.jsx("input",{type:"text",value:U,onChange:ue=>H(ue.target.value),onBlur:()=>D(K.id,{fieldImageUrl:U}),placeholder:"https://example.com/field.png (1200x800 recommended)",className:"w-full p-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white text-sm"}),h.jsx("p",{className:"text-[10px] text-slate-400 mt-1",children:"Recommended dimensions: 1200Ã800 pixels (3:2 ratio)"})]})]})]},K.id))})]}),J&&h.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-6 max-w-md w-full shadow-2xl",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[h.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:h.jsx(Wg,{className:"text-red-600",size:24})}),h.jsx("h3",{className:"text-lg font-bold text-slate-800 dark:text-white",children:"Delete Season?"})]}),h.jsxs("p",{className:"text-slate-600 dark:text-slate-300 mb-2",children:[h.jsx("strong",{children:"Warning:"})," This will permanently delete the season ",h.jsxs("strong",{children:['"',(En=T.find(K=>K.id===J))==null?void 0:En.name,'"']})," and ALL associated data:"]}),h.jsxs("ul",{className:"text-sm text-slate-500 dark:text-slate-400 list-disc list-inside mb-4",children:[h.jsx("li",{children:"All tasks"}),h.jsx("li",{children:"All team members"}),h.jsx("li",{children:"All scouting reports"}),h.jsx("li",{children:"All match plans"}),h.jsx("li",{children:"All portfolio entries"})]}),h.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm font-medium mb-6",children:"This action cannot be undone."}),h.jsxs("div",{className:"flex justify-end gap-3",children:[h.jsx("button",{onClick:()=>Y(null),className:"px-4 py-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition",children:"Cancel"}),h.jsx("button",{onClick:()=>{P(J),Y(null)},className:"px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition",children:"Delete Season"})]})]})})]})};function AO({setActiveTab:n}){var w,S;const{user:e}=Cn(),{tasks:t,matchPlans:s,scoutingReports:i,currentSeasonId:r}=Xe(),o=t.filter(A=>!A.seasonId||A.seasonId===r),a=s.filter(A=>!A.seasonId||A.seasonId===r),c=i.filter(A=>!A.seasonId||A.seasonId===r),d=((S=(w=e==null?void 0:e.user_metadata)==null?void 0:w.full_name)==null?void 0:S.split(" ")[0])||"Team Member",u=o.filter(A=>A.status==="Done").length,m=["To Do","In Progress","Testing","Done"],p=o.filter(A=>m.includes(A.status)).length,y=o.filter(A=>A.status==="Backlog").length,v=[{label:"Sprint Progress",value:`${u} / ${p}`,icon:gh,color:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-900/20",link:"kanban"},{label:"Backlog Items",value:y,icon:mh,color:"text-purple-600",bg:"bg-purple-50 dark:bg-purple-900/20",link:"kanban"},{label:"Scouting Reports",value:c.length,icon:fh,color:"text-green-600",bg:"bg-green-50 dark:bg-green-900/20",link:"scouting"},{label:"Match Plans",value:a.length,icon:ph,color:"text-orange-600",bg:"bg-orange-50 dark:bg-orange-900/20",link:"planner"}],x=[{id:"kanban",label:"Sprint Planning",desc:"Track your team's progress",icon:mh,color:"bg-blue-500"},{id:"checklist",label:"Pre-Match Checklist",desc:"Always be competition ready",icon:gh,color:"bg-teal-500"},{id:"scouting",label:"Scouting Reports",desc:"Know your competition",icon:fh,color:"bg-green-500"},{id:"planner",label:"Match Planner",desc:"Plan with your allies",icon:ph,color:"bg-orange-500"},{id:"portfolio",label:"Portfolio Helper",desc:"Summarize your team's accomplishments",icon:Zm,color:"bg-pink-500"},{id:"judging",label:"Judging Prep",desc:"Be ready to answer any question",icon:Zm,color:"bg-purple-500"}],b=[...a.map(A=>({type:"plan",title:A.title,date:A.updatedAt,id:A.id})),...c.map(A=>({type:"scout",title:`Team ${A.teamNumber}`,date:Date.now(),id:A.id})),...o.slice(-5).map(A=>({type:"task",title:A.title,date:A.createdAt,id:A.id}))].sort((A,k)=>k.date-A.date).slice(0,5);return h.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[h.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-orange-600 to-orange-500 rounded-3xl p-8 text-white shadow-xl",children:[h.jsxs("div",{className:"relative z-10",children:[h.jsxs("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:["Welcome back, ",d,"! ð"]}),h.jsxs("p",{className:"text-orange-100 text-lg opacity-90 max-w-xl",children:["Your robotics Command Center is ready. You have ",o.filter(A=>["To Do","In Progress","Testing"].includes(A.status)).length," open tasks for this sprint."]})]}),h.jsx("div",{className:"absolute top-0 right-0 -mr-16 -mt-16 w-64 h-64 bg-white/10 rounded-full blur-3xl"}),h.jsx("div",{className:"absolute bottom-0 right-10 w-32 h-32 bg-orange-400/20 rounded-full blur-2xl"})]}),h.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:v.map((A,k)=>h.jsxs("div",{onClick:()=>n(A.link),className:"bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm cursor-pointer hover:shadow-md hover:border-orange-300 dark:hover:border-orange-600 transition-all",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[h.jsx("div",{className:`${A.bg} ${A.color} p-2 rounded-lg`,children:h.jsx(A.icon,{size:18})}),h.jsx("span",{className:"text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider",children:A.label})]}),h.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:A.value})]},k))}),h.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[h.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[h.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(k1,{size:20,className:"text-orange-500"}),"Quick Actions"]}),h.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:x.map((A,k)=>h.jsxs("button",{onClick:()=>n(A.id),className:"group relative bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md hover:border-orange-500/50 transition-all text-left overflow-hidden",children:[h.jsxs("div",{className:"relative z-10",children:[h.jsx("div",{className:`${A.color} text-white w-12 h-12 rounded-xl flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition-transform`,children:h.jsx(A.icon,{size:24})}),h.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-1",children:A.label}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:A.desc})]}),h.jsx(Nr,{className:"absolute top-6 right-6 text-slate-300 dark:text-slate-600 group-hover:text-orange-500 group-hover:translate-x-1 transition-all"}),h.jsx("div",{className:"absolute -bottom-4 -right-4 w-24 h-24 bg-slate-50 dark:bg-slate-700/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"})]},k))})]}),h.jsxs("div",{className:"space-y-4",children:[h.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[h.jsx(py,{size:20,className:"text-orange-500"}),"Recent Activity"]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden text-sm",children:[b.length>0?h.jsx("div",{className:"divide-y divide-slate-100 dark:divide-slate-700",children:b.map((A,k)=>h.jsxs("div",{className:"p-4 flex items-start gap-3 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer",onClick:()=>n(A.type==="plan"?"planner":A.type==="scout"?"scouting":"kanban"),children:[h.jsx("div",{className:`mt-1 w-2 h-2 rounded-full shrink-0 ${A.type==="plan"?"bg-orange-500":A.type==="scout"?"bg-green-500":"bg-blue-500"}`}),h.jsxs("div",{className:"flex-1 min-w-0",children:[h.jsxs("p",{className:"font-medium text-slate-900 dark:text-white truncate",children:[A.type==="plan"?"Match Plan: ":A.type==="scout"?"Scouting: ":"Task: ",A.title]}),h.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:new Date(A.date).toLocaleDateString()})]})]},k))}):h.jsxs("div",{className:"p-8 text-center",children:[h.jsx(MI,{className:"mx-auto text-slate-300 mb-2",size:32}),h.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"No activity yet. Start by adding a task or scouting report!"})]}),h.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 border-t border-slate-100 dark:border-slate-700",children:h.jsx("button",{onClick:()=>n("kanban"),className:"w-full text-center text-xs font-bold text-orange-600 dark:text-orange-400 hover:underline",children:"View all project updates"})})]})]})]})]})}function SO(){var v,x;const{user:n,updateProfile:e,isConfigured:t}=Cn(),{currentMembership:s}=Br(),[i,r]=F.useState(!1),[o,a]=F.useState(""),[c,d]=F.useState(!1),[u,m]=F.useState(null),p=async()=>{if(!o.trim())return;d(!0),m(null);const{error:b}=await e(o.trim());b?m({type:"error",text:b.message}):(m({type:"success",text:"Name updated successfully!"}),r(!1)),d(!1)};if(!t||!n)return h.jsx("div",{className:"p-3 md:p-6 max-w-2xl mx-auto",children:h.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 p-6 text-center",children:h.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"Please sign in to view your profile."})})});const y={owner:"Team Owner",coach:"Coach",mentor:"Mentor",student:"Student"};return h.jsxs("div",{className:"p-3 md:p-6 max-w-2xl mx-auto w-full h-full overflow-y-auto",children:[h.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-6",children:"Your Profile"}),u&&h.jsx("div",{className:`mb-6 p-4 rounded-xl text-sm ${u.type==="success"?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400 border border-red-200 dark:border-red-800"}`,children:u.text}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 overflow-hidden",children:[h.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-amber-500 p-6",children:h.jsxs("div",{className:"flex items-center gap-4",children:[h.jsx("div",{className:"w-20 h-20 rounded-full bg-white/20 flex items-center justify-center",children:h.jsx(Rr,{size:40,className:"text-white"})}),h.jsxs("div",{children:[h.jsx("h3",{className:"text-xl font-bold text-white",children:((v=n.user_metadata)==null?void 0:v.full_name)||"No name set"}),h.jsx("p",{className:"text-orange-100",children:n.email})]})]})}),h.jsxs("div",{className:"p-6 space-y-6",children:[h.jsxs("div",{children:[h.jsxs("label",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 flex items-center gap-2 mb-2",children:[h.jsx(Rr,{size:16}),"Display Name"]}),i?h.jsxs("div",{className:"flex gap-2 items-center",children:[h.jsx("input",{type:"text",value:o,onChange:b=>a(b.target.value),placeholder:"Enter your name",className:"flex-1 p-3 rounded-lg border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-white",onKeyDown:b=>b.key==="Enter"&&p(),autoFocus:!0}),h.jsx("button",{onClick:p,disabled:c||!o.trim(),className:"bg-orange-600 text-white p-3 rounded-lg hover:bg-orange-700 transition disabled:opacity-50",children:h.jsx(vy,{size:18})}),h.jsx("button",{onClick:()=>{r(!1),m(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 p-3",children:h.jsx(Pi,{size:18})})]}):h.jsxs("div",{className:"flex items-center justify-between",children:[h.jsx("p",{className:"text-lg text-slate-800 dark:text-white",children:((x=n.user_metadata)==null?void 0:x.full_name)||"Not set"}),h.jsx("button",{onClick:()=>{var b;a(((b=n.user_metadata)==null?void 0:b.full_name)||""),r(!0),m(null)},className:"px-4 py-2 text-sm font-medium text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition",children:"Edit Name"})]})]}),h.jsxs("div",{children:[h.jsxs("label",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 flex items-center gap-2 mb-2",children:[h.jsx(ku,{size:16}),"Email Address"]}),h.jsx("p",{className:"text-lg text-slate-800 dark:text-white",children:n.email}),h.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Email cannot be changed"})]}),s&&h.jsxs("div",{children:[h.jsxs("label",{className:"text-sm font-medium text-slate-500 dark:text-slate-400 flex items-center gap-2 mb-2",children:[h.jsx(ou,{size:16}),"Current Team Role"]}),h.jsx("p",{className:"text-lg text-slate-800 dark:text-white",children:y[s.role]||s.role})]})]})]})]})}function CO(){const{user:n}=Cn(),[e,t]=F.useState(null),[s,i]=F.useState(!0),[r,o]=F.useState("orgs"),[a,c]=F.useState([]),[d,u]=F.useState([]),[m,p]=F.useState([]),[y,v]=F.useState(""),[x,b]=F.useState(""),[w,S]=F.useState(null),[A,k]=F.useState([]);F.useEffect(()=>{T()},[n]);const T=async()=>{if(!z||!n){t(!1),i(!1);return}try{const L=z,{data:U,error:H}=await L.from("users").select("is_super_admin").eq("id",n.id).single();if(H)throw H;t((U==null?void 0:U.is_super_admin)||!1),U!=null&&U.is_super_admin&&N()}catch(L){console.error("Error checking super admin:",L),t(!1)}finally{i(!1)}},N=async()=>{await Promise.all([I(),D(),P()])},I=async()=>{if(z)try{const L=z,{data:U,error:H}=await L.from("organizations").select("*").order("created_at",{ascending:!1});if(H)throw H;const J=await Promise.all((U||[]).map(async Y=>{const{count:re}=await L.from("organization_members").select("*",{count:"exact",head:!0}).eq("organization_id",Y.id).eq("status","approved"),{data:xe}=await L.from("users").select("email").eq("id",Y.owner_user_id).single();return{...Y,member_count:re||0,owner_email:xe==null?void 0:xe.email}}));c(J)}catch(L){console.error("Error loading organizations:",L)}},D=async()=>{if(z)try{const L=z,{data:U,error:H}=await L.from("users").select("*").order("created_at",{ascending:!1});if(H)throw H;u(U||[])}catch(L){console.error("Error loading users:",L)}},P=async()=>{if(z)try{const L=z,{data:U,error:H}=await L.from("admin_audit_log").select("*").order("created_at",{ascending:!1}).limit(100);if(H)throw H;p(U||[])}catch(L){console.error("Error loading audit logs:",L)}},R=async L=>{if(z)try{const U=z,{data:H}=await U.from("organization_members").select("*").eq("organization_id",L),J=(H||[]).map(xe=>xe.user_id),{data:Y}=await U.from("users").select("id, email, full_name").in("id",J),re=Object.fromEntries((Y||[]).map(xe=>[xe.id,xe]));k((H||[]).map(xe=>({...xe,user:re[xe.user_id]})))}catch(U){console.error("Error loading org members:",U)}},j=L=>{alert(`Impersonation feature would log you in as user ${L}. This requires server-side implementation with secure session management.`)},$=async(L,U)=>{if(z)try{const H=z,{error:J}=await H.rpc("admin_transfer_ownership",{org_id:L,new_owner_id:U});if(J)throw J;await I(),alert("Ownership transferred successfully")}catch(H){console.error("Error transferring ownership:",H),alert("Error: "+H.message)}};if(s)return h.jsx("div",{className:"p-6 flex items-center justify-center",children:h.jsx(Wt,{className:"w-8 h-8 animate-spin text-orange-500"})});if(!e)return h.jsx("div",{className:"p-6 max-w-2xl mx-auto",children:h.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 text-center",children:[h.jsx(Wg,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),h.jsx("h2",{className:"text-xl font-bold text-red-700 dark:text-red-300 mb-2",children:"Access Denied"}),h.jsx("p",{className:"text-red-600 dark:text-red-400",children:"You do not have super admin privileges. This page is only accessible to administrators."})]})});const B=a.filter(L=>{var U,H;return L.name.toLowerCase().includes(y.toLowerCase())||((U=L.team_number)==null?void 0:U.includes(y))||((H=L.owner_email)==null?void 0:H.toLowerCase().includes(y.toLowerCase()))}),V=d.filter(L=>{var U;return L.email.toLowerCase().includes(x.toLowerCase())||((U=L.full_name)==null?void 0:U.toLowerCase().includes(x.toLowerCase()))});return h.jsxs("div",{className:"p-3 md:p-6 max-w-7xl mx-auto w-full h-full overflow-y-auto",children:[h.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[h.jsx("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center",children:h.jsx(ou,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),h.jsxs("div",{children:[h.jsx("h2",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"Super Admin Dashboard"}),h.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Manage all organizations and users"})]}),h.jsx("button",{onClick:N,className:"ml-auto p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white",children:h.jsx(zg,{className:"w-5 h-5"})})]}),h.jsxs("div",{className:"flex gap-2 mb-6 border-b border-slate-200 dark:border-slate-700",children:[h.jsxs("button",{onClick:()=>o("orgs"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${r==="orgs"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[h.jsx(yc,{className:"w-4 h-4 inline mr-2"}),"Organizations (",a.length,")"]}),h.jsxs("button",{onClick:()=>o("users"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${r==="users"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[h.jsx(Ii,{className:"w-4 h-4 inline mr-2"}),"Users (",d.length,")"]}),h.jsxs("button",{onClick:()=>o("audit"),className:`px-4 py-2 font-medium border-b-2 transition-colors ${r==="audit"?"border-purple-500 text-purple-600 dark:text-purple-400":"border-transparent text-slate-500 hover:text-slate-700"}`,children:[h.jsx(ru,{className:"w-4 h-4 inline mr-2"}),"Audit Log"]})]}),r==="orgs"&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"relative",children:[h.jsx(Qm,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",value:y,onChange:L=>v(L.target.value),placeholder:"Search organizations...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg"})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[B.map(L=>h.jsxs("div",{className:"border-b border-slate-100 dark:border-slate-700 last:border-0",children:[h.jsxs("div",{className:"p-4 flex items-center justify-between cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50",onClick:()=>{w===L.id?S(null):(S(L.id),R(L.id))},children:[h.jsxs("div",{className:"flex items-center gap-3",children:[w===L.id?h.jsx(iu,{className:"w-4 h-4 text-slate-400"}):h.jsx(aS,{className:"w-4 h-4 text-slate-400"}),h.jsxs("div",{children:[h.jsxs("p",{className:"font-medium text-slate-800 dark:text-white",children:[L.name,L.team_number&&h.jsxs("span",{className:"text-slate-500 ml-2",children:["#",L.team_number]})]}),h.jsxs("p",{className:"text-sm text-slate-500",children:["Owner: ",L.owner_email]})]})]}),h.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500",children:[h.jsxs("span",{children:[L.member_count," members"]}),h.jsx("span",{children:new Date(L.created_at).toLocaleDateString()})]})]}),w===L.id&&h.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 p-4 border-t border-slate-100 dark:border-slate-700",children:[h.jsx("h4",{className:"font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Members"}),h.jsx("div",{className:"space-y-2",children:A.map(U=>{var H,J;return h.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-slate-800 p-2 rounded-lg",children:[h.jsxs("div",{children:[h.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:((H=U.user)==null?void 0:H.full_name)||((J=U.user)==null?void 0:J.email)||U.user_id}),h.jsxs("p",{className:"text-xs text-slate-500",children:[U.role," â¢ ",U.status]})]}),h.jsxs("div",{className:"flex gap-2",children:[h.jsxs("button",{onClick:Y=>{Y.stopPropagation(),j(U.user_id)},className:"text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded",children:[h.jsx(xy,{className:"w-3 h-3 inline mr-1"}),"Impersonate"]}),U.role!=="owner"&&U.status==="approved"&&h.jsxs("button",{onClick:Y=>{var re;Y.stopPropagation(),confirm(`Transfer ownership to ${(re=U.user)==null?void 0:re.email}?`)&&$(L.id,U.user_id)},className:"text-xs px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded",children:[h.jsx(rm,{className:"w-3 h-3 inline mr-1"}),"Make Owner"]})]})]},U.id)})})]})]},L.id)),B.length===0&&h.jsx("div",{className:"p-8 text-center text-slate-500",children:"No organizations found"})]})]}),r==="users"&&h.jsxs("div",{className:"space-y-4",children:[h.jsxs("div",{className:"relative",children:[h.jsx(Qm,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),h.jsx("input",{type:"text",value:x,onChange:L=>b(L.target.value),placeholder:"Search users...",className:"w-full pl-10 pr-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg"})]}),h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[h.jsxs("table",{className:"w-full",children:[h.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:h.jsxs("tr",{children:[h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"User"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Email"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Created"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Actions"})]})}),h.jsx("tbody",{children:V.map(L=>h.jsxs("tr",{className:"border-t border-slate-100 dark:border-slate-700",children:[h.jsx("td",{className:"p-3",children:h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("p",{className:"font-medium text-slate-800 dark:text-white",children:L.full_name||"No name"}),L.is_super_admin&&h.jsx("span",{className:"text-xs px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded",children:"Admin"})]})}),h.jsx("td",{className:"p-3 text-sm text-slate-600 dark:text-slate-400",children:L.email}),h.jsx("td",{className:"p-3 text-sm text-slate-500",children:new Date(L.created_at).toLocaleDateString()}),h.jsx("td",{className:"p-3",children:h.jsxs("button",{onClick:()=>j(L.id),className:"text-xs px-2 py-1 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded",children:[h.jsx(xy,{className:"w-3 h-3 inline mr-1"}),"Impersonate"]})})]},L.id))})]}),V.length===0&&h.jsx("div",{className:"p-8 text-center text-slate-500",children:"No users found"})]})]}),r==="audit"&&h.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[h.jsxs("table",{className:"w-full",children:[h.jsx("thead",{className:"bg-slate-50 dark:bg-slate-900/50",children:h.jsxs("tr",{children:[h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Time"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Action"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Target"}),h.jsx("th",{className:"text-left p-3 text-sm font-medium text-slate-600 dark:text-slate-400",children:"Details"})]})}),h.jsx("tbody",{children:m.map(L=>{var U;return h.jsxs("tr",{className:"border-t border-slate-100 dark:border-slate-700",children:[h.jsx("td",{className:"p-3 text-sm text-slate-500",children:new Date(L.created_at).toLocaleString()}),h.jsx("td",{className:"p-3",children:h.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:L.action_type})}),h.jsxs("td",{className:"p-3 text-sm text-slate-600 dark:text-slate-400",children:[L.target_type,": ",(U=L.target_id)==null?void 0:U.substring(0,8),"..."]}),h.jsx("td",{className:"p-3 text-sm text-slate-500",children:h.jsx("button",{onClick:()=>alert(JSON.stringify(L.details,null,2)),className:"text-purple-500 hover:text-purple-600",children:h.jsx(gy,{className:"w-4 h-4"})})})]},L.id)})})]}),m.length===0&&h.jsx("div",{className:"p-8 text-center text-slate-500",children:"No audit logs yet"})]})]})}function mk(){var V;const[n,e]=F.useState("dashboard"),[t,s]=F.useState(!1),[i,r]=F.useState(!1),{user:o,signOut:a,isConfigured:c}=Cn(),{currentOrganization:d}=Br(),{tasks:u,members:m,teams:p,theme:y,setTheme:v,addTask:x,updateTask:b,deleteTask:w,setMembers:S,setTeams:A,seasons:k,currentSeasonId:T,setCurrentSeason:N}=Xe(),I=ub();F.useEffect(()=>{(async()=>{if(!o||!c){r(!1);return}try{const{supabase:U}=await sh(async()=>{const{supabase:J}=await Promise.resolve().then(()=>yT);return{supabase:J}},[]);if(!U)return;const{data:H}=await U.from("users").select("is_super_admin").eq("id",o.id).single();r((H==null?void 0:H.is_super_admin)||!1)}catch{r(!1)}})()},[o,c]);const D=u.filter(L=>!L.seasonId||L.seasonId===T),P=m.filter(L=>!L.seasonId||L.seasonId===T),R=p.filter(L=>!L.seasonId||L.seasonId===T),j=D.map(L=>({...L,timeline:L.timeline.map(U=>({...U,type:U.type}))})),$=async()=>{await a(),I("/login")},B=({id:L,label:U,icon:H})=>h.jsxs("button",{onClick:()=>{e(L),s(!1)},className:`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 mb-1
        ${n===L?"bg-orange-50 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 font-bold shadow-sm":"text-slate-500 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-slate-200 font-medium"}`,children:[h.jsx(H,{size:20}),h.jsx("span",{children:U})]});return h.jsxs("div",{className:"flex h-screen bg-slate-50 dark:bg-slate-900 font-sans overflow-hidden transition-colors duration-200",children:[h.jsxs("aside",{className:"hidden lg:flex w-64 flex-col bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 h-full",children:[h.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-slate-700 flex items-center gap-3",children:[h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-12 h-12 object-contain",alt:"FalconForge Logo"}),h.jsxs("h1",{className:"text-xl font-black italic tracking-tighter bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent drop-shadow-sm",children:["FALCON",h.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"FORGE"})]})]}),h.jsx("div",{className:"px-4 pt-3 pb-1",children:h.jsx(XI,{onCreateTeam:()=>e("createteam")})}),h.jsxs("div",{className:"px-4 pt-3",children:[h.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Season"}),h.jsxs("div",{className:"relative",children:[h.jsx("select",{value:T||"",onChange:L=>N(L.target.value),className:"w-full appearance-none bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-2 pr-8 text-sm font-medium text-slate-700 dark:text-slate-200 cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-600 transition",children:k.map(L=>h.jsx("option",{value:L.id,children:L.name},L.id))}),h.jsx(iu,{size:16,className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]}),h.jsxs("nav",{className:"flex-1 p-4 overflow-y-auto",children:[h.jsx(B,{id:"dashboard",label:"Dashboard",icon:mh}),h.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-700"}),h.jsx(B,{id:"kanban",label:"Sprint Planning",icon:py}),h.jsx(B,{id:"checklist",label:"Pre-Match Checklist",icon:gh}),h.jsx(B,{id:"scouting",label:"Scouting Reports",icon:fh}),h.jsx(B,{id:"planner",label:"Match Planner",icon:ph}),h.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-700"}),h.jsx(B,{id:"portfolio",label:"Portfolio Helper",icon:my}),h.jsx(B,{id:"judging",label:"Judging Prep",icon:yy}),h.jsx("div",{className:"my-4 border-t border-slate-100 dark:border-slate-700"}),h.jsx(B,{id:"profile",label:"Your Profile",icon:Rr}),h.jsx(B,{id:"admin",label:"Coaches Portal",icon:Lv}),i&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"my-4 border-t border-purple-200 dark:border-purple-800"}),h.jsx(B,{id:"superadmin",label:"Super Admin",icon:ou})]})]}),h.jsxs("div",{className:"p-4 border-t border-slate-100 dark:border-slate-700",children:[h.jsxs("div",{className:"bg-slate-100 dark:bg-slate-700 rounded-xl p-4",children:[h.jsxs("div",{className:"flex justify-between items-center mb-4",children:[h.jsx("p",{className:"text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase",children:"Appearance"}),h.jsx("button",{onClick:()=>v(y==="light"?"dark":"light"),className:"text-slate-500 dark:text-slate-400 hover:text-orange-600 dark:hover:text-orange-400",children:y==="light"?h.jsx(Dv,{size:16}):h.jsx(Fv,{size:16})})]}),h.jsxs("div",{className:"flex justify-between text-sm mb-1 text-slate-600 dark:text-slate-300",children:[h.jsx("span",{children:"Tasks Done"}),h.jsx("span",{className:"font-bold",children:D.filter(L=>L.status==="Done").length})]}),h.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-600 rounded-full h-1.5 mt-2",children:h.jsx("div",{className:"bg-green-500 h-1.5 rounded-full",style:{width:`${D.length>0?D.filter(L=>L.status==="Done").length/D.length*100:0}%`}})})]}),c&&o&&h.jsxs("div",{className:"mt-4 flex flex-col gap-2",children:[h.jsxs("div",{className:"flex items-center gap-3 p-3 bg-slate-50 dark:bg-slate-900/50 rounded-xl",children:[h.jsx("div",{className:"w-8 h-8 bg-orange-100 dark:bg-orange-900/50 rounded-full flex items-center justify-center",children:h.jsx(Rr,{size:16,className:"text-orange-600 dark:text-orange-400"})}),h.jsx("div",{className:"flex-1 min-w-0",children:h.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white truncate",children:((V=o.user_metadata)==null?void 0:V.full_name)||o.email})}),h.jsx("button",{onClick:$,className:"p-2 text-slate-400 hover:text-red-500 transition-colors",title:"Sign out",children:h.jsx(by,{size:16})})]}),h.jsx(jv,{variant:"full"})]})]})]}),h.jsxs("div",{className:"lg:hidden fixed top-0 left-0 right-0 h-16 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-4 z-20 safe-area-top",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-12 h-12 object-contain",alt:"FalconForge Logo"}),h.jsxs("span",{className:"font-black text-lg italic tracking-tighter",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"FORGE"})]})]}),h.jsxs("div",{className:"flex items-center gap-3",children:[h.jsx(jv,{variant:"icon"}),h.jsx("button",{onClick:()=>v(y==="light"?"dark":"light"),className:"text-slate-600 dark:text-slate-300",children:y==="light"?h.jsx(Dv,{size:20}):h.jsx(Fv,{size:20})}),h.jsx("button",{onClick:()=>s(!t),className:"p-2 text-slate-600 dark:text-slate-300",children:t?h.jsx(Pi,{}):h.jsx(oI,{})})]})]}),t&&h.jsxs("div",{className:"lg:hidden fixed inset-0 bg-white dark:bg-slate-800 z-50 pt-4 px-4 safe-area-top",children:[h.jsxs("div",{className:"flex items-center justify-between mb-6 px-2",children:[h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-10 h-10 object-contain",alt:"FalconForge Logo"}),h.jsxs("span",{className:"font-black text-xl italic tracking-tighter",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"FORGE"})]})]}),h.jsx("button",{onClick:()=>s(!1),className:"p-2 text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition flex items-center justify-center w-10 h-10",children:h.jsx(Pi,{size:24})})]}),d&&h.jsx("div",{className:"mb-4 px-2",children:h.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg",children:[h.jsx(yc,{size:14,className:"text-slate-500 dark:text-slate-400"}),h.jsx("span",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 truncate",children:d.name})]})}),h.jsxs("div",{className:"mb-4 px-2",children:[h.jsx("label",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 block",children:"Season"}),h.jsxs("div",{className:"relative",children:[h.jsx("select",{value:T||"",onChange:L=>N(L.target.value),className:"w-full appearance-none bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg px-3 py-2 pr-8 text-sm font-medium text-slate-700 dark:text-slate-200",children:k.map(L=>h.jsx("option",{value:L.id,children:L.name},L.id))}),h.jsx(iu,{size:16,className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none"})]})]}),h.jsxs("nav",{className:"space-y-2",children:[h.jsx(B,{id:"dashboard",label:"Dashboard",icon:mh}),h.jsx(B,{id:"kanban",label:"Sprint Planning",icon:py}),h.jsx(B,{id:"checklist",label:"Pre-Match Checklist",icon:gh}),h.jsx(B,{id:"scouting",label:"Scouting Reports",icon:fh}),h.jsx(B,{id:"planner",label:"Match Planner",icon:ph}),h.jsx(B,{id:"portfolio",label:"Portfolio Helper",icon:my}),h.jsx(B,{id:"judging",label:"Judging Prep",icon:yy}),h.jsx(B,{id:"profile",label:"Your Profile",icon:Rr}),h.jsx(B,{id:"admin",label:"Coaches Portal",icon:Lv}),i&&h.jsx(B,{id:"superadmin",label:"Super Admin",icon:ou})]}),c&&o&&h.jsx("div",{className:"mt-8 pt-4 border-t border-slate-200 dark:border-slate-700",children:h.jsxs("button",{onClick:$,className:"w-full flex items-center gap-3 px-4 py-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-all",children:[h.jsx(by,{size:20}),h.jsx("span",{className:"font-medium",children:"Sign Out"})]})})]}),h.jsx("main",{className:"flex-1 h-full overflow-hidden relative pt-16 lg:pt-0",children:h.jsxs("div",{className:"h-full w-full overflow-y-auto bg-slate-50 dark:bg-slate-900 p-4 lg:p-6",children:[n==="dashboard"&&h.jsx(AO,{setActiveTab:e}),n==="kanban"&&h.jsx(rP,{tasks:j,setTasks:L=>{let U=[];typeof L=="function"?U=L(j):U=L,U.forEach(J=>{D.find(re=>re.id===J.id)?b(J.id,J):x(J)});const H=new Set(U.map(J=>J.id));D.forEach(J=>{H.has(J.id)||w(J.id)})},members:P,teams:R}),n==="checklist"&&h.jsx(aP,{}),n==="scouting"&&h.jsx(oP,{}),n==="planner"&&h.jsx(lP,{}),n==="portfolio"&&h.jsx(V_,{tasks:j,view:"portfolio"}),n==="judging"&&h.jsx(V_,{tasks:j,view:"judging"}),n==="profile"&&h.jsx(SO,{}),n==="admin"&&h.jsx(_O,{members:P,setMembers:S,teams:R,setTeams:A}),n==="superadmin"&&h.jsx(CO,{}),n==="createteam"&&h.jsx("div",{className:"p-3 md:p-6 max-w-lg mx-auto",children:h.jsx(dS,{onComplete:()=>e("dashboard")})})]})})]})}function EO(){const{organizations:n,pendingOrganizations:e,isLoading:t}=Br();return t?h.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"text-center",children:[h.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-8",children:[h.jsx("div",{className:"absolute inset-0 bg-orange-500/20 rounded-3xl blur-xl animate-pulse"}),h.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl flex items-center justify-center border border-slate-700/50 shadow-2xl",children:h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-16 h-16 object-contain animate-pulse",alt:"FalconForge Logo"})})]}),h.jsxs("h2",{className:"text-xl font-black italic tracking-tighter",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-slate-300",children:"FORGE"})]}),h.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-400",children:[h.jsx("div",{className:"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"}),h.jsx("p",{className:"text-sm font-medium",children:"Loading your teams..."})]})]})}):n.length>0?h.jsx(mk,{}):e.length>0?h.jsx(YI,{}):h.jsx(dS,{})}function kO(){const{user:n,isLoading:e,isConfigured:t}=Cn(),{theme:s,initializeStore:i}=Xe();return F.useEffect(()=>{i(),sh(async()=>{const{setupSyncListeners:r}=await Promise.resolve().then(()=>$N);return{setupSyncListeners:r}},void 0).then(({setupSyncListeners:r})=>{const o=r(()=>{});return()=>o()})},[i]),F.useEffect(()=>{s==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s]),e?h.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"text-center",children:[h.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-8",children:[h.jsx("div",{className:"absolute inset-0 bg-orange-500/20 rounded-3xl blur-xl animate-pulse"}),h.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl flex items-center justify-center border border-slate-700/50 shadow-2xl",children:h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-16 h-16 object-contain animate-pulse",alt:"FalconForge Logo"})})]}),h.jsxs("h2",{className:"text-xl font-black italic tracking-tighter",children:[h.jsx("span",{className:"bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent",children:"FALCON"}),h.jsx("span",{className:"text-slate-300",children:"FORGE"})]}),h.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-400",children:[h.jsx("div",{className:"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"}),h.jsx("p",{className:"text-sm font-medium",children:"Preparing your workspace..."})]})]})}):h.jsxs(Rk,{children:[h.jsx(Vr,{path:"/join/:code",element:h.jsx(KI,{})}),h.jsx(Vr,{path:"/explore",element:h.jsx(JI,{})}),h.jsx(Vr,{path:"/terms",element:h.jsx(QI,{})}),h.jsx(Vr,{path:"/privacy",element:h.jsx(ZI,{})}),h.jsx(Vr,{path:"/parental-consent",element:h.jsx(eP,{})}),h.jsx(Vr,{path:"/login",element:!t||n?h.jsx(ev,{to:"/",replace:!0}):h.jsx(WI,{})}),h.jsx(Vr,{path:"/auth/callback",element:h.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center p-4",children:h.jsxs("div",{className:"text-center",children:[h.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-8",children:[h.jsx("div",{className:"absolute inset-0 bg-orange-500/20 rounded-3xl blur-xl animate-pulse"}),h.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl flex items-center justify-center border border-slate-700/50 shadow-2xl",children:h.jsx("img",{src:"/ftc-team-manager/falcon_logo.png",className:"w-16 h-16 object-contain animate-pulse",alt:"FalconForge Logo"})})]}),h.jsx("h2",{className:"text-xl font-bold text-white mb-2 tracking-tight",children:"Authenticating"}),h.jsxs("div",{className:"flex items-center justify-center gap-2 text-slate-400",children:[h.jsx("div",{className:"w-4 h-4 border-2 border-orange-500 border-t-transparent rounded-full animate-spin"}),h.jsx("p",{className:"text-sm font-medium",children:"Securing your session..."})]})]})})}),h.jsx(Vr,{path:"/*",element:t?n?h.jsx(EO,{}):h.jsx(ev,{to:"/login",replace:!0}):h.jsx(mk,{})})]})}const TO=new pT({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}}),gk=document.getElementById("root");if(!gk)throw new Error("Could not find root element to mount to");const NO=L0.createRoot(gk);NO.render(h.jsx(tA.StrictMode,{children:h.jsx(gT,{client:TO,children:h.jsx(Mk,{children:h.jsx(JN,{children:h.jsx(XN,{children:h.jsx(t1,{children:h.jsx(kO,{})})})})})})}));
//# sourceMappingURL=index-mQvPMs5u.js.map
